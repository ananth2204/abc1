/* REXX  */
/* THIS PROGRAM IS NOT FULLY COMMENTED                      */
/* A COMMENTS SHOULD BE VERY LIKELY AS IN CONSOLV PROGRAM   */

"EXECIO 1 DISKR INPDD1"
PARSE PULL COMMAND
"EXECIO 0 DISKR INPDD1 (FINIS"

"EXECIO 1 DISKR INPDD2"
PARSE PULL AUTHID
"EXECIO 0 DISKR INPDD2 (FINIS"

RET_CODE = 0
I = 0
DO WHILE RET_CODE <> 2
   /* READ ALL THREADS FROM INPDD3 CAPTURED BY CONSOLV3      */
   "EXECIO 1 DISKR INPDD3"
   IF RC = 2 THEN LEAVE
   RET_CODE = RC
   I = I + 1
   PARSE PULL CMDOUT.I
   /* AUTH = THE THREAD ORIGINAL AUTHORIZATION IDENTIFIER */
   /* DIST = THE THREAD PLANNAME                          */
   /* THD  = THE THREAD TOKEN IDENTIFIER                  */
   PARSE VAR CMDOUT.I W1 W2 W3 W4 W5 AUTH DIST W8 THD
   /* IF IT IS A DRDA CONNECTION */
   IF STRIP(DIST) = 'DISTSERV' THEN
      /* IF THREAD'S AUTHID REQUIRED OR IF KEYWORD SVI  */
      IF (STRIP(AUTH) = STRIP(AUTHID)) | (STRIP(AUTHID) = 'SVI') THEN
      DO
         /* FORM THE DB2 COMMAND */
         COMMANDI = "-"STRIP(COMMAND) "CANCEL THD("STRIP(THD)")"
         "CONSPROF SOLDISPLAY(NO) SOLNUM(400)"
         "CONSPROF UNSOLDISPLAY(NO) SOLNUM(400)"
         "CONSOLE ACTIVATE NAME(SYSCONEX)"
         CART_VAR = '000'C
         IF C > 9 THEN
            CART_VAR = '00'C
         CART = 'APPL'CART_VAR
         SAY 'CART='CART
         INTERPRET "'CONSOLE SYSCMD('COMMANDI') CART('"CART"')'"
         MESSAGE = 'F'
         MSG_STEM.0 = 0
         DO WHILE MESSAGE = 'F'
            INTERPRET 'MSG =' "GETMSG(''MSG_STEM.'',''SOL'','"CART"',,1)"
     /* INTERPRET 'MSG =' "GETMSG(''MSG_STEM.'',''SOL'','"CART"',,1)"*/
            SAY 'MSG' MSG
            IF MSG = 0  THEN
               LEAVE
            ELSE
            DO
               IF MSG = 4 THEN
                  LEAVE
               ELSE
                  ITERATE
            END
         END
         SAY 'IZVEDENA KOMANDA:' COMMANDI 'AUTHID = ' AUTH
         SAY '-----------------------------------------------------'
         DO I = 1 TO MSG_STEM.0
            SAY MSG_STEM.I
         END
         SAY ' '
         "CONSOLE DEACTIVATE"
         "CONSPROF SOLDISPLAY(YES)"
         "CONSPROF UNSOLDISPLAY(YES)"
         MSG_STEM.0 = 0
        END
END
EXIT 0
