OPMSUE08 TITLE 'VPS USER EXIT-08:   ERROR RETRY'                 JDM00
*---------------------------------------------------------------------*
*                                                                     *
*                            JIM MARSHALL, SOFTWARE "JANITOR"    JDM00*
*                            US OFFICE OF PERSONNEL MANAGEMENT   JDM00*
*                            CENTER FOR INFORMATION SERVICES/    JDM00*
*                                DATA CENTER GROUP               JDM00*
*                            1900 E STREET NW - ROOM BH04        JDM00*
*                            WASHINGTON DC  20415                JDM00*
*                            (W) 202-606-1261 (0700-1530ET)      JDM00*
*                            JIM.MARSHALL@OPM.GOV                JDM00*
*                                                                     *
*                                                                     *
*        VTAM PRINTER SUPPORT SYSTEM - VERSION 1, RELEASE 8.0         *
*                                                                     *
*        (C) COPYRIGHT - 1999, 2000                                   *
*                        LEVI, RAY & SHOUP, INC.                      *
*                        2401 WEST MONROE STREET                      *
*                        SPRINGFIELD, IL 62704                        *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*                                                                     *
*   MODULE NAME:    OPMSUE08 (MODIFIED VPSSUE08)                 JDM00*
*                                                                     *
*                                                                     *
*   EXIT NAME:      ERROR RETRY                                       *
*                                                                     *
*                                                                     *
*   EXIT TYPE:      PRINTER                                           *
*                                                                     *
*                                                                     *
*   EXIT TCB:       SYSTEM                                            *
*                                                                     *
*                                                                     *
*   RECOVERY:       EXITNN= KEYWORD DETERMINES RECOVERY ON/OFF        *
*                                                                     *
*                   RECOVERY ON:  EXIT WILL BE DISABLED               *
*                                                                     *
*                   RECOVERY OFF: VPS ADDRESS SPACE WILL TERMINATE    *
*                                                                     *
*                                                                     *
*   ATTRIBUTES:     REENTRANT, REUSEABLE, REFRESHABLE                 *
*                                                                     *
*                   PROBLEM STATE, KEY 8                              *
*                                                                     *
*                   AUTHORIZED                                        *
*                                                                     *
*                   AMODE=31 RMODE=31                                 *
*                                                                     *
*                                                                     *
*   FUNCTION:       THIS EXIT IS CALLED FOR PRINTERS IN AN 'EDRAINED' *
*                   STATUS PRIOR TO SEARCHING FOR NEW WORK.  VPS DOES *
*                   NOT REQUEST WORK FOR AN 'EDRAINED' PRINTER, BUT   *
*                   THIS EXIT CAN REQUEST THAT VPS CLEAR THE          *
*                   'EDRAINED' STATUS AND BEGIN SELECTING WORK FOR    *
*                   THE PRINTER.                                      *
*                                                                     *
*                                                                     *
*                                                                     *
*=====================================================================*
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*   FUNCTION:                                                         *
*                                                                     *
*   WHEN A PRINTER IS 'EDRAINED', VPS RECORDS A UNIQUE MAJOR/MINOR    *
*   CODE, REPRESENTING THAT PARTICULAR EDRAIN REASON, IN THE          *
*   PRINTER'S CONTROL BLOCK.  THE MAJOR/MINOR CODE IS PASSED TO THIS  *
*   EXIT IN FIELD 'PRECODE'.  MEMBER 'VPSSPRER' IN THE VPS MACRO      *
*   LIBRARY LISTS THE MAJOR/MINOR CODES FOR ALL OF THE POSSIBLE       *
*   EDRAIN REASONS.                                                   *
*                                                                     *
*   THIS EXIT CAN BE MODIFIED TO RETRY ANY OR ALL POSSIBLE EDRAIN     *
*   REASONS.  EACH TYPE OF EDRAIN ERROR TO BE RETRIED REQUIRES ONE    *
*   'ENTRY' IN A TABLE IN THIS PROGRAM LABELED 'ERRTABLE'.            *
*                                                                     *
*   AN ENTRY IN 'ERRTABLE' CONSISTS OF THESE VALUES:                  *
*       - THE MAJOR/MINOR CODE REPRESENTING THE PARTICULAR ERROR      *
*       - EIGHT BYTES RESERVED FOR FUTURE USE                         *
*       - THE NAME OF THE ROUTINE IN THIS PROGRAM WHICH IS TO HANDLE  *
*         THE ERROR (NORMALLY, 'STD', UNLESS YOU WANT TO PERFORM      *
*         FURTHER CHECKING OR SOME SPECIAL PROCESSING)                *
*       - THE INTERVAL AT WHICH TO RETRY                              *
*       - THE NUMBER OF TIMES TO RETRY                                *
*       - FLAGS INDICATING IF A MESSAGE SHOULD BE ISSUED WHEN THE     *
*         THE RETRY COUNT IS EXCEEDED, AND IF THE PRINTER SHOULD      *
*         BE INACTIVATED WHEN THE RETRY COUNT IS EXCEEDED             *
*       - ONE BYTE RESERVED FOR ALIGNMENT                             *
*                                                                     *
*   AN EXAMPLE OF A SINGLE ENTRY IS SHOWN HERE:                       *
*                                                                     *
* *----------------------------------------------------------------*  *
* * ENTRY FOR LOST TERMINAL                                        *  *
* *----------------------------------------------------------------*  *
*        DC    X'0010000F'     ERROR CODE:  MAJOR/MINOR.              *
*        DC    X'00000000'     RESERVED.                              *
*        DC    X'00000000'     RESERVED.                              *
*        DC    A(STD)          ROUTINE TO HANDLE ERROR.               *
*        DC    A(60*3)         INTERVAL BETWEEN RETRIES (180 SEC).    *
*        DC    H'3'            RETRY COUNT (3).                       *
*        DC    AL1($1WTO)      ISSUE WTO WHEN RETRIES EXHAUSTED.      *
*        DC    1X'00'          RESERVED.                              *
*                                                                     *
*   A RETRY INTERVAL SHOULD NOT BE SPECIFIED THAT IS SHORTER THAN     *
*   THE VALUE OF THE "INTERVAL" KEYWORD IN YOUR VPS INITIALIZATION    *
*   MEMBER.  THIS EXIT IS INVOKED EACH TIME THAT INTERVAL EXPIRES.    *
*                                                                     *
*   IF YOU SPECIFY A RETRY COUNT OF ZERO, THE ERROR WILL BE RETRIED   *
*   "FOREVER".                                                        *
*                                                                     *
*---------------------------------------------------------------------*
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*   FUNCTION: (CONTINUED)                                             *
*                                                                     *
*   THE SAMPLE EXIT, SUPPLIED BY LRS, CAN BE USED AS SUPPLIED TO      *
*   RECOVER FROM THE FOLLOWING ERRORS:                                *
*                                                                     *
*   - QPUT X37 DCB ABEND                                              *
*     THE PRIMARY AND DOUBLE THE SECONDARY ALLOCATION IS QUADRUPLED.  *
*                                                                     *
*   - SIMLOGON RC=10 F2=00 SNS=0000                                   *
*     LU IS NOT ACTIVE, BUT MAJOR NODE IS ACTIVE                      *
*                                                                     *
*   - SIMLOGON RC=14 F2=53 SNS=0000                                   *
*     LU IS NOT ACTIVE AND MAJOR NODE IS NOT ACTIVE                   *
*                                                                     *
*   - OPNDST RC=10 F2=01 SNS=080A                                     *
*     DEVICE POWERED OFF                                              *
*                                                                     *
*   - SESSION CLEANUP REQUESTED                                       *
*     VTAM HAS REQUESTED, VIA NSEXIT, THAT VPS CLEAN UP ITS END OF    *
*     A SESSION.                                                      *
*                                                                     *
*   - LOST TERMINAL                                                   *
*     VTAM HAS TOLD VPS THAT CONTACT WITH THE PRINTER LU HAS BEEN     *
*     LOST, AND THE PRINTER LU CANNOT BE RECOVERED.                   *
*                                                                     *
*   - APPCCMD ERROR                                                   *
*     VTAM HAS TOLD VPS THAT CONTACT WITH THE LU6.2 DEVICE INDICATED  *
*     AN ERROR CONDITION.                                             *
*                                                                     *
*   - TCPIP REQUEST FAILURE - CONNECTION FAILURE                      * VPSTCP
*     REMOTE HOST IS BUSY OR NOT AVAILABLE.                           * VPSTCP
*     REMOTE HOST CONNECTION ABORTED BY SOFTWARE.                     * VPS61088
*                                                                     *
*   - TCPIP CONNECTION REFUSED                                        * VPSTCP
*     TCPIP IS NOT CONNECTED FOR THE SYSTEM                           * VPSTCP
*     ICS DISCONNECT RECEIVED DURING CONNECT PROCESS                  * VPS62
*                                                                     *
*   - TCPIP CONNECTION TIMED OUT - TCPMRD INTERVAL EXPIRED            * VPS61088
*     NO RESPONSE RECEIVED DURING TIME INTERVAL DEFINED FOR PRINTER   * VPS61088
*                                                                     *
*---------------------------------------------------------------------*
          EJECT
*---------------------------------------------------------------------*
*                                                                     *
*   FUNCTION: (CONTINUED)                                             *
*                                                                     *
*   THE PRINTER USER AREA IS NOT USED.                                *
*                                                                     *
*   THIS EXIT CHECKS THAT THE REQUEST CODE PASSED TO THE EXIT IS 0.   *
*   NO OTHER REQUEST CODES ARE CURRENTLY IN USE.                      *
*                                                                     *
*   NOTES:                                                            *
*                                                                     *
*   - THIS EXIT RUNS UNDER THE VPS DISPATCHER SYSTEM TCB.  THEREFORE, *
*     THIS EXIT MUST NOT INVOKE ANY SERVICE THAT WILL PLACE THIS TASK *
*     IN A WAIT STATE.                                                *
*                                                                     *
*   - ANY RESOURCE(S) ACQUIRED BY THIS EXIT MUST ALSO BE RELEASED     *
*     PRIOR TO RETURNING TO VPS.                                      *
*                                                                     *
*   - THE ERROR RETRY COUNT, PASSED IN THE PRINTER ERROR DSECT        *
*     (VPSSPRER), IS THE NUMBER OF TIMES THIS EXIT RETRIED AN ERROR   *
*     FOR THE CURRENT JOB.                                            *
*                                                                     *
*   - IF MORE THAN 1 ERROR OCCURS BETWEEN INVOCATIONS OF THIS EXIT,   *
*     THE ERROR DATA PASSED DESCRIBES THE LAST ERROR.                 *
*                                                                     *
*---------------------------------------------------------------------*
          EJECT
*---------------------------------------------------------------------*
*                                                                     *
*   REGISTER USAGE:                                                   *
*                                                                     *
*      ON ENTRY:                                                      *
*         R0 ==>  REQUEST CODE (ALWAYS 00).                           *
*         R1 ==>  ADDRESS OF PARAMETER LIST.                          *
*        R13 ==>  ADDRESS OF CALLERS SAVEAREA.                        *
*        R14 ==>  RETURN ADDRESS.                                     *
*        R15 ==>  ENTRY ADDRESS.                                      *
*                                                                     *
*      DURING EXECUTION:                                              *
*      R0-R1 ==>  VOLATILE.                                           *
*         R2 ==>  NOT USED.                                           *
*         R3 ==>  MODULE REQUEST CODE.                                *
*         R4 ==>  MODULE PARAMETER LIST ADDRESS.                      *
*         R5 ==>  SYSTEM  ATTRIBUTE BASE REGISTER.                    *
*         R6 ==>  TWO WORD WORKAREA.                                  *
*         R7 ==>  PRINTER ATTRIBUTE BASE REGISTER.                    *
*         R8 ==>  PRINTER ERROR ATTRIBUTE BASE REGISTER.              *
*         R9 ==>  NOT USED.                                           *
*        R10 ==>  VOLATILE.                                           *
*        R11 ==>  NOT USED.                                           *
*        R12 ==>  PROGRAM BASE REGISTER.                              *
*        R13 ==>  MODULE WORKAREA BASE REGISTER.                      *
*    R14-R15 ==>  VOLATILE.                                           *
*                                                                     *
*      ON EXIT:                                                       *
*         ALL REGISTERS WILL BE RESTORED TO ENTRY CONDITIONS, EXCEPT  *
*      R15, WHICH WILL CONTAIN THE RETURN CODE.                       *
*                                                                     *
*---------------------------------------------------------------------*
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*   PARAMETER LIST FORMAT:                                            *
*                                                                     *
*      A(SYSTEM ATTRIBUTES)  - MAPPING MACRO: VPSSSYAT                *
*      A(USER WORKAREA)      - MAPPING MACRO: N/A                     *
*      A(PRINTER ATTRIBUTES) - MAPPING MACRO: VPSSPRAT                *
*      A(PRINTER ERROR INFO) - MAPPING MACRO: VPSSPRER                *
*                                                                     *
*      THE HIGH ORDER BIT OF THE LAST ADDRESS PARAMETER WILL BE SET   *
*      TO 1.                                                          *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*   RETURN CODES:                                                     *
*                                                                     *
*      00 - REQUEST VPS TO RETRY THE ERROR.                           *
*                                                                     *
*      04 - REQUEST VPS TO IGNORE THE ERROR.  THE PRINTER REMAINS     *
*           ERROR DRAINED, AND VPS WILL INVOKE THIS EXIT AGAIN.       *
*                                                                     *
*      08 - REQUEST VPS TO IGNORE THE ERROR.  THE PRINTER REMAINS     *
*           ERROR DRAINED, AND VPS WILL NOT INVOKE THIS EXIT AGAIN.   *
*                                                                     *
*      12 - REQUEST VPS TO INACTIVATE THE PRINTER.                    *
*                                                                     *
*      16 - REQUEST VPS TO INACTIVATE THE PRINTER AND PURGE THE       *
*           PRINTER'S OUTPUT FROM THE JES SPOOL.                      *
*                                                                     *
* CHANGE LOG:                                                         *
*                                                                     *
*      JDM00 - 02/09/1996 - ESTABLISH FMS VERSION OF EXIT AS     JDM00*
*              VPS$X05. CHANGE LOG IS ALSO UNDER THIS MOD.       JDM00*
*      JDM01 - 02/09/96 - CHANGE "X37" RECOVERY SO WE RETRY      JDM00*
*              THE ABEND BY INCREASING THE PRIMARY BY 2          JDM00*
*              (NOT 4), AND THE SECONDARY BY 4 (NOT 2).          JDM00*
*      JDM02 - 02/09/96 - CHANGE WTO ROUTCDE FROM 1 TO 3. WANT   JDM00*
*              IT IN THE SYSLOG AND NO NEED TO HIGHLIGHT AND     JDM00*
*              NON-ROLLABLE.                                     JDM00*
*      JDM03 - 02/09/96 - FOR ALL NETWORK RELATED ERRORS,        JDM00*
*              INDICATE WE RETRY FOREVER.                        JDM00*
*      JDM04 - 05/22/97 - INCLUDE TCP/IP PRTERS FOR ERROR RETRY. JDM00*
*      JDM05 - 06/03/97 - LIMIT RETRIES FOR A CERTAIN ERROR.     JDM00*
*                         RC=10  FC=01 SNS=08450000              JDM00*
*      JDM06 - 10/24/97 - ADD RETRIES FOR "CONNECTION RESET      JDM00*
*                         BY PEER"                               JDM00*
*      JDM07 - 03/23/99 - UPDATE VARIOUS RETRY TIMES.            JDM00*
*              NOTE: 6.2, VMCF, PRINTER LIST, ENTER "P", AND     JDM00*
*                    MAJOR/MINOR CODES WILL BE AT 3FA AND 3FC    JDM00*
*---------------------------------------------------------------------*
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*        V P S $ X 0 8     E N T R Y                             JDM00*
*                                                                     *
*---------------------------------------------------------------------*
OPMSUE08 CSECT                                                   JDM00
OPMSUE08 AMODE ANY                                               JDM00
OPMSUE08 RMODE ANY                                               JDM00
         B     28(,R15)
         DC    CL8'OPMSUE08 ',CL8'&SYSDATE',CL8'&SYSTIME'        JDM00
         BAKR  R14,R0                  SAVE REGISTERS.                  VPS80
         LR    R12,R15                 LOAD PROGRAM BASE REGISTER.
         USING OPMSUE08,R12            ESTABLISH PGM BASE REG    JDM00
         LR    R3,R0                   SAVE REQUEST CODE.               VPS80
         LR    R4,R1                   SAVE PARM LIST ADDRESS.          VPS80
         LM    R5,R8,0(R4)             LOAD PARAMETER REGISTERS.        VPS80
         USING SYADSECT,R5             ESTABLISH SYAT ADDRESSABILITY.
         USING PRADSECT,R7             ESTABLISH PRAT ADDRESSABILITY.
         USING PREDSECT,R8             ESTABLISH PRER ADDRESSABILITY.
         SPACE
         $$VPSERV REQUEST=GETMAIN,                                     XVPS80
               LV=UE08DSLN,                                            XVPS80
               SYAT=YES,                                               XVPS80
               MF=S                                                     VPS80
         SPACE
         LR    R13,R1                  LOAD WORKAREA BASE REGISTER.
         MVC   4(4,R13),=CL4'F1SA'     LINKAGE STACK INDICATOR.         VPS80
         USING UE08DSCT,R13            ESTABLISH MAP FOR WORKAREA.
         EJECT
*---------------------------------------------------------------------*
*        EXAMINE REQUEST CODE                                         *
*---------------------------------------------------------------------*
         ST    R3,UE08REQ              SAVE REQUEST CODE.               VPS80
         ST    R4,UE08PLST             SAVE PARAMETER LIST ADDRESS.     VPS80
         LTR   R0,R3                   EXPECTED REQUEST CODE?           VPS80
         BNZ   UXITRC04                NO, EXIT WITH RETURN CODE = 04.
         SPACE
*---------------------------------------------------------------------*
*        SCAN TABLE TO SEE IF ERROR SHOULD BE RETRIED                 *
*---------------------------------------------------------------------*
         LA    R10,ERRTABLE            GET ERROR TABLE ADDRESS.
         USING TABLE,R10               ESTABLISH ERRTAB ADDRESSABILITY.
         SPACE
UXIT005  DS    0H                      ********************************
         CLI   TABCODE,X'FF'           END OF TABLE?
         BE    UXIT005A                YES, EXIT WITH RC=08.     JDM03
         CLC   TABCODE,PRECODE         MAJOR/MINOR CODE IN TABLE?
         BE    UXIT010                 YES, GO PROCESS ERROR.
         LA    R10,TABLEN(,R10)        POINT TO NEXT ENTRY IN TABLE.
         B     UXIT005                 GO CHECK NEXT ENTRY.
         SPACE
*----------------------------------------------------------------JDM03*
*        MAKE ONE MORE LOOK FOR ONLY NETWORK RELATED ERRORS      JDM03*
*----------------------------------------------------------------JDM03*
         SPACE 1                                                 JDM03
UXIT005A EQU   *                                                 JDM03
         LA    R10,NETERROR            ONE MORE ERROR TO CHECK   JDM03
         CLC   TABCODE(2),PRECODE      MAJOR CODE IN TABLE?      JDM03
         BE    UXIT010                 YES, GO PROCESS ERROR     JDM03
         B     UXITRC08                EXIT WITH RC=08.          JDM03
         SPACE 1                                                 JDM03
UXIT010  DS    0H                      ********************************
         L     R15,TABADDR             LOAD ERROR ROUTINE ADDRESS.
         BR    R15                     GO TO ERROR HANDLER.
         TITLE 'SPECFIC ERROR ROUTINES'
*---------------------------------------------------------------------*
*                                                                     *
*        SPECIFIC ERROR ROUTINES                                      *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*   THESE ROUTINES LOOK FOR THE FOLLOWING:                            *
*                                                                     *
*   FOR ERROR CODE 0010.0001   (SIMLOGON FAILURE)                     *
*   - RPL RC/F2 OF 10/00       (LU NOT ACTIVE)                        *
*   - RPL RC/F2 OF 14/53       (LU NOT DEFINED)                       *
*                                                                     *
*   FOR ERROR CODE 0010.000C   (OPNDST FAILURE)                       *
*   - RPL RC/F2 OF 10/01                                              *
*      WITH SNA SENSE 080A     (POWERED OFF)                          *
*                              (NON-CONTACT)                     JDM05*
*                                                                     *
*   FOR ERROR CODE 0010.0025   (APPCCMD FAILURE - LU6.2 DEVICE)       * VPS61
*   - RCPRI/RCSEC OF 0004/0000 (ALLOCATION ERROR - LU NOT ACTIVE)     * VPS61
*   - RCPRI/RCSEC OF 0004/0001 (ALLOCATION ERROR - RETRY ALLOWED)     * VPS61
*   - RCPRI/RCSEC OF 0020/0000 (CNOS FAILURE - RETRY ALLOWED)         * VPS61
*   - RCPRI/RCSEC OF 0048/0000 (RESOURCE FAILURE)                     * VPS61
*   - RCPRI/RCSEC OF 0088/0000 (ABNORMAL DEALLOCATION)                * VPS61
*                                                                     *
*   FOR ERROR CODE 0010.0102   (TCPIP REQUEST FAILURE)                * VPSTCP
*   - 2ND ANS WORD OF 00000030 (ADDRESS IN USE)                       * VPSTCP
*   - 2ND ANS WORD OF 00000035 (CONNECTION ABORTED BY SOFTWARE)       * VPS61088
*   - 2ND ANS WORD OF 0000003D (CONNECTION REFUSED)                   * VPSTCP
*                                                                     *
*   IF THE ERROR IS IDENTIFIED, GO TO STANDARD ERROR RECOVERY         *
*                                                                     *
*---------------------------------------------------------------------*
*        SIMLOGON FAILURE                                             *
*---------------------------------------------------------------------*
E1001    DS    0H                      ********************************
         CLC   PREVARY+2(2),=X'1000'   LU NOT ACTIVE?
         BE    STD                     PROCESS AS STANDARD ERROR.
         CLC   PREVARY+2(2),=X'1453'   LU NOT DEFINED?
         BE    STD                     PROCESS AS STANDARD ERROR.
         B     UXITRC08                EXIT WITH RC=08.
         SPACE
*---------------------------------------------------------------------*
*        OPNDST FAILURE                                               *
*---------------------------------------------------------------------*
E100C    DS    0H                      ********************************
         CLC   PREVARY+2(4),=X'1001080A' POWERED OFF?
         BE    STD                       PROCESS AS STANDARD ERROR.
         B     UXITRC08                  EXIT WITH RC=08.
E1025    DS    0H                      ******************************** VPS61
         CLC   PREVARY+4(4),=X'00040000' ALLOCATION ERROR/NOT ACTIVE?   VPS61
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61
         CLC   PREVARY+4(4),=X'00040001' ALLOCATION ERR/RETRY ALLOWED?  VPS61
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61
         CLC   PREVARY+4(4),=X'00200000' CNOS FAILED/RETRY ALLOWED?     VPS61
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61
         CLC   PREVARY+4(4),=X'00480000' RESOURCE FAILURE?              VPS61
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61
         CLC   PREVARY+4(4),=X'00880000' ABNORMAL DEALLOCATION?         VPS61
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61
         B     UXITRC08                  EXIT WITH RC=08.
         SPACE
*----------------------------------------------------------------JDM06*
*        REFINE THE LIST BELOW AND ALSO DOCUMENT THE EXISTING    JDM06
*        ERRORS AS FAR AS TCP/IP NUMBER.  PLUS ADD A FEW.        JDM06
*----------------------------------------------------------------JDM06*
E10102   DS    0H                      ******************************** VPSTCP
         CLC   PREVARY(4),=A(TPEADRNU) 48ADDRESS ALREADY IN USE?        VPSTCP
         BE    STD                       PROCESS AS STANDARD ERROR.     VPSTCP
         CLC   PREVARY(4),=A(TPENETUR) 51NETWORK UNREACHABLE     JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPENETRS) 52NETWORK DROPPED CON     JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPECONAB) 53CONNECTION ABORT BY SOFTWARE?  VPS61088
         BE    STD                       PROCESS AS STANDARD ERROR.     VPS61088
         CLC   PREVARY(4),=A(TPECONRS) 54CON RESET BY PEER.      JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPEISCON) 56SOCKET ALREADY CONNECT  JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPETIMEO) 60CONNECTION TIMED OUT.   JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPECONRF) 61CONNECTION REFUSED?            VPSTCP
         BE    STD                       PROCESS AS STANDARD ERROR.     VPSTCP
         CLC   PREVARY(4),=A(TPEHSTDN) 64HOST IS DOWN.           JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         CLC   PREVARY(4),=A(TPEHSTUR) 65NO ROUTE TO HOST        JDM06
         BE    STD                       PROCESS AS STD ERROR.   JDM06
         B     UXITRC08                  EXIT WITH RC=08.               VPSTCP
         SPACE
         TITLE 'EX37 - ERROR ROUTINE FOR DCB ABEND X37'
*---------------------------------------------------------------------*
*                                                                     *
*        QPUT DCB ABEND (X37 ONLY)                                    *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*   IF PRINTER TASK ABENDED WITH AN X37 ABEND, BOTH THE PRIMARY AND   *
*   SECONDARY SPACE ALLOCATIONS WILL BE INCREASED, AND THE ERROR WILL *
*   BE RETRIED.  THE PRIMARY ALLOCATION IS MULTIPLIED BY 4 AND THE    *
*   SECONDARY ALLOCATION BY 2.  THE ERROR WILL BE RETRIED ONLY ONCE.  *
*                                                                     *
*   THE USER COULD CONTINUE INCREASING THE ALLOCATION QUANTITIES IF   *
*   DESIRED BY MODIFYING THE FOLLOWING CODE.                          *
*                                                                     *
*   NOTE:  THIS CODE WILL BE DRIVEN THE FIRST TIME THE "INTERVAL"     *
*   EXPIRES AFTER THE PRINTER IS EDRAINED.  THE RETRY INTERVAL IS     *
*   NOT TESTED IN THIS CODE, BUT IT COULD BE MODIFIED TO DO SO.       *
*                                                                     *
*---------------------------------------------------------------------*
EX37     DS    0H                      ********************************
         XR    R0,R0                   CLEAR REGISTER TO INSERT...
         ICM   R0,B'0111',PREVARY         ABEND CODE (EG. D37004).
         SLL   R0,4                    SHIFT OFF HIGHEST DIGIT.
         CLM   R0,B'0100',=X'37'       IS THIS AN X37 ABEND?
         BNE   UXITRC08                NO, DO NOT RETRY THIS ERROR.
         SPACE
         XR    R0,R0                   CLEAR RREGISTER TO INSERT...
         ICM   R0,B'0011',PRECOUNT        RETRY COUNT.
         BNZ   UXITRC08                ALREADY RETRIED, BYPASS.
         EJECT
*---------------------------------------------------------------------*
*        INQUIRE FOR PRIMARY AND SECONDARY ALLOCATION QUANTITIES      *
*---------------------------------------------------------------------*
         MVC   UE08CBM(UE08CBML),CBMLIST INITIALIZE $$CBINQ PARM LIST.
         SPACE
         $$CBINQ QSPACE=(UE08QTYP,UE08QPRI,UE08QSEC),                  *
               SYAT=YES,                                               *VPS80
               TYPE=PRINTER,MF=(E,UE08CBM)
         SPACE
         LTR   R15,R15                 INQUIRE SUCCESSFUL?
         BNZ   UXITRC08                NO, DO NOT RETRY THE ERROR.
         SPACE
         XR    R0,R0                   CLEAR REGISTER TO...
         ICM   R0,B'0011',UE08QPRI        INSERT Q-PRIMARY QUANTITY.
         SLL   R0,1                    MULTIPLY IT BY 2.         JDM01
         STCM  R0,B'0011',UE08QPRI     RESTORE NEW Q-PRIMARY QUANTITY.
         SPACE
         XR    R0,R0                   CLEAR REGISTER TO...
         ICM   R0,B'0011',UE08QSEC        INSERT Q-SECONDARY QUANTITY.
         BNZ   *+8                     IF NOT ZERO, USE IT.
         LA    R0,1                    FORCE TO 1 BEFORE DOUBLE.
         SLL   R0,2                    MULTIPLY IT BY 4.         JDM01
         STCM  R0,B'0011',UE08QSEC     RESTORE NEW Q-SECONARY QUANTITY.
         EJECT
*---------------------------------------------------------------------*
*        SET NEW PRIMARY AND SECONDARY ALLOCATION QUANTITIES          *
*---------------------------------------------------------------------*
         MVC   UE08CBM(UE08CBML),CBMLIST INITIALIZE $$CBSET PARM LIST.
         SPACE
         $$CBSET QSPACE=(UE08QTYP,UE08QPRI,UE08QSEC),SYAT=YES,         *VPS80
               MF=(E,UE08CBM)
         SPACE
         LTR   R15,R15                 $$CBSET SUCCESSFUL?
         BNZ   UXITRC08                NO, DO NOT RETRY THE ERROR.
         B     UXITRC00                GO RETRY WITH NEW ALLOCATIONS.
         TITLE 'STD - STANDARD ERROR HANDLER'
*---------------------------------------------------------------------*
*                                                                     *
*        STD - STANDARD ERROR HANDLER                                 *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*   ENTRY TO THIS ROUTINE CAN BE FROM NORMAL TABLE SCAN OR FROM       *
*     OTHER ERROR HANDLERS.                                           *
*                                                                     *
*   THIS ROUTINE WILL TREAT THE ERRORS AS FOLLOWS:                    *
*   - CHECK FOR RETRIES EXHAUSTED                                     *
*     IF YES, ISSUE MESSAGE IF REQUESTED ($1WTO   )                   *
*             IF INACT REQUESTED($1INACT), SET RC=12                  *
*              ELSE, SET RC=08.                                       *
*   - CHECK IF WAIT INTERVAL HAS EXPIRED                              *
*     IF NO,  SET RC=04                                               *
*     IF YES, SET RC=00                                               *
*                                                                     *
*   NOTES:                                                            *
*   - A RETRY COUNT OF ZEROS INDICATES RETRY FOREVER.                 *
*                                                                     *
*---------------------------------------------------------------------*
STD      DS    0H                      ********************************
         CLC   TABRCNT,=H'0'           RETRY FOREVER?
         BE    STD010                  YES, BRANCH
         CLC   PRECOUNT,TABRCNT        ALL RETRIES USED?
         BL    STD010                  NO,  BRANCH
         EJECT
*---------------------------------------------------------------------*
*                                                                     *
*        NO MORE RETRIES                                              *
*                                                                     *
*---------------------------------------------------------------------*
*        - ISSUE MESSAGE IF REQUESTED                                 *
*        - REQUEST INACT IF REQUESTED                                 *
*        - SET RC=08                                                  *
*---------------------------------------------------------------------*
         TM    TABFLG1,$1WTO           ISSUE MESSAGE?
         BZ    STD005                  NO, CONTINUE.
         SPACE
*---------------------------------------------------------------------* VPS80
*        INITIALIZE WTO WORKAREA FOR $$VPSERV                         * VPS80
*---------------------------------------------------------------------* VPS80
         LA    R14,UE08WTAT            GET ADDRESS OF WTAT WORKAREA.    VPS80
         USING WTADSECT,R14            ESTABLISH WTAT ADDRESSABILITY.   VPS80
         OI    WTATYPE,WTATNOR         SET NORMAL MESSAGE TYPE.         VPS80
         MVC   WTAMSGID,=AL2(2008)     SET MESSAGE ID TO 2008.          VPS80
         MVI   WTATEXT,C' '            SET MESSAGE TEXT AREA...         VPS80
         MVC   WTATEXT+1(L'WTATEXT-1),WTATEXT   TO BLANKS.              VPS80
         SPACE                                                          VPS80
         LA    R1,L'WTOTEXT            LOAD LENGTH OF MESSAGE TEXT.     VPS80
         STCM  R1,B'0011',WTALGTH      SET LENGTH OF MESSAGE TEXT.      VPS80
         MVC   WTATEXT(L'WTOTEXT),WTOTEXT  INITIALIZE MESSAGE TEXT.     VPS80
         MVC   WTATEXT+09(8),SYASTCNM  MOVE IN VPS STC NAME.            VPS80
         MVC   WTATEXT+18(8),PRATNAME  MOVE IN LUNAME.                  VPS80
         DROP  R14                     DROP WTAT ADDRESSABILITY.        VPS80
         SPACE                                                          VPS80
         $$VPSERV REQUEST=WTO,                                         XVPS80
               WTOAREA=UE08WTAT,                                       XVPS80
               SYAT=YES,                                               XVPS80
               MF=(E,UE08SERV)                                          VPS80
         SPACE
STD005   DS    0H                      ********************************
         TM    TABFLG1,$1INACT         REQUEST INACTIVATION?
         BO    UXITRC12                YES, EXIT WITH RC=12.
         B     UXITRC08                EXIT WITH RC=08.
         SPACE
*---------------------------------------------------------------------*
*                                                                     *
*        CHECK INTERVAL EXPRIRATION                                   *
*                                                                     *
*---------------------------------------------------------------------*
*        IF INTERVAL HAS EXPIRED, INDICATE RETRY                      *
*---------------------------------------------------------------------*
STD010   DS    0H                      ********************************
         BAS   R14,CALCINT             CALCULATE INTERVAL SINCE ERROR.
         CLC   UE08INTV,TABINTV        COMPARE TO TABLE INTERVAL VALUE.
         BL    UXITRC04                TIME HAS NOT EXPIRED.
         B     UXITRC00                TIME HAS EXPIRED.
         TITLE 'MODULE EXIT'
*---------------------------------------------------------------------*
*                                                                     *
*        OPMSUE08 MODULE EXIT                                         *
*                                                                     *
*---------------------------------------------------------------------*
*        REQUEST VPS RETRY ERROR                                      *
*---------------------------------------------------------------------*
UXITRC00 DS    0H                      ********************************
         LA    R15,RC00                SET RETURN CODE TO 00.
         B     UXIT999                 RETURN TO VPS.
         SPACE
*---------------------------------------------------------------------*
*        REQUEST VPS IGNORE ERROR AND CALL AGAIN FOR THIS ERROR       *
*---------------------------------------------------------------------*
UXITRC04 DS    0H                      ********************************
         LA    R15,RC04                SET RETURN CODE TO 04.
         B     UXIT999                 RETURN TO VPS.
         SPACE
*---------------------------------------------------------------------*
*        REQUEST VPS IGNORE ERROR AND NOT CALL AGAIN FOR THIS ERROR   *
*---------------------------------------------------------------------*
UXITRC08 DS    0H                      ********************************
         LA    R15,RC08                SET RETURN CODE TO 08.
         B     UXIT999                 RETURN TO VPS.
         SPACE
*---------------------------------------------------------------------*
*        REQUEST VPS INACTIVATE PRINTER                               *
*---------------------------------------------------------------------*
UXITRC12 DS    0H                      ********************************
         LA    R15,RC12                SET RETURN CODE TO 12.
         B     UXIT999                 RETURN TO VPS.
         SPACE
*---------------------------------------------------------------------* VPS80
*        REQUEST VPS INACTIVATE PRINTER AND PURGE ALL PRINTER OUTPUT  * VPS80
*---------------------------------------------------------------------* VPS80
UXITRC16 DS    0H                      ******************************** VPS80
         LA    R15,RC16                SET RETURN CODE TO 16.           VPS80
         B     UXIT999                 RETURN TO VPS.                   VPS80
         SPACE
*---------------------------------------------------------------------*
*        RETURN TO VPS                                                *
*---------------------------------------------------------------------*
UXIT999  DS    0H                      ********************************
         LR    R10,R15                 SAVE RETURN CODE.                VPS80
         LR    R1,R13                  ADDRESS OF MODULE WORKAREA.
         $$VPSERV REQUEST=FREEMAIN,                                    XVPS80
               A=(R1),                                                 XVPS80
               LV=UE08DSLN,                                            XVPS80
               SYAT=YES,                                               XVPS80
               MF=S                                                     VPS80
         SPACE
         EREG  R0,R1                   RESTORE R0 AND R1.               VPS80
         LR    R15,R10                 RESTORE RETURN CODE.             VPS80
         PR    ,                       RESTORE STATUS AND RETURN.       VPS80
         TITLE 'CALCINT - CALCULATE ELAPSED TIME INTERVAL'
*---------------------------------------------------------------------*
*                                                                     *
*        CALCULATE ELAPSED TIME INTERVAL                              *
*                                                                     *
*---------------------------------------------------------------------*
*        - COMPUTE ELAPSED TIME SINCE ERROR IN SECONDS.               *
*        - STORE RESULTS IN FIELD 'UE08INTV'.                         *
*---------------------------------------------------------------------*
CALCINT  DS    0H                      ********************************
         BAKR  R14,R0                  SAVE REGISTERS.                  VPS80
         SPACE
         TIME  BIN                     GET TIME AND DATE.
         SPACE
         STM   R0,R1,UE08TIME          STORE CURRENT TIME AND DATE.
         SPACE
         C     R1,PREDATE              DOES CURRENT DATE = ERROR DATE.
         BE    *+8                     NO, BYPASS.
         A     R0,DAYSECS              INCREMENT CURRENT TIME BY 1 DAY.
         S     R0,PRETIME              SUBTRACT FOR ELAPSED TIME.
         SPACE
         LR    R1,R0                   LOAD ELAPSED TIME INTO R1.
         XR    R0,R0                   CLEAR REGISTER FOR DIVIDE.
         D     R0,F100                 CALCULATE SECONDS SINCE ERROR.
         ST    R1,UE08INTV             SAVE INTERVAL SINCE ERROR.
         SPACE
         EREG  R15,R1                  RESTORE R15, R0 AND R1.          VPS80
         PR    ,                       RESTORE STATUS AND RETURN.       VPS80
         TITLE 'REGISTER EQUATES'
*---------------------------------------------------------------------*
*        REGISTER EQUATES                                             *
*---------------------------------------------------------------------*
R0       EQU   0
R1       EQU   1
R2       EQU   2
R3       EQU   3
R4       EQU   4
R5       EQU   5
R6       EQU   6
R7       EQU   7
R8       EQU   8
R9       EQU   9
R10      EQU   10
R11      EQU   11
R12      EQU   12
R13      EQU   13
R14      EQU   14
R15      EQU   15
         TITLE 'LITERALS && CONSTANTS'
*---------------------------------------------------------------------*
*        LITERALS & CONSTANTS                                         *
*---------------------------------------------------------------------*
         LTORG
         EJECT
RC00     EQU   00
RC04     EQU   04
RC08     EQU   08
RC12     EQU   12
RC16     EQU   16
         SPACE
DAYSECS  DC    A(24*60*60*100)         HUNDREDTHS/SECOND PER DAY.
F100     DC    F'100'                  FULLWORD VALUE OF 100.
         SPACE
WTOTEXT  DS    0CL100
         DC    CL09'VPSX2008 '         +00 - VPS EXIT MSG ID.
         DC    CL09'         '         +09 - VPS STC NAME.
         DC    CL09'         '         +18 - PRINTER NAME.
         DC    CL23'- RETRIES ARE COMPLETE'
         DC    CL50' '                 +50 - RESERVE ANOTHER 50 BYTES.
         SPACE
CBMLIST  $$CBINQ TYPE=PRINTER,MF=L
         TITLE 'ERROR TABLE FOR ATTEMPTED RECOVERY'
*---------------------------------------------------------------------*
*                                                                     *
*        ERROR TABLE FOR ATTEMPTED RECOVERY                           *
*                                                                     *
*---------------------------------------------------------------------*
*                                                                     *
*        MAPPED BY TABLE DSECT BELOW                                  *
*                                                                     *
*   BYTES                                                             *
*   -----                                                             *
*   00-03  MAJOR AND MINOR ERROR CODES                                *
*   04-0B  (RESERVED)                                                 *
*   0C-0F  ADDRESS OF RECOVERY ROUTINE                                *
*   10-13  TIME INTERVAL BETWEEN RETRIES, EXPRESSED IN SECONDS.       *
*   14-15  NUMBER OF RETRIES                                          *
*   16     FLAG BYTE                                                  *
*          $1WTO    - ISSUE MESSAGE WHEN RETRIES ARE EXHAUSTED        *
*          $1INACT  - INACTIVATE PRINTER WHEN RETRIES ARE EXHAUSTED   *
*   17     (RESERVED)                                                 *
*                                                                     *
*---------------------------------------------------------------------*
ERRTABLE DS    0F
*---------------------------------------------------------------------*
*        ENTRY FOR QPUT DCB ABEND                                     *
*---------------------------------------------------------------------*
         DC    X'00080006'             ERROR CODE:  MAJOR/MINOR.
         DC    X'00000000'             RESERVED.
         DC    X'00000000'             RESERVED.
         DC    A(EX37)                 ROUTINE TO HANDLE ERROR.
         DC    A(60*1)                 INTERVAL BETWEEN RETRIES (SEC).
         DC    H'1'                    RETRY COUNT.
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.
         DC    1X'00'                  RESERVED.
         SPACE
*---------------------------------------------------------------------*
*        ENTRY FOR SIMLOGON FAILURE                                   *
*---------------------------------------------------------------------*
         DC    X'00100001'             ERROR CODE:  MAJOR/MINOR.
         DC    X'00000000'             RESERVED.
         DC    X'00000000'             RESERVED.
         DC    A(E1001)                ROUTINE TO HANDLE ERROR.
         DC    A(60*15)                INT BETWEEN RETRIES (SEC) JDM07
         DC    H'00'                   RETRY COUNT.              JDM03
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.
         DC    1X'00'                  RESERVED.
         EJECT
*---------------------------------------------------------------------*
*        ENTRY FOR OPNDST FAILURE                                     *
*---------------------------------------------------------------------*
         DC    X'0010000C'             ERROR CODE:  MAJOR/MINOR.
         DC    X'00000000'             RESERVED.
         DC    X'00000000'             RESERVED.
         DC    A(E100C)                ROUTINE TO HANDLE ERROR.
         DC    A(60*3)                 INTERVAL BETWEEN RETRIES (SEC).
         DC    H'01'                   RETRY COUNT.              JDM05
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.
         DC    1X'00'                  RESERVED.
         SPACE
*---------------------------------------------------------------------*
*        ENTRY FOR LOST TERMINAL                                      *
*---------------------------------------------------------------------*
         DC    X'0010000F'             ERROR CODE:  MAJOR/MINOR.
         DC    X'00000000'             RESERVED.
         DC    X'00000000'             RESERVED.
         DC    A(STD)                  ROUTINE TO HANDLE ERROR.
         DC    A(60*10)                INT BETWEEN RETRIES (SEC) JDM07
         DC    H'00'                   RETRY COUNT.              JDM03
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.
         DC    1X'00'                  RESERVED.
         SPACE
*---------------------------------------------------------------------*
*        ENTRY FOR SESSION CLEANUP REQUESTED                          *
*---------------------------------------------------------------------*
         DC    X'00100018'             ERROR CODE:  MAJOR/MINOR.
         DC    X'00000000'             RESERVED.
         DC    X'00000000'             RESERVED.
         DC    A(STD)                  ROUTINE TO HANDLE ERROR.
         DC    A(60*6)                 INT BETWEEN RETRIES (SEC) JDM07
         DC    H'00'                   RETRY COUNT.              JDM03
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.
         DC    1X'00'                  RESERVED.
         SPACE
*---------------------------------------------------------------------* VPS61
*        ENTRY FOR APPCCMD ERROR FOR LU6.2 DEVICES                    * VPS61
*---------------------------------------------------------------------* VPS61
         DC    X'00100025'             ERROR CODE:  MAJOR/MINOR.        VPS61
         DC    X'00000000'             RESERVED.                        VPS61
         DC    X'00000000'             RESERVED.                        VPS61
         DC    A(E1025)                ROUTINE TO HANDLE ERROR.         VPS61
         DC    A(60*3)                 INTERVAL BETWEEN RETRIES (SEC).  VPS61
         DC    H'10'                   RETRY COUNT.                     VPS61
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.      VPS61
         DC    1X'00'                  RESERVED.                        VPS61
         EJECT
*---------------------------------------------------------------------* VPSTCP
*        ENTRY FOR TCPIP REQUEST FAILURE                              * VPSTCP
*---------------------------------------------------------------------* VPSTCP
         DC    X'00100102'             ERROR CODE:  MAJOR/MINOR.        VPSTCP
         DC    X'00000000'             RESERVED.                        VPSTCP
         DC    X'00000000'             RESERVED.                        VPSTCP
         DC    A(E10102)               ROUTINE TO HANDLE ERROR.         VPSTCP
         DC    A(60*10)                INT BETWEEN RETRIES (SEC) JDM07  VPS61088
         DC    H'00'                   RETRY COUNT.              JDM04  VPS61088
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.      VPSTCP
         DC    1X'00'                  RESERVED.                        VPSTCP
         SPACE
*---------------------------------------------------------------------* VPSTCP
*        ENTRY FOR TCPIP CONNECTION ERROR                             * VPSTCP
*---------------------------------------------------------------------* VPSTCP
         DC    X'00100105'             ERROR CODE:  MAJOR/MINOR.        VPSTCP
         DC    X'00000000'             RESERVED.                        VPSTCP
         DC    X'00000000'             RESERVED.                        VPSTCP
         DC    A(STD)                  ROUTINE TO HANDLE ERROR.         VPSTCP
         DC    A(60*12)                INT BETWEEN RETRIES (SEC) JDM07  VPS62
         DC    H'00'                   RETRY COUNT.              JDM04  VPS62
         DC    AL1(0)                  WTO WHEN RETRIES EXHASUTED.      VPSTCP
         DC    1X'00'                  RESERVED.                        VPSTCP
         SPACE
*---------------------------------------------------------------------* VPS61088
*        ENTRY FOR TCPIP MRD EXPIRED - CONNECTION TIMED OUT           * VPS61088
*---------------------------------------------------------------------* VPS61088
         DC    X'00100107'             ERROR CODE:  MAJOR/MINOR.        VPS61088
         DC    X'00000000'             RESERVED.                        VPS61088
         DC    X'00000000'             RESERVED.                        VPS61088
         DC    A(STD)                  ROUTINE TO HANDLE ERROR.         VPS61088
         DC    A(60*12)                INT BETWEEN RETRIES (SEC) JDM07  VPS61088
         DC    H'00'                   RETRY COUNT.              JDM04  VPS61088
         DC    AL1($1WTO)              WTO WHEN RETRIES EXHASUTED.      VPS61088
         DC    1X'00'                  RESERVED.                        VPS61088
         SPACE
*---------------------------------------------------------------------*
*        END OF TABLE INDICATOR -- ALL ENTRIES MUST PRECEDE THIS      *
*---------------------------------------------------------------------*
         DC    XL4'FFFFFFFF'           END OF TABLE.
         SPACE 1                                                 JDM03
*----------------------------------------------------------------JDM03* VPS61088
*        GENERIC ENTRY FOR ALL NETWORK RELATED ERRORS            JDM03  VPS61088
*----------------------------------------------------------------JDM03* VPS61088
         SPACE 1                                                 JDM03
         DS    0F                                                JDM03
NETERROR EQU   *                                                 JDM03
         DC    X'00100000'             ERR: ONLY LOOK AT 1ST 2   JDM03  VPS61088
         DC    X'00000000'             RESERVED.                 JDM03  VPS61088
         DC    X'00000000'             RESERVED.                 JDM03  VPS61088
         DC    A(STD)                  ROUTINE TO HANDLE ERROR.  JDM03  VPS61088
         DC    A(60*15)                INT BETWEEN RETRIES (SEC) JDM07  VPS61088
         DC    H'00'                   RETRY FOREVER             JDM03  VPS61088
         DC    AL1($1WTO)              WTO NEVER USED            JDM03  VPS61088
         DC    1X'00'                  RESERVED.                 JDM03  VPS61088
         TITLE 'ERROR TABLE DSECT'
*---------------------------------------------------------------------*
*                                                                     *
*        ERROR TABLE DSECT                                            *
*                                                                     *
*---------------------------------------------------------------------*
TABLE    DSECT
TABCODE  DS    0XL4                    ERROR CODE.
TABMAJOR DC    XL2'00'                 MAJOR CODE.
TABMINOR DC    XL2'00'                 MINOR CODE.
         DC    XL8'00'                 RESERVED
TABADDR  DC    A(0)                    ADDRESS OF ERROR ROUTINE.
TABINTV  DC    A(0)                    INTERVAL BETWEEN RETRIES -
*                                      SPECIFIED IN SECONDS.
TABRCNT  DC    XL2'00'                 RETRY COUNT.
TABFLG1  DC    XL1'00'                 FLAG BYTE 1.
$1WTO    EQU   X'80'                   ISSUE MESSAGE WHEN RETRIES GONE.
$1INACT  EQU   X'40'                   DO INACT WHEN RETRIES GONE.
         DC    XL1'00'                 RESERVED.
         SPACE
TABLEN   EQU   *-TABLE                 LENGTH OF TABLE ENTRY.
         TITLE 'OPMSUE08 MODULE WORKAREA DSECT'
*---------------------------------------------------------------------*
*        OPMSUE08 WORK AREA DSECT                                     *
*---------------------------------------------------------------------*
UE08DSCT DSECT
         DC    18A(0)                  REGISTER SAVE AREA.
         SPACE
UE08REQ  DC    A(0)                    MODULE REQUEST CODE.
UE08PLST DC    A(0)                    MODULE PARAMETER LIST ON ENTRY.
UE08TIME DC    A(0)                    CURRENT TIME.
UE08DATE DC    A(0)                    CURRENT DATE.
         SPACE
UE08INTV DC    A(0)                    CALCULATED INTERVAL SINCE ERROR.
         SPACE
UE08QTYP DC    CL1' '                  QSPACE TYPE (CYL/TRK).
UE08QPRI DC    XL2'00'                 QSPACE PRIMARY   QUANTITY.
UE08QSEC DC    XL2'00'                 QSPACE SECONDARY QUANTITY.
         SPACE
         DS    0D                      ALIGN ON A DOUBLEWORD BOUNDARY.  VPS80
UE08WTAT DC    XL(WTADLGTH)'00'        VPSSWTAT - WTO WORKAREA.         VPS80
         EJECT
*---------------------------------------------------------------------*
*        MACRO LISTS                                                  *
*---------------------------------------------------------------------*
UE08CBM  $$CBINQ TYPE=PRINTER,MF=L
UE08CBML EQU   *-UE08CBM
         SPACE
UE08SERV $$VPSERV REQUEST=WTO,WTOAREA=UE08WTAT,SYAT=YES,MF=L            VPS80
         SPACE
         DC    XL32'00'                RESERVED.
         DS    0D                      ALIGN ON A DOUBLEWORD BOUNDARY.
         SPACE
UE08DSLN EQU   *-UE08DSCT              WORK AREA LENGTH
         SPACE
         #LRTCEQU                      EQUATES FOR TCPIP SESSIONS
         VPSSPRAT
         VPSSPRER
         VPSSSYAT
         VPSSWTAT                                                       VPS80
         END   OPMSUE08                                          JDM00
