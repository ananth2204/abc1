 /* REXX EXEC  */
 /*  TRACE RESULTS */
 "EXECIO * DISKR VOLLIST (STEM REC. FINIS)"


 SFX = 0
 CMD_COUNT = 0
   SCAN_OK = ALXRDASD('DASDUCB',2500,'DASD')
 IF SCAN_OK = 'OK' THEN
  DO
  /* THIS MUST BE A PRE-DEFINED DATA SET, WHICH IS USEFUL  */
  /* FOR DETERMINING WHAT DASD WAS ONLINE AT IPL           */
   "ALLOC F(DASDONLN) DA('SYSP.DASD.ONLINE.LASTIPL') SHR"
   IF RC = 0 THEN
    DO
     OUTRECD.1 = '      ' DATE('U') ' ' TIME()
     "EXECIO 1 DISKW DASDONLN(STEM OUTRECD."
     "EXECIO" DASDUCB.0 "DISKW DASDONLN(STEM DASDUCB. FINIS"
     "FREE F(DASDONLN)"
    END
   DO I = 1 TO DASDUCB.0
    IF WORD(DASDUCB.I,1) = 'ON' THEN
     CALL PROCESS_VOLUME
   END
  END
  IF SFX > 0 THEN
   "EXECIO" SFX "DISKW OUTFILE (STEM OUTREC. FINIS"
 "FREE F(OUTFILE)"
 EXIT
PROCESS_VOLUME:
 VOLUME = WORD(DASDUCB.I,3)
 UNIT = WORD(DASDUCB.I,2)

 F = 'N'
 DO A = 1 TO REC.0
  SELECT
   WHEN SUBSTR(REC.A,1,1) = '*' THEN NOP

   WHEN WORD(REC.A,1) = 'KEEP' THEN
    DO
     SELECT
      WHEN WORD(REC.A,1) = 'KEEP' & WORD(REC.A,2) = VOLUME THEN
       RETURN
      WHEN  WORDS(REC.A) > 2 THEN
       DO
        IF WORDS(REC.A) > 3 THEN
         CHECK = 'IF ' WORD(REC.A,2) '=' WORD(REC.A,3) '&',
                WORD(REC.A,4) '=' WORD(REC.A,5) 'THEN F = Y'
        ELSE
         CHECK = 'IF ' WORD(REC.A,2) '=' WORD(REC.A,3) 'THEN F = Y'
        INTERPRET CHECK
        IF F = 'Y' THEN
         RETURN
       END
       OTHERWISE NOP
     END
    END
   OTHERWISE
    DO
  IF WORDS(REC.A) > 2 THEN
    CHECK = 'IF ' WORD(REC.A,1) '=' WORD(REC.A,2) '&',
                  WORD(REC.A,3) '=' WORD(REC.A,4) 'THEN F = Y'
  ELSE
    CHECK = 'IF ' WORD(REC.A,1) '=' WORD(REC.A,2) 'THEN F = Y'
  INTERPRET CHECK
  IF F = 'Y' THEN
    A = REC.0
  END
 END
END
 IF F = 'Y' THEN
  DO
   SFX = SFX + 1
   CMD_COUNT = CMD_COUNT + 1
   OUTREC.SFX = ' V' UNIT',OFFLINE '  VOLUME
   IF CMD_COUNT > 24 THEN
    DO
     SFX = SFX + 1
     CMD_COUNT = 0
     OUTREC.SFX = '#WAIT=5'
    END
  END
RETURN
