Updating the CSD in batch

We maintain all the terminals in our network in a network
database.  The CSD does not allow data such as the location and
user of the terminal to be specified.  Macro TCT source is
generated from the network database and could be input to a TCT
assembly.  Manual updates to the CSD were easy but errors can be
a common occurrence.  The cross checking that was done to
prevent errors was time consuming, so we developed a batch
update technique.

We have modified the DFHTCTRD macro so that we can use the
batch update utility DFHCSDUP to perform the addition of
terminals to the CSD in the batch.  Deletions must still be done
manually.

The job stream shown below is run to modify the DFHTCTRD
macro and run a TCT assembly.  The TCT is migrated to the CSD
using the DFHCSDUP batch utility.

SYSIN to the assembly is a temporary dataset containing the
modified DFHTCTRD macro, a temporary dataset containing
outer macros for the TCT macro definitions which will be
explained later, a dataset containing the title and DFHTCT
TYPE=INITIAL macro, a dataset containing the generated
DFHTCT source, and a dataset containing the DFHTCT
TYPE=FINAL macro and END statement.

The TYPETERM generated by the process is deleted after the TCT
is migrated to the CSD as we already have a TYPETERM defined
in another group.  The code is in the macro to examine the
TYPETERM and set the group for that TYPETERM accordingly if
it is appropriate for the TYPETERM to be saved the first time.
Just remove the last card from the IEBUPDTE input that sets the
TYPETERM to the V@GARB group (our throw-away group for
this function).

In the assembly and migration steps, we use a load library dataset
we call TABLELIB to ensure that assemblies do not abend in the
link-edit step on an 'out of space' condition.  This load library is
used in the DFHCSDUP step as a STEPLIB dataset so the TCT
load module can be located.

//DFHTCTRD EXEC PGM=IEBUPDTE,REGION=512K
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DSN=CICS.OL7.MACLIB,DISP=SHR
//SYSUT2   DD DSN=&&TEMPMAC,DISP=(,PASS),UNIT=SYSWK,
//       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120),SPACE=(3120,(400,400,5))
//SYSIN    DD  *
./      CHANGE NAME=DFHTCTRD,LIST=ALL
&TRMTYN  SETC  '&RDOGP'
         AIF   ('&TRMIDNT'(3,2) GT '49').FW50
.FW00    ANOP
&RDOGP   SETC  'V'
&RDOGP   SETC  '&RDOGP'.'&TRMIDNT'(1,2).'00'
         AGO   .FW99
.FW50    ANOP
&RDOGP   SETC  'V'
&RDOGP   SETC  '&RDOGP'.'&TRMIDNT'(1,2).'50'
.FW99    ANOP
         AIF   ('&TRMIDNT'(1,1) EQ 'C').FWCXXX
         AIF   ('&TRMIDNT'(1,1) EQ 'Q').FWQXXX
         AIF   ('&TRMIDNT'(1,1) EQ 'T').FWTXXX
         AIF   ('&TRMIDNT'(1,1) EQ 'V').FWVXXX
         AIF   ('&TRMIDNT'(1,1) EQ 'D').FWDXXX
         AIF   ('&TRMIDNT'(1,1) EQ 'H').FWHXXX
&REGION  SETC  'CIPL'
         AGO   .FWXXXX
.FWCXXX  ANOP
.FWQXXX  ANOP
.FWTXXX  ANOP
.FWVXXX  ANOP
&RDOGP   SETC  '&RDOGP'.'P0'
&REGION  SETC  'CIP0'
         AGO   .FWXXXX
.FWDXXX  ANOP
.FWHXXX  ANOP
&REGION  SETC  'CIPT'
         AGO   .FWXXXX
.FWXXXX  ANOP
         AIF   ('&TRMTYN' EQ 'VSYS38').V@3270
         AIF   ('&TRMTYN' EQ 'VWANG').V@3270
         AIF   ('&TRMTYN' EQ 'V3270D').V@3270
         AIF   ('&TRMTYN' EQ 'V3270S').V@3270
         AIF   ('&TRMTYN' EQ 'V3270B').V@3270B
         AIF   ('&TRMTYN' EQ 'V3270L').V@3270B
         AIF   ('&TRMTYN' EQ 'V3277L').V@3270B
         AIF   ('&TRMTYN' EQ 'VNVCEC').V@3600
         AIF   ('&TRMTYN' EQ 'VRM47T').V@3600
         AIF   ('&TRMTYN' EQ 'V2261').V@3600
         AIF   ('&TRMTYN' EQ 'V5000').V@5000
         AIF   ('&TRMTYN' EQ 'VSCSPRT').V@PRTRS
         AIF   ('&TRMTYN' EQ 'VSNAPRT').V@PRTRS
         AIF   ('&TRMTYN' EQ 'VSNAPRTL').V@PRTRS
         AIF   ('&TRMTYN' EQ 'V3287L').V@PRTRS
.V@3270  ANOP
&RDOGP   SETC  'V@3270'
         AGO   .V@@@@@
.V@3270B ANOP
&RODGP   SETC  'V@3270B'
         AGO   .V@@@@@
.V@3600  ANOP
&RDOGP   SETC  'V@3600'
         AGO   .V@@@@@
.V@5000  ANOP
&RDOGP   SETC  'V@5000'
         AGO   .V@@@@@
.V@PRTRS ANOP
&RDOGP   SETC  'V@PRTRS'
         AGO   .V@@@@@
.V@@@@@  ANOP
&RDOGP   SETC  'V@GARB'   DFHCSDUP SCREWS UP TYPTERM
./       ENDUP
/*
//*
//TBLASMB EXEC DFHTABLE,
//   SYSINDX='CICS.OL7',
//   MTSLOW=MTS,
//   LOADHI='CICS.OL2',LDNAME=TABLELIB
//ZZ0471.PANDD1 DD DSN=FWNB.PANVALET
//ZZ0471.SYSIN DD *
++WRITE WORK,DFHTCTRDO
/*
//ASM.SYSIN DD DSN=&&TEMPMAC(DFHTCTRD),DISP=(SHR,PASS),
// DCB=BLKSIZE=20000
// DD DSN=&&TEMPPDS(MACROS),DISP=(SHR,PASS)
// DD DSN=CICS.OL2.TERM.CNTL(TCTINIT),DISP=SHR
// DD DSN=&&TEMPRDO(RDOMIGR),DISP=(SHR,PASS)
// DD DSN=CICS.OL2.TERM.CNTL(TCTFINL),DISP=SHR
//*
//XFERMIGR EXEC PGM=DFHCSDUP
//STEPLIB  DD  DSN=CICS.OL2.TABLELIB,
//             DISP=SHR
//         DD  DSN=CICS.OL7.LOADLIB,
//             DISP=SHR
//DFHCSD   DD  DSN=CICS.OL2.XFERLIB.DFHCSD,
//             DISP=SHR
//SYSPRINT DD  SYSOUT=R,DEST=NBO3820,FCB=08#1
//SYSUDUMP DD  SYSOUT=*
//SYSIN    DD  *
           MIGRATE TABLE(DFHTCTXF)
           DELETE GROUP(V@GARB)
/*

DFHTABLE PROCEDURE USED FOR TCT ASSEMBLY.

//DFHTABLE PROC ASMBLR=IEV90,
//             LNKPARM='LIST,XREF,LET,NCAL',
//             SYSINDX='CICS.OL7',
//             LOADHI='CICS.OL2',
//             OUTCLAS=M,
//             LDNAME=TABLELIB,
//             MTSLOW=MTS,
//             WRK=SYSWK
//*
//ZZ0471   EXEC PGM=PAN#1
//PANDD1    DD DSN=FWNB.PANVALET,DISP=(SHR,KEEP,KEEP)
//PANDD11   DD DSN=FWNB.PRODSRCE,DISP=(SHR,KEEP,KEEP)
//PANDD2    DD DSN=&SOURCE,DISP=(NEW,PASS),UNIT=SYSVIO,
//             DCB=(BLKSIZE=1680,LRECL=80),SPACE=(CYL,(2,1))
//SYSPRINT  DD SYSOUT=&OUTCLAS
//SYSPUNCH  DD DUMMY
//*
//ASSEM EXEC PGM=IEBGENER,COND=(4,LT,ZZ0471)
//SYSPRINT DD SYSOUT=&OUTCLAS
//SYSUT1   DD DISP=(OLD,PASS),DSN=&SOURCE
//SYSUT2   DD DSN=&&TEMPPDS(MACROS),DISP=(,PASS),UNIT=&WRK,
//       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120),SPACE=(3120,(400,400,5))
//SYSIN    DD DUMMY
//*
//ASM EXEC PGM=&ASMBLR,COND((3,LT,ASSEM),(4,LT,ZZ0471)),REGION=4096K,
//     PARM=('SYSPARM(INITIAL),DECK,NOOBJECT,TERM,LINECOUNT(80),',    X
//             'XREF(SHORT),NORLD')
//SYSLIB   DD DSN=SYS1.MACLIB,DISP=SHR,DCB=BLKSIZE=20000
//         DD DSN=&SYSINDX..&MTSLOW,DISP=SHR
//         DD DSN=&SYSINDX..MACLIB,DISP=SHR
//         DD DSN=&SYSINDX..SOURCE,DISP=SHR
//         DD DSN=CICSOSVS.ASMCOPY,DISP=SHR
//         DD DSN=SYS1.AMODGEN,DISP=SHR
//SYSUT1   DD UNIT=&WRK,SPACE=(CYL,(100,25))
//SYSPUNCH DD DSN=&&OBJMOD,DISP=(,PASS),
//       VOL=REF=*.ASSEM.SYSUT2,
//       DCB=(RECFM=FB,LRECL=80,BLKSIZE=3120),SPACE=(3120,(300,300))
//SYSPRINT DD SYSOUT=&OUTCLAS
//SYSTERM  DD SYSOUT=&OUTCLAS
//SYSIN    DD DSN=&&TEMPPDS(MACROS),DISP=(OLD,PASS)
//*
//BLDMBR EXEC PGM=IEBUPDTE,PARM=NEW,COND=((3,LT,ASSEM),(7,LT,ASM),
//       (4,LT,ZZ0471))
//SYSPRINT DD SYSOUT=Z
//SYSUT2   DD DISP=(OLD,PASS),DSN=&&TEMPPDS
//SYSIN    DD DISP=(OLD,PASS),DSN=&&OBJMOD
//*
//LNKEDT EXEC PGM=IEWL,PARM='&LNKPARM',COND=((3,LT,ASSEM),(7,LT,ASM),
//       (4,LT,ZZ0471))
//SYSUT1   DD UNIT=&WRK,SPACE=(1024,(1000,100))
//SYSLIB   DD DSN=SYS1.TELCMLIB,DISP=SHR
//SYSPRINT DD SYSOUT=&OUTCLAS
//SYSLMOD  DD DSN=&LOADHI..&LDNAME,DISP=SHR
//SYSPUNCH DD DSN=&&TEMPPDS,DISP=(OLD,PASS)
//SYSLIN   DD DSN=&&TEMPPDS(LNKCTL),DISP=(OLD,PASS),
//       VOL=REF=*.SYSPUNCH
//*
//* USE VERIFY AFTER A DFHCSDUP LOCK FAILURE
//*
//SYSIN    DD  *
           MIGRATE TABLE(DFHTCTXF)
           DELETE GROUP(V@GARB)
/*

The basic TCT source appears below.  V3270S is not the true
name of the group and is actually the TYPETERM.  The V3270S
macro also equates to the TYPETERM.  The modifications to the
DFHTCTRD macro cause this to happen.  The group is created
from the TRMIDNT specification.  Terminals T000-T049 end up
in group TV000 and terminals T050-T099 end up in group VT050.
Terminals are thus grouped in groups of up to 50 terminals.  Only
one unique TYPETERM can appear multiple times in the TCT
source since DFHCSDUP will change the TYPETERM definition
after the first change in TYPETERM.  The first unique
TYPETERM will not be changed by DFHCSDUP.  To do multiple
TYPETERMs, multiple assemblies and migrations must be done.

Migrating a macro TCT to an RDO TCT normally means an
assembly for each local and remote MRO region.  Since we can
tell whether a region is the Terminal-Owning Region (TOR) from
the first character of the TRMIDNT, the region can be plugged in
using our DFHTCTRD macro modifications.  This results in a
combined RDO terminal definition that can be used in both local
and remote regions.

         TITLE '*** TERMINAL CONTROL TABLE FOR CICS 1.7.0 MRO ***'
         DFHTCT TYPE=INITIAL,                                          X
               ACCMETH=VTAM,                                           X
               MIGRATE=YES,                                            X
               SUFFIX=XF,                                              X
               ERRATT=NO
*
         DFHTCT TYPE=GROUP,GROUP=V3270S
         V3270S TRMIDNT=T000,NETNAME=T000
*
         DFHTCT TYPE=GROUP,GROUP=V3270S
         V3270S TRMIDNT=T001,NETNAME=T001
*
         MORE TERMINAL DEFINITIONS
*
         DFHTCT TYPE=GROUP,GROUP=V3270S
         V3270S TRMIDNT=T999,NETNAME=T999
*
         DFHTCT TYPE=FINAL
         END   DFHTCTBA

Macros are created for each TYPETERM in our system.  An inner
DFHTCT TYPE=TERMINAL is contained in the TYPETERM
macros.  This allows the TCT source input to be minimal, only
requiring the TRMIDNT and NETNAME to be specified.  Other
fields in the RDO terminal definition could be added, such as a
TRMPRTY field.  We do not want to specify fields that are
equivalent RDO TYPETERM fields since that definition already
exists in the CSD.  Generally speaking, we can specify anything
on the DFHTCT inner macro as long as it has no effect on the
terminal definition since the TYPETERM definition is of no value
to us.  It has already been created in the CSD and will be thrown
away.

*          DATA SET DFHTCTRDO
*    V3270L   USED FOR VTAM/LOCAL 3270'S (EG TSO TUBES)
         MACRO
         V3270L   &ACCMETH=VTAM,&TRMTYPE=3277,&TRMMODL=2,              X
               &GMMSG=YES,&FEATURE=(UCTRAN,DCKYBD),                    X
               &RELREQ=(NO,YES),                                       X
               &TRMPRTY=050,                                           X
               &TRMSTAT=TRANSCEIVE,&PGESTAT=PAGE,                      X
               &TCTUAL=0,&TIOAL=1920,                                  X
               &DEFSCRN=(24,80),&PGESIZE=(24,80),                      X
               &ALTSCRN=(24,80),&ALTPGE=(24,80),                       X
               &NETNAME=,&TRMIDNT=
 DFHTCT TYPE=TERMINAL,ACCMETH=&ACCMETH,TRMTYPE=&TRMTYPE,               X
               TRMMODL=&TRMMODL,                                       X
               GMMSG=&GMMSG,FEATURE=&FEATURE,RELREQ=&RELREQ,           X
               TRMPRTY=&TRMPRTY,                                       X
               TRMSTAT=&TRMSTAT,PGESTAT=&PGESTAT,                      X
               TCTUAL=&TCTUAL,TIOAL=&TIOAL,                            X
               DEFSCRN=&DEFSCRN,PGESIZE=&PGESIZE,                      X
               ALTSCRN=&ALTSCRN,ALTPGE=&ALTPGE,                        X
               NETNAME=&NETNAME,TRMIDNT=&TRMIDNT
         MEND
*
*    V2370S  USED FOR VTAM/REMOTE 3270'S ON 3274'S (WITHOUT AUTOCNECT)
*
         MACRO
         V3270S    &ACCMETH=VTAM,&TRMTYPE=LUTYPE2,&TRMMODL=2,          X
               &BRACKET=YES,&BUFFER=512,&GMMSG=YES,                    X
               &FEATURE=(DCKYBD,UCTRAN),&RELREQ=(NO,YES),&TRMPRTY=50,  X
               &TRMSTAT=(TRANSCEIVE,INTLOG),&PGESTAT=PAGE,&CHNASSY=YES,X
               &TCTUAL=0,&TIOAL=(1024,4096),&RUSIZE=1024,              X
               &DEFSCRN=(24,80),&PGESIZE=(24,80),                      X
               &ALTSCRN=(24,80),&ALTPGE=(24,80),                       X
               &NETNAME=,&TRMIDNT=
 DFHTCT TYPE=TERMINAL,ACCMETH=&ACCMETH,TRMTYPE=&TRMTYPE,               X
               TRMMODL=&TRMMODL,                                       X
               BRACKET=&BRACKET,BUFFER=&BUFFER,GMMSG=&GMMSG,           X
               FEATURE=&FEATURE,RELREQ=&RELREQ,TRMPRTY=&TRMPRTY,       X
               TRMSTAT=&TRMSTAT,PGESTAT=&PGESTAT,CHNASSY=&CHNASSY,     X
               TCTUAL=&TCTUAL,TIOAL=&TIOAL,RUSIZE=&RUSIZE,             X
               DEFSCRN=&DEFSCRN,PGESIZE=&PGESIZE,                      X
               ALTSCRN=&ALTSCRN,ALTPGE=&ALTPGE,                        X
               NETNAME=&NETNAME,TRMIDNT=&TRMIDNT
         MEND

This technique can be used to convert from a macro TCT to an
RDO TCT depending on the amount of work involved in
massaging the TCT source.  The key point to remember is that the
DFHCSDUP can only handle one unique TYPETERM in a single
execution.  Basically, terminals should be migrated one
TYPETERM at a time.


John L Sparks
Lead Systems Programmer/Analyst ) First Wisconsin National Bank 1990
First Wisconsin National Bank of Milwaukee (USA)


