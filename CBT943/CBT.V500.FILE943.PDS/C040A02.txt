On-line PSB display

We are a shop running CICS and DL/I.  I work in the technical
support group, which is also responsible for the DBA function.  In
order to keep track of all our DBDs and PSBs, we used to keep the
latest assembly listings for every DBDGEN and PSBGEN.  After a
while this became a nuisance.  We had a lot of paper piling up and
keeping the pile updated became a problem.  Frequently being
interrupted by programmers and operators wanting to know
which databases and segments a given PSB was using was also
annoying.

We found that the best solution to our problem was to get the PSB
information directly from the generated ACB (the phase produced
by the ACBGEN utility), because this is the information that DL/I
actually uses.

Using the PSB source was a possibility but it was not available to
our operators.  If we could display the PSB information via CICS,
everybody could find the information at any time, even during the
night.  Using the DL/I Logic manual and a printed ACB, I managed
to decode the ACB and produced the following program.

The program displays information from a given PSB on-line.  It is
possible to show every PCB in the PSB and, for every PCB, to show
each sensitive segment, parent, processing option, access method,
secondary index, language, key length, and key position.
It is written in command-level Assembler and is conversational.
The ACB is loaded into CICS storage using the LOAD macro (SVC 4)
twice, once to obtain the size of the ACB in order to GETMAIN
storage to hold the ACB and again to actually load the ACB.  I
noted that an ACB could be quite large (we have some ACBs of 10-
16K in size) and so I decided to make the transaction
conversational and keep the ACB in storage.  If it were not
conversational either the program would have to load the ACB
every time the user pressed a key or the program would need to
hold it in temporary storage for example.  This has, of course,
some implications:

%   As it issues SVCs the whole CICS system is put into a wait
    state while the SVCs are being serviced.  For that reason, you
    should not use the transaction in your production system, unless
    it's lightly loaded or response time is not critical.

%   As itUs conversational it ties up storage for the duration of
    the conversation.  If you are tight on storage I suggest using the
    RTIMOUT parameter in the PCT.  It tells CICS to abend the
    transaction when the specified time-out value has expired without
    the user having pressed a key.


All data structures are mapped using IBM-supplied DSECTS.  The
program is written for CICS 1.6 and has been tested on VSE/AF
1.3.5 with DL/I 1.6 and on VSE/SP 2.1 with DL/I 1.7 without any
problems.  I assume it could run under MVS too if the LOAD macro
and library directory handling is changed accordingly.  When you
enter a PSB name on the terminal the program automatically
suffixes the PSB name with '0's and a 'P' to change it into an ACB
name.

As I wasnUt able to locate the name of the library from which the
phase was fetched I had to find a different approach.  We only
ever have one library of PSBs in the search chain for any CICS.  I
have therefore made a table at the bottom of the program
containing the VTAM APPLIDs of every CICS in our installation
and the corresponding text to be displayed when the ACB is found
on the library.  This feature of the program makes it VTAM-
dependent.  If you are running BTAM just skip that part of the
code.  DL/I is not required in the CICS running the transaction.

By the way, the program contains enough information to recreate
the PSB source in case you should lose it (God forbid!).  It requires
the following PCT entry:
AZL1     DFHPCT TYPE=ENTRY,PROGRAM=AZL1OD,TRANSID=xxxx,                X
               SPURGE=YES,RTIMOUT=130     timeout value of 90 sec
and the following PPT-entries:
AZL1OD   DFHPPT TYPE=ENTRY,PROGRAM=AZL1OD
AZL1N1D  DFHPPT TYPE=ENTRY,PROGRAM=AZL1N1D

Figures 1, 2, and 3 show the various screen displays generated by
the program.


SOURCE CODE FOR MAP AZL1N1D

AZL1     DFHMSD TYPE=&SYSPARM,DATA=FIELD,LANG=ASM,MODE=INOUT,          X
               STORAGE=AUTO,TIOAPFX=YES,EXTATT=MAPONLY,COLOR=BLUE
AZL1N1D  DFHMDI CTRL=(FREEKB),SIZE=(24,80)
         DFHMDF POS=(01,28),LENGTH=23,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL, X
               INITIAL='P S B  -  D I S P L A Y'
         DFHMDF POS=(01,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Date :'
DATE1    DFHMDF POS=(01,71),LENGTH=06,ATTRB=ASKIP
         DFHMDF POS=(02,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Time :'
TIME1    DFHMDF POS=(02,71),LENGTH=08,ATTRB=ASKIP
         DFHMDF POS=(03,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Term :'
TERM1    DFHMDF POS=(03,71),LENGTH=04,ATTRB=ASKIP
         DFHMDF POS=(04,01),LENGTH=16,ATTRB=ASKIP,                     X
               INITIAL='Enter PSB-name :'
PSBNAME  DFHMDF POS=(04,18),LENGTH=08,ATTRB=(UNPROT,BRT,IC,FSET),      X
               COLOR=RED
LOADED   DFHMDF POS=(04,27),LENGTH=11,ATTRB=(ASKIP,DRK),               X
               INITIAL='Loaded from'
CICSNAM  DFHMDF POS=(04,39),LENGTH=14,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL
PT01     DFHMDF POS=(07,01),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(01) ='
PF01     DFHMDF POS=(07,12),LENGTH=07,ATTRB=ASKIP
PT02     DFHMDF POS=(07,20),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(02) ='
PF02     DFHMDF POS=(07,31),LENGTH=07,ATTRB=ASKIP
PT03     DFHMDF POS=(07,39),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(03) ='
PF03     DFHMDF POS=(07,50),LENGTH=07,ATTRB=ASKIP
PT04     DFHMDF POS=(07,58),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(04) ='
PF04     DFHMDF POS=(07,69),LENGTH=07,ATTRB=ASKIP

    and similarly for PT05-PT52 and PF05-PF52

PT53     DFHMDF POS=(20,01),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(53) ='
PF53     DFHMDF POS=(20,12),LENGTH=07,ATTRB=ASKIP
PT54     DFHMDF POS=(20,20),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(54) ='
PF54     DFHMDF POS=(20,31),LENGTH=07,ATTRB=ASKIP
PT55     DFHMDF POS=(20,39),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(55) ='
PF55     DFHMDF POS=(20,50),LENGTH=07,ATTRB=ASKIP
PT56     DFHMDF POS=(20,58),LENGTH=10,ATTRB=(ASKIP,DRK),               X
               INITIAL='PCB(56) ='
PF56     DFHMDF POS=(20,69),LENGTH=07,ATTRB=ASKIP
SELTXT   DFHMDF POS=(22,01),LENGTH=16,ATTRB=(ASKIP,DRK),               X
               INITIAL='Select PCB no. :'
SELECT   DFHMDF POS=(22,18),LENGTH=02,ATTRB=(UNPROT,NUM,BRT,FSET),     X
               COLOR=RED
         DFHMDF POS=(22,21),LENGTH=01,ATTRB=ASKIP
         DFHMDF POS=(23,24),LENGTH=35,ATTRB=ASKIP,                     X
               INITIAL='Enter=Select   PF03=Menu   PF04=End'
MSG1     DFHMDF POS=(24,01),LENGTH=72,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL
AZL1N2D  DFHMDI CTRL=(FREEKB),SIZE=(24,80)
         DFHMDF POS=(01,28),LENGTH=23,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL  X
               INITIAL='P S B  -  D I S P L A Y'
         DFHMDF POS=(01,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Date :'
DATE2    DFHMDF POS=(01,71),LENGTH=06,ATTRB=ASKIP
         DFHMDF POS=(02,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Time :'
TIME2    DFHMDF POS=(02,71),LENGTH=08,ATTRB=ASKIP
         DFHMDF POS=(03,64),LENGTH=06,ATTRB=ASKIP,                     X
               INITIAL='Term :'
TERM2    DFHMDF POS=(03,71),LENGTH=04,ATTRB=ASKIP
         DFHMDF POS=(04,01),LENGTH=05,ATTRB=ASKIP,                     X
               INITIAL='PSB :'
PSBNAM2  DFHMDF POS=(04,07),LENGTH=08,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL
         DFHMDF POS=(04,16),LENGTH=12,ATTRB=ASKIP,                     X
               INITIAL='   Procopt :'
PROCOPT  DFHMDF POS=(04,29),LENGTH=04,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(04,34),LENGTH=08,ATTRB=ASKIP,                     X
               INITIAL='Lang :'
LANG     DFHMDF POS=(04,46),LENGTH=07,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(04,54),LENGTH=11,ATTRB=ASKIP,                     X
               INITIAL='   Keylen :'
KEYLEN   DFHMDF POS=(04,73),LENGTH=04,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(05,01),LENGTH=05,ATTRB=ASKIP,                     X
               INITIAL='PCB :'
PCBNAME  DFHMDF POS=(05,07),LENGTH=08,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL
         DFHMDF POS=(05,19),LENGTH=05,ATTRB=ASKIP,                     X
               INITIAL='Pos :'
POS      DFHMDF POS=(05,29),LENGTH=01,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(05,31),LENGTH=14,ATTRB=ASKIP,                     X
               INITIAL='   Procseq :'
PROCSEQ  DFHMDF POS=(05,46),LENGTH=07,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(05,54),LENGTH=17,ATTRB=ASKIP,                     X
               INITIAL='   Organization :'
ORG      DFHMDF POS=(05,72),LENGTH=05,ATTRB=ASKIP,COLOR=RED
         DFHMDF POS=(07,01),LENGTH=30,ATTRB=ASKIP,                     X
               INITIAL='Segment      Parent    Procopt'
         DFHMDF POS=(07,42),LENGTH=30,ATTRB=ASKIP,                     X
               INITIAL='Segment      Parent    Procopt'
SEG1     DFHMDF POS=(08,01),LENGTH=08,ATTRB=ASKIP
PAR1     DFHMDF POS=(08,13),LENGTH=08,ATTRB=ASKIP
PROC1    DFHMDF POS=(08,25),LENGTH=04,ATTRB=ASKIP
SEG2     DFHMDF POS=(08,42),LENGTH=08,ATTRB=ASKIP
PAR2     DFHMDF POS=(08,54),LENGTH=08,ATTRB=ASKIP
PROC2    DFHMDF POS=(08,66),LENGTH=04,ATTRB=ASKIP
SEG3     DFHMDF POS=(09,01),LENGTH=08,ATTRB=ASKIP
PAR3     DFHMDF POS=(09,13),LENGTH=08,ATTRB=ASKIP
PROC3    DFHMDF POS=(09,25),LENGTH=04,ATTRB=ASKIP

       and similarly for SEG4-SEG24, PAR3-PAR24, and PROC2-PROC24

SEG25    DFHMDF POS=(20,01),LENGTH=08,ATTRB=ASKIP
PAR25    DFHMDF POS=(20,13),LENGTH=08,ATTRB=ASKIP
PROC25   DFHMDF POS=(20,25),LENGTH=04,ATTRB=ASKIP
SEG26    DFHMDF POS=(20,42),LENGTH=08,ATTRB=ASKIP
PAR26    DFHMDF POS=(20,54),LENGTH=08,ATTRB=ASKIP
PROC26   DFHMDF POS=(20,66),LENGTH=04,ATTRB=ASKIP
         DFHMDF POS=(23,17),LENGTH=46,ATTRB=ASKIP,                     X
               INITIAL='Enter=Return to selection  PF03=Menu  PF04=End'
MSG2     DFHMDF POS=(24,01),LENGTH=72,ATTRB=(ASKIP,BRT),COLOR=NEUTRAL
         DFHMSD TYPE=FINAL
         END

Next month we shall conclude this article by publishing the source
code for AZL1OD.


Steen Spuur Hansen
Systems Programmer
Texaco A/S (Denmark) ) Steen Spuur Hansen 1989

