{"INMR01": {"INMLRECL": 80, "INMFNODE": "N1", "INMFUID": "SBGOLOB", "INMTNODE": "A", "INMTUID": "A", "INMFTIME": "20201220012152000000", "INMNUMF": 1}, "INMR02": {"1": {"INMUTILN": "IEBCOPY", "INMSIZE": 2292654, "INMDSORG": "PO", "INMTYPE": "None", "INMLRECL": 80, "INMBLKSZ": 5600, "INMRECFM": "FB", "INMDIR": 7, "INMDSNAM": "CBT.V500.FILE491.PDS", "numfile": 1}, "2": {"INMUTILN": "INMCOPY", "INMSIZE": 2292654, "INMDSORG": "PS", "INMLRECL": 32756, "INMBLKSZ": 3120, "INMRECFM": "VS", "numfile": 1}}, "INMR03": {"1": {"INMSIZE": 2292654, "INMDSORG": "PS", "INMLRECL": 80, "INMRECFM": "?"}}, "file": {"CBT.V500.FILE491.PDS": {"COPYR1": {"type": "PDS", "DS1DSORG": 512, "DS1BLKL": 5600, "DS1LRECL": 80, "DS1RECFM": "FB", "DS1KEYL": 0, "DS1OPTCD": 0, "DS1SMSFG": 0, "file_tape_blocksize": 3120, "DVAOPTS": 12336, "DVACLASS": 32, "DVAUNIT": 15, "DVAMAXRC": 32760, "DVACYL": 3340, "DVATRK": 15, "DVATRKLN": 58786, "DVAOVHD": 0, "num_header_records": 2, "DS1REFD": "200354", "DS1SCEXT": "b'\\x00\\x00\\x00'", "DS1SCALO": "b'\\x80\\x00\\x00\\xbe'", "DS1LSTAR": "b'\\x00$\\x02'", "DS1TRBAL": "b'\\xd4\\xc4'"}, "COPYR2": {"deb": "b'\\x01\\x00\\x00\\x00\\xff\\x00\\x00\\x00\\x8f\\x03\\xa0\\x00\\x04\\x9a\\xc0\\xd8'", "extents": ["b'\\x01\\x00\\x00\\x00\\xff\\x00\\x00\\x00\\x8f\\x03\\xa0\\x00\\x04\\x9a\\xc0\\xd8'", "b'X\\xf4\\xfd\\xd0\\x00\\x00\\x03\\x8e\\x00\\r\\x03\\x91\\x00\\x04\\x00%'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'", "b'\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'"]}, "members": {"$$$#DATE": {"ttr": 516, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x04P\\x00\\x08\\x01\\x102O\\x01\\x102O\"H\\x00\\x0c\\x00\\x0c\\x00\\x00\\xc3\\xc2\\xe3`\\xf4\\xf8\\xf0@@@'", "ispf": {"version": "04.80", "flags": 0, "createdate": "2010-11-20T00:00:00", "modifydate": "2010-11-20T22:48:08", "lines": 12, "newlines": 12, "modlines": 0, "user": "CBT-480"}, "text": "REGULAR CBT TAPE - VERSION 480    FILE:  491\n\n    ORIGINAL DSNAME:  SBGOLOB.CBT480.FILE491\n    ---------------\n                    --RECFM-LRECL-BLKSIZE-DSORG\n                      FB    80    5600    PO\n\n   PDS117I 11 MEMBERS COUNTED; CUMULATIVE SIZE IS 21,244 RECORDS\n\n\nTIME THIS PDS WAS SHIPPED:   11/20/10    22:48:08    GMT-5:00\n\n", "mimetype": "text/plain", "datatype": "iso-8859-1", "extension": ".txt"}, "$$NOTE": {"ttr": 518, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x03\\x00\\x00\\x01\\x005_\\x01\\x005_\\x11W\\x00\\x12\\x00\\r\\x00\\x00\\xe6\\xe2\\xc2\\xc7@@@@@@'", "ispf": {"version": "01.03", "flags": 0, "createdate": "2000-12-20T00:00:00", "modifydate": "2000-12-20T11:57:00", "lines": 18, "newlines": 13, "modlines": 0, "user": "WSBG"}, "text": "Here are two files from my site in TSO XMIT format:\n\n    1)  XMITMAIL - a \"lite, fast\" version of XMITIP, written in\nCOBOL, callable from any HLL in batch or CICS.  Attachments\nonly supported if you format them yourself. (File 490)\n\n    2)  INSTASM   -  library of macros useful for reentrant\nassembler programming, including a reentrant date conversion\nroutine.                                    (File 491)\n\nMuch thanks to Lionel Dyck.  His version of XMITIP (the original,\nwritten in REXX) is on File 312 of the CBT Tape.\n\n    Andy Robertson <andywrobertson@clara.co.uk>\n\n    home site:  http://home.clara.net/andywrobertson/mvsindex.html\n\n\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "$$NOTE1": {"ttr": 520, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x15\\x01\\x05\\x07\\x0f\\x01\\x05\\x07\\x0f\\x162\\x00\\x19\\x00\\x19\\x00\\x00\\xe2\\xc2\\xc7\\xd6\\xd3\\xd6\\xc2@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2005-03-11T00:00:00", "modifydate": "2005-03-11T16:32:15", "lines": 25, "newlines": 25, "modlines": 0, "user": "SBGOLOB"}, "text": "Sam, here are up to date versions of the MVS freeware I have\nwritten, for the CBT tape.  They are in zipped binary XMIT\nformat.  I am not sure if they are on the tape or the overflow\nalready - I have a feeling I sent versions a few years ago but I\ncan't find them - but if they are they won't be up to date.\n\n\nLECH\nA sample LE condition handler. Code two COPY statements in your\ncobol mainline. Interrupts will be intercepted with a dump and a\nmessage and your program will continue to run.\n\nBATCHART.\nDrive the GDDM-PGF CHART utility in batch using a SYSIN-type file\nof commands. No terminal required.  Create gifs in batch.\n\nINSTASM\nA set of assembler macros useful for building re-entrant\nassembler programs, date handling, parsing and stringing, and\nsome utilities.\n\nXMITCICS / XMITMAIL\n\"lite\" version of XMITIP, in Cobol, usable from CICS\n\nAndy Robertson\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "$$NOTE2": {"ttr": 522, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x11\\x01\\x102O\\x01\\x102O \\x14\\x00\\x1b\\x00\\x1b\\x00\\x00\\xe2\\xc2\\xc7\\xd6\\xd3\\xd6\\xc2@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2010-11-20T00:00:00", "modifydate": "2010-11-20T20:14:11", "lines": 27, "newlines": 27, "modlines": 0, "user": "SBGOLOB"}, "text": "Subject:  CBT updates\nFrom:     \"pinlighter\" <pinlighter@btconnect.com>\nDate:     Sat, 20 Nov 2010 21:54:48 -0000\nTo:       <sbgolob@cbttape.org>\n\nSam\n\nHere are updated versions of my freeware: I think on Files 490 491.\n\nINSTASM\nLECH\nBATCHART\nXMITMAIL/XMITCICS\n\nHome has now moved to\n\nhttp://www.thenightland.co.uk/MYWEB/mvsindex.html\n\nHope this is OK - many thanks for your work\n\nAndy Robertson\n\ninstasm.xmit\nbatchart.xmit\nlech.xmit\nxmitmail.xmit\n\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "$PDSLOAD": {"ttr": 524, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\r\\x00\\'\\x01\\x026_\\x01\\x102O\"F\\x00\\'\\x00\\x08\\x00\\x00\\xe2\\xc2\\xc7\\xd6\\xd3\\xd6\\xc2@@@'", "ispf": {"version": "01.13", "flags": 0, "createdate": "2002-12-31T00:00:00", "modifydate": "2010-11-20T22:46:27", "lines": 39, "newlines": 8, "modlines": 0, "user": "SBGOLOB"}, "text": "//SBGOLOBL JOB (ACCT#),PDSLOAD,\n// NOTIFY=&SYSUID,\n// CLASS=B,MSGCLASS=X\n//* --------------------------------------------------- *//\n//*      PDSLOAD JOB TO CREATE INSTALL LIBRARIES        *//\n//*                                                     *//\n//*     (THIS JOB WAS TESTED TO WORK ON MY SYSTEM)      *//\n//* --------------------------------------------------- *//\n//TSOBATCH EXEC PGM=IKJEFT01\n//SYSTSPRT DD SYSOUT=*\n//SYSTSIN DD *\n   RECEIVE INDS('SBGOLOB.CBT480.FILE491(PDSLOAD)')\n   DSN ('SBGOLOB.TEMP.PDSLOAD') VOL(WORK04)\n/*\n//*\n//PDSLOAD PROC IPDS='SBGOLOB.CBT480.FILE491',      <=== CHANGE\n//             OPRE=SBGOLOB,\n//             QUAL=FILE491,\n//             MEMB=XXX,\n//             OUNT=SYSALLDA,\n//             OVL=DATA04,\n//             DSP1=NEW,\n//             DSP2=CATLG,\n//             DSP3='',\n//             P=30,S=60,D=44\n//*\n//LOAD   EXEC PGM=PDSLOAD\n//STEPLIB  DD DISP=SHR,DSN=SBGOLOB.TEMP.PDSLOAD\n//SYSPRINT DD SYSOUT=*\n//SYSUT1   DD DISP=SHR,DSN=&IPDS(&MEMB)\n//SYSUT2   DD UNIT=&OUNT,VOL=SER=&OVL,\n//             DSN=&OPRE..&QUAL..&MEMB,\n//             DISP=(&DSP1,&DSP2&DSP3),\n//             SPACE=(TRK,(&P,&S,&D),RLSE)\n//  PEND\n//*\n//S001 EXEC PDSLOAD,MEMB=BATCHART\n//S002 EXEC PDSLOAD,MEMB=LECH\n//S003 EXEC PDSLOAD,MEMB=XMITMAIL\n", "mimetype": "text/plain", "datatype": "iso-8859-1", "extension": ".txt"}, "@FILE491": {"ttr": 526, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x04P\\x00T\\x01\\x102O\\x01\\x102O\"G\\x004\\x004\\x00\\x00\\xc3\\xc2\\xe3`\\xf4\\xf8\\xf0@@@'", "ispf": {"version": "04.80", "flags": 0, "createdate": "2010-11-20T00:00:00", "modifydate": "2010-11-20T22:47:54", "lines": 52, "newlines": 52, "modlines": 0, "user": "CBT-480"}, "text": "//***FILE 491 is from Andy Robertson and contains a \"lite\" version  *   FILE 491\n//*           of XMITIP which is written in COBOL.  Lionel Dyck's   *   FILE 491\n//*           \"original\" version of XMITIP is on File 314 of this   *   FILE 491\n//*           tape.  Lionel's (File 314) version is written in      *   FILE 491\n//*           REXX.  These programs allow the sending of email      *   FILE 491\n//*           messages from your MVS machine if you have an SMTP    *   FILE 491\n//*           server running.                                       *   FILE 491\n//*                                                                 *   FILE 491\n//*           This file has been modified to include Andy's         *   FILE 491\n//*           BATCHART package too.  See below for explanation.     *   FILE 491\n//*                                                                 *   FILE 491\n//*     Andy Robertson <andywrobertson@clara.co.uk>                 *   FILE 491\n//*                                                                 *   FILE 491\n//*     home site:                                                  *   FILE 491\n//*         http://home.clara.net/andywrobertson/mvsindex.html      *   FILE 491\n//*                                                                 *   FILE 491\n//*   Note:  The following packages are in PDSLOAD format, which    *   FILE 491\n//*          is a modified IEBUPDTE format that preserves ISPF      *   FILE 491\n//*          statistics.  The PDSLOAD program load module is        *   FILE 491\n//*          included in this pds, and a sample job to create the   *   FILE 491\n//*          installation pds'es for the packages is in member      *   FILE 491\n//*          $PDSLOAD.  Modify that member and run the job....      *   FILE 491\n//*                                                                 *   FILE 491\n//*     LECH     - A sample LE condition handler.  Code two COPY    *   FILE 491\n//*                statements in your cobol mainline.  Interrupts   *   FILE 491\n//*                will be intercepted with a dump and a message    *   FILE 491\n//*                and your program will continue to run.           *   FILE 491\n//*                                                                 *   FILE 491\n//*     XMITMAIL - a \"lite, fast\" version of XMITIP, written in     *   FILE 491\n//*                COBOL, callable from any HLL in batch or         *   FILE 491\n//*                CICS.  Attachments only supported if you         *   FILE 491\n//*                format them yourself.                            *   FILE 491\n//*                                                                 *   FILE 491\n//*     XMITCICS - an interface to run XMITMAIL from CICS.          *   FILE 491\n//*                                                                 *   FILE 491\n//*     BATCHART - a member in PDSLOAD format which contains COBOL  *   FILE 491\n//*                source to produce 3270-displayable pictures.     *   FILE 491\n//*                                                                 *   FILE 491\n//*        BATCHART can be used to create GDFs in batch,            *   FILE 491\n//*        using an input file of commands.                         *   FILE 491\n//*                                                                 *   FILE 491\n//*        The GDFs can be displayed on a 3720-type terminal,       *   FILE 491\n//*        printed on an AFP printer, plotted, or saved as          *   FILE 491\n//*        members of a PDS.  Saved PDS members can later be        *   FILE 491\n//*        converted to .gif files by the IBM-provided              *   FILE 491\n//*        ADMUGIF utility                                          *   FILE 491\n//*                                                                 *   FILE 491\n//*        BATCHART needs LE, GDDM and GDDM-PGF.                    *   FILE 491\n//*                                                                 *   FILE 491\n//*        To generate the BATCHART installation pds, just run the  *   FILE 491\n//*        job $PDSLOAD.  This will generate the other pds'es also. *   FILE 491\n//*                                                                 *   FILE 491\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "BATCHART": {"ttr": 528, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x00\\x01\\x05\\x07\\x0f\\x01\\x05\\x07\\x0f\"A/\\xeb/\\xeb\\x00\\x00\\xd7\\xc4\\xe2\\xd3\\xd6\\xc1\\xc4@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2005-03-11T00:00:00", "modifydate": "2005-03-11T22:41:00", "lines": 12267, "newlines": 12267, "modlines": 0, "user": "PDSLOAD"}, "mimetype": "application/octet-stream", "datatype": "binary", "extension": ".bin"}, "LECH": {"ttr": 5633, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x00\\x01\\x102O\\x01\\x102O\"A\\x08\\xf9\\x08\\xf9\\x00\\x00\\xd7\\xc4\\xe2\\xd3\\xd6\\xc1\\xc4@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2010-11-20T00:00:00", "modifydate": "2010-11-20T22:41:00", "lines": 2297, "newlines": 2297, "modlines": 0, "user": "PDSLOAD"}, "text": "./ ADD NAME=$$README 0107-02010-05097-1415-00040-00029-00000-TSO057\n\n      LECHCL is a Language Environment Condition Handler.\n\n      It handles interrupts by printing out errors and allowing the\n      program to continue.\n\n      To use LECHCL in a COBOL program, you just code COPY LECHCLD in\n      your working-storage section and COPY LECHCLD in your procedure\n      division.  Copy/include code is also supplied for C/C++ and for\n      LE-enabled assembler.\n\n      Instructions for installation and use are in member LECHDOC of\n      this library\n\n\n\n\n\n      LECHCL is written in COBOL and distributes as COBOL source code.\n\n\n\n\n      Copyright (C) 2000  Andy Robertson\n\n      This program is free software; you can redistribute it and/or\n      modify it under the terms of the GNU General Public License as\n      published by the Free Software Foundation; either version 2 of the\n      License, or (at your option) any later version.\n\n      This program is distributed in the hope that it will be useful,\n      but WITHOUT ANY WARRANTY; without even the implied warranty of\n      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n      GNU General Public License for more details.\n\n      You should have received a copy of the GNU General Public License\n      along with this program; if not, write to the Free Software\n      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.\n\n\n./ ADD NAME=LECHALC  0103-02011-02011-1134-00007-00007-00000-TSO057\n        CEELOAD  NAME=LECHCLL,FEEDBACK=LECHCL_FC\n        ST     15,LECHCL_ROUTINE_POINTER\n        CALL CEEHDLR,(LECHCL_ROUTINE_POINTER,LECHCL_TOKEN,LECHCL_FC),VL\n        CLC    LECHCL_FC_SEVERITY,=H'0'\n        BE     LECHCLCZ\n        WTO    ' INITIALISATION OF LECHCL FAILED'\nLECHCLCZ DS 0H\n./ ADD NAME=LECHALD  0103-02011-02011-1134-00009-00010-00000-TSO057\nLECHCL_LOAD_NAME       DC CL8'LECHCLL '\nLECHCL_ROUTINE_POINTER DC 2A(0)     PROCEDURE_POINTER\nLECHCL_TOKEN           DC A(0)\nLECHCL_FC              DC CL12' '\n                       ORG LECHCL_FC\nLECHCL_FC_SEVERITY     DS H\nLECHCL_FC_MSG_NO       DS H\nLECHCL_FC_I_S_INFO     DS H\n                       ORG\n./ ADD NAME=LECHCLC  0105-02010-02010-1335-00014-00013-00000-TSO057\n\n           SET LECHCL-ROUTINE-POINTER TO ENTRY LECHCLL\n\n           CALL 'CEEHDLR' USING LECHCL-ROUTINE-POINTER LECHCL-TOKEN\n                                LECHCL-FC\n\n           IF LECHCL-FC-SEVERITY NOT = 0\n               MOVE LECHCL-FC-SEVERITY TO\n               LECHCL-SEVERITY\n               MOVE LECHCL-FC-MSG-NO   TO\n               LECHCL-MSG-NO\n               DISPLAY LECHCL-SETUP-ERROR UPON CONSOLE\n           END-IF\n\n./ ADD NAME=LECHCLD  0105-02010-02010-1440-00014-00012-00000-TSO057\n       01  LECHCL-SETUP-ERROR.\n           04   FILLER                  PIC X(34)\n                VALUE  'INITIALISATION OF LECHCL FAILED '.\n           04   LECHCL-SEVERITY         PIC ZZZZ9.\n           04   FILLER                  PIC X VALUE ' '.\n           04   LECHCL-MSG-NO           PIC ZZZZ9.\n       01  LECHCL-ROUTINE-POINTER     PROCEDURE-POINTER.\n       01  LECHCLL                    PIC X(8) VALUE 'LECHCLL'.\n       01  LECHCL-TOKEN               PIC S9(8) COMP VALUE 0.\n       01  LECHCL-FC                  PIC X(12).\n       01  FILLER REDEFINES  LECHCL-FC.\n           04   LECHCL-FC-SEVERITY      PIC S9(4) COMP.\n           04   LECHCL-FC-MSG-NO        PIC S9(4) COMP.\n           04   LECHCL-FC-I-S-INFO      PIC S9(8) COMP.\n./ ADD NAME=LECHCLL  0156-02010-09167-1620-00960-00732-00000-TSO057\n\n\n      **************************************************************\n      *   LECH LE condition handler for OS/390\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * LECHCLL  IS OUR STANDARD ERROR HANDLER ROUTINE, INVOKED BY THE *\n      * CODE IN COPYBOOK \"LECHCLC\"                                     *\n      *                                                                *\n      * Andy Robertson  12/01/2002                                     *\n      *                                                                *\n      *                                                                *\n      *                                                                *\n      ******************************************************************\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID. 'LECHCLL'.\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n\n\n      ******************************************************************\n      *                                                                *\n      * UTILITY AREAS FOR LE/370 CALLS                                 *\n      *                                                                *\n      ******************************************************************\n\n\n       01  FEEDBACK.\n           04  FEEDBACK-CONDITION-TOKEN-VALUE.\n           COPY  CEEIGZCT.\n               07  FEEDBACK-CASE-1-CONDITION-ID.\n                   10  FEEDBACK-SEVERITY        PIC S9(4) COMP.\n                   10  FEEDBACK-MSG-NO          PIC S9(4) COMP.\n               07  FEEDBACK-CASE-2-CONDITION-ID\n                         REDEFINES FEEDBACK-CASE-1-CONDITION-ID.\n                   10  FEEDBACK-CLASS-CODE      PIC S9(4) COMP.\n                   10  FEEDBACK-CAUSE-CODE      PIC S9(4) COMP.\n               07  FEEDBACK-CASE-SEV-CTL    PIC X.\n               07  FEEDBACK-FACILITY-ID     PIC XXX.\n           04  FEEDBACK-I-S-INFO        PIC 9(9) COMP.\n\n       01  FEEDBACK-HEX                  PIC X(24).\n\n\n       01  MOVE-REPLY                    PIC X.\n\n       01  EDITNUM-X.\n           04  EDITNUM                       PIC ZZZZZZZZ9.\n\n       01  CEEMOUT-MSG.\n           04  CEEMOUT-MSG-LEN               PIC S9(4) COMP VALUE 80.\n           04  CEEMOUT-MSG-TEXT              PIC X(80) VALUE \" \".\n\n       01  CEEMOUT-DEST                  PIC S9(9) COMP VALUE 2.\n\n       01  ERROR-WRKCNT            PIC 9(9) COMP VALUE 0.\n\n\n\n      ******************************************************************\n      *                                                                *\n      * DATA AREAS EXTRACT INDEX                                       *\n      *                                                                *\n      ******************************************************************\n\n       01  DATA-EXTRACT-INDEX.\n           04  INT-RESUME-SAME            PIC X.\n           04  LOW-CORE                   PIC X.\n           04  WILD-BRANCH                PIC X.\n           04  SPECIFICATION              PIC X.\n\n      ******************************************************************\n      *                                                                *\n      * DATA AREAS EXTRACTED BY CALLS TO LE/370 ROUTINES               *\n      *                                                                *\n      ******************************************************************\n\n\n           COPY CEEIGZCI.\n\n       01  MSIB.\n           04  MSIB-EYECATCHER     PIC X(4).\n           04  MSIB-SIZE           PIC S9(4) COMP.\n           04  MSIB-LEVEL          PIC S9(4) COMP.\n           04  MSIB-GPRS.\n               07  MSIB-GPR-X OCCURS 16\n                   INDEXED BY MSIB-GPR-IX.\n                   10  MSIB-GPR USAGE POINTER.\n           04  MSIB-PSW            PIC X(8).\n           04  MSIB-PSWX           PIC X(4).\n           04  MSIB-IC             PIC X(4).\n           04  FILLER              PIC X(8).\n           04  MSIB-FPRS.\n               07  MSIB-FPR0           PIC X(8).\n               07  MSIB-FPR2           PIC X(8).\n               07  MSIB-FPR4           PIC X(8).\n               07  MSIB-FPR6           PIC X(8).\n           04  FILLER REDEFINES MSIB-FPRS.\n               07  MSIB-FPR-X OCCURS 4\n                   INDEXED BY MSIB-FPR-IX.\n                   10  MSIB-FPR.\n                   13  MSIB-FPR-1STHALF PIC X(4).\n                   13  MSIB-FPR-2NDHALF PIC X(4).\n\n       01  CIB-PTR                 USAGE POINTER.\n\n\n\n\n       01  TRUE-INT-X.\n           04  TRUE-INT                USAGE POINTER.\n       01  TRUE-RESUME-X.\n           04  TRUE-RESUME             USAGE POINTER.\n       01  CODE-POINTER-X.\n           04  CODE-POINTER-N          PIC 9(8) COMP-5.\n           04  CODE-POINTER REDEFINES\n               CODE-POINTER-N          USAGE POINTER.\n\n\n       01  W-DUMP-COUNT         PIC S9(8) COMP.\n\n       01  ten-bytes            PIC X(20).\n\n       01  MODULE-INT           PIC X(8).\n\n       01  MODULE-INT-START USAGE POINTER.\n       01  MODULE-INT-START-COMP REDEFINES\n           MODULE-INT-START PIC 9(9) COMP.\n\n       01  MODULE-INT-RELA USAGE POINTER.\n       01  MODULE-INT-RELA-COMP REDEFINES\n           MODULE-INT-RELA PIC 9(9) COMP.\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * PRINT WORK AREAS                                               *\n      *                                                                *\n      ******************************************************************\n\n       01  CEE3DMP-TITLE    PIC X(120).\n       01  CEE3DMP-OPTIONS  PIC X(255) value\n      *      customise\n             'ENCL(CUR),TRACEBACK,VAR'.\n      *      'ENCL(CUR),THREAD(CUR),VAR,STORAGE,STACKFRAME(1)'.\n      *      customise see CEE3DMP OPTIONS in LE manual Prog Ref\n\n       01  LECHCON          PIC X(255).\n       01   W-IDISNAP       PIC X(8)  VALUE 'IDISNAP'.\n       01  IDISNAP-TITLE    PIC X(140) VALUE ' ' .\n\n       01  BUFFER-1        PIC X(1500).\n       01  WRKCNT          PIC 9(9) COMP.\n       01  WRKCNT-2        PIC 9(9) COMP.\n\n       01  display-int-number PIC Z9.\n\n       01  ERROR-TYPE      PIC X(23).\n\n       01  HEX-DATA-4-2    PIC X(8).\n\n      ******************************************************************\n      *                                                                *\n      * DATA AREAS USED BY NESTED CONDITION HANDLER LECHCLLN           *\n      *                                                                *\n      ******************************************************************\n\n\n       01  LECHCLLN-ROUTINE-POINTER   PROCEDURE-POINTER.\n       01  LECHCLLN-TOKEN             PIC 9(9) COMP VALUE 0.\n       01  CURSOR-MOVE             PIC 9(9) COMP.\n\n\n\n      ******************************************************************\n      *                                                                *\n      * DATA AREAS USED TO KEEP TRACK OF HISTORY OF DUMPS              *\n      *                                                                *\n      ******************************************************************\n\n\n       01  UNIQUE-INT-NUMBER            PIC 9(9) COMP VALUE 0.\n       01  BIN-INT-NUMBER              PIC 9(9) COMP VALUE 0.\n       01  CURR-INT-ADDR-PTR            USAGE POINTER.\n       01  CURR-INT-ADDR-COMP\n           REDEFINES CURR-INT-ADDR-PTR            PIC 9(9) COMP.\n\n       01  INT-ADDRES                   PIC X(400)  VALUE LOW-VALUES.\n       01  FILLER REDEFINES INT-ADDRES.\n      *    customise max number of different interrupts tolerated\n           04  INT-ADDR OCCURS 100 INDEXED BY\n               INT-ADDR-IX.\n               07  INT-ADDR-PTR             USAGE POINTER.\n               07  INT-ADDR-COMP\n                   REDEFINES INT-ADDR-PTR\n                   PIC 9(9) COMP.\n\n\n\n\n      *****************************************************************\n      *\n      * UTILITY AREAS\n      *\n      *****************************************************************\n\n\n        01   W-ILC                   PIC 9(4) COMP VALUE 0.\n\n\n       LINKAGE SECTION.\n\n       01  LINKAGE-tenbyTES              PIC X(10).\n\n       01  LINKAGE-MSIB                  PIC X(100).\n\n       01  LINKAGE-BYTE                PIC X.\n\n           COPY CEEIGZCI REPLACING CEECIB BY LINKAGE-CEECIB.\n\n       01  TOKEN                   PIC 9(9) COMP.\n\n       01  RESULT                  PIC 9(9) COMP.\n           88 RESUME                   VALUE 10.\n           88 PERCOLATE                VALUE 20.\n\n       01  CURCOND.\n\n           04  CURCOND-CONDITION-TOKEN-VALUE.\n           COPY  CEEIGZCT.\n               07  CURCOND-CASE-1-CONDITION-ID.\n                   10  CURCOND-SEVERITY        PIC S9(4) COMP.\n                   10  CURCOND-MSG-NO          PIC S9(4) COMP.\n               07  CURCOND-CASE-2-CONDITION-ID\n                         REDEFINES CURCOND-CASE-1-CONDITION-ID.\n                   10  CURCOND-CLASS-CODE      PIC S9(4) COMP.\n                   10  CURCOND-CAUSE-CODE      PIC S9(4) COMP.\n               07  CURCOND-CASE-SEV-CTL    PIC X.\n               07  CURCOND-FACILITY-ID     PIC XXX.\n           04  CURCOND-I-S-INFO        PIC 9(9) COMP.\n\n       01  NEWCOND.\n\n           04  NEWCOND-CONDITION-TOKEN-VALUE.\n           COPY  CEEIGZCT.\n               07  NEWCOND-CASE-1-CONDITION-ID.\n                   10  NEWCOND-SEVERITY        PIC S9(4) COMP.\n                   10  NEWCOND-MSG-NO          PIC S9(4) COMP.\n               07  NEWCOND-CASE-2-CONDITION-ID\n                         REDEFINES NEWCOND-CASE-1-CONDITION-ID.\n                   10  NEWCOND-CLASS-CODE      PIC S9(4) COMP.\n                   10  NEWCOND-CAUSE-CODE      PIC S9(4) COMP.\n               07  NEWCOND-CASE-SEV-CTL    PIC X.\n               07  NEWCOND-FACILITY-ID     PIC XXX.\n           04  NEWCOND-I-S-INFO        PIC 9(9) COMP.\n\n\n       PROCEDURE DIVISION USING\n           CURCOND, TOKEN, RESULT, NEWCOND.\n\n\n           PERFORM NEST-HANDLER\n\n           PERFORM FILTER-CONDITIONS\n\n           PERFORM OBTAIN-CIB\n\n\n           ADD 1 TO BIN-INT-NUMBER\n\n      *    /* print out diagnosis in batch */\n\n      *    to stop producing 1000's of messages, we keep track of\n      *    the location of each unique interrupt and only dump\n      *    once at each interrupt\n\n\n           SET CURR-INT-ADDR-PTR TO CIB-INT OF CEECIB\n           SET INT-ADDR-IX TO 1\n           SEARCH INT-ADDR\n           AT END\n               ADD 1 TO UNIQUE-INT-NUMBER\n           WHEN INT-ADDR-PTR(INT-ADDR-IX) = CURR-INT-ADDR-PTR\n               PERFORM DUMMY-PARA\n           WHEN INT-ADDR-COMP(INT-ADDR-IX) = 0\n               SET INT-ADDR-PTR(INT-ADDR-IX)\n               TO CURR-INT-ADDR-PTR\n               ADD 1 TO UNIQUE-INT-NUMBER\n               MOVE UNIQUE-INT-NUMBER TO display-int-number\n               PERFORM SET-TITLE\n               MOVE CEE3DMP-TITLE TO LECHCON\n               PERFORM SEND-MSG-LECHCON\n               MOVE '                                      ****'\n                                  TO LECHCON\n               PERFORM SEND-MSG-LECHCON\n               MOVE '                                          '\n                                  TO LECHCON\n               PERFORM SEND-MSG-LECHCON\n\n      *    customise max number of LE dumps issued in a step\n               IF UNIQUE-INT-NUMBER < 11\n                   PERFORM CALL-DUMPER\n               END-IF\n      *    customise max number of different interrupts tolerated\n               IF UNIQUE-INT-NUMBER > 99\n                   CALL \"LECHCON\" USING BY CONTENT '   $'\n                   CALL \"LECHCON\" USING BY CONTENT\n          \"C LECHCL MAX UNIQUE INTERRUPTS EXCEEDED - JOB ENDS$\"\n               END-IF\n           END-SEARCH\n           PERFORM POPUP-OR-RESUME\n\n      *    You should never get here\n\n           CALL \"LECHCON\" USING BY CONTENT '   $'\n           CALL 'LECHCON' USING BY CONTENT\n           'C LECHCL - run on past popup$'\n           STOP RUN\n\n\n\n\n           .\n\n       FILTER-CONDITIONS.\n      *    DISPLAY \"FILTER-CONDITIONS\"  DATA-EXTRACT-INDEX\n      *    DISPLAY \"CURCOND=(\" CURCOND \")\"\n\n      *\n      *    GOBACK WITH PERCOLATE UNLESS CONDITION IS ONE WE ARE\n      *    PREPARED TO HANDLE\n      *\n\n           MOVE \"N\" TO SPECIFICATION\n\n           EVALUATE TRUE\n           WHEN CEE341 OF CURCOND\n               MOVE \"Operation\" TO ERROR-TYPE\n           WHEN CEE342 OF CURCOND\n               MOVE \"Priviliged_operation\" TO ERROR-TYPE\n           WHEN CEE343 OF CURCOND\n               MOVE \"Execute            \" TO ERROR-TYPE\n           WHEN CEE344 OF CURCOND\n               MOVE \"Protection            \" TO ERROR-TYPE\n           WHEN CEE345 OF CURCOND\n               MOVE \"Addressing               \" TO ERROR-TYPE\n           WHEN CEE346 OF CURCOND\n               MOVE \"Specification            \" TO ERROR-TYPE\n               MOVE 'Y' TO SPECIFICATION\n           WHEN CEE347 OF CURCOND\n               MOVE \"Decimal_Data    \" TO ERROR-TYPE\n           WHEN CEE348 OF CURCOND\n               MOVE \"Fixed_point_overflow            \" TO ERROR-TYPE\n           WHEN CEE349 OF CURCOND\n               MOVE \"Fixed_point_divide            \" TO ERROR-TYPE\n           WHEN CEE34A OF CURCOND\n               MOVE \"Decimal_overflow            \" TO ERROR-TYPE\n           WHEN CEE34B OF CURCOND\n               MOVE \"Decimal_divide            \" TO ERROR-TYPE\n           WHEN CEE34C OF CURCOND\n               MOVE \"Exponent_overflow            \" TO ERROR-TYPE\n           WHEN CEE34D OF CURCOND\n               MOVE \"Exponent_underflow            \" TO ERROR-TYPE\n           WHEN CEE34E OF CURCOND\n               MOVE \"Significance            \" TO ERROR-TYPE\n           WHEN CEE34F OF CURCOND\n               MOVE \"Floating_point_divide            \" TO ERROR-TYPE\n           WHEN OTHER\n               SET PERCOLATE TO TRUE\n               GOBACK\n           END-EVALUATE\n           .\n\n       OBTAIN-CIB.\n      *    display \"OBTAIN-CIB\"         data-extract-index\n\n\n\n           MOVE ALL \"?\" TO CEECIB\n           CALL \"CEE3CIB\" USING CURCOND CIB-PTR FEEDBACK\n           IF NOT CEE000 OF FEEDBACK\n               PERFORM SEND-MSG-TEXT\n               STRING \"LECHCLL: Bad feedback calling CEE3CIB \"\n               DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n               PERFORM SEND-MSG-TEXT\n               PERFORM SEND-MSG-FEEDBACK\n               PERFORM SEND-MSG-TEXT\n           ELSE\n               SET ADDRESS OF LINKAGE-CEECIB TO CIB-PTR\n               MOVE LINKAGE-CEECIB TO CEECIB\n               SET TRUE-INT TO CIB-INT OF CEECIB\n               SET TRUE-RESUME TO CIB-RSM-POINT OF CEECIB\n               IF TRUE-RESUME = TRUE-INT\n                   MOVE \"Y\" TO INT-RESUME-SAME\n               END-IF\n      *\n      *    IF THE RESUME POINTER IS AT LESS THAN 4096 WE ARE IN LOW CORE\n      *\n               MOVE \"N\" TO LOW-CORE\n               MOVE 0 TO WRKCNT\n               CALL \"LECHCLL4\" USING TRUE-INT WRKCNT WRKCNT-2\n               IF WRKCNT-2 < 4096\n                   MOVE \"Y\" TO LOW-CORE\n               ELSE\n      *\n      *    SET INST LEN\n      *\n                   CALL \"LECHCLL4\" USING TRUE-RESUME TRUE-INT WRKCNT-2\n\n                   MOVE ALL '?' TO MODULE-INT\n\n               END-IF\n\n           END-IF\n\n           .\n\n       SEt-TITLE.\n      *    display \"SEND-MSG-LECHCON\"\n\n      *    1)  GET HEADER STRING\n\n           MOVE \" \" TO CEE3DMP-TITLE\n\n           SET CODE-POINTER TO TRUE-INT\n           SUBTRACT 4 FROM CODE-POINTER-N\n           SET ADDRESS OF LINKAGE-tenbyTES TO CODE-POINTER\n           MOVE ALL '?' TO ten-bytes\n           CALL \"LECHCVX\" USING\n           LINKAGE-tenbyTES\n           ten-bytes\n           BY CONTENT LENGTH OF\n           LINKAGE-tenbyTES\n\n           CALL \"LECHCVX\" USING\n           CIB-INT OF CEECIB\n           HEX-DATA-4-2\n           BY CONTENT LENGTH OF\n           CIB-INT OF CEECIB\n\n           STRING\n           \"  INTERRUPT \" DELIMITED SIZE\n           display-int-number\n           \" AT \" DELIMITED SIZE\n           HEX-DATA-4-2 DELIMITED SIZE\n           \" - \" DELIMITED SIZE\n           \"'\"   DELIMITED SIZE\n           ten-bytes DELIMITED SIZE\n           \"' \"   DELIMITED SIZE\n           ERROR-TYPE DELIMITED SIZE\n           \" \" DELIMITED SIZE\n           INTO CEE3DMP-TITLE\n\n           .\n\n\n       SEND-MSG-LECHCON.\n      *    display \"SEND-MSG-LECHCON\"\n\n\n           INSPECT  LECHCON CONVERTING \"_\" TO \" \"\n           CALL \"LECHCON\" USING LECHCON\n\n           .\n\n       CALL-DUMPER.\n      *    DISPLAY \"CALL-DUMPER\"\n      *    customise max number of dumps issued\n           IF W-DUMP-COUNT < 10\n               MOVE CEE3DMP-TITLE TO IDISNAP-TITLE(1:40)\n               CALL W-IDISNAP USING BY CONTENT '0001'\n                                    BY REFERENCE IDISNAP-TITLE\n               ON EXCEPTION\n                   PERFORM DUMMY-PARA\n                   CALL \"CEE3DMP\" USING CEE3DMP-TITLE CEE3DMP-OPTIONS\n                   FEEDBACK\n                   END-CALL\n               END-CALL\n               ADD 1 TO W-DUMP-COUNT\n           END-IF\n\n\n           .\n\n       SEND-MSG-FEEDBACK.\n      *    DISPLAY \"SEND-MSG-FEEDBACK\"\n\n           PERFORM SEND-MSG-TEXT\n\n           MOVE FEEDBACK-SEVERITY TO EDITNUM\n           STRING \"                  Severity = \" EDITNUM\n           DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n           PERFORM SEND-MSG-TEXT\n           MOVE FEEDBACK-MSG-NO TO EDITNUM\n           STRING \"                  Msg-No   = \" EDITNUM\n           DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n           PERFORM SEND-MSG-TEXT\n           MOVE FEEDBACK-CASE-SEV-CTL TO EDITNUM\n           STRING \"                  Sev-Ctl  = \" EDITNUM\n           DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n           PERFORM SEND-MSG-TEXT\n           MOVE FEEDBACK-FACILITY-ID TO EDITNUM\n           STRING \"                  Facility = \" EDITNUM\n           DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n           PERFORM SEND-MSG-TEXT\n           MOVE FEEDBACK-I-S-INFO TO EDITNUM\n           STRING \"                  I-S-Info = \" EDITNUM\n           DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n           PERFORM SEND-MSG-TEXT\n           .\n\n\n\n       SEND-MSG-TEXT.\n      *    display \"SEND-MSG-TEXT\"\n      *    CEEMOUT-MSG-TEXT\n\n           CALL \"CEEMOUT\" USING CEEMOUT-MSG CEEMOUT-DEST FEEDBACK\n           MOVE \" \" TO CEEMOUT-MSG-TEXT\n           .\n\n           .\n       NEST-HANDLER.\n      *    display \"NEST-HANDLER\"\n\n           SET LECHCLLN-ROUTINE-POINTER TO ENTRY \"LECHCLLN\"\n\n           CALL \"CEEHDLR\" USING LECHCLLN-ROUTINE-POINTER LECHCLLN-TOKEN\n                                FEEDBACK\n\n           IF FEEDBACK-SEVERITY NOT = 0\n               STRING \"LECHCLL ERROR CALLING CEEHDLR\"\n               DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n               PERFORM SEND-MSG-TEXT\n\n               PERFORM SEND-MSG-FEEDBACK\n           END-IF\n\n           .\n\n       POPUP-OR-RESUME.\n      *    display \"POPUP-OR-RESUME\"\n\n      *\n      *\n      *    CONDITIONS WHICH REQUIRE POP ONE LEVEL UP\n      *\n      *\n           IF LOW-CORE = \"Y\"\n               CALL \"LECHCON\"   USING BY CONTENT '  $'\n               CALL \"LECHCON\"   USING BY CONTENT\n               \"C LECHCL LOW CORE - JOB ABENDED$\"\n               STOP RUN\n           END-IF\n      *\n      *    display \"POPUP \" data-extract-index\n      *\n           IF INT-RESUME-SAME = \"Y\"\n           OR WILD-BRANCH = \"Y\"\n\n      *    display \"POPUP -popped\"\n               MOVE 0 TO CURSOR-MOVE\n               CALL \"CEEMRCR\" USING CURSOR-MOVE FEEDBACK\n               IF FEEDBACK-SEVERITY NOT = 0\n                   ADD 1 TO ERROR-WRKCNT\n                   IF ERROR-WRKCNT > 1000\n                       CALL \"LECHCON\"   USING BY CONTENT '  $'\n                       CALL \"LECHCON\" USING BY CONTENT\n                       \"C LECHCLL EXCESSIVE NUMBER OF INTERNAL ERRORS$\"\n                   END-IF\n                   STRING \"          LECHCLL error calling CEEMRCR\"\n                   DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n                   PERFORM SEND-MSG-TEXT\n                   PERFORM SEND-MSG-FEEDBACK\n               END-IF\n\n               PERFORM UNNEST-AND-RESUME\n           END-IF\n      *\n\n           PERFORM UNNEST-AND-RESUME\n           .\n\n       DUMMY-PARA.\n      *    display \"DUMMY-PARA\"\n           EXIT\n\n           .\n\n       UNNEST-AND-RESUME.\n      *    display \"UNNEST-AND-RESUME\"\n\n      *    REMOVE HANDLER LECHCLN\n\n           CALL \"CEEHDLU\" USING LECHCLLN-ROUTINE-POINTER\n                                FEEDBACK\n           IF FEEDBACK-SEVERITY NOT = 0\n               ADD 1 TO ERROR-WRKCNT\n               IF ERROR-WRKCNT > 1000\n                   CALL \"LECHCON\"   USING BY CONTENT '  $'\n                   CALL \"LECHCON\" USING BY CONTENT\n                   \"C LECHCLL EXCESSIVE NUMBER OF INTERNAL ERRORS$\"\n               END-IF\n               STRING \"LECHCLL ERROR CALLING CEEHDLU\"\n               DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n               PERFORM SEND-MSG-TEXT\n               PERFORM SEND-MSG-FEEDBACK\n           END-IF\n           SET RESUME TO TRUE\n           GOBACK\n           .\n\n\n       END PROGRAM 'LECHCLL'.\n\n\n\n      ******************************************************************\n      *      LECHCLL4 - GIVEN TWO ADDRESSES, RETURN DIFFERENCE         *\n      *                 GIVEN ADDRESSES HAVE BIT 0 TRIMMED OFF         *\n      *                 ALWAYS.                                        *\n      *                                                                *\n      *                 NOTE WE CANNOT SIMPLY SUBTRACT PIC S9(8) COMP  *\n      *                 FIELDS BECAUSE OF THE WAY COBOL TREATS THEM    *\n      *                                                                *\n      *                 REQUIRES TRUNC(OPT)                            *\n      *                                                                *\n      ******************************************************************\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID. 'LECHCLL4'.\n       DATA DIVISION.\n\n       WORKING-STORAGE SECTION.\n\n       01  W-NUM-1           PIC S9(18) COMP.\n       01  W-NUM-1-X REDEFINES W-NUM-1  PIC X(8).\n       01  W-NUM-2           PIC S9(18) COMP.\n       01  W-NUM-2-X REDEFINES W-NUM-2  PIC X(8).\n\n       LINKAGE SECTION.\n\n       01  FIRST-ADDR       PIC XXXX.\n       01  SECOND-ADDR      PIC XXXX.\n       01  DIFF             PIC XXXX.\n\n       PROCEDURE DIVISION USING FIRST-ADDR SECOND-ADDR DIFF.\n\n           MOVE 0 TO W-NUM-1\n           MOVE 0 TO W-NUM-2\n\n           MOVE FIRST-ADDR TO W-NUM-1-X(5:)\n           IF W-NUM-1 > (2 ** 31)\n               COMPUTE W-NUM-1 = W-NUM-1 - (2 ** 31)\n           END-IF\n\n           MOVE SECOND-ADDR TO W-NUM-2-X(5:)\n           IF W-NUM-2 > (2 ** 31)\n               COMPUTE W-NUM-2 = W-NUM-2 - (2 ** 31)\n           END-IF\n\n           COMPUTE W-NUM-2 = W-NUM-1 - W-NUM-2\n\n           MOVE W-NUM-2-X(5:) TO DIFF\n\n           GOBACK.\n\n       END PROGRAM 'LECHCLL4'.\n\n\n\n      ******************************************************************\n      *                                                                *\n      * LECHCLLN IS A NESTED ERROR HANDLER WHICH SIMPLY GOES BACK      *\n      *                                                                *\n      * IT IS SET UP AT THE START OF LECHCLL  AND CANCELLED AT THE     *\n      * END OF LECHCLL                                                 *\n      *                                                                *\n      * THE POINT IS MERELY TO INTERCEPT ANY ERRORS IN LECHCLDA. IT    *\n      * DOES NOT FLAG THESE ERRORS - THEY MUST BE DETECTED BY LECHCLDA *\n      *                                                                *\n      ******************************************************************\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID. 'LECHCLLN'.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n       01  FEEDBACK.\n           04  FEEDBACK-CONDITION-TOKEN-VALUE.\n               07  FEEDBACK-CASE-1-CONDITION-ID.\n                   10  FEEDBACK-SEVERITY        PIC S9(4) COMP.\n                   10  FEEDBACK-MSG-NO          PIC S9(4) COMP.\n               07  FEEDBACK-CASE-2-CONDITION-ID\n                         REDEFINES FEEDBACK-CASE-1-CONDITION-ID.\n                   10  FEEDBACK-CLASS-CODE      PIC S9(4) COMP.\n                   10  FEEDBACK-CAUSE-CODE      PIC S9(4) COMP.\n               07  FEEDBACK-CASE-SEV-CTL    PIC X.\n               07  FEEDBACK-FACILITY-ID     PIC XXX.\n           04  FEEDBACK-I-S-INFO        PIC 9(9) COMP.\n\n       01  ERROR-WRKCNT            PIC 9(9) COMP VALUE 0.\n       01  CEEMOUT-MSG.\n           04  CEEMOUT-MSG-LEN               PIC S9(4) COMP VALUE 80.\n           04  CEEMOUT-MSG-TEXT              PIC X(80).\n\n       01  CEEMOUT-DEST                  PIC S9(9) COMP VALUE 2.\n\n       01  EDITNUM                       PIC ZZZZZZZZ9.\n\n       LINKAGE SECTION.\n\n\n       01  TOKEN                   PIC 9(9) COMP.\n\n       01  RESULT                  PIC 9(9) COMP.\n           88 RESUME                   VALUE 10.\n\n       01  CURCOND.\n\n           04  CURCOND-CONDITION-TOKEN-VALUE.\n           COPY  CEEIGZCT.\n               07  CURCOND-CASE-1-CONDITION-ID.\n                   10  CURCOND-SEVERITY        PIC S9(4) COMP.\n                   10  CURCOND-MSG-NO          PIC S9(4) COMP.\n               07  CURCOND-CASE-2-CONDITION-ID\n                         REDEFINES CURCOND-CASE-1-CONDITION-ID.\n                   10  CURCOND-CLASS-CODE      PIC S9(4) COMP.\n                   10  CURCOND-CAUSE-CODE      PIC S9(4) COMP.\n               07  CURCOND-CASE-SEV-CTL    PIC X.\n               07  CURCOND-FACILITY-ID     PIC XXX.\n           04  CURCOND-I-S-INFO        PIC 9(9) COMP.\n\n       01  NEWCOND.\n\n           04  NEWCOND-CONDITION-TOKEN-VALUE.\n           COPY  CEEIGZCT.\n               07  NEWCOND-CASE-1-CONDITION-ID.\n                   10  NEWCOND-SEVERITY        PIC S9(4) COMP.\n                   10  NEWCOND-MSG-NO          PIC S9(4) COMP.\n               07  NEWCOND-CASE-2-CONDITION-ID\n                         REDEFINES NEWCOND-CASE-1-CONDITION-ID.\n                   10  NEWCOND-CLASS-CODE      PIC S9(4) COMP.\n                   10  NEWCOND-CAUSE-CODE      PIC S9(4) COMP.\n               07  NEWCOND-CASE-SEV-CTL    PIC X.\n               07  NEWCOND-FACILITY-ID     PIC XXX.\n           04  NEWCOND-I-S-INFO        PIC 9(9) COMP.\n\n\n       PROCEDURE DIVISION USING\n           CURCOND, TOKEN, RESULT, NEWCOND.\n\n      *    DISPLAY 'LECHCLLN ENTERED'\n\n           ADD 1 TO ERROR-WRKCNT\n           IF ERROR-WRKCNT > 1000\n               CALL 'LECHCON' USING BY CONTENT '  $'\n               CALL 'LECHCON' USING BY CONTENT\n               'C LECHCLDA EXCESSIVE NUMBER OF INTERNAL ERRORS$'\n           END-IF\n           SET RESUME TO TRUE\n      *    DISPLAY 'LECHCLLN norm ret'\n           GOBACK\n           .\n\n\n       END PROGRAM 'LECHCLLN'.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n       IDENTIFICATION DIVISION.\n\n       PROGRAM-ID.                    LECHCON.\n\n       ENVIRONMENT DIVISION.\n       INPUT-OUTPUT SECTION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n       01  W-COUNT                   PIC S9(8) COMP.\n\n       01  W-DUMMY                   PIC X(200) VALUE ' '.\n       01  W-STARS                   PIC X(70) VALUE ALL ' '.\n       01  W-DISPLAY.\n           04  W-DISPLAY-START       PIC X VALUE  '*'.\n           04  W-DISPLAY-MID         PIC X(70) VALUE ALL ' '.\n       01  W-LAST-MSG-CHAR           PIC X     VALUE     ' '.\n       01  W-LASTLINE.\n           04  W-LASTLINE-START PIC X(27) VALUE ALL '*'.\n           04  W-LASTLINE-MID   PIC X(16) VALUE\n           ' LECHCON CLASS '.\n           04  W-LASTLINE-TYPE  PIC X VALUE     '?'.\n           04  FILLER           PIC X VALUE     ' '.\n           04  W-LASTLINE-END   PIC X(25) VALUE ALL '*'.\n\n       LINKAGE SECTION.\n\n       01  CON-MSG                   PIC X(82).\n\n       01  CON-REPLY                 PIC X(82).\n\n       01  CON-REPLY-LEN             PIC S9(8) COMP.\n\n\n       PROCEDURE DIVISION USING CON-MSG CON-REPLY CON-REPLY-LEN.\n\n           MOVE 1 TO W-COUNT\n           PERFORM VARYING W-COUNT FROM 1 BY 1\n           UNTIL W-COUNT = LENGTH OF CON-MSG\n           OR CON-MSG(W-COUNT:1) = '$'\n           END-PERFORM\n\n           SUBTRACT 2 FROM W-COUNT\n\n           IF W-COUNT < 1\n               MOVE 1 TO W-COUNT\n           END-IF\n\n\n           MOVE CON-MSG(2:W-COUNT) TO W-DISPLAY-MID\n\n           DISPLAY W-DISPLAY UPON CONSOLE\n\n           IF CON-MSG(1:1) = 'C'\n\n               MOVE 2000 TO RETURN-CODE\n               STOP RUN\n\n           END-IF\n\n           MOVE 0 TO RETURN-CODE\n\n           GOBACK.\n       END PROGRAM LECHCON.\n\n       IDENTIFICATION DIVISION.\n\n       PROGRAM-ID.     LECHCVX.\n\n      * MODULE TO CONVERT CHARS TO HEX\n      *\n      * MODIFICATION HISTORY:\n      *\n\n       ENVIRONMENT DIVISION.\n\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n\n       01  CHARS-POINTER       PIC S9(8) COMP.\n\n       01  HEX-POINTER         PIC S9(8) COMP.\n\n       01  TAB-INDX.\n       04  TAB-IND             PIC S9(8) COMP.\n\n       01  TAB.\n        04 T0 PIC X(32) VALUE  '000102030405060708090A0B0C0D0E0F'.\n        04 T1 PIC X(32) VALUE  '101112131415161718191A1B1C1D1E1F'.\n        04 T2 PIC X(32) VALUE  '202122232425262728292A2B2C2D2E2F'.\n        04 T3 PIC X(32) VALUE  '303132333435363738393A3B3C3D3E3F'.\n        04 T4 PIC X(32) VALUE  '404142434445464748494A4B4C4D4E4F'.\n        04 T5 PIC X(32) VALUE  '505152535455565758595A5B5C5D5E5F'.\n        04 T6 PIC X(32) VALUE  '606162636465666768696A6B6C6D6E6F'.\n        04 T7 PIC X(32) VALUE  '707172737475767778797A7B7C7D7E7F'.\n        04 T8 PIC X(32) VALUE  '808182838485868788898A8B8C8D8E8F'.\n        04 T9 PIC X(32) VALUE  '909192939495969798999A9B9C9D9E9F'.\n        04 TA PIC X(32) VALUE  'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'.\n        04 TB PIC X(32) VALUE  'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'.\n        04 TC PIC X(32) VALUE  'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'.\n        04 TD PIC X(32) VALUE  'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'.\n        04 TE PIC X(32) VALUE  'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'.\n        04 TF PIC X(32) VALUE  'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'.\n\n\n\n\n       LINKAGE SECTION.\n\n       01  CHARS               PIC X(100000).\n\n       01  HEX                 PIC X(200000).\n\n       01  LEN                 PIC S9(8) COMP.\n\n\n       PROCEDURE DIVISION USING CHARS HEX LEN.\n\n\n           MOVE 'N' TO HEX(1:1)\n\n           IF LEN NOT > 0 GOBACK END-IF\n\n           MOVE 1 TO CHARS-POINTER\n           MOVE 1 TO  HEX-POINTER\n\n           PERFORM UNTIL CHARS-POINTER > LEN\n\n\n               MOVE 0 TO TAB-IND\n               MOVE CHARS(CHARS-POINTER:1) TO TAB-INDX(4:1)\n               COMPUTE TAB-IND = (TAB-IND * 2) + 1\n               MOVE TAB(TAB-IND:2) TO HEX(HEX-POINTER:2)\n               ADD 1 TO CHARS-POINTER\n               ADD 2 TO  HEX-POINTER\n\n\n           END-PERFORM\n\n           GOBACK.\n./ ADD NAME=LECHDOC  0117-02010-09167-1616-00190-01389-00000-TSO057\n                                                           Ver 1.1\n                                                            8 Apr 2005\n\n\n  FUNCTION - GENERAL DESCRIPTION\n  ------------------------------\n\n\n  1.  LECH is a Language Environment CONDITION HANDLER.\n\n      It will intercept conditions that would make a program abend and\n      allow the program to continue\n\n      It will print out a message and a dump when an interrupt occurs\n      and then return to the interrupted program at the next machine\n      instruction so the program can continue\n\n\n\n      The conditions handled are the classic ones:\n\n                     Operation\n                     Priviliged_operation\n                     Execute\n                     Protection\n                     Addressing\n                     Specification\n                     Decimal_Data\n                     Fixed_point_overflow\n                     Fixed_point_divide\n                     Decimal_overflow\n                     Decimal_divide\n                     Exponent_overflow\n                     Exponent_underflow\n                     Significance\n                     Floating_point_divide\n\n\n      LECH will put out a message and a dump the first time a condition\n      occurs at any particular address.  Control is then returned to the\n      abending program, and it may continue to run.\n\n      If a condition recurs later at the same address no action will be\n      taken.\n\n      Up to 100 different unique conditions can be intercepted (this\n      limit is customisable).   After that the program is allowed to\n      abend.\n\n      The message has form eg\n\n\n       INTERRUPT  1 AT 24701132 - '2008A17DFA402008A040' Decimal Data\n                                           ****\n                                           |\n                                       interrupt here\n\n\n      As an aid to debugging 4 bytes before and 6 bytes after the\n      interrupt are displayed in hex.\n\n\n      LECH then attempts to invoke IDISNAP (Fault Analyzer) to print\n      off a proper analysis.  If IDISNAP is not available, LECH will\n      call CEE3DMP instead.\n\n\n\n\n  2.  To use LECH, code\n\n\n            COPY LECHCLD.\n\n\n          in your WORKING-STORAGE, and\n\n\n            COPY LECHCLC.\n\n\n          at the start of your PROCEDURE DIVISION.\n\n\n      Then compile your programs with the LECH COBOL library in the\n      SYSLIB concatenation.\n\n\n      You only need to include these copybooks in your mainline, not any\n      subprograms\n\n\n  3.  Copybooks LECHALC and LECHALD are supplied for use from\n      LE-compliant assembler.\n\n  4.  Headers LECHELC and LECHELD are supplied for use from C/C++\n\n\n\n  HOW TO INSTALL LECH\n  -------------------\n\n\n 10.  Prerequisites:\n\n      o  OS/390, any level\n\n      o  Language Environment, any level.\n\n      o  COBOL II or later\n\n\n\n 11.  To install LECH\n\n      o  The LECH COBOL library is in zipped TSO XMIT format. It is\n         available from:\n\n              http://home.clara.net/andywrobertson/mvsindex.html\n\n         Follow the instructions at that site to download it, unzip it,\n         SEND it to your mainframe as a flat file and TSO RECEIVE it\n         into a library.\n\n      o  Examine member LECHDOC (this member) for any updates\n\n      o  Perform any customisations on the source of LECHCLL.\n         Sections where customisation is recommended are commented\n         (search for the string \"customise\")\n\n      o  Customise and run the job LECHINST. This will put LECHCLL\n         in a load library, which you must create beforehand.  This\n         library must be linklisted or steplibed to your live jobs\n\n      o  You may run LECHIVP1 to demonstrate LECH handling interrupts\n         in COBOL\n\n      o  You may run LECHIVP2 to demonstrate LECH handling interrupts\n         in LE COMPLIANT ASSSEMBLER\n\n      o  You may run LECHIVP3 to demonstrate LECH handling interrupts\n         in C/C++\n\n      o  Note you must run with TRAP(ON).  I assume this is a universal\n         default.\n\n\n\n\n  SAMPLE ROUTINE LECHMOVE\n  -----------------------\n\n\n 20.  This has nothing to do with LECH but it is supplied in case you\n      may find it useful. The idea is a callable subroutine which\n      will move data between two locations if the locations are\n      accessible, but will return a flag rather than abend if the\n      data cannot be accessed or if the to-field is protected.\n\n\n\n           CALL 'LECHMOVE' USING FROM-FIELD\n                                 TO-FIELD\n                                 MOVE-LENGTH\n                                 REPLY-FLAG\n\n      REPLY-FLAG is set to 'V' if the move is successful, 'N' if not.\n\n\n\n\n  SAMPLE ROUTINE LECHNL\n  ---------------------\n\n\n 30.  This is a NON-LE routine that can be called from non-LE programs.\n      It sets an ESTAE and traps abends, restarting the abending\n      program with a message.\n\n      To use it code:\n\n\n           CALL 'LECHNL'\n\n      at the beginning of your program\n\n\n      It needs the INSTASM routines available from\n           http://home.clara.net/andywrobertson/mvsindex.html\n\n./ ADD NAME=LECHELC  0112-02011-02011-1230-00013-00013-00000-TSO057\n\n     lechcl_routine_pointer.address\n     = (lechcl_funcV *) fetch(\"LECHCLL\");\n     lechcl_routine_pointer.nesting = NULL;\n\n     CEEHDLR(&lechcl_routine_pointer,&lechcl_token,&lechcl_fc);\n\n     if (_FBCHECK (lechcl_fc, CEE000) != 0)\n         ??<\n         printf(\"INITIALISATION OF LECHCLL FAILED\");\n         return;\n         ??>;\n\n./ ADD NAME=LECHELD  0109-02011-02011-1230-00011-00013-00000-TSO057\n       #include <leawi.h>\n       #include <ceeedcct.h>\n\n\n       _ENTRY lechcl_routine_pointer;\n       _INT4  lechcl_token;\n       _FEEDBACK lechcl_fc;\n\n        typedef void lechcl_funcV();\n        #pragma linkage(lechcl_funcV, COBOL)\n\n./ ADD NAME=LECHINST 0109-02010-09166-1651-00080-00044-00000-TSO057\n//TSO057X JOB (T951V57),                                                JOB09309\n//           CLASS=A,MSGCLASS=T,REGION=300M,\n//           NOTIFY=TSO057\n// INCLUDE MEMBER=SYSLEV\n//*\n//*\n//******************************************************************\n//*                                                                *\n//*  THIS JOB WILL COMPILE AND LINK LECHCLL INTO A                 *\n//*  LOAD LIBRARY, WHICH YOU MUST PRE-ALLOCATE BEFORE RUNNING      *\n//*                                                                *\n//*  THIS LIBRARY MUST BE LINKLISTED OR STEPLIBED TO ANY PROGRAM   *\n//*  THAT USES LECHCLL                                             *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 12 JAN 2002 1.0  WRITTEN                                  AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        PP.LECH.COBOL - TO THE LECHCLL COBOL LIBRARY\n//*\n//*        JLP.TEST.LOADLIB  - TO THE LOAD LIBRARY WHERE YOU WANT\n//*                            LECHCLL TO BE STORED\n//*\n//*        SYS1. LIBRARIES    - AS APPROPRIATE\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*\n//* COBOL COMPILE - NB COMPILE OPTIONS NOSSRANGE,RENT\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,\n// PARM=('NOOFFSET,NOSSRANGE,RENT,LIST',\n//       'NODYNAM,LIB,APOST,NOCICS,TRUNC(OPT)')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB  DD   DISP=SHR,DSN=PP.LECH.COBOL                  <== CHANGE\n//         DD   DSN=SYS1.&SYSMINL..ACEESRC1,DISP=SHR       <== CHANGE\n//SYSIN    DD   DSN=PP.LECH.COBOL(LECHCLL),DISP=SHR        <== CHANGE\n//*\n//*\n//* LINKEDIT\n//*\n//*\n//* STANDARD LINKEDIT PROC\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,RENT,REUS')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLMOD  DD   DSN=JLP.TEST.LOADLIB(LECHCLL),DISP=SHR     <== CHANGE\n//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.&SYSMINL..SCEELKED,DISP=SHR       <== CHANGE\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//         DD   *\n//*\n./ ADD NAME=LECHIVPA 0199-99026-05108-0945-00053-00007-00000-TSO057\n*\n*\n* THIS IS A SAMPLE LE COMPLIANT ASSEMBLER PROGRAM USING LECH\n*\n*\n\n\n\n\n* LE COMPLIANT ENTRY\nLECHIVPA CEEENTRY MAIN=YES,PPA=LECHIVPARMPPA,BASE=11,PLIST=MVS\n*\n\n         USING LECHIVPA,11\n\n\n*\n* COPYBOOK 1\n*\n         COPY LECHALC\n\n\n*\n* MAKE THE ABEND\n*\n         LA   1,0\n         LA   2,0\n         LA   3,0\n         LA   4,0\n         DR   2,1\n\n\n         L    4,=A(X'00FFFF00')\n         BR   4\n\n* LE COMPLIANT TERMINATION\n         CEETERM RC=0\n         LTORG\nLECHIVPARMPPA CEEPPA\n         CEEDSA\n         CEECAA\n\n\n\n\n\n\nLECHIVPA CSECT\n\n*\n* COPYBOOK 2\n*\n         COPY LECHALD\n./ ADD NAME=LECHIVPC 0102-02011-03021-1045-00040-00040-00000-TSO057\n       IDENTIFICATION DIVISION.\n\n       PROGRAM-ID.        'LECHIVPC'.\n\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE  SECTION.\n\n       01  ADDR-X.\n           04  ADDR   PIC S9(8) COMP VALUE 0.\n\n       01  AAA-X.\n           04   AAA   PIC S9(8) COMP-3.\n\n\n       01  W-0  PIC S9(8) COMP VALUE 0.\n       01  W-1  PIC S9(8) COMP VALUE 1.\n       01  W-2  PIC S9(8) COMP VALUE 2.\n\n           COPY LECHCLD.\n\n\n       PROCEDURE DIVISION.\n\n\n           COPY LECHCLC.\n\n\n\n           PERFORM 3 TIMES\n               MOVE ' ' TO AAA-X\n               ADD 1 TO AAA\n               DIVIDE W-1 BY W-0 GIVING W-2\n           END-PERFORM\n\n\n           GOBACK.\n\n       END PROGRAM 'LECHIVPC'.\n\n./ ADD NAME=LECHIVPE 0133-99302-02011-1233-00017-00041-00000-TSO057\n  /*          sample c/c++ use of LECH */\n\n  ??=include \"LECHELD.h\"\n\n  main ()\n    ??<\n      int i = 0;\n      int j = 0;\n      int k = 0;\n\n      ??=include \"LECHELC.h\"\n\n      i = j / k;\n\n      return;\n\n  ??>\n./ ADD NAME=LECHIVP1 0105-02011-09166-1651-00078-00077-00000-TSO057\n//TSO057X JOB (T951V57),\n//           CLASS=A,MSGCLASS=T,REGION=300M,\n//           NOTIFY=TSO057\n// INCLUDE MEMBER=SYSLEV\n//*\n//*\n//*\n//******************************************************************\n//*                                                                *\n//*  THIS JOB WILL COMPILE AND LINK LECHIVPC, AND RUN IT           *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 12 JAN 2002 1.0  WRITTEN                                  AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        PP.LECH.COBOL - TO THE LECHCLL COBOL LIBRARY\n//*\n//*        JLP.TEST.LOADLIB  - TO THE LOAD LIBRARY WHERE YOU WANT\n//*                            LECHCLL TO BE STORED\n//*\n//*\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,\n// PARM=('NOOFFSET,NOSSRANGE,RENT,LIST',\n//       'NODYNAM,LIB,APOST,NOCICS')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP\n//SYSUT1   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=VIO,SPACE=(6233,(150,300),,,ROUND)\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=VIO,SPACE=(80,(1500,7750))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB  DD   DISP=SHR,DSN=PP.LECH.COBOL                    <===CHANGE\n//         DD   DSN=SYS1.&SYSMINL..ACEESRC1,DISP=SHR         <===CHANGE\n//SYSIN    DD   DSN=PP.LECH.COBOL(LECHIVPC),DISP=SHR         <===CHANGE\n//*\n//*\n//* LINKEDIT\n//*\n//*\n//* STANDARD LINKEDIT PROC\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,RENT,REUS')\n//SYSUT1   DD   UNIT=VIO,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLMOD  DD   DSN=&&LOADLIB(LECHIVPC),DISP=(,PASS),\n//            SPACE=(9991,(9991,1,1)),BLKSIZE=32760,RECFM=U\n//SYSLIB   DD UNIT=VIO,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.&SYSMINL..SCEELKED,DISP=SHR         <===CHANGE\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//         DD   *\n//*\n//* RUN IVP\n//*\n//RUNIVP   EXEC PGM=LECHIVPC\n//STEPLIB  DD   DSN=&&LOADLIB,DISP=SHR\n//         DD   DSN=JLP.TEST.LOADLIB,DISP=SHR                <===CHANGE\n./ ADD NAME=LECHIVP2 0106-02011-05108-0945-00071-00047-00000-TSO057\n//TSO057X JOB (T951V57),'LECHIVPA',                                     JOB04952\n//           CLASS=A,MSGCLASS=T,REGION=300M,\n//           NOTIFY=TSO057\n// INCLUDE MEMBER=SYSLEV\n//*\n//*\n//******************************************************************\n//*                                                                *\n//*  THIS JOB WILL ASSEMBLE AND LINK LECHIVPA, AND RUN IT          *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 12 JAN 2002 1.0  WRITTEN                                  AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        PP.LECH.COBOL - TO THE LECHCLL COBOL LIBRARY\n//*\n//*        JLP.TEST.LOADLIB  - TO THE LOAD LIBRARY WHERE YOU WANT\n//*                            LECHCLL TO BE STORED\n//*\n//*\n//*\n//*\n//ASM      EXEC PGM=ASMA90,COND=(4,LT),\n// PARM='NORLD,XREF(SHORT),DECK,NOOBJECT,LIST,TERM,'\n//SYSTERM  DD   SYSOUT=*\n//SYSPRINT DD   SYSOUT=*\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1700,(600,600))\n//SYSLIN   DD   DUMMY\n//SYSPUNCH DD   DSN=&&OBJ,DISP=(NEW,PASS),\n//         SPACE=(80,(1500,750)),UNIT=SYSALLDA,BLKSIZE=3120\n//SYSLIB   DD   DISP=SHR,DSN=PP.LECH.COBOL      <===CHANGE\n//         DD   DSN=SYS1.&SYSMINL..ACEESRC1,DISP=SHR      <===CHANGE\n//         DD   DSN=SYS1.MACLIB,DISP=SHR                  <===CHANGE\n//SYSIN    DD   DSN=PP.LECH.COBOL(LECHIVPA),DISP=SHR      <===CHANGE\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=24,NORENT,NOREUS')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//         DD   *\n//SYSLIB   DD   DSN=SYS1.&SYSMINL..SCEELKED,DISP=SHR      <===CHANGE\n//SYSLMOD  DD   DSN=&&LOADLIB(LECHIVPA),DISP=(,PASS),\n//            SPACE=(9991,(9991,1,1)),BLKSIZE=32760,RECFM=U\n//*\n//*\n//*\n//*\n//* RUN IVP\n//*\n//RUNIVP   EXEC PGM=LECHIVPA\n//CEEDUMP  DD   SYSOUT=*\n//STEPLIB  DD   DSN=&&LOADLIB,DISP=SHR\n//         DD   DSN=JLP.TEST.LOADLIB,DISP=SHR                <===CHANGE\n./ ADD NAME=LECHIVP3 0106-02011-09166-1658-00112-00067-00000-TSO057\n//TSO057X JOB (T951V57),'LECHIVPE',                                     JOB07358\n//           CLASS=A,MSGCLASS=T,REGION=300M,\n//           NOTIFY=TSO057,SCHENV=SYSAFF\n//*\n// INCLUDE MEMBER=SYSLEV\n//*\n//*\n//******************************************************************\n//*                                                                *\n//*  THIS JOB WILL COMPILE AND LINK LECHIVPE, AND RUN IT           *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 12 JAN 2002 1.0  WRITTEN                                  AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        SFT.LECH.COBOL - TO THE LECHCLL COBOL LIBRARY\n//*\n//*        JLP.TEST.LOADLIB  - TO THE LOAD LIBRARY WHERE YOU WANT\n//*                            LECHCLL TO BE STORED\n//*\n//*        SYS1. LIBRARIES   - AS SUITABLE\n//*\n//*\n//*  STANDARD C COMPILE\n//*\n//COMPILE  EXEC PGM=CCNDRVR,\n// COND=(4,LT),\n// PARM='/OPTF(DD:O)'\n//O DD *\n          AGG SHOW NOSEQ\n               MAR(1,172)\n               INL(AUTO,REPORT,999,999999)\n               EXPMAC RENT LO SO\n               NOSEARCH\n               LIS SS ARCH(7)\n//STEPLIB  DD  DSNAME=SYS1.SYSMINL.SCCNCMP,DISP=SHR\n//SYSMSGS  DD  DUMMY,DSNAME=SYS1.&SYSMINL..SCEEMSGP(EDCMSGE),DISP=SHR\n//SYSLIN   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,\n//             DISP=(NEW,PASS),SPACE=(TRK,(30,30)),\n//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)\n//SYSOUT   DD  SYSOUT=*\n//SYSPRINT DD  SYSOUT=*\n//SYSCPRT  DD  SYSOUT=*\n//SYSUT1   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=80,RECFM=FB\n//SYSUT4   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=80,RECFM=FB\n//SYSUT5   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=3200,RECFM=FB\n//SYSUT6   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=3200,RECFM=FB\n//SYSUT7   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=3200,RECFM=FB\n//SYSUT8   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),LRECL=3200,RECFM=FB\n//SYSUT9   DD  UNIT=SYSALLDA,SPACE=(32000,(90,900)),\n//             DCB=(RECFM=VB,LRECL=137,BLKSIZE=882)\n//SYSUT10  DD  SYSOUT=*\n//SYSUT14  DD  UNIT=SYSALLDA,SPACE=(32000,(90,930)),\n//             DCB=(RECFM=FB,LRECL=3200,BLKSIZE=12800)\n//*\n//USERLIB  DD  DISP=SHR,DSN=PP.LECH.COBOL\n//SYSLIB   DD  DSN=SYS1.&SYSMINL..SCEEH.H,DISP=SHR         <===CHANGE\n//         DD  DSN=SYS1.&SYSMINL..SCEESAMP,DISP=SHR        <===CHANGE\n//         DD  DSN=SYS1.&SYSMINL..SCEEH.SYS.H,DISP=SHR     <===CHANGE\n//SYSIN    DD  DSN=PP.LECH.COBOL(LECHIVPE),DISP=SHR        <===CHANGE\n//*\n//* PRE-LINKEDIT STEP:\n//*\n//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),REGION=7M,\n// PARM=''\n//SYSMSGS  DD  DSNAME=SYS1.&SYSMINL..SCEEMSGP(EDCPMSGE),     <===CHANGE\n//             DISP=SHR\n//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),\n//             SPACE=(32000,(30,30)),\n//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)\n//SYSOUT   DD  SYSOUT=*\n//SYSPRINT DD  SYSOUT=*\n//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)\n//*\n//*\n//*\n//* STANDARD LINKEDIT PROC\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,RENT,REUS')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//         DD   *\n//SYSLIB DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.&SYSMINL..SCEELKED,DISP=SHR         <===CHANGE\n//SYSLMOD  DD   DSN=&&LOADLIB(LECHIVPE),DISP=(,PASS),\n//            SPACE=(9991,(9991,1,1)),BLKSIZE=32760,RECFM=U\n//*\n//*\n//*\n//*\n//* RUN IVP\n//*\n//RUNIVP   EXEC PGM=LECHIVPE\n//STEPLIB  DD   DSN=&&LOADLIB,DISP=SHR\n//         DD   DSN=JLP.TEST.LOADLIB,DISP=SHR                <===CHANGE\n./ ADD NAME=LECHMOVE 0105-05097-05097-1429-00273-00266-00273-TSO057\n000100******************************************************************\n000200*                                                                *\n000300* LECHMOVE is a sample program which is may be used to move      *\n000400* data which may be in invalid or inaccessable locations         *\n000410* to locations which may themselves be invalid or protected.     *\n000420*                                                                *\n000430*                                                                *\n000440* It has its own error handler   which sets the resume cursor    *\n000450* 'one program up' if it is entered.  The effect of this is      *\n000460* to abandon all work in this module and go back to the calling  *\n000470* program.                                                       *\n000480*                                                                *\n000490******************************************************************\n000500 IDENTIFICATION DIVISION.\n000600 PROGRAM-ID. 'LECHMOVE'.\n000700 DATA DIVISION.\n000800 WORKING-STORAGE SECTION.\n000900\n001000 01  ERROR-WRKCNT            PIC 9(9) COMP VALUE 0.\n001100\n001200 01  LECHLX-SETUP-ERROR           PIC X(40) VALUE\n001300                        'I REGISTRATION OF LECHLX FAILED$'.\n001400 01  LECHLX-UNREG-ERROR           PIC X(40) VALUE\n001500                        'I UNREGISTRATION OF LECHLX FAILED$'.\n001600 01  LECHLX-ROUTINE-POINTER     PROCEDURE-POINTER.\n001700 01  LECHLX-TOKEN               PIC 9(9) COMP VALUE 0.\n001800\n001900 01  FEEDBACK.\n002000     04  FEEDBACK-CONDITION-TOKEN-VALUE.\n002100     COPY  CEEIGZCT.\n002200         07  FEEDBACK-CASE-1-CONDITION-ID.\n002300             10  FEEDBACK-SEVERITY        PIC S9(4) COMP.\n002400             10  FEEDBACK-MSG-NO          PIC S9(4) COMP.\n002500         07  FEEDBACK-CASE-2-CONDITION-ID\n002600                   REDEFINES FEEDBACK-CASE-1-CONDITION-ID.\n002700             10  FEEDBACK-CLASS-CODE      PIC S9(4) COMP.\n002800             10  FEEDBACK-CAUSE-CODE      PIC S9(4) COMP.\n002900         07  FEEDBACK-CASE-SEV-CTL    PIC X.\n003000         07  FEEDBACK-FACILITY-ID     PIC XXX.\n003100     04  FEEDBACK-I-S-INFO        PIC 9(9) COMP.\n003200\n003300 01  CEEMOUT-MSG.\n003400     04  CEEMOUT-MSG-LEN               PIC S9(4) COMP VALUE 80.\n003500     04  CEEMOUT-MSG-TEXT              PIC X(80).\n003600\n003700 01  CEEMOUT-DEST                  PIC S9(9) COMP VALUE 2.\n003800\n003900 01  EDITNUM                       PIC ZZZZZZZZ9.\n004000\n004100\n004200 LINKAGE SECTION.\n004300\n004400 01  FROM-FIELD              PIC X(9999999).\n004500 01  TO-FIELD                PIC X(9999999).\n004600 01  MOVE-LENGTH             PIC 9(9) COMP.\n004700 01  MOVE-REPLY              PIC X.\n004800\n004900 PROCEDURE DIVISION USING\n005000     FROM-FIELD TO-FIELD MOVE-LENGTH MOVE-REPLY.\n005100\n005200     SET LECHLX-ROUTINE-POINTER TO ENTRY 'LECHLX'\n005300\n005400     CALL 'CEEHDLR' USING LECHLX-ROUTINE-POINTER LECHLX-TOKEN\n005500                          FEEDBACK\n005600\n005700     IF FEEDBACK-SEVERITY NOT = 0\n005800         ADD 1 TO ERROR-WRKCNT\n005900         IF ERROR-WRKCNT < 10\n006000             STRING '         LECHMOVE ERROR CALLING CEEHDLR'\n006100             DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n006200             PERFORM SEND-MSG-TEXT\n006300             PERFORM SEND-MSG-FEEDBACK\n006400         END-IF\n006500         MOVE 'N' TO MOVE-REPLY\n006600         GOBACK\n006700     END-IF\n006800\n006900     MOVE 'N' TO MOVE-REPLY\n006910     IF MOVE-LENGTH = 0 GOBACK END-IF\n006920\n006930     MOVE FROM-FIELD(1:MOVE-LENGTH) TO TO-FIELD(1:MOVE-LENGTH)\n006940     MOVE 'V' TO MOVE-REPLY\n006950     CALL 'CEEHDLU' USING LECHLX-ROUTINE-POINTER\n006960                          FEEDBACK\n006970\n006980     IF FEEDBACK-SEVERITY NOT = 0\n006990         ADD 1 TO ERROR-WRKCNT\n007000         IF ERROR-WRKCNT < 10\n007100             STRING '         LECHMOVE ERROR CALLING CEEHDLU'\n007200             DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n007300             PERFORM SEND-MSG-TEXT\n007400             PERFORM SEND-MSG-FEEDBACK\n007500         END-IF\n007600         GOBACK\n007700     END-IF\n007800\n007900     GOBACK\n008000     .\n008100\n008200 SEND-MSG-FEEDBACK.\n008300\n008400     PERFORM SEND-MSG-TEXT\n008500\n008600     MOVE FEEDBACK-SEVERITY TO EDITNUM\n008700     STRING '                  SEVERITY = ' EDITNUM\n008800     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n008900     PERFORM SEND-MSG-TEXT\n009000     MOVE FEEDBACK-MSG-NO TO EDITNUM\n009100     STRING '                  MSG-NO   = ' EDITNUM\n009200     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n009300     PERFORM SEND-MSG-TEXT\n009400     MOVE FEEDBACK-CASE-SEV-CTL TO EDITNUM\n009500     STRING '                  SEV-CTL  = ' EDITNUM\n009600     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n009700     PERFORM SEND-MSG-TEXT\n009800     MOVE FEEDBACK-FACILITY-ID TO EDITNUM\n009900     STRING '                  FACILITY = ' EDITNUM\n010000     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n010100     PERFORM SEND-MSG-TEXT\n010200     MOVE FEEDBACK-I-S-INFO TO EDITNUM\n010300     STRING '                  I-S-INFO = ' EDITNUM\n010400     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n010500     PERFORM SEND-MSG-TEXT\n010600     .\n010700\n010800 SEND-MSG-TEXT.\n010900\n011000\n011100     CALL 'CEEMOUT' USING CEEMOUT-MSG CEEMOUT-DEST FEEDBACK\n011200     MOVE ' ' TO CEEMOUT-MSG-TEXT\n011300     .\n011400\n011500 END PROGRAM 'LECHMOVE'.\n011600\n011700\n011800\n011900******************************************************************\n012000*                                                                *\n012100* LECHLX IS THE ERROR HANDLER FOR LECHMOVE                       *\n012200*                                                                *\n012300* IT SETS THE RESUME CURSOR ONE PROGRAM UP                       *\n012400*                                                                *\n012500******************************************************************\n012600 IDENTIFICATION DIVISION.\n012700 PROGRAM-ID. 'LECHLX'.\n012800 DATA DIVISION.\n012900 WORKING-STORAGE SECTION.\n013000\n013100 01  ERROR-WRKCNT            PIC 9(9) COMP VALUE 0.\n013200\n013300 01  CURSOR-MOVE             PIC 9(9) COMP.\n013400\n013500 01  FEEDBACK.\n013600     04  FEEDBACK-CONDITION-TOKEN-VALUE.\n013700     COPY  CEEIGZCT.\n013800         07  FEEDBACK-CASE-1-CONDITION-ID.\n013900             10  FEEDBACK-SEVERITY        PIC S9(4) COMP.\n014000             10  FEEDBACK-MSG-NO          PIC S9(4) COMP.\n014100         07  FEEDBACK-CASE-2-CONDITION-ID\n014200                   REDEFINES FEEDBACK-CASE-1-CONDITION-ID.\n014300             10  FEEDBACK-CLASS-CODE      PIC S9(4) COMP.\n014400             10  FEEDBACK-CAUSE-CODE      PIC S9(4) COMP.\n014500         07  FEEDBACK-CASE-SEV-CTL    PIC X.\n014600         07  FEEDBACK-FACILITY-ID     PIC XXX.\n014700     04  FEEDBACK-I-S-INFO        PIC 9(9) COMP.\n014800\n014900 01  CEEMOUT-MSG.\n015000     04  CEEMOUT-MSG-LEN               PIC S9(4) COMP VALUE 80.\n015100     04  CEEMOUT-MSG-TEXT              PIC X(80).\n015200\n015300 01  CEEMOUT-DEST                  PIC S9(9) COMP VALUE 2.\n015400\n015500 01  EDITNUM                       PIC ZZZZZZZZ9.\n015600\n015700 LINKAGE SECTION.\n015800\n015900\n016000 01  TOKEN                   PIC 9(9) COMP.\n016100\n016200 01  RESULT                  PIC 9(9) COMP.\n016300     88 RESUME                   VALUE 10.\n016400\n016500 01  CURCOND.\n016600\n016700     04  CURCOND-CONDITION-TOKEN-VALUE.\n016800     COPY  CEEIGZCT.\n016900         07  CURCOND-CASE-1-CONDITION-ID.\n017000             10  CURCOND-SEVERITY        PIC S9(4) COMP.\n017100             10  CURCOND-MSG-NO          PIC S9(4) COMP.\n017200         07  CURCOND-CASE-2-CONDITION-ID\n017300                   REDEFINES CURCOND-CASE-1-CONDITION-ID.\n017400             10  CURCOND-CLASS-CODE      PIC S9(4) COMP.\n017500             10  CURCOND-CAUSE-CODE      PIC S9(4) COMP.\n017600         07  CURCOND-CASE-SEV-CTL    PIC X.\n017700         07  CURCOND-FACILITY-ID     PIC XXX.\n017800     04  CURCOND-I-S-INFO        PIC 9(9) COMP.\n017900\n018000 01  NEWCOND.\n018100\n018200     04  NEWCOND-CONDITION-TOKEN-VALUE.\n018300     COPY  CEEIGZCT.\n018400         07  NEWCOND-CASE-1-CONDITION-ID.\n018500             10  NEWCOND-SEVERITY        PIC S9(4) COMP.\n018600             10  NEWCOND-MSG-NO          PIC S9(4) COMP.\n018700         07  NEWCOND-CASE-2-CONDITION-ID\n018800                   REDEFINES NEWCOND-CASE-1-CONDITION-ID.\n018900             10  NEWCOND-CLASS-CODE      PIC S9(4) COMP.\n019000             10  NEWCOND-CAUSE-CODE      PIC S9(4) COMP.\n019100         07  NEWCOND-CASE-SEV-CTL    PIC X.\n019200         07  NEWCOND-FACILITY-ID     PIC XXX.\n019300     04  NEWCOND-I-S-INFO        PIC 9(9) COMP.\n019400\n019500\n019600 PROCEDURE DIVISION USING\n019700     CURCOND, TOKEN, RESULT, NEWCOND.\n019800\n019900*    DISPLAY 'LECHLX ENTERED'\n020000     MOVE 1 TO CURSOR-MOVE\n020100     CALL 'CEEMRCR' USING CURSOR-MOVE FEEDBACK\n020200     IF FEEDBACK-SEVERITY NOT = 0\n020300         STRING '         LECHLX ERROR CALLING CEEMRCR'\n020400         DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n020500         PERFORM SEND-MSG-TEXT\n020600         PERFORM SEND-MSG-FEEDBACK\n020700         ADD 1 TO ERROR-WRKCNT\n020800         IF ERROR-WRKCNT > 1000\n020900             CALL 'CONMESSG' USING BY CONTENT\n021000             'C LECH SERIOUS INTERNAL ERROR IN LECHLX$'\n021100         END-IF\n021200     END-IF\n021300\n021400     SET RESUME TO TRUE\n021500*    DISPLAY 'LECHMOVE RET'\n021600     GOBACK\n021700     .\n021800\n021900 SEND-MSG-FEEDBACK.\n022000\n022100     PERFORM SEND-MSG-TEXT\n022200\n022300     MOVE FEEDBACK-SEVERITY TO EDITNUM\n022400     STRING '                  Severity = ' EDITNUM\n022500     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n022600     PERFORM SEND-MSG-TEXT\n022700     MOVE FEEDBACK-MSG-NO TO EDITNUM\n022800     STRING '                  Msg-No   = ' EDITNUM\n022900     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n023000     PERFORM SEND-MSG-TEXT\n023100     MOVE FEEDBACK-CASE-SEV-CTL TO EDITNUM\n023200     STRING '                  Sev-Ctl  = ' EDITNUM\n023300     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n023400     PERFORM SEND-MSG-TEXT\n023500     MOVE FEEDBACK-FACILITY-ID TO EDITNUM\n023600     STRING '                  Facility = ' EDITNUM\n023700     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n023800     PERFORM SEND-MSG-TEXT\n023900     MOVE FEEDBACK-I-S-INFO TO EDITNUM\n024000     STRING '                  I-S-Info = ' EDITNUM\n024100     DELIMITED SIZE INTO CEEMOUT-MSG-TEXT\n024200     PERFORM SEND-MSG-TEXT\n024300     .\n024400\n024500\n024600 SEND-MSG-TEXT.\n024700\n024800\n024900     CALL 'CEEMOUT' USING CEEMOUT-MSG CEEMOUT-DEST FEEDBACK\n025000     MOVE ' ' TO CEEMOUT-MSG-TEXT\n025100     .\n025200\n025300\n025400 END PROGRAM 'LECHLX'.\n025500\n./ ADD NAME=LECHNL   0103-05105-05105-1518-00297-00294-00004-TSO057\n***********************************************************************\n*                                                                     *\n*        LECHNL IS A NON-LE ESTAE ROUTINE                             *\n*                                                                     *\n*        TO USE IT JUST CODE                                          *\n*                         CALL LECHNL                                 *\n*                                                                     *\n*        AT THE START OF YOUR NON-LE PROGRAM                          *\n*                                                                     *\n*        IT NEEDS THE INSTASM ROUTINES AVAILABLE AT                   *\n*    http://home.clara.net/andywrobertson/mvsindex.html               *\n*                                                                     *\n***********************************************************************\nLECHNL  INSTSS  VER=20\nNOTFST   NOP   LECHNLZ\n         OI    NOTFST+1,X'F0'           FIRST TIME THRU ONLY\n         IPM   R3                       SAVE PROGRAM MASK\n         ESPIE SET,LECHNL4,((1,15))     POINT TO LECHNL4, ALL INTS\n         SPM   R3\nLECHNLZ  DS    0H\n        INSTRS\n         LTORG\n        INSTWORK  START\n        INSTWORK  END\n\n***********************************************************************\n*                                                                     *\n*        LECHNL4 IS THE ESPIE CSECT.  IT IS ENTERED DIRECT FROM       *\n*        THE CALLING PROGRAM WHEN THE INTERRUPT OCCURRS.              *\n*                                                                     *\n*        ON ENTRY THE REGISTERS HAVE BEEN SET TO:                     *\n*                                                                     *\n*        R1    ->  EPIE                                               *\n*        R2-13     AS IN PROGRAM WHERE INTERRUPT HAPPENED             *\n*        R14   ->  RETURN ADDRESS TO SYSTEM                           *\n*        R15   ->  LECHNL4                                            *\n*                                                                     *\n*        THE REGISTERS AS THEY WERE WHEN THE INTERRUPT HAPPENED       *\n*        ARE SAVED IN A SAVE AREA IN THE EPIE (AT EPIEGPR)            *\n*                                                                     *\n***********************************************************************\n\nLECHNL4  CSECT\n         PUSH USING\n         USING *,R15\n         LR    R12,R15\n         DROP R15\n         USING LECHNL4,R12\n         LA    R13,SAVEAREA\n\n         ST    R14,RET@\n\n         LR    R9,R1\n         USING EPIE,R9\n\n*        SET AMODE IN THIS CSECT TO 31\n\n         SLR   R1,R1\n         LA    R1,SETAMODE\n         O     R1,=A(X'80000000')\n         BSM   0,R1\nSETAMODE DS    0H\n\n*        GET TRUE INSTRUCTION ADDRESS\n\n         L     R1,EPIENXT1\n         N     R1,=A(X'7FFFFFFF')\n         TM    EPIENXT1,EPIEMOD1\n         BO    AMODE_31\n         N     R1,=A(X'00FFFFFF')\nAMODE_31 DS    0H\n         ST    R1,TRUE_INT\n\n         L     R1,TOT_INT_NUMBER\n         LA    R1,1(R1)\n         ST    R1,TOT_INT_NUMBER\n\n         BAL   R6,A000_ANALYSE\n\n*        RETURN TO INTERRUPTED PROGRAM\n*\n*\n*        IF ILC IS 0, THEN THE RETURN MAY BE STRAIGHT BACK TO\n*        THE FAILING INSTRUCTION: THIS WILL LEAD TO AN ENDLESS LOOP.\n*        TO AVOID THIS, WE TEST: IF THE INSTRUCTION LENGTH\n*        EPIEINT WAS 0, WE GET THE INSTRUCTION LENGTH\n*        (BY ACTUALLY LOOKING AT THE\n*        INSTRUCTION IN THE PROGRAM) AND ADD THIS TO THE EPIEPSW\n*\n\n         CLI   EPIEILC1,0    IF INSTRUCTION LENGTH WAS 0\n         BNE   DONT_ADJ_PSW\n         LA    R2,2                     R2 HOLDS LEN INST\n*\n*        WE CAN ONLY LOOK AT INSTR IF INTERRUPT IS OF TYPE THAT\n*        CAN NOT POSSIBLY BE DUE TO INSTR NOT ACCESSIBLE\n*\n         CLI   EPIEICD1,1 OPERATION\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,2 PRIVILEDGED\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,3 EXECUTE\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,6 SPECIFICATION\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,7 DATA\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,8 FIXED POINT OVERFLOW\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,9  FIXED POINT DIVIDE\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,10 DEC OVERFLOW\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,11 DEC DIVIDE\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,12 EXP OVERFLOW\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,13 EXP UNDERFLOW\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,14 SIGNIFICANCE\n         BE    LOOKAT_INST\n         CLI   EPIEICD1,15 FLOATING POINT DIVIDE\n         BE    LOOKAT_INST\n         B     ADJ_PSW\nLOOKAT_INST DS   0H\n         L     R3,TRUE_INT\n         CLI   0(R3),X'40'\n         BL    ADJ_PSW\n         LA    R2,2(R2)\n         CLI   0(R3),X'C0'\n         BL    ADJ_PSW\n         LA    R2,2(R2)\nADJ_PSW  EQU    *\n         L     R8,EPIEPSW+4\n         ALR   R8,R2\n         ST    R8,EPIEPSW+4\nDONT_ADJ_PSW  EQU   *\nRETURN_TO_SYSTEM DS  0H\n         L     R14,RET@\n         BSM   0,R14        RETURN TO SYSTEM\n\n\n\nA000_ANALYSE DS  0H\n         L     R1,TOT_INT_NUMBER\n         SLR   R0,R0\n         D     R0,=A(10000)\n         C     R0,=A(0)\n         BNE   A001_NOT10000\n         MVC   MSG,=CL100' LECHNL - ANOTHER 10,000 INTERRUPTS!!!'\n         CALL  INSTWTOR,(MSG),VL\nA001_NOT10000  DS    0H\n\n*        CHECK TO SEE IF LOW CORE\n\n         CLC   TRUE_INT,=A(4096)\n         BH    A010_NOTLOW\n         MVC   MSG,=CL100' LECHNL - LOW CORE, JOB ABENDED '\n         CALL   INSTWTOR,(MSG),VL\n         ABEND  450,DUMP\n\nA010_NOTLOW EQU *\n\n*        CHECK TO SEE IF DUPLICATE DUMP\n\n         L     R7,TRUE_INT\n         LA    R5,INTTAB\n         USING  INTDS,R5\n         LA    R1,0\n         ST    R1,DIF_INT_NUMBER\nA020_INTLOOP1 DS 0H\n         L     R1,DIF_INT_NUMBER\n         LA    R1,1(R1)\n         ST    R1,DIF_INT_NUMBER\n         CLC   =F'-1',INTDS_TRUE_INT\n         BE    TOO_MANY_INTS\n         CLC   =F'0',INTDS_TRUE_INT\n         BNE   A030_NOTNEW\n         ST    R7,INTDS_TRUE_INT\n         MVC   INTDS_OCCURRED,=A(1)\n         B     A030_INTLOOPZ\nA030_NOTNEW DS 0H\n         C     R7,INTDS_TRUE_INT\n         BNE   A030_NOTTHIS\n         L     R1,INTDS_OCCURRED\n         LA    R1,1(R1)\n         ST    R1,INTDS_OCCURRED\n         B     A030_INTLOOPZ\nA030_NOTTHIS DS 0H\n         LA    R5,INTDSZ-INTDS(R5)\n         B     A020_INTLOOP1\nA030_INTLOOPZ DS 0H\n         CLC   =F'1',INTDS_OCCURRED\n         BNE   A040_NOTFIRST\n         BAL   R10,B000_FIRST_TIME_THIS_DUMP\nA040_NOTFIRST DS 0H\n\n         BR    R6\n\n\n\n\nINTTAB   DC     30A(0,0)  TRUE ADDR INT, NO OF INTS THERE\n         DC     F'-1'\n         DC     F'-1'\n         DC     F'-1'\n\n\n\n\nTOO_MANY_INTS  DS   0H\n         MVC    MSG,=CL100' LECHNL TOO MANY INTERRUPTS - JOB ABENDED '\n         CALL   INSTWTOR,(MSG),VL\n         ABEND 450,DUMP\n\n\n\n\n\nB000_FIRST_TIME_THIS_DUMP DS  0H\n*        WTO   'B000'\n*        WTO   'C000'\n         MVC   ERROR_TYPE,=C'????????????????????'\n         SLR   R1,R1\n         IC    R1,EPIEICD1\n         BCTR  R1,0                    DECREM\n         MH    R1,=Y(L'ERRORS_TAB)     MULTIPLY BY PIC TECXT LEN\n         L     R2,=A(ERRORS_TAB)\n         LA    R1,0(R2,R1)\n         C     R1,=A(ERRORS_TAB)\n         BL    B100_UNKNOWN_ERROR\n         C     R1,=A(ERRORS_TABZ)\n         BNL   B100_UNKNOWN_ERROR\n         MVC   ERROR_TYPE,0(R1)        PRINT PROG INT CODE TEXT\nB100_UNKNOWN_ERROR DS 0H\n         L    R2,TRUE_INT\n         SL   R2,MODULE_INT_START\n         MVI  MSG,C' '\n         MVC  MSG+1(L'MSG-1),MSG\n         MVC  MSG(22),=CL22' LECHNL INTERRUPT AT '\n         CALL INSTCNVX,(TRUE_INT,X8,A4),VL\n         MVC  MSG+23(8),X8\n         MVC  MSG+32(3),=C' - '\n         MVC  MSG+36(L'ERROR_TYPE),ERROR_TYPE\n         CALL  INSTWTOR,(MSG),VL\n         BR    R10\n\nMODULE_INT DS  CL8\nX8         DS  CL8\nA4         DC  A(4)\nMODULE_INT_START DS A\n\n\n\n\nERRORS_TAB DC  CL20'OPERATION'\n         DC    CL20'PRIVILEGED OPERATION'\n         DC    CL20'EXECUTE'\n         DC    CL20'PROTECTION'\n         DC    CL20'ADDRESSING'\n         DC    CL20'SPECIFICATION'\n         DC    CL20'DECIMAL DATA'\n         DC    CL20'FIXED POINT OVERFLOW'\n         DC    CL20'FIXED POINT DIVIDE'\n         DC    CL20'DECIMAL OVERFLOW'\n         DC    CL20'DECIMAL DIVIDE'\n         DC    CL20'EXPONENT OVERFLOW'\n         DC    CL20'EXPONENT UNDERFLOW'\n         DC    CL20'SIGNIFICANCE'\n         DC    CL20'FLOATNG POINT DIVIDE'\nERRORS_TABZ DS 0C\nERROR_TYPE DC  CL20' '\n\n\n\n\nDIF_INT_NUMBER DC A(0)\nTOT_INT_NUMBER DC A(0)\nMSG      DC    CL100' '\nSAVEAREA DS    18F\nTCBADDR  DS    F\nRET@     DS    F\nTRUE_INT DS    F\nECBWAIT  DC    A(0)\n\n*\n         LTORG\n         IHAEPIE\nINTDS    DSECT\nINTDS_TRUE_INT DS A\nINTDS_OCCURRED DS A\nINTDSZ   DS  0C\n\n         END\n\n         COPY INSTCNVX\n        COPY INSTWTOR\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "PDSLOAD": {"ttr": 6408, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x00\\x01\\x01\\x15\\x7f\\x01\\x01\\x15\\x7f\\x156\\x00e\\x00e\\x00\\x00\\xd3\\xd6\\xc1\\xc4\\xd3\\xc9\\xc2@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2001-06-06T00:00:00", "modifydate": "2001-06-06T15:36:00", "lines": 101, "newlines": 101, "modlines": 0, "user": "LOADLIB"}, "mimetype": "application/xmit", "datatype": "binary", "extension": ".xmi"}, "XMITMAIL": {"ttr": 6411, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01\\x00\\x00\\x00\\x01\\x102O\\x01\\x102O\"A\\x18\\xe2\\x18\\xe2\\x00\\x00\\xd7\\xc4\\xe2\\xd3\\xd6\\xc1\\xc4@@@'", "ispf": {"version": "01.00", "flags": 0, "createdate": "2010-11-20T00:00:00", "modifydate": "2010-11-20T22:41:00", "lines": 6370, "newlines": 6370, "modlines": 0, "user": "PDSLOAD"}, "text": "./ ADD NAME=$$README 0124-98352-10217-2304-00030-00053-00000-TSO057\n      See member XMITDOC\n\n\n\n\n\n\n\n\n      Copyright (C) 2000  Andy Robertson\n\n      This program is free software; you can redistribute it and/or\n      modify it under the terms of the GNU General Public License as\n      published by the Free Software Foundation; either version 2 of the\n      License, or (at your option) any later version.\n\n      This program is distributed in the hope that it will be useful,\n      but WITHOUT ANY WARRANTY; without even the implied warranty of\n      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n      GNU General Public License for more details.\n\n      You should have received a copy of the GNU General Public License\n      along with this program; if not, write to the Free Software\n      Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.\n\n\n\n\n\n\n./ ADD NAME=XMITBND  0106-05060-05069-1701-00056-00023-00000-TSO057\n\n      **************************************************************\n      *   XMITBND\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITBND' .\n\n      ******************************************************************\n      *                                                                *\n      * CREATE A 37-BYTE BOUNDARY TOKEN                                *\n      *                                                                *\n      ******************************************************************\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n       LINKAGE         SECTION.\n\n       01   XMITMAIL-BND  PIC X(37).\n\n\n       PROCEDURE DIVISION USING XMITMAIL-BND.\n\n\n             MOVE\n                   'ab1234tyrewwuytdfghjksillrhgo0x0zax1d'\n             TO XMITMAIL-BND\n\n             STRING\n                   'Mime.XMITMAIL.'  FUNCTION CURRENT-DATE (1:16)\n             DELIMITED SIZE INTO XMITMAIL-BND\n\n             GOBACK\n\n             .\n       END PROGRAM   'XMITBND'.\n./ ADD NAME=XMITCHAR 0105-05091-10217-2305-00604-00550-00056-TSO057\n000100\n000110\n000120************************************************************\n000130*   XMITCHAR batch e-mail subroutine\n000140*   Copyright (C) 2000  Andy Robertson\n000150*\n000160*   This program is free software; you can redistribute\n000170*   it and/or modify it under the terms of the GNU\n000180*   General Public License as published by the Free\n000190*   Software Foundation; either version 2 of the\n000191*   License, or (at your option) any later version.\n000192*\n000193*   This program is distributed in the hope that it\n000194*   will be useful, but WITHOUT ANY WARRANTY; without\n000195*   even the implied warranty of MERCHANTABILITY or\n000196*   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n000197*   General Public License for more details.\n000198*\n000199*   You should have received a copy of the GNU General\n000200*   Public License along with this program; if not,\n000201*   write to the Free Software Foundation, Inc., 675\n000202*   Mass Ave, Cambridge, MA 02139, USA.\n000203*\n000204************************************************************\n000205\n000210\n000300 IDENTIFICATION DIVISION.\n000400 PROGRAM-ID.\n000500        'XMITCHAR'.\n000600\n000700******************************************************************\n000800*                                                                *\n000900* CONVERT FROM 64-bit mime                                       *\n001000*                                                                *\n001010***\n001020*** Processing may end by\n001030***\n001040*** 0) input field exhausted\n001041***\n001050*** 1) a well-formed quartet including 'mm==' where mm <= 255\n001060*** 2) a well-formed quartet including 'mmm=' where mmm <= 65535\n001070***\n001080*** Where m is any valid mime char\n001090***\n001091*** 3) a quartet beginning with byte space      'b???'\n001092*** 4) a quartet beginning with byte low-values '0???'\n001093***\n001094*** Where ? is any char\n001095***\n001096*** Input field exhaustion gives reply 'V'\n001097***\n001098*** Termination by a well formed quartet gives reply 'V' if it\n001099*** is the last quartet in the input and 'P' if not\n001100***\n001101*** Termination by space or low value gives a reply of\n001102*** 'P'\n001103***\n001104*** Other premature terminations including partial quartets\n001105*** or other non-mime characters\n001106***\n001107*** in the input field are errors and return 'E'\n001108***\n001109*** errors return all data possible\n001110***\n001120******************************************************************\n001200\n001300 ENVIRONMENT DIVISION.\n001400 DATA DIVISION.\n001500 WORKING-STORAGE SECTION.\n001600\n001700 01   W-CHAR-OFFSET PIC S9(8) COMP.\n001800 01   W-64-OFFSET PIC S9(8) COMP.\n001900\n002000 01   w-quartet-x.\n002100      04 w-quartet     PIC S9(8) COMP.\n002200\n002300 01   W-triplet-x.\n002400      04 W-triplet     PIC S9(8) COMP.\n002500\n002600 01   W-quartet-mimevalue-1-x.\n002700      04 W-quartet-mimevalue-1 PIC S9(8) COMP VALUE 0.\n002800\n002900 01   W-quartet-mimevalue-2-x.\n003000      04 W-quartet-mimevalue-2 PIC S9(8) COMP VALUE 0.\n003100\n003200 01   W-quartet-mimevalue-3-x.\n003300      04 W-quartet-mimevalue-3 PIC S9(8) COMP VALUE 0.\n003400\n003500 01   W-quartet-mimevalue-4-x.\n003600      04 W-quartet-mimevalue-4 PIC S9(8) COMP VALUE 0.\n003700\n003800\n003900 01   W-quartet-char-1-x.\n004000      04 W-quartet-char-1     PIC S9(8) COMP VALUE 0.\n004100\n004200 01   W-quartet-char-2-x.\n004300      04 W-quartet-char-2     PIC S9(8) COMP VALUE 0.\n004400\n004500 01   W-quartet-char-3-x.\n004600      04 W-quartet-char-3     PIC S9(8) COMP VALUE 0.\n004700\n004800 01   W-quartet-char-4-x.\n004900      04 W-quartet-char-4     PIC S9(8) COMP VALUE 0.\n005000\n005100 01   W-W    .\n005200      04 premature-end   pic x.\n005300      04 W-REMAIN      PIC S9(8) COMP.\n005400      04 W-no-of-quartets PIC S9(8) COMP.\n005500\n005600 01   W-mimechars.\n005700\n005800**** 00\n005900      04 FILLER PIC X VALUE x'ff'.\n006000      04 FILLER PIC X VALUE x'ff'.\n006100      04 FILLER PIC X VALUE x'ff'.\n006200      04 FILLER PIC X VALUE x'ff'.\n006300      04 FILLER PIC X VALUE x'ff'.\n006400      04 FILLER PIC X VALUE x'ff'.\n006500      04 FILLER PIC X VALUE x'ff'.\n006600      04 FILLER PIC X VALUE x'ff'.\n006700      04 FILLER PIC X VALUE x'ff'.\n006800      04 FILLER PIC X VALUE x'ff'.\n006900      04 FILLER PIC X VALUE x'ff'.\n007000      04 FILLER PIC X VALUE x'ff'.\n007100      04 FILLER PIC X VALUE x'ff'.\n007200      04 FILLER PIC X VALUE x'ff'.\n007300      04 FILLER PIC X VALUE x'ff'.\n007400      04 FILLER PIC X VALUE x'ff'.\n007500\n007600**** 10\n007700      04 FILLER PIC X VALUE x'ff'.\n007800      04 FILLER PIC X VALUE x'ff'.\n007900      04 FILLER PIC X VALUE x'ff'.\n008000      04 FILLER PIC X VALUE x'ff'.\n008100      04 FILLER PIC X VALUE x'ff'.\n008200      04 FILLER PIC X VALUE x'ff'.\n008300      04 FILLER PIC X VALUE x'ff'.\n008400      04 FILLER PIC X VALUE x'ff'.\n008500      04 FILLER PIC X VALUE x'ff'.\n008600      04 FILLER PIC X VALUE x'ff'.\n008700      04 FILLER PIC X VALUE x'ff'.\n008800      04 FILLER PIC X VALUE x'ff'.\n008900      04 FILLER PIC X VALUE x'ff'.\n009000      04 FILLER PIC X VALUE x'ff'.\n009100      04 FILLER PIC X VALUE x'ff'.\n009200      04 FILLER PIC X VALUE x'ff'.\n009300\n009400\n009500**** 20\n009600      04 FILLER PIC X VALUE x'ff'.\n009700      04 FILLER PIC X VALUE x'ff'.\n009800      04 FILLER PIC X VALUE x'ff'.\n009900      04 FILLER PIC X VALUE x'ff'.\n010000      04 FILLER PIC X VALUE x'ff'.\n010100      04 FILLER PIC X VALUE x'ff'.\n010200      04 FILLER PIC X VALUE x'ff'.\n010300      04 FILLER PIC X VALUE x'ff'.\n010400      04 FILLER PIC X VALUE x'ff'.\n010500      04 FILLER PIC X VALUE x'ff'.\n010600      04 FILLER PIC X VALUE x'ff'.\n010700      04 FILLER PIC X VALUE x'ff'.\n010800      04 FILLER PIC X VALUE x'ff'.\n010900      04 FILLER PIC X VALUE x'ff'.\n011000      04 FILLER PIC X VALUE x'ff'.\n011100      04 FILLER PIC X VALUE x'ff'.\n011200\n011300\n011400**** 30\n011500      04 FILLER PIC X VALUE x'ff'.\n011600      04 FILLER PIC X VALUE x'ff'.\n011700      04 FILLER PIC X VALUE x'ff'.\n011800      04 FILLER PIC X VALUE x'ff'.\n011900      04 FILLER PIC X VALUE x'ff'.\n012000      04 FILLER PIC X VALUE x'ff'.\n012100      04 FILLER PIC X VALUE x'ff'.\n012200      04 FILLER PIC X VALUE x'ff'.\n012300      04 FILLER PIC X VALUE x'ff'.\n012400      04 FILLER PIC X VALUE x'ff'.\n012500      04 FILLER PIC X VALUE x'ff'.\n012600      04 FILLER PIC X VALUE x'ff'.\n012700      04 FILLER PIC X VALUE x'ff'.\n012800      04 FILLER PIC X VALUE x'ff'.\n012900      04 FILLER PIC X VALUE x'ff'.\n013000      04 FILLER PIC X VALUE x'ff'.\n013100\n013200\n013300**** 40\n013400      04 FILLER PIC X VALUE x'ff'.\n013500      04 FILLER PIC X VALUE x'ff'.\n013600      04 FILLER PIC X VALUE x'ff'.\n013700      04 FILLER PIC X VALUE x'ff'.\n013800      04 FILLER PIC X VALUE x'ff'.\n013900      04 FILLER PIC X VALUE x'ff'.\n014000      04 FILLER PIC X VALUE x'ff'.\n014100      04 FILLER PIC X VALUE x'ff'.\n014200      04 FILLER PIC X VALUE x'ff'.\n014300      04 FILLER PIC X VALUE x'ff'.\n014400      04 FILLER PIC X VALUE x'ff'.\n014500      04 FILLER PIC X VALUE x'ff'.\n014600      04 FILLER PIC X VALUE x'ff'.\n014700      04 FILLER PIC X VALUE x'ff'.\n014800      04 FILLER PIC X VALUE x'3E'.\n014900      04 FILLER PIC X VALUE x'ff'.\n015000\n015100\n015200**** 50\n015300      04 FILLER PIC X VALUE x'ff'.\n015400      04 FILLER PIC X VALUE x'ff'.\n015500      04 FILLER PIC X VALUE x'ff'.\n015600      04 FILLER PIC X VALUE x'ff'.\n015700      04 FILLER PIC X VALUE x'ff'.\n015800      04 FILLER PIC X VALUE x'ff'.\n015900      04 FILLER PIC X VALUE x'ff'.\n016000      04 FILLER PIC X VALUE x'ff'.\n016100      04 FILLER PIC X VALUE x'ff'.\n016200      04 FILLER PIC X VALUE x'ff'.\n016300      04 FILLER PIC X VALUE x'ff'.\n016400      04 FILLER PIC X VALUE x'ff'.\n016500      04 FILLER PIC X VALUE x'ff'.\n016600      04 FILLER PIC X VALUE x'ff'.\n016700      04 FILLER PIC X VALUE x'ff'.\n016800      04 FILLER PIC X VALUE x'ff'.\n016900\n017000\n017100**** 60\n017200      04 FILLER PIC X VALUE x'ff'.\n017300      04 FILLER PIC X VALUE x'3f'.\n017400      04 FILLER PIC X VALUE x'ff'.\n017500      04 FILLER PIC X VALUE x'ff'.\n017600      04 FILLER PIC X VALUE x'ff'.\n017700      04 FILLER PIC X VALUE x'ff'.\n017800      04 FILLER PIC X VALUE x'ff'.\n017900      04 FILLER PIC X VALUE x'ff'.\n018000      04 FILLER PIC X VALUE x'ff'.\n018100      04 FILLER PIC X VALUE x'ff'.\n018200      04 FILLER PIC X VALUE x'ff'.\n018300      04 FILLER PIC X VALUE x'ff'.\n018400      04 FILLER PIC X VALUE x'ff'.\n018500      04 FILLER PIC X VALUE x'ff'.\n018600      04 FILLER PIC X VALUE x'ff'.\n018700      04 FILLER PIC X VALUE x'ff'.\n018800\n018900\n019000**** 70\n019100      04 FILLER PIC X VALUE x'ff'.\n019200      04 FILLER PIC X VALUE x'ff'.\n019300      04 FILLER PIC X VALUE x'ff'.\n019400      04 FILLER PIC X VALUE x'ff'.\n019500      04 FILLER PIC X VALUE x'ff'.\n019600      04 FILLER PIC X VALUE x'ff'.\n019700      04 FILLER PIC X VALUE x'ff'.\n019800      04 FILLER PIC X VALUE x'ff'.\n019900      04 FILLER PIC X VALUE x'ff'.\n020000      04 FILLER PIC X VALUE x'ff'.\n020100      04 FILLER PIC X VALUE x'ff'.\n020200      04 FILLER PIC X VALUE x'ff'.\n020300      04 FILLER PIC X VALUE x'ff'.\n020400      04 FILLER PIC X VALUE x'ff'.\n020500      04 FILLER PIC X VALUE x'40'.\n020600      04 FILLER PIC X VALUE x'ff'.\n020700\n020800\n020900**** 80\n021000      04 FILLER PIC X VALUE x'ff'.\n021100      04 FILLER PIC X VALUE x'1a'.\n021200      04 FILLER PIC X VALUE x'1B'.\n021300      04 FILLER PIC X VALUE x'1C'.\n021400      04 FILLER PIC X VALUE x'1D'.\n021500      04 FILLER PIC X VALUE x'1E'.\n021600      04 FILLER PIC X VALUE x'1F'.\n021700      04 FILLER PIC X VALUE x'20'.\n021800      04 FILLER PIC X VALUE x'21'.\n021900      04 FILLER PIC X VALUE x'22'.\n022000      04 FILLER PIC X VALUE x'ff'.\n022100      04 FILLER PIC X VALUE x'ff'.\n022200      04 FILLER PIC X VALUE x'ff'.\n022300      04 FILLER PIC X VALUE x'ff'.\n022400      04 FILLER PIC X VALUE x'ff'.\n022500      04 FILLER PIC X VALUE x'ff'.\n022600\n022700\n022800**** 90\n022900      04 FILLER PIC X VALUE x'ff'.\n023000      04 FILLER PIC X VALUE x'23'.\n023100      04 FILLER PIC X VALUE x'24'.\n023200      04 FILLER PIC X VALUE x'25'.\n023300      04 FILLER PIC X VALUE x'26'.\n023400      04 FILLER PIC X VALUE x'27'.\n023500      04 FILLER PIC X VALUE x'28'.\n023600      04 FILLER PIC X VALUE x'29'.\n023700      04 FILLER PIC X VALUE x'2A'.\n023800      04 FILLER PIC X VALUE x'2B'.\n023900      04 FILLER PIC X VALUE x'ff'.\n024000      04 FILLER PIC X VALUE x'ff'.\n024100      04 FILLER PIC X VALUE x'ff'.\n024200      04 FILLER PIC X VALUE x'ff'.\n024300      04 FILLER PIC X VALUE x'ff'.\n024400      04 FILLER PIC X VALUE x'ff'.\n024500\n024600\n024700**** A0\n024800      04 FILLER PIC X VALUE x'ff'.\n024900      04 FILLER PIC X VALUE x'ff'.\n025000      04 FILLER PIC X VALUE x'2C'.\n025100      04 FILLER PIC X VALUE x'2D'.\n025200      04 FILLER PIC X VALUE x'2E'.\n025300      04 FILLER PIC X VALUE x'2F'.\n025400      04 FILLER PIC X VALUE x'30'.\n025500      04 FILLER PIC X VALUE x'31'.\n025600      04 FILLER PIC X VALUE x'32'.\n025700      04 FILLER PIC X VALUE x'33'.\n025800      04 FILLER PIC X VALUE x'ff'.\n025900      04 FILLER PIC X VALUE x'ff'.\n026000      04 FILLER PIC X VALUE x'ff'.\n026100      04 FILLER PIC X VALUE x'ff'.\n026200      04 FILLER PIC X VALUE x'ff'.\n026300      04 FILLER PIC X VALUE x'ff'.\n026400\n026500\n026600**** B0\n026700      04 FILLER PIC X VALUE x'ff'.\n026800      04 FILLER PIC X VALUE x'ff'.\n026900      04 FILLER PIC X VALUE x'ff'.\n027000      04 FILLER PIC X VALUE x'ff'.\n027100      04 FILLER PIC X VALUE x'ff'.\n027200      04 FILLER PIC X VALUE x'ff'.\n027300      04 FILLER PIC X VALUE x'ff'.\n027400      04 FILLER PIC X VALUE x'ff'.\n027500      04 FILLER PIC X VALUE x'ff'.\n027600      04 FILLER PIC X VALUE x'ff'.\n027700      04 FILLER PIC X VALUE x'ff'.\n027800      04 FILLER PIC X VALUE x'ff'.\n027900      04 FILLER PIC X VALUE x'ff'.\n028000      04 FILLER PIC X VALUE x'ff'.\n028100      04 FILLER PIC X VALUE x'ff'.\n028200      04 FILLER PIC X VALUE x'ff'.\n028300\n028400\n028500**** C0\n028600      04 FILLER PIC X VALUE x'ff'.\n028700      04 FILLER PIC X VALUE x'00'.\n028800      04 FILLER PIC X VALUE x'01'.\n028900      04 FILLER PIC X VALUE x'02'.\n029000      04 FILLER PIC X VALUE x'03'.\n029100      04 FILLER PIC X VALUE x'04'.\n029200      04 FILLER PIC X VALUE x'05'.\n029300      04 FILLER PIC X VALUE x'06'.\n029400      04 FILLER PIC X VALUE x'07'.\n029500      04 FILLER PIC X VALUE x'08'.\n029600      04 FILLER PIC X VALUE x'FF'.\n029700      04 FILLER PIC X VALUE x'ff'.\n029800      04 FILLER PIC X VALUE x'ff'.\n029900      04 FILLER PIC X VALUE x'ff'.\n030000      04 FILLER PIC X VALUE x'ff'.\n030100      04 FILLER PIC X VALUE x'ff'.\n030200\n030300\n030400**** D0\n030500      04 FILLER PIC X VALUE x'ff'.\n030600      04 FILLER PIC X VALUE x'09'.\n030700      04 FILLER PIC X VALUE x'0A'.\n030800      04 FILLER PIC X VALUE x'0B'.\n030900      04 FILLER PIC X VALUE x'0C'.\n031000      04 FILLER PIC X VALUE x'0D'.\n031100      04 FILLER PIC X VALUE x'0E'.\n031200      04 FILLER PIC X VALUE x'0F'.\n031300      04 FILLER PIC X VALUE x'10'.\n031400      04 FILLER PIC X VALUE x'11'.\n031500      04 FILLER PIC X VALUE x'ff'.\n031600      04 FILLER PIC X VALUE x'ff'.\n031700      04 FILLER PIC X VALUE x'ff'.\n031800      04 FILLER PIC X VALUE x'ff'.\n031900      04 FILLER PIC X VALUE x'ff'.\n032000      04 FILLER PIC X VALUE x'ff'.\n032100\n032200\n032300**** E0\n032400      04 FILLER PIC X VALUE x'ff'.\n032500      04 FILLER PIC X VALUE x'ff'.\n032600      04 FILLER PIC X VALUE x'12'.\n032700      04 FILLER PIC X VALUE x'13'.\n032800      04 FILLER PIC X VALUE x'14'.\n032900      04 FILLER PIC X VALUE x'15'.\n033000      04 FILLER PIC X VALUE x'16'.\n033100      04 FILLER PIC X VALUE x'17'.\n033200      04 FILLER PIC X VALUE x'18'.\n033300      04 FILLER PIC X VALUE x'19'.\n033400      04 FILLER PIC X VALUE x'ff'.\n033500      04 FILLER PIC X VALUE x'ff'.\n033600      04 FILLER PIC X VALUE x'ff'.\n033700      04 FILLER PIC X VALUE x'ff'.\n033800      04 FILLER PIC X VALUE x'ff'.\n033900      04 FILLER PIC X VALUE x'ff'.\n034000\n034100\n034200**** F0\n034300      04 FILLER PIC X VALUE x'34'.\n034400      04 FILLER PIC X VALUE x'35'.\n034500      04 FILLER PIC X VALUE x'36'.\n034600      04 FILLER PIC X VALUE x'37'.\n034700      04 FILLER PIC X VALUE x'38'.\n034800      04 FILLER PIC X VALUE x'39'.\n034900      04 FILLER PIC X VALUE x'3A'.\n035000      04 FILLER PIC X VALUE x'3B'.\n035100      04 FILLER PIC X VALUE x'3C'.\n035200      04 FILLER PIC X VALUE x'3D'.\n035300      04 FILLER PIC X VALUE x'FF'.\n035400      04 FILLER PIC X VALUE x'FF'.\n035500      04 FILLER PIC X VALUE x'ff'.\n035600      04 FILLER PIC X VALUE x'ff'.\n035700      04 FILLER PIC X VALUE x'ff'.\n035800      04 FILLER PIC X VALUE x'ff'.\n035900\n036000\n036100 linkage         section.\n036200\n036300 01   f-64          pic x(9999999).\n036400 01   f-64-length   pic s9(8) comp.\n036500 01   f-char        pic x(9999999).\n036600 01   f-char-length pic s9(8) comp.\n036700 01   f-reply       pic x.\n036800\n036900\n037000 procedure division using\n037100         f-64\n037200         f-64-length\n037300         f-char\n037400         f-char-length\n037500         f-reply\n037600       .\n037700\n037800     if f-64-length < 1\n037900       move 'V' to f-reply\n038000       move 0 to f-char-length\n038100       goback\n038200     end-if\n038300\n038400\n038500\n038600     divide f-64-length by 4 giving w-no-of-quartets\n038700         remainder w-remain\n038710\n038720\n038730     move 0 to f-char-length\n038740\n038750***\n038760*** Processing may end by\n038770***\n038780*** 0) input field exhausted\n038790*** 1) a well-formed quartet including 'mm==' where mm <= 255\n038800*** 2) a well-formed quartet including 'mmm=' where mmm <= 65535\n038900***\n039000*** Where m is a valid mime char\n039100***\n039200*** 3) a byte space                    'b???'\n039300*** 4) a byte low-values               '0???'\n039400***\n039500*** Where ? is any char\n039600***\n039700*** Input field exhaustion lives reply 'V'\n039800***\n039900*** Termination by a well formed quartet gives reply 'V' if it\n040000*** is the last quartet in the input and 'P' if not\n040100***\n040200*** Termination by space or low value gives a reply of\n040300*** 'P'\n040400***\n040500*** Other premature terminations including partial quartets\n040600*** or other non-mime characters\n040700*** in the input field are errors and return 'E'\n040800***\n040900*** errors return all data possible\n041000***\n041100\n041200\n041300\n041400     move 1 to w-char-offset\n041500     move 1 to w-64-offset\n041600     move 'n' to premature-end\n041700\n041800     move 'P' to f-reply\n041900     perform until w-no-of-quartets < 1\n042000       perform one-quartet\n042100     end-perform\n042200\n042300     if w-remain not = 0\n042400       move 'E' to f-reply\n042500       goback\n042510     end-if\n042520\n042530     move 'V' to f-reply\n042540     goback  .\n042550\n042560\n042570\n042580     .\n042590 one-quartet.\n042600\n042700     move f-64(w-64-offset:4) to w-quartet-x\n042800\n042900     if w-quartet-x(1:1) = ' '\n043000       move 'P' to f-reply\n043100       goback\n043200     end-if\n043300\n043400     if w-quartet-x(1:1) = low-values\n043500       move 'P' to f-reply\n043600       goback\n043700     end-if\n043800\n043900     move 0               to w-quartet-char-1\n044000     move 0               to w-quartet-char-2\n044100     move 0               to w-quartet-char-3\n044200     move 0               to w-quartet-char-4\n044300     move w-quartet-x(1:1) to w-quartet-char-1-x(4:1)\n044400     move w-quartet-x(2:1) to w-quartet-char-2-x(4:1)\n044500     move w-quartet-x(3:1) to w-quartet-char-3-x(4:1)\n044600     move w-quartet-x(4:1) to w-quartet-char-4-x(4:1)\n044700     add 1                to w-quartet-char-1\n044800     add 1                to w-quartet-char-2\n044900     add 1                to w-quartet-char-3\n045000     add 1                to w-quartet-char-4\n045100\n045200     move w-mimechars(w-quartet-char-1:1) to\n045300      w-quartet-mimevalue-1-x(4:1)\n045400     move w-mimechars(w-quartet-char-2:1) to\n045500      w-quartet-mimevalue-2-x(4:1)\n045600     move w-mimechars(w-quartet-char-3:1) to\n045700      w-quartet-mimevalue-3-x(4:1)\n045800     move w-mimechars(w-quartet-char-4:1) to\n045900      w-quartet-mimevalue-4-x(4:1)\n046000\n046100****\n046200**** The mime values now contain 0 to 63 if they are valid\n046300**** mime characters, 64 if they are =, or 255 if they are\n046400**** not valid\n046500****\n046600     if w-quartet-mimevalue-1 = 255\n046700     or w-quartet-mimevalue-2 = 255\n046800     or w-quartet-mimevalue-3 = 255\n046900     or w-quartet-mimevalue-4 = 255\n047000       move 'E' to f-reply\n047100       goback\n047200     end-if\n047300\n047400\n047500     evaluate true\n047600     when w-quartet-mimevalue-1 not = 64\n047700     and  w-quartet-mimevalue-2 not = 64\n047800     and  w-quartet-mimevalue-3 not = 64\n047900     and  w-quartet-mimevalue-4 not = 64\n048000       compute w-triplet =\n048100         (w-quartet-mimevalue-1 * (64**3))\n048200       + (w-quartet-mimevalue-2 * (64**2))\n048300       + (w-quartet-mimevalue-3 * (64**1))\n048400       + (w-quartet-mimevalue-4)\n048500       move w-triplet-x(2:3) to f-char(w-char-offset:3)\n048600       add 4 to w-64-offset\n048700       add 3 to w-char-offset\n048800       add 3 to f-char-length\n048900       subtract 1 from w-no-of-quartets\n049000     when w-quartet-mimevalue-1 not = 64\n049100     and  w-quartet-mimevalue-2 not = 64\n049200     and  w-quartet-mimevalue-3 not = 64\n049300     and  w-quartet-mimevalue-4     = 64\n049400       compute w-triplet =\n049500         (w-quartet-mimevalue-1 * (64**2))\n049600       + (w-quartet-mimevalue-2 * (64**1))\n049700       + (w-quartet-mimevalue-3)\n049800\n049900       if w-triplet > 65535\n050000         move 'E' to f-reply\n050100         goback\n050200       end-if\n050300       move w-triplet-x(3:2) to f-char(w-char-offset:2)\n050400       add 2 to f-char-length\n050500       subtract 1 from w-no-of-quartets\n050600       if w-no-of-quartets < 1\n050700         move 'V' to f-reply\n050800       end-if\n050900       goback\n051000     when w-quartet-mimevalue-1 not = 64\n051100     and  w-quartet-mimevalue-2 not = 64\n051200     and  w-quartet-mimevalue-3     = 64\n051300     and  w-quartet-mimevalue-4     = 64\n051400       compute w-triplet =\n051500         (w-quartet-mimevalue-1 * (64**1))\n051600       + (w-quartet-mimevalue-2)\n051700       if w-triplet > 255\n051800         move 'E' to f-reply\n051900         goback\n052000       end-if\n052100       move w-triplet-x(4:1) to f-char(w-char-offset:1)\n052200       add 1 to f-char-length\n052300       subtract 1 from w-no-of-quartets\n052400       if w-no-of-quartets < 1\n052500         move 'V' to f-reply\n052600       end-if\n052700       goback\n052800     end-evaluate\n052900\n053000\n053100     .\n053200 end program xmitchar.\n./ ADD NAME=XMITCICS 0144-00332-10264-1548-00309-00139-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * SUBROUTINE TO SEND a SIMPLE E-MAIL BY SPOOLING OUTPUT TO       *\n      * SMTP.  RUNS UNDER CICS.                                        *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 Nov 2000 1.1  written                                  AWR  *\n      * 26 JUL 2010 1.6  SECURE mode spport                       AWR  *\n      *                                                                *\n      ******************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITCICS'.\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n\n\n\n       WORKING-STORAGE SECTION.\n\n\n       01  USER-ID                        PIC X(8).\n       01  NJE-NODE                       PIC X(8).\n       01  DUMMY-UNSTRING                 PIC X(8).\n       01  DUMMY-UNSTRING2                PIC X(8).\n       01  W-FROM                         PIC X(80).\n\n       01  W-TOKEN                        PIC X(8).\n\n       01  W-RESP  PIC 9(8) VALUE 0.\n       01  W-RESP2 PIC 9(8) VALUE 0.\n\n       01  W-OUTPUT-POINTER1 USAGE POINTER.\n       01  W-OUTPUT-POINTER2 USAGE POINTER.\n       01  W-OUTPUT-STATEMENT.\n           04  W-OUTPUT-STATEMENT-LENGTH PIC S9(8) COMP VALUE 100.\n           04  W-OUTPUT-STATEMENT-PARMS  PIC X(100) VALUE ' '.\n\n\n       01   OUTFILE-LENGTH         PIC 9(8) COMP.\n\n\n       01   W-WORK.\n            04   XMITINMR-CHARNO   PIC S9(8) COMP.\n            04   XMITMAFM-CHARNO   PIC S9(8) COMP.\n            04   OUTFILE-CHARNO    PIC S9(8) COMP.\n            04   W-LINE            PIC X(256).\n\n\n       01   XMITMAFM-RECL         PIC S9(8) COMP.\n       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.\n       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.\n\n\n       01   XMITMAFM-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITMAIL-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n       01   XMITINMR-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITINMR-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n\n       COPY XMITMADF.\n\n\n       LINKAGE SECTION.\n\n       01   DFHCOMMAREA.\n            COPY XMITMACC.\n\n\n       PROCEDURE DIVISION.\n\n           MOVE 'C' TO XMITMAIL-ENV\n\n\n           MOVE 'E' TO XMITMAIL-REPLY\n           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC\n\n           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL\n           IF 80 > XMITMAFM-RECL\n               MOVE 80 TO XMITMAFM-RECL\n           END-IF\n           ADD 1 TO XMITMAFM-RECL\n      *    FOR POSS INITIAL PERIOD\n\n           PERFORM CALL-EXIT\n\n\n           IF XMITMAIL-SECURE= 'Y'\n               MOVE XMITMAIL-NJE-NODE TO NJE-NODE\n               IF NJE-NODE = SPACE OR LOW-VALUE\n\n                   MOVE XMITMAIL-FROM TO W-FROM\n                   IF W-FROM = HIGH-VALUES OR SPACES\n                       MOVE XMITMAIL-FROM-DEFAULT TO W-FROM\n                   END-IF\n                   UNSTRING W-FROM DELIMITED '@'\n                   INTO DUMMY-UNSTRING DUMMY-UNSTRING2\n                   UNSTRING DUMMY-UNSTRING2 DELIMITED '.'\n                   INTO NJE-NODE DUMMY-UNSTRING2\n               END-IF\n               EXEC CICS ASSIGN USERID(USER-ID)\n               END-EXEC\n           END-IF\n           PERFORM FORMAT-MESSAGE\n           PERFORM ALLOC-OUTFILE\n           PERFORM OPEN-OUTFILE\n           PERFORM WRITE-MESSAGE\n           PERFORM CLOSE-OUTFILE\n           PERFORM FREE-OUTFILE\n\n           MOVE 'V' TO XMITMAIL-REPLY\n           MOVE ' ' TO XMITMAIL-DIAGNOSTIC\n           MOVE 0 TO RETURN-CODE\n           GOBACK\n\n           .\n\n\n\n\n\n           .\n       OPEN-OUTFILE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY ' '\n               DISPLAY '....  SPOOL FILE STARTS  .... '\n           ELSE\n\n               EXEC CICS SPOOLOPEN\n                    OUTPUT\n                    TOKEN(W-TOKEN)\n                    OUTDESCR(W-OUTPUT-POINTER1)\n                    USERID('*')\n                    NODE('*')\n                    CLASS('A')\n                    RECORDLENGTH(LENGTH OF W-LINE)\n                    RESP (W-RESP) RESP2 (W-RESP2)\n               END-EXEC\n\n               IF W-RESP NOT = 00\n                   STRING 'XMITCICS: SPOOLOPEN '\n                   'FAILED RESP=' W-RESP ' RESP2=' W-RESP2\n                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n                   MOVE 'I' TO XMITMAIL-REPLY\n                   MOVE 0 TO RETURN-CODE\n                   GOBACK\n               END-IF\n           END-IF\n\n\n\n\n\n           .\n       WRITE-LINE-SECURE.\n           PERFORM WRITE-LINE\n\n\n\n           .\n       WRITE-LINE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY W-LINE\n           ELSE\n               EXEC CICS SPOOLWRITE\n                    TOKEN(W-TOKEN)\n                    FROM(W-LINE)\n                    FLENGTH(OUTFILE-LENGTH)\n                    RESP (W-RESP) RESP2 (W-RESP2)\n               END-EXEC\n\n               IF W-RESP NOT = 00\n                   STRING 'XMITCICS: SPOOLWRITE '\n                   'FAILED RESP=' W-RESP ' RESP2=' W-RESP2\n                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n                   MOVE 'I' TO XMITMAIL-REPLY\n                   MOVE 0 TO RETURN-CODE\n                   GOBACK\n               END-IF\n           END-IF\n\n\n\n           .\n       CLOSE-OUTFILE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY '....  SPOOL FILE ENDS  .... '\n               DISPLAY ' '\n           ELSE\n               EXEC CICS SPOOLCLOSE\n                    TOKEN(W-TOKEN)\n                    RESP (W-RESP) RESP2 (W-RESP2)\n               END-EXEC\n           END-IF\n\n\n\n           .\n       ALLOC-OUTFILE.\n           IF XMITMAIL-DEBUG NOT = 'Y'\n\n               CALL 'XMITGETA' USING\n                   W-OUTPUT-POINTER2\n                   W-OUTPUT-POINTER1\n\n               CALL 'XMITGETA' USING\n                   W-OUTPUT-STATEMENT\n                   W-OUTPUT-POINTER2\n\n               MOVE ' '\n               TO W-OUTPUT-STATEMENT-PARMS\n               STRING\n                    ' DEST('\n                    DELIMITED SIZE\n                    XMITMAIL-SMTP-ADDRESS\n                    DELIMITED SPACE\n                    ')'\n                    DELIMITED SIZE\n               INTO W-OUTPUT-STATEMENT-PARMS\n           END-IF\n\n\n\n           .\n       FREE-OUTFILE.\n           EXIT\n\n           .\n\n\n\n       COPY XMITCOMM.\n\n\n\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.    XMITGETA\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n       LINKAGE SECTION.\n       01  PARM1                       PIC X.\n       01  PARM2                       USAGE IS POINTER.\n       PROCEDURE DIVISION USING PARM1 PARM2.\n           SET PARM2 TO ADDRESS OF PARM1\n           GOBACK\n           .\n       END PROGRAM XMITGETA.\n\n\n\n\n       COPY XMITINMR.\n\n\n\n\n       COPY XMITMAFM.\n\n\n\n\n       END PROGRAM 'XMITCICS'.\n./ ADD NAME=XMITCOMM 0188-00333-10207-1002-00154-00019-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * COMMON ROUTINES USED IN XMITMAIL AND IN XMITCICS               *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 Nov 2000 1.1  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n\n           .\n       CALL-EXIT.\n           IF XMITMAIL-CALL-EXIT = 'Y'\n\n\n               MOVE 'N' TO XMITMAIL-CALL-EXIT\n      *        Note: BEFORE the call - so the exit can reset it\n      *        if it wants to\n\n\n\n               IF XMITMAIL-EXIT-MOD NOT = ' '\n                   CALL XMITMAIL-EXIT-MOD USING\n                           XMITMAIL-CONTROL\n                           XMITMAIL-DEFAULTS\n                           XMITMAIL-TOS\n                           XMITMAIL-CCS\n                           XMITMAIL-BCCS\n                           XMITMAIL-SUBJECT\n                           XMITMAIL-MSGS\n                   ON EXCEPTION\n                   DISPLAY \"XMITMAIL: EXIT PROGRAM \"\n                       XMITMAIL-EXIT-MOD\n                       \" NOT FOUND\"\n                   END-CALL\n                   IF XMITMAIL-REPLY = 'X'\n                       MOVE 0 TO RETURN-CODE\n                       GOBACK\n                   END-IF\n               END-IF\n           END-IF\n\n\n           .\n       WRITE-MESSAGE.\n\n           IF XMITMAIL-SECURE = 'Y'\n             MOVE 1 TO XMITINMR-CHARNO\n\n             PERFORM XMITINMR-TOT-RECNO TIMES\n                 MOVE XMITINMR-BACK(XMITINMR-CHARNO:80)\n                 TO W-LINE\n                 COMPUTE OUTFILE-LENGTH = 80\n                 PERFORM WRITE-LINE-SECURE\n                 ADD 80 TO XMITINMR-CHARNO\n             END-PERFORM\n           ELSE\n             MOVE 1 TO XMITMAFM-CHARNO\n\n             PERFORM UNTIL\n             (XMITMAFM-CHARNO NOT < LENGTH OF XMITMAFM-BACK)  OR\n             (XMITMAFM-BACK(XMITMAFM-CHARNO:40) = HIGH-VALUES)\n                 MOVE XMITMAFM-BACK(XMITMAFM-CHARNO:XMITMAFM-RECL)\n                 TO W-LINE\n                 COMPUTE OUTFILE-LENGTH = XMITMAFM-RECL\n                 PERFORM WRITE-LINE\n                 ADD XMITMAFM-RECL TO XMITMAFM-CHARNO\n             END-PERFORM\n           END-IF\n\n\n           .\n       FORMAT-MESSAGE.\n           CALL 'XMITMAFM' USING\n                XMITMAIL-CONTROL\n                XMITMAIL-DEFAULTS\n                XMITMAIL-TOS\n                XMITMAIL-CCS\n                XMITMAIL-BCCS\n                XMITMAIL-SUBJECT\n                XMITMAIL-MSGS\n                XMITMAFM-BACK\n                XMITMAFM-RECL\n                XMITMAFM-TOT-RECNO\n           IF XMITMAIL-REPLY NOT = 'V'\n               MOVE 0 TO RETURN-CODE\n               GOBACK\n           END-IF\n\n           IF XMITMAIL-SECURE = 'Y'\n                CALL 'XMITINMR' USING\n               XMITMAIL-CONTROL\n               XMITMAIL-DEFAULTS\n               XMITMAFM-BACK\n               XMITMAFM-RECL\n               XMITMAFM-TOT-RECNO\n               XMITINMR-BACK\n               XMITINMR-TOT-RECNO\n               USER-ID\n               NJE-NODE\n\n             IF XMITMAIL-REPLY NOT = 'V'\n                 MOVE 0 TO RETURN-CODE\n                 GOBACK\n             END-IF\n           END-IF\n\n\n\n\n\n\n\n           .\n\n./ ADD NAME=XMITDEBL 0103-10218-10218-1704-00171-00107-00068-TSO057\n000100 IDENTIFICATION DIVISION.\n000200\n000300 PROGRAM-ID.     'XMITDEBL'.\n000400\n000500******************************************************************\n000600*                                                                *\n000700*  XMITDEBL - MODULE TO REMOVE BLANKS FROM A STRING SO THAT THE  *\n000800*             RESULT HAS ONLY ONE SPACE BETWEEN WORDS            *\n000900*                                                                *\n001000*                   AUTHOR: AWR                                  *\n001100*                                                                *\n001200*             DATE WRITTEN: JUN 2007                             *\n001300*                                                                *\n001311*                                                                *\n001312* FUNCTION - GENERAL DESCRIPTION                                 *\n001313*                                                                *\n001314* 1.  This module reformats a mass of text by removing all       *\n001315* leading and trailing blanks and repositioning all words so     *\n001316* that there is only one blank between them.                     *\n001317*                                                                *\n001318*                                                                *\n001319* PARAMETERS                                                     *\n001320*                                                                *\n001321* 2.  Format:-                                                   *\n001322*                                                                *\n001323* (COBOL)                                                        *\n001324*                                                                *\n001325*     01  INPUT-TEXT              PIC X(xxxx).                   *\n001326*     01  INPUT-LENGTH            PIC S9(8) COMP.                *\n001327*     01  OUTPUT-TEXT             PIC X(xxxx).                   *\n001328*     01  OUTPUT-LENGTH           PIC S9(8) COMP.                *\n001329*     01  W-REPLY                 PIC X.                         *\n001330*                                                                *\n001331*         .............                                          *\n001332*     MOVE ' ' TO OUTPUT-TEXT                                    *\n001333*     MOVE LENGTH OF OUTPUT-TEXT TO OUTPUT-LENGTH                *\n001334*                                                                *\n001335*     CALL 'JTXTDEBL' USING INPUT-TEXT INPUT-LENGTH              *\n001336*                          OUTPUT-TEXT OUTPUT-LENGTH             *\n001337*                           W-REPLY                              *\n001338*                                                                *\n001339*                                                                *\n001340*                                                                *\n001341* 3.  The format of the parameters is:                           *\n001342*                                                                *\n001343*     INPUT-TEXT    the text to be formatted.  Can be any        *\n001344*                   number of characters long.                   *\n001345*                                                                *\n001346*     INPUT-LENGTH  the length of the input text.                *\n001347*                                                                *\n001348*     OUTPUT-TEXT   the formatted text, set by the module.       *\n001349*                                                                *\n001350*     OUTPUT-LENGTH the total length of OUTPUT-TEXT.   After     *\n001351*                   every call, the module replaces this by      *\n001352*                   the number of characters of OUTPUT-TEXT      *\n001353*                   actually returned. Therefore the calling     *\n001354*                   program should reset this field before       *\n001355*                   every call.                                  *\n001356*                                                                *\n001357*     W-REPLY       is a single character field set by the       *\n001358*                   module.  Possible values :-                  *\n001359*                                                                *\n001360*                       'V' -  success.                          *\n001361*                                                                *\n001362*                       'O' -  output overflow occurred.  In     *\n001363*                              this case all possible data       *\n001364*                              is put in OUTPUT-TEXT             *\n001365*                                                                *\n001366*                   The calling program should test the          *\n001367*                   reply field to make sure an 'O' error        *\n001368*                   has not occurred.                            *\n001369*                                                                *\n001370* 4.  INPUT-TEXT can be totally blank and/or INPUT-LENGTH        *\n001371*     can be 0.  In this case 'V' is returned and                *\n001372*     OUTPUT-LENGTH is set to 0                                  *\n001373*                                                                *\n001450******************************************************************\n001500\n001600 ENVIRONMENT DIVISION.\n001700\n001710 DATA DIVISION.\n001720\n001730 WORKING-STORAGE SECTION.\n001740\n001750\n001760 01  WS-FIELDS.\n001770     04  INPUT-POS            PIC S9(8)      COMP.\n001780     04  OUTPUT-POS           PIC S9(8)      COMP.\n001790\n001800 LINKAGE SECTION.\n001900\n002000 01  INPUT-TEXT               PIC X(32000).\n002100 01  INPUT-LENGTH             PIC S9(8)      COMP.\n002200\n002300 01  OUTPUT-TEXT              PIC X(32000).\n002400 01  OUTPUT-LENGTH            PIC S9(8)      COMP.\n002500\n002600\n002700 01  REPLY                    PIC X.\n002800\n002900 PROCEDURE DIVISION USING INPUT-TEXT\n003000                          INPUT-LENGTH\n003100                          OUTPUT-TEXT\n003200                          OUTPUT-LENGTH\n003300                          REPLY.\n003400\n003500     IF OUTPUT-LENGTH > 0\n003600         MOVE ' ' TO OUTPUT-TEXT(1:OUTPUT-LENGTH)\n003700     END-IF\n003800\n003900     IF INPUT-LENGTH < 1\n004000         MOVE 0 TO OUTPUT-LENGTH\n004100         MOVE 'V' TO REPLY\n004200         GOBACK\n004300     END-IF\n004400\n004500     MOVE 1 TO INPUT-POS\n004600     MOVE 0 TO OUTPUT-POS\n004700\n004800     PERFORM SKIP-BLANKS\n004900\n005000     PERFORM UNTIL INPUT-POS > INPUT-LENGTH\n005100         ADD 1 TO OUTPUT-POS\n005200         PERFORM MOVE-WORD\n005300\n005400         IF OUTPUT-POS > OUTPUT-LENGTH\n005500             MOVE 'O' TO REPLY\n005600             IF INPUT-POS > INPUT-LENGTH\n005700                 MOVE 'V' TO REPLY\n005800             END-IF\n005900             GOBACK\n006000         END-IF\n006100\n006200         IF INPUT-POS NOT > INPUT-LENGTH\n006300             PERFORM SKIP-BLANKS\n006400         END-IF\n006500\n006600     END-PERFORM\n006700\n006800     SUBTRACT 1 FROM OUTPUT-POS\n006900     IF OUTPUT-POS < 0 MOVE 0 TO OUTPUT-POS END-IF\n006910     IF OUTPUT-POS < OUTPUT-LENGTH\n006920         MOVE OUTPUT-POS TO OUTPUT-LENGTH\n006930     END-IF\n006940\n006950     MOVE 'V' TO REPLY\n006960\n006970     GOBACK\n006980\n006990\n007000     .\n007100 SKIP-BLANKS.\n007200     PERFORM UNTIL\n007300     INPUT-POS > INPUT-LENGTH\n007400     OR INPUT-TEXT(INPUT-POS:1) NOT = ' '\n007500         ADD 1 TO INPUT-POS\n007600     END-PERFORM\n007700\n007800     .\n007900 MOVE-WORD.\n008000     PERFORM UNTIL\n008100     INPUT-POS > INPUT-LENGTH\n008200     OR OUTPUT-POS > OUTPUT-LENGTH\n008300     OR INPUT-TEXT(INPUT-POS:1) = ' '\n008400         MOVE INPUT-TEXT(INPUT-POS:1) TO OUTPUT-TEXT(OUTPUT-POS:1)\n008500         ADD 1 TO INPUT-POS\n008600         ADD 1 TO OUTPUT-POS\n008700     END-PERFORM\n008800\n008900     .\n009000  end program xmitdebl.\n./ ADD NAME=XMITDOC  0166-00333-10222-1215-00487-00357-00000-TSO057\n\n      ******************************************************************\n      *                                                                *\n      * Documentation as at 10 Aug 2010 ver 1.6                        *\n      *                                                                *\n      ******************************************************************\n\n\n  XMITMAIL OVERVIEW\n  -----------------\n\n  1.  The callable subprogram XMITMAIL is used to generate and queue a\n      simple e-mail on an OS/390 system with SMTP configured.\n\n      XMITMAIL is designed as a \"light, fast\" alternative to the XMITIP\n      clist created by Lionel Dyck.\n\n      XMITMAIL is suitable for use from any batch mainline COBOL, C,\n      PL/I or LE-enabled Assembler program.\n\n      Attachments can be handled and MIME conversion is supported by\n      auxillary routines but formatting must be done in the calling\n      program\n\n\n\n  2.  Each call generates a new e-mail, so many different e-mails can be\n      rapidly generated in a single job step.\n\n\n  3.  A similar program, XMITCICS, is provided for use under CICS.\n\n\n  HOW TO USE XMITMAIL\n  -------------------\n\n\n 10.  Sample call format for batch:\n\n\n\n    WORKING-STORAGE SECTION.\n\n       01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n\n       COPY XMITMAC.\n\n       01   XMITMAIL-TOS.\n            04   FILLER            PIC X(80) VALUE\n            'Andy_Robertson@JohnLewis.co.uk'.\n            04   FILLER            PIC X(80) VALUE\n            'CTHULHU@Ryleh.com'.\n            04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n\n       01   XMITMAIL-CCS.\n            04   FILLER            PIC X(80) VALUE\n            'AZATHOTH@TheCenterOfInfinity.com'.\n            04   FILLER            PIC X(80) VALUE\n            'The_Black_Goat_With_1000_Young@TheWoods.com'.\n            04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n\n       01   XMITMAIL-BCCS.\n            04   FILLER            PIC X(80) VALUE\n            'Whatley@Dunwich.com'.\n            04   FILLER            PIC X(80) VALUE\n            'Wilmarth@Miskatonic_U.edu'.\n            04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n\n       01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n            'Test E-mail   '.\n\n       01   XMITMAIL-MSGS.\n            04   FILLER            PIC X(80) VALUE\n            'Whoop-de-do !!        '.\n            04   FILLER            PIC X(80) VALUE\n            'The stars just came right!!'.\n            04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n\n\n        . . . . . .\n\n        . . . . . .\n\n\n    PROCEDURE DIVISION.\n\n        . . . . . .\n\n        . . . . . .\n\n\n         CALL XMITMAIL-NAME USING\n             XMITMAIL-CONTROL\n             XMITMAIL-TOS\n             XMITMAIL-CCS\n             XMITMAIL-BCCS\n             XMITMAIL-SUBJECT\n             XMITMAIL-MSGS\n\n\n        . . . . . .\n\n        . . . . . .\n\n\n\n\n 11. The parameters are:\n\n       XMITMAIL-CONTROL  In copybook XMITMAC, a control block containing\n                       various control fields.   See below for details.\n\n                       You must include the XMITMAIL library in the\n                       SYSLIB concatenation when you compile any calling\n                       program, so that the copybook XMITMAC will be\n                       picked up.\n\n\n       XMITMAIL-TOS    A series of e-mail addressees (padded to 80\n                       bytes) for To:  recepients.\n\n                       This list of 80-byte addressees must be\n                       terminated by an 80-byte line all high-values.\n                       There must be at least one To:  addressee.\n\n\n       XMITMAIL-CCS    A series of e-mail addressees (padded to 80\n                       bytes) for Carbon Copy.\n\n                       This list of 80-byte addressees must be\n                       terminated by an 80-byte line of all high-values.\n                       There may be zero addressees i.e.  the first or\n                       only line may be blank or high-values.\n\n\n       XMITMAIL-BCCS   A series of e-mail addressees (padded to 80\n                       bytes) for Blank Carbon Copy.\n\n                       This list of 80-byte addressees must be\n                       terminated by an 80-byte line of all high-values.\n                       There may be zero addressees i.e.  the first or\n                       only line may be blank or high-values.\n\n\n       XMITMAIL-SUBJECT An 80 bytes Subject for the e-mail\n\n\n       XMITMAIL-MSGS   The message text.  A series of 80-byte lines.\n                       Terminated by an 80-byte line of high-values.\n                       The line length of the MSGS may be adjusted by\n                       changing the control field XMITMAIL-LINE-LENGTH,\n                       see below.\n\n\n 12. Sub-fields within XMITMAIL-CONTROL are:\n\n     XMITMAIL-REPLY          A one-byte flag indicating the success or\n                             failure of the subprogram call:\n\n                             V  -  all OK\n                             E  -  undefined error\n                             I  -  I/O error\n                             L  -  line length invalid\n                             N  -  error in dynamic allocation\n                             O  -  internal buffer overflow\n                             A  -  invalid e-mail address\n                             X  -  rejected by exit subprogram\n                             P  -  invalid PROCESS-OPTION\n                             M  -  Max number e-mails sent exceeded\n\n\n     XMITMAIL-PROCESS-OPTION Process option \"1\" is for plain text and is\n                             the default. XMITMAIL creates all envelope\n                             headers up to the Subject: header and\n                             then inserts a blank line.  You simply pass\n                             a series of plain text message lines.\n\n                             Process option \"2\" indicates that you want\n                             to add more headers. The data you supply\n                             must include any Mime-Version header and\n                             all subsequent parts of the mail envelope.\n                             This is the only way to send multi-part\n                             e-mails using XMITMAIL\n\n                             See sample programs XMITIVP2, XMITIVP4,\n                             XMITIVP7\n\n\n     XMITMAIL-DEBUG          set to 'Y' to have the mail DISPLAYed\n                             not written to the spool\n\n\n     XMITMAIL-FROM           you may place an e-mail address here to\n                             specify who the e-mail is From:  If you\n                             leave it blank the value from\n                             XMITMAIL-FROM-DEFAULT in XMITMADF is used,\n                             or, if XMITMAIL-FROM-DEFAULT is blank, no\n                             From: is generated.\n\n\n     XMITMAIL-RECEIPT        you may place an e-mail address here to\n                             specify who the e-mail Return-Receipt-to:\n                             is set to.  If you leave it blank a\n                             Return-Receipt-to: is not generated.\n\n\n     XMITMAIL-REPLYTO        you may place an e-mail address here to\n                             specify who the e-mail Reply-to: is set to.\n                             If you leave it blank a Reply-to: is not\n                             generated and replies will go to the From:\n                             address.\n\n\n     XMITMAIL-LINE-LENGTH    The length of lines within XMITMAIL-MSG.\n                             The XMITMAC copybook defines this as 80,\n                             but you may change it at any time.  Range\n                             is 10 to 255.\n\n\n     XMITMAIL-MAX-MAILS      The maximum number of e-mails that may be\n                             sent in a batch run.\n\n                             This is a safeguard against looping\n                             programs which may flood the spool with\n                             e-mails.  Default is 999. 0 means no\n                             limit\n\n\n     XMITMAIL-DIAGNOSTIC     An 80-byte IEHIBALL diagnostic that\n                             explains errors.\n\n\n\n   XMITIP OR XMITMAIL?\n   --------------------\n\n\n 20.  Use XMITIP if you need to send attachments, or if you want to send\n      a one-off e-mail.\n\n 21.  Use XMITMAIL if you have a mainline program running as a regular\n      batch process, and you need to generate many different simple\n      e-mails from it under program control.\n\n 22.  If you want to send e-mails from CICS, use XMITCICS\n\n 23.  XMITMAIL works under ISPF the same as in batch.\n\n\n\n\n   PERFORMANCE?\n   ------------\n\n 30.  XMITMAIL will require about 1/10 the CPU resource XMITIP needs to\n      format a simple e-mail and queue it on the JES spool.\n\n      On our system (MIPS about 150) XMITIP took about 0.15 seconds CPU\n      per simple message, XMITMAIL about 0.017 seconds CPU\n\n     (The e-mail will not actually be sent until the SMTP started task\n      takes it off the JES spool and transmits it.  The CPU requirement\n      for this will of course be the same for XMITIP and XMITMAIL).\n\n 31.  XMITMAIL is limited to 4000 records of 80 bytes each or a total\n      size 320,000 bytes.  This may be changed by changing the value\n      in the XMITSIZE copybook before installation.\n\n 32.  XMITCICS is limited to 360 records of 80 bytes each or a total\n      size 28,800 bytes. This can not be increased because it is limited\n      by the 32K COMMAREA restriction.\n\n\n\n   BUGS, SUGGESTIONS, ETC.\n   ----------------------\n\n 40.  Contact\n\n\n          Andy_Robertson@JohnLewis.co.uk\n\n\n 41.  WHAT WILL NOT BE DONE\n\n          - support for non-LE sites. If you haven't got LE in by now,\n            here is another reason to buck up.\n\n          - sophisticated attachment support.  If you need attachments\n            you may format the mail-envelope yourself using\n            PROCESS-OPTION 2 and the auxilary subroutines supplied with\n            this software (see later).\n\n\n  HOW TO USE XMITCICS\n  -------------------\n\n\n 50.  XMITCICS repackages XMITMAIL code for CICS. It accesses the spool\n      using EXEC CICS SPOOL..... commands not the dynamic allocate\n      commands used by XMITMAIL in batch.\n\n      XMITCICS can be EXEC CICS LINKed to under CICS.\n\n      Your e-mail must be placed inside a standard copybook XMITMACC,\n      which should be the COMMAREA for the EXEC CICS LINK.\n\n      XMITCICC includes all the control fields detailed in 12) above as\n      well as the XMITMAIL-TO, XMITMAIL-CC, XMITMAIL-BCC and\n      XMITMAIL-MSG fields.  You are limited to ten addressees of each\n      type (To: Cc: and Bcc:) and to 360 lines of message.\n\n      See XMITIVP3 for a sample CICS program that calls XMITCICS\n\n      You do not need to add a DDNAME to CICS to make XMITCICS work\n\n\n 51.  Sample call format:\n\n\n       WORKING-STORAGE SECTION.\n\n       01   XMITCICS-COMM-AREA.\n         COPY XMITMACC.\n\n        . . . . . .\n\n        . . . . . .\n\n\n       PROCEDURE DIVISION.\n\n        . . . . . .\n\n        . . . . . .\n\n\n           MOVE  'Andy_Robertson@JohnLewis.co.uk'\n             TO  XMITMAIL-TO(1)\n           MOVE  HIGH-VALUES\n             TO  XMITMAIL-TO(2)\n\n           MOVE  HIGH-VALUES\n             TO  XMITMAIL-CC(1)\n\n           MOVE  HIGH-VALUES\n             TO  XMITMAIL-BCC(1)\n\n           MOVE  'Test e-mail'\n             TO  XMITMAIL-SUBJECT\n\n           MOVE  'Hi there'\n             TO  XMITMAIL-MSG(1)\n           MOVE  ' '\n             TO  XMITMAIL-MSG(2)\n           MOVE  'This is a test e-mail'\n             TO  XMITMAIL-MSG(3)\n           MOVE  HIGH-VALUES\n             TO  XMITMAIL-MSG(4)\n\n      ********* SECURE MODE ONLY\n           MOVE  'MC1'\n             TO  XMITMAIL-NJE-NODE\n\n           EXEC CICS LINK\n                PROGRAM('XMITCICS')\n                COMMAREA(XMITCICS-COMM-AREA)\n           END-EXEC\n\n        . . . . . .\n\n        . . . . . .\n\n\n\n\n\n\n\n  HOW TO INSTALL\n  --------------\n\n\n 60.  Prerequisites:\n\n      o  OS/390, any level, or z/OS, any level.\n\n      o  Language Environment, any level.  XMITMAIL may work without\n         LE run time but I do not have facilities to test it.\n\n      o  SMTP properly configured\n\n      o  COBOL II or later\n\n      o  CICS 4.1 or later (using LE) for XMITCICS.  I am pretty sure\n         XMITCICS will NOT work without LE.\n\n\n 61.  To install XMITMAIL and XMITCICS\n\n      o  The XMITMAIL library is in unzipped TSO XMIT format.  It is\n         available from:\n\n              http://www.thenightland.co.uk/MYWEB/mvsindex.html\n\n         Follow the instructions at that site to download it, FTP or\n         SEND it to your mainframe as a binary file and TSO RECEIVE it\n         into a PDS.\n\n      o  Examine member XMITDOC (this member) for any updates\n\n      o  Customise the defaults in XMITMADF according to the comments\n         within that copybook\n\n      o  If 320,000 bytes is likely to be too small modify XMITSIZE.\n\n      o  Customise and run the job XMITINST. This will put XMITMAIL and\n         XMITCICS in load libraries, which you must, as usual,  include\n         in STEPLIB/LINKLIST for batch jobs, or DFHRPL for CICS.\n         Note, compile with NOSSRANGE.\n\n      o  Create exit subprogram(s) if you need them.  See XMITMADF for a\n         description of what an exit subprogram does. See XMITEXIT for a\n         sample exit program.\n\n         Compile an exit program using the XMITINSX job.\n\n         Place the exits in STEPLIB/LINKLIB or in DFHRPL.  ** NOTE **\n         this exit program is accessed through COBOL dynamic call.  This\n         DOES WORK under CICS - provided you have LE.\n\n\n 62.  Optionally\n\n      o  You may compile and run XMITIVP1/2/3 . . .   if the fancy takes\n         you These programs are described by comments within them. They\n         demonstrate standard use, use under CICS, HTML, and\n         attachments.\n\n      o  AT your discretion compile the auxillary formatting routines\n         XMITFMT and XMITDEBL to object code. These are designed to\n         handle masses of text and help you reformat it to fit e-mail\n         lines.  You may find them useful in other contexts.  For detail\n         of use see comments inline in the source code.\n\n      o  AT your discretion compile the auxillary attachment routines\n         XMIT64, XMITCHAR, XMITMIME and XMITBND to object code.\n\n             XMIT64 converts data to 64-bit mime format;\n\n             XMITCHAR converts data from 64-bit mime format;\n\n             XMITMIME takes a binary object and creates records to\n             transmit it in 64-bit mime format, ready for use by\n             XMITMAIL.\n\n             XMITBND creates a separator.\n\n         These are for use with process-option 2 and their use is\n         demonstrated in XMITIVPx. THEY HAVE NOT BEEN COMPREHENSIVELY\n         TESTED.\n\n         Note, compile with NOSSRANGE.\n\n      o  You may wish to use the sample XMITSMS program for sending\n         short messages.  You will need to customise the message\n         destination to the email-to-SMS gateway you use.\n\n\n\n\n  SECURE MODE\n  -----------\n\n\n 80.  if you are running SMTP in SECURE mode you must set the\n      XMITMAIL-SECURE flag in XMITMADF to Y before running XMITINST.\n\n 81.  You must also put your local NJE node in the XMITMAIL-NJE-NODE\n      field whenever you invoke XMITCICS.\n\n      If you omit this the node will be derived from the used or\n      defaulted FROM address eg if XMITMAIL-FROM is\n      TSO057@IPO.tiffani.co.uk then node will be IPO.\n\n      The node is not needed in batch.  Nor is it needed if you are not\n      running in SECURE mode.\n./ ADD NAME=XMITEXIT 0110-00329-05074-1516-00077-00066-00000-TSO057\n      ******************************************************************\n      *                                                                *\n      * SAMPLE EXIT ROUTINE                                            *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      *                                                                *\n      * Note.  This module is dynamically called.  Dynamic call DOES   *\n      * work under CICS & is fully supported.  To run an exit          *\n      * module like this under CICS, simply compile & link to a        *\n      * DFHRPL library WITHOUT translation.                            *\n      *                                                                *\n      ******************************************************************\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITEXIT'.\n       DATA DIVISION.\n       ENVIRONMENT DIVISION.\n       WORKING-STORAGE SECTION.\n\n       LINKAGE SECTION.\n\n       COPY XMITMAC.\n\n       COPY XMITMADF.\n\n       01   XMITMAIL-TOS.\n            04   XMITMAIL-TO       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-CCS.\n            04   XMITMAIL-CC       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-BCCS.\n            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-SUBJECT       PIC X(80).\n\n       01   XMITMAIL-MSGS.\n            04   XMITMAIL-MSG      PIC X(80)\n                   copy xmitsize.\n\n\n       PROCEDURE DIVISION USING\n            XMITMAIL-CONTROL\n            XMITMAIL-DEFAULTS\n            XMITMAIL-TOS\n            XMITMAIL-CCS\n            XMITMAIL-BCCS\n            XMITMAIL-SUBJECT\n            XMITMAIL-MSGS\n            .\n\n      *    Daft test\n\n           IF XMITMAIL-TO (1) (1:1) = 'B'\n               MOVE 'X' TO XMITMAIL-REPLY\n               MOVE ' You cant call people with names starting \"B\"'\n               TO XMITMAIL-DIAGNOSTIC\n           END-IF\n\n\n      *    Make sure we are called again for the next e-mail\n\n           MOVE 'Y' TO XMITMAIL-CALL-EXIT\n\n           GOBACK.\n./ ADD NAME=XMITFMT  0103-10218-10218-1703-00346-00271-00080-TSO057\n000100 identification division.\n000200\n000300 PROGRAM-ID.     'XMITFMT'.\n000400\n000500******************************************************************\n000600*                                                                *\n000700*  XMITFMT - MODULE TO REFORMAT TEXT SO THAT IT CAN BE DISPLAYED *\n000800*            WITHOUT WORDS BEING SPLIT ACROSS LINES.             *\n000900*                                                                *\n001000*                   AUTHOR: GARY HIRD                            *\n001100*                                                                *\n001200*             DATE WRITTEN: MAY 1990                             *\n001300*                                                                *\n001310*                                                                *\n001320*  FUNCTION - GENERAL DESCRIPTION                                *\n001321*                                                                *\n001322*  1.  This module reformats a mass of text into a number of     *\n001323*  fixed-length lines in such a way that words (assumed          *\n001324*  delimited by blanks) are not split between the lines, and     *\n001325*  there are no leading blanks in any lines                      *\n001326*                                                                *\n001327*                                                                *\n001328*  PARAMETERS                                                    *\n001329*                                                                *\n001330*  2.  Format:-                                                  *\n001331*                                                                *\n001332*  (COBOL)                                                       *\n001333*                                                                *\n001334*      01  INPUT-TEXT              PIC X(xxxx).                  *\n001335*      01  INPUT-LENGTH            PIC S9(8) COMP.               *\n001336*      01  OUTPUT-LINES.                                         *\n001337*          04  OUTPUT-LINE         PIC X(yyyy) OCCURS(zz).       *\n001338*      01  OUTPUT-LENGTH           PIC S9(8) COMP.               *\n001339*      01  OUTPUT-LINE-LENGTH      PIC S9(8) COMP value yyyy.    *\n001340*      01  W-REPLY                 PIC X.                        *\n001341*                                                                *\n001342*          .............                                         *\n001343*      MOVE ' ' TO OUTPUT-LINES                                  *\n001344*      MOVE LENGTH OF OUTPUT-LINES TO OUTPUT-LENGTH              *\n001345*                                                                *\n001346*      CALL 'XMITFMT' USING INPUT-TEXT INPUT-LENGTH              *\n001347*                           OUTPUT-LINES OUTPUT-LENGTH           *\n001348*                           OUTPUT-LINE-LENGTH W-REPLY           *\n001349*                                                                *\n001350*                                                                *\n001351*                                                                *\n001352*  3.  The format of the parameters is:                          *\n001353*                                                                *\n001354*      INPUT-TEXT    the text to be formatted.  Can be up to     *\n001355*                    320000 characters long.                     *\n001356*                                                                *\n001357*      INPUT-LENGTH  the length of the input text.               *\n001358*                                                                *\n001359*      OUTPUT-LINES  the formatted text, set by the module.      *\n001360*                    Can be up to 320000 characters long.        *\n001361*                                                                *\n001362*      OUTPUT-LENGTH the total length of OUTPUT-LINES.           *\n001363*                    After every call, the module replaces       *\n001364*                    this by the number of characters of         *\n001365*                    OUTPUT-LINES actually used. Therefore       *\n001366*                    the calling program should reset this       *\n001367*                    field before every call.                    *\n001368*                                                                *\n001369*      OUTPUT-LINE-LENGTH  the output line length.  This         *\n001370*                    field does NOT have to be an exact          *\n001371*                    fraction of OUTPUT-LENGTH.                  *\n001372*                                                                *\n001373*      W-REPLY       is a single character field set by the module\n001374*                    Possible values :-                          *\n001375*                                                                *\n001376*                        'V' -  success.                         *\n001377*                                                                *\n001378*                        'O' -  output overflow occurred.        *\n001379*                                                                *\n001380*                        'S' -  the line length given is too     *\n001381*                               small, being less than the       *\n001382*                               length of at least one of        *\n001383*                               the words in the text.           *\n001384*                                                                *\n001385*                    The calling program should test the reply   *\n001386*                    field to make sure an 'O' or 'S' error has  *\n001387*                    not occurred.                               *\n001388*                                                                *\n001389*                                                                *\n001390*                                                                *\n001451*                                                                *\n001452*                                                                *\n001460******************************************************************\n001500*                                                                *\n001600*  MODIFICATION HISTORY:                                         *\n001700*                                                                *\n001710*  14/12/00  AWR     MOD TO ELIMINATE BLANKS AT START OF NEW     *\n001720*                    LINE                                        *\n001730*                                                                *\n001740******************************************************************\n001750\n001760 ENVIRONMENT DIVISION.\n001770\n001780 data division.\n001790\n001800 working-storage section.\n001900\n002000\n002100 01  ws-fields.\n002200     04  current-word         pic x(320000).\n002300     04  work-out-lineno      pic s9(8)      comp.\n002400     04  w-prevchar           pic s9(8)      comp.\n002500     04  w-dummy1             pic s9(8)      comp.\n002600     04  w-dummy2             pic s9(8)      comp.\n002700     04  position-in-word     pic s9(8)      comp.\n002800     04  position-in-input    pic s9(8)      comp.\n002900     04  position-in-output   pic s9(8)      comp.\n003000     04  position-in-block    pic s9(8)      comp.\n003100     04  space-left-in-block  pic s9(8)      comp.\n003200     04  word-length          pic s9(8)      comp.\n003300     04  reply-flag           pic X.\n003400        88 end-of-input              value 'V'.\n003500        88 output-overflow           value 'O'.\n003600        88 block-length-too-small    value 'S'.\n003700\n003800 linkage section.\n003900\n004000 01  input-text               pic x(320000).\n004100 01  input-length             pic s9(8)      comp.\n004200\n004300 01  output-text              pic x(320000).\n004400 01  output-length            pic s9(8)      comp.\n004500\n004600 01  block-length             pic s9(8)      comp.\n004700\n004800 01  reply                    pic x.\n004900\n005000 procedure division using input-text  input-length\n005100                          output-text output-length\n005200                          block-length reply.\n005300\n005400******************************************************************\n005500*                                                                *\n005600*  Start of mainline.                                            *\n005700*                                                                *\n005800******************************************************************\n005900\n006000     perform b100-initialization\n006100     perform b400-deal-with-spaces\n006200\n006300     perform until end-of-input or output-overflow\n006400                            or block-length-too-small\n006500         perform b200-get-next-word\n006600         perform b300-move-word-to-output\n006700         perform b400-deal-with-spaces\n006800     end-perform\n006900\n007000     perform b500-finalization\n007100\n007200     goback\n007300******************************************************************\n007400*                                                                *\n007500*  End of mainline.                                              *\n007600*                                                                *\n007700******************************************************************\n007800\n007900\n008000     .\n008100 b100-initialization.\n008200******************************************************************\n008300*                                                                *\n008400*  Initialize pointers, etc.                                     *\n008500*                                                                *\n008600******************************************************************\n008700\n008800     move spaces to current-word output-text(1:output-length)\n008900                                 reply-flag\n009000     move zero to   position-in-block  position-in-output\n009100     move +1   to   position-in-input\n009200\n009300     .\n009400 b200-get-next-word.\n009500******************************************************************\n009600*                                                                *\n009700*  Get next word.                                                *\n009800*                                                                *\n009900******************************************************************\n010000\n010100     move zero to position-in-word\n010200     perform until input-text(position-in-input:1) = space\n010300                    or position-in-input > input-length\n010400         add +1 to position-in-word\n010500         move input-text(position-in-input:1)\n010600           to current-word(position-in-word:1)\n010700         add +1 to position-in-input\n010800     end-perform\n010900\n011000     move position-in-word to word-length\n011100\n011200     if position-in-input not < input-length\n011300         set end-of-input to true\n011400     end-if\n011500\n011600     .\n011700 b300-move-word-to-output.\n011800******************************************************************\n011900*                                                                *\n012000*  Check word length.                                            *\n012100*                                                                *\n012200******************************************************************\n012300\n012400     move zero to position-in-word\n012500     subtract position-in-block from block-length\n012600                       giving space-left-in-block\n012700\n012800     if space-left-in-block < word-length\n012900\n013000         if word-length > block-length\n013100\n013200             set block-length-too-small to true\n013300         else\n013400*            display \"=1>\" current-word(1:word-length)\n013500             perform until position-in-block = block-length\n013600                       or output-overflow\n013700                 add +1 to position-in-block position-in-output\n013800                 perform c100-check-for-overflow\n013900                 move space to output-text (position-in-output:1)\n014000             end-perform\n014100\n014200             move zero to position-in-block\n014300\n014400             perform until position-in-word = word-length\n014500                       or output-overflow\n014600                 add +1 to position-in-block position-in-output\n014700                           position-in-word\n014800                 perform c100-check-for-overflow\n014900                 move current-word (position-in-word:1)\n015000                   to output-text (position-in-output:1)\n015100             end-perform\n015200\n015300         end-if\n015400\n015500     else\n015600***transfer word and continue\n015700*        display \"=2>\" current-word(1:word-length)\n015800         perform until position-in-word = word-length\n015900                       or output-overflow\n016000             add +1 to position-in-block position-in-output\n016100                       position-in-word\n016200             perform c100-check-for-overflow\n016300             move current-word (position-in-word:1)\n016400               to output-text (position-in-output:1)\n016500         end-perform\n016600\n016700     end-if\n016800\n016900     .\n017000 b400-deal-with-spaces.\n017100******************************************************************\n017200*                                                                *\n017300*  Deal with spaces between words                                *\n017400*                                                                *\n017500******************************************************************\n017600\n017700     perform until input-text(position-in-input:1) not = space\n017800                    or position-in-input > input-length\n017900                    or output-overflow\n018000         add +1 to position-in-output position-in-block\n018100         if position-in-block > block-length\n018200             move +1 to position-in-block\n018300         end-if\n018400         perform c100-check-for-overflow\n018500         move input-text(position-in-input:1)\n018600           to output-text(position-in-output:1)\n018700         add +1 to position-in-input\n018800     end-perform\n018900\n019000******************************************************************\n019100*                                                                *\n019200*  Deal with case where initial char of an output line,          *\n019300*  following this word, is blank                                 *\n019400*                                                                *\n019500*  If it is second or subsequent output line, eliminate the      *\n019600*  blank.                                                        *\n019700*                                                                *\n019800******************************************************************\n019900\n020000     if not (position-in-input > input-length\n020100                    or output-overflow)\n020200\n020300         compute w-prevchar = (position-in-output)\n020400         compute work-out-lineno = (w-prevchar) / block-length\n020500\n020600         if work-out-lineno > 0\n020700\n020800             divide w-prevchar by block-length\n020900             giving w-dummy1 remainder w-dummy2\n021000\n021100*            display \"       \" w-prevchar\n021200*            display \"       \" w-dummy1\n021300*            display \"       \" w-dummy2\n021400*            display \"       \" position-in-block\n021500\n021600             if w-dummy2 = 1\n021700                 if output-text(w-prevchar:1) = ' '\n021800\n021900                     subtract 1 from position-in-output\n022000                     subtract 1 from position-in-block\n022100\n022200                 end-if\n022300             end-if\n022400         end-if\n022500     end-if\n022600*\n022700*                                                                *\n022800*                                                                *\n022900\n023000\n023100\n023200\n023300     if position-in-input not < input-length\n023400         set end-of-input to true\n023500     end-if\n023600\n023700     .\n023800 b500-finalization.\n023900******************************************************************\n024000*                                                                *\n024100*  End processing - set reply flag, etc.                         *\n024200*                                                                *\n024300******************************************************************\n024400\n024500     if not output-overflow\n024600         move position-in-output to output-length\n024700     end-if\n024800     move reply-flag to reply\n024900\n025000     .\n025100 c100-check-for-overflow.\n025200******************************************************************\n025300*                                                                *\n025400*  Check for overflow.                                           *\n025500*                                                                *\n025600******************************************************************\n025700\n025800     if position-in-output not < output-length\n025900         set output-overflow to true\n026000     end-if\n026100\n026200     .\n026300  end program xmitfmt.\n./ ADD NAME=XMITINMR 0116-10201-10222-1202-00326-00604-00000-TSO057\n\n\n      ************************************************************\n      *   XMITINMR batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      ************************************************************\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITINMR'.\n\n      ******************************************************************\n      *                                                                *\n      * CONVERT FROM AN FB INCORE FILE OF ARBITRARY LRECL AND LENGTH   *\n      * TO A FILE IN TSO TRANSMIT FORMAT, ALSO INCORE                  *\n      *                                                                *\n      ***\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 JUL 2010 1.6  SECURE mode spport  - NEW PROGRAM        AWR  *\n      *                                                                *\n      ******************************************************************\n\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n       01   INMR-LEN-X.\n            04   INMR-LEN           PIC S9(8) COMP.\n       01   W-LEN-X.\n            04   W-LEN         PIC S9(8) COMP.\n       01   XMITINMR-CHAR-X.\n            04   XMITINMR-CHAR PIC S9(8) COMP.\n       01   XMITMAFM-REC-X.\n            04   XMITMAFM-REC  PIC S9(8) COMP.\n       01   W-T-DATA PIC X(255).\n\n       01   INMR01.\n           04 INMR01-LEN-X          PIC X.\n           04 INMR01-SEG            PIC X VALUE X'E0'.\n           04 INMR01-ID             PIC XXXXXX VALUE 'INMR01'.\n           04 INMR01-T1.\n              07 INMR01-T1-KEY      PIC XX VALUE X'0042'.\n              07 INMR01-T1-NO       PIC XX VALUE X'0001'.\n              07 INMR01-T1-LEN      PIC XX VALUE X'0001'.\n              07 INMR01-T1-RECL     PIC X.\n           04 INMR01-REST           PIC X(7777).\n\n\n       01   INMR02.\n           04 INMR02-LEN-X          PIC X.\n           04 INMR02-SEG            PIC X VALUE X'E0'.\n           04 INMR02-ID             PIC XXXXXX VALUE 'INMR02'.\n           04 INMR02-T0.\n              07 INMR02-T0-KEY      PIC XX VALUE X'0000'.\n              07 INMR02-T0-NO       PIC XX VALUE X'0001'.\n           04 INMR02-T1.\n              07 INMR02-T1-KEY      PIC XX VALUE X'1028'.\n              07 INMR02-T1-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T1-LEN      PIC XX VALUE X'0007'.\n              07 INMR02-T1-UTIL     PIC XXXXXXX VALUE 'INMCOPY'.\n           04 INMR02-T2.\n              07 INMR02-T2-KEY      PIC XX VALUE X'102C'.\n              07 INMR02-T2-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T2-LEN      PIC XX VALUE X'0004'.\n              07 INMR02-T2-BYTES-X  PIC XXXX.\n           04 INMR02-T3.\n              07 INMR02-T3-KEY      PIC XX VALUE X'003C'.\n              07 INMR02-T3-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T3-LEN      PIC XX VALUE X'0002'.\n              07 INMR02-T3-DSORG    PIC XX VALUE X'4000'.\n           04 INMR02-T4.\n              07 INMR02-T4-KEY      PIC XX VALUE X'0042'.\n              07 INMR02-T4-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T4-LEN      PIC XX VALUE X'0004'.\n              07 INMR02-T4-RECL-X   PIC XXXX VALUE X'000000FF'.\n           04 INMR02-T5.\n              07 INMR02-T5-KEY      PIC XX VALUE X'0030'.\n              07 INMR02-T5-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T5-LEN      PIC XX VALUE X'0004'.\n              07 INMR02-T5-BLOCK-X  PIC XXXX VALUE X'00001000'.\n           04 INMR02-T6.\n              07 INMR02-T6-KEY      PIC XX VALUE X'0049'.\n              07 INMR02-T6-NO       PIC XX VALUE X'0001'.\n              07 INMR02-T6-LEN      PIC XX VALUE X'0002'.\n              07 INMR02-T6-RECFM    PIC XX VALUE X'5002'.\n           04 INMR02-T7.\n              07 INMR02-T7-KEY      PIC XX VALUE X'0002'.\n              07 INMR02-T7-NO       PIC XX VALUE X'0005'.\n              07 INMR02-T7-LEN1     PIC XX VALUE X'0004'.\n              07 INMR02-T7-QUAL1    PIC X(4) VALUE 'SENT'.\n              07 INMR02-T7-LEN2     PIC XX VALUE X'0008'.\n              07 INMR02-T7-QUAL2    PIC X(8) VALUE 'XMITMAIL'.\n              07 INMR02-T7-LEN3     PIC XX VALUE X'0007'.\n              07 INMR02-T7-QUAL3    PIC X(7) VALUE 'DYYMMDD'.\n              07 INMR02-T7-LEN4     PIC XX VALUE X'0007'.\n              07 INMR02-T7-QUAL4    PIC X(7) VALUE 'HHHMMSS'.\n              07 INMR02-T7-LEN5     PIC XX VALUE X'0003'.\n              07 INMR02-T7-QUAL5    PIC XXX VALUE 'XTH'.\n\n\n\n\n       01   INMR03.\n           04 INMR03-LEN-X          PIC X.\n           04 INMR03-SEG            PIC X VALUE X'E0'.\n           04 INMR03-ID             PIC XXXXXX VALUE 'INMR03'.\n           04 INMR03-T1.\n              07 INMR03-T1-KEY      PIC XX VALUE X'102C'.\n              07 INMR03-T1-NO       PIC XX VALUE X'0001'.\n              07 INMR03-T1-LEN      PIC XX VALUE X'0004'.\n              07 INMR03-T1-SIZEBYTE PIC XXXX.\n           04 INMR03-T2.\n              07 INMR03-T2-KEY      PIC XX VALUE X'003C'.\n              07 INMR03-T2-NO       PIC XX VALUE X'0001'.\n              07 INMR03-T2-LEN      PIC XX VALUE X'0002'.\n              07 INMR03-T2-DSORG    PIC XX VALUE X'4000'.\n           04 INMR03-T3.\n              07 INMR03-T3-KEY      PIC XX VALUE X'0042'.\n              07 INMR03-T3-NO       PIC XX VALUE X'0001'.\n              07 INMR03-T3-LEN      PIC XX VALUE X'0002'.\n              07 INMR03-T3-RECL     PIC XX VALUE X'0050'.\n           04 INMR03-T4.\n              07 INMR03-T4-KEY      PIC XX VALUE X'0049'.\n              07 INMR03-T4-NO       PIC XX VALUE X'0001'.\n              07 INMR03-T4-LEN      PIC XX VALUE X'0002'.\n              07 INMR03-T4-RECFM    PIC XX VALUE X'0001'.\n\n\n\n       01   INMR06.\n           04 INMR06-LEN-X          PIC X VALUE X'08'.\n           04 INMR06-SEG            PIC X VALUE X'E0'.\n           04 INMR06-ID             PIC XXXXXX VALUE 'INMR06'.\n\n\n       LINKAGE SECTION.\n\n       COPY XMITMAC.\n\n       COPY XMITMADF.\n\n       01   T.\n          04  T-KEY PIC XX.\n          04  T-NO   PIC XX.\n          04  T-LEN-X.\n             07  T-LEN PIC 9999 COMP.\n          04  T-DATA PIC X(777).\n\n       01   XMITMAFM-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITMAIL-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n       01   XMITMAFM-RECL         PIC S9(8) COMP.\n       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.\n\n       01   XMITINMR-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITINMR-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.\n       01   USER-ID               PIC XXXXXXXX.\n       01   NJE-NODE              PIC XXXXXXXX.\n\n       PROCEDURE DIVISION USING\n            XMITMAIL-CONTROL\n            XMITMAIL-DEFAULTS\n            XMITMAFM-BACK\n            XMITMAFM-RECL\n            XMITMAFM-TOT-RECNO\n            XMITINMR-BACK\n            XMITINMR-TOT-RECNO\n            USER-ID\n            NJE-NODE\n\n             .\n           MOVE 'E' TO XMITMAIL-REPLY\n\n           COMPUTE W-LEN = XMITMAFM-RECL\n           MOVE W-LEN-X(4:1) TO INMR01-T1-RECL\n           SET ADDRESS OF T TO ADDRESS OF INMR01-REST\n           COMPUTE INMR-LEN = LENGTH OF INMR01-T1\n                            + 8\n   ******  DISPLAY 'INMR-LEN ' INMR-LEN\n           MOVE X'1011' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE NJE-NODE        TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n\n           MOVE X'1012' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE USER-ID         TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n\n           MOVE X'1001' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE XMITMAIL-CENTER TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n\n           MOVE X'1002' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE XMITMAIL-SMTP-ADDRESS TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n\n           MOVE X'1024' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE FUNCTION CURRENT-DATE (1:14)\n           TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n\n           MOVE X'102F' TO T-KEY\n           MOVE X'0001' TO T-NO\n           MOVE X'01'\n           TO W-T-DATA\n           PERFORM MOVEIN-01-T-DATA\n           MOVE INMR-LEN-X(4:1) TO INMR01-LEN-X\n\n           MOVE FUNCTION CURRENT-DATE (03:06)\n           TO INMR02-T7-QUAL3(2:6)\n\n           MOVE FUNCTION CURRENT-DATE (09:06)\n           TO INMR02-T7-QUAL4(2:6)\n\n           MOVE FUNCTION CURRENT-DATE (15:02)\n           TO INMR02-T7-QUAL5(2:2)\n\n           MOVE LENGTH OF INMR02 TO W-LEN\n           MOVE W-LEN-X(4:1) TO INMR02-LEN-X\n\n\n           COMPUTE W-LEN = XMITMAFM-RECL *\n                           XMITMAFM-TOT-RECNO\n           MOVE W-LEN-X TO INMR03-T1-SIZEBYTE\n           MOVE W-LEN-X TO INMR02-T2-BYTES-X\n\n           MOVE LENGTH OF INMR03 TO W-LEN\n           MOVE W-LEN-X(4:1) TO INMR03-LEN-X\n\n\n           MOVE 1 TO XMITINMR-CHAR\n\n           MOVE 0 TO W-LEN\n           MOVE INMR01-LEN-X TO W-LEN-X(4:1)\n           MOVE INMR01(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)\n           ADD W-LEN TO XMITINMR-CHAR\n\n           MOVE 0 TO W-LEN\n           MOVE INMR02-LEN-X TO W-LEN-X(4:1)\n           MOVE INMR02(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)\n           ADD W-LEN TO XMITINMR-CHAR\n\n           MOVE 0 TO W-LEN\n           MOVE INMR03-LEN-X TO W-LEN-X(4:1)\n           MOVE INMR03(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)\n           ADD W-LEN TO XMITINMR-CHAR\n\n           MOVE 1 TO XMITMAFM-REC\n\n           PERFORM UNTIL XMITMAFM-REC > XMITMAFM-TOT-RECNO\n               COMPUTE W-LEN = 2 + XMITMAFM-RECL\n               MOVE W-LEN-X(4:1) TO XMITINMR-BACK(XMITINMR-CHAR:1)\n               ADD 1 TO XMITINMR-CHAR\n               MOVE X'C0' TO XMITINMR-BACK(XMITINMR-CHAR:1)\n               ADD 1 TO XMITINMR-CHAR\n               COMPUTE W-LEN = 1 + (XMITMAFM-REC - 1) * XMITMAFM-RECL\n               MOVE XMITMAFM-BACK(W-LEN:XMITMAFM-RECL)\n               TO   XMITINMR-BACK(XMITINMR-CHAR:XMITMAFM-RECL)\n               ADD 1 TO XMITMAFM-REC\n               ADD XMITMAFM-RECL TO XMITINMR-CHAR\n           END-PERFORM\n\n\n           MOVE 0 TO W-LEN\n           MOVE INMR06-LEN-X TO W-LEN-X(4:1)\n           MOVE INMR06(1:W-LEN) TO XMITINMR-BACK(XMITINMR-CHAR:W-LEN)\n           ADD W-LEN TO XMITINMR-CHAR\n           MOVE ' '             TO XMITINMR-BACK(XMITINMR-CHAR:180)\n           ADD 80   TO XMITINMR-CHAR\n           COMPUTE XMITINMR-TOT-RECNO = XMITINMR-CHAR / 80\n           MOVE 'V' TO XMITMAIL-REPLY\n           GOBACK\n\n           .\n       MOVEIN-01-T-DATA.\n           MOVE 1 TO W-LEN\n           PERFORM UNTIL W-LEN NOT < LENGTH OF W-T-DATA\n           OR W-T-DATA(W-LEN:1) = ' '\n               ADD 1 TO W-LEN\n           END-PERFORM\n           SUBTRACT 1 FROM W-LEN\n           IF W-LEN > 0 MOVE W-T-DATA(1:W-LEN) TO T-DATA(1:W-LEN)\n           MOVE W-LEN TO T-LEN\n           COMPUTE INMR-LEN = INMR-LEN + T-LEN + 6\n   *****   display 'data     ' W-T-DATA(1:W-LEN)\n   *****   display 'inmr-len ' inmr-len\n           ADD 1 TO W-LEN\n           SET ADDRESS OF T TO ADDRESS OF T-DATA(W-LEN:1)\n           MOVE ' ' TO W-T-DATA\n\n\n           .\n       END PROGRAM XMITINMR.\n./ ADD NAME=XMITINST 0134-00329-10210-1525-00185-00063-00000-TSO057\n//TSO05765 JOB (T951V00),\n//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A,SCHENV=COBOL\n//*\n//******************************************************************\n//*                                                                *\n//*  This job will compile and link XMITMAIL and XMITCICS into     *\n//*  load libraries                                                *\n//*                                                                *\n//*  Run after you have customised the XMITMADF member             *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 22 Nov 2000 1.0  written                                  AWR  *\n//* 26 Nov 2000 1.1  XMITCICS added                           AWR  *\n//* 26 Jul 2010 1.6  XMITUID and XMITNODE (assembler)         AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        PP.XMITMA16.COBOL  - to the XMITMAIL library\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITMAIL to be stored\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITCICS to be stored\n//*\n//*        SYS1.SYSLEV. libraries - as appropriate\n//*\n//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate\n//*\n//*\n//*   3) ADD COMPILER STEPLIBS IF NEEDED, ETC ETC\n//*\n//*\n//*   4) CHECK YOU HAVE CUSTOMISED XMITMADF\n//*\n//*\n//*   5) SUBMIT JOB\n//*\n//*\n//* Expect RC 4\n//*\n//ASM      PROC  M=\n//ASM    EXEC PGM=ASMA90,PARM=(OBJ,NODECK)\n//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR\n//         DD  DSN=SYS1.AMODGEN,DISP=SHR\n//SYSIN    DD  DSN=PP.XMITMA16.COBOL(&M),DISP=SHR\n//SYSUT1   DD  DSN=&&SYSUT1,UNIT=VIO,SPACE=(9999,(600,100))\n//SYSUT2   DD  DSN=&&SYSUT2,UNIT=VIO,SPACE=(1700,(300,50))\n//SYSUT3   DD  DSN=&&SYSUT3,UNIT=VIO,SPACE=(1700,(300,50))\n//SYSPRINT DD  SYSOUT=*,DCB=BLKSIZE=1089\n//SYSPUNCH DD  SYSOUT=B\n//SYSLIN   DD  DSN=&&ASMOBJ(&M),UNIT=SYSALLDA,SPACE=(80,(200,50,70)),\n//             DISP=(MOD,PASS)\n//         PEND\n//*\n//       EXEC ASM,M=XMITNODE\n//       EXEC ASM,M=XMITUID\n//*\n//*   ******************************************************************\n//*   *                                                                *\n//*   *       BATCH MODULE                                             *\n//*   *                                                                *\n//*   ******************************************************************\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),\n// PARM=('NOOFFSET,SSRANGE,RENT,NOCICS',\n//       'NODYNAM,LIB,APOST,')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL\n//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITMAIL),DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//*\n//* PRE-LINKEDIT STEP:\n//*\n//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),\n// PARM=''\n//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR\n//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),\n//             SPACE=(32000,(30,30)),\n//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)\n//SYSOUT   DD  SYSOUT=*\n//SYSPRINT DD  SYSOUT=*\n//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)\n//         DD  *\n//SYSLIB   DD  DUMMY\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,REUS,RENT')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITMAIL),DISP=SHR\n//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR\n//         DD   DSN=&&ASMOBJ,DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//*\n//*\n//*\n//*\n//*   ******************************************************************\n//*   *                                                                *\n//*   *        CICS MODULE                                             *\n//*   *                                                                *\n//*   ******************************************************************\n//*\n//*\n//* STANDARD CICS TRANSLATE\n//*\n//T        EXEC  PGM=DFHECP1$,COND=(4,LT),\n// PARM='LINECOUNT(56),NOSOURCE,NOXREF,APOST,COBOL2'\n//STEPLIB  DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR\n//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLPA,DISP=SHR\n//SYSPRINT DD   SYSOUT=*\n//SYSPUNCH DD   DSN=&&SOURCE,\n//           DISP=(NEW,PASS),\n//           BLKSIZE=3120,\n//           UNIT=SYSALLDA,SPACE=(400,(400,100))\n//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITCICS),DISP=SHR\n//*\n//* COBOL COMPILE\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),\n// PARM=('NOOFFSET,NOSSRANGE,RENT,NOCICS,LIST',\n//       'NODYNAM,LIB,APOST,')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB  DD    DISP=SHR,DSN=PP.XMITMA16.COBOL\n//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHCOB,DISP=SHR\n//         DD   DSN=SYS1.SYSLEV.ACEESRC1,DISP=SHR\n//SYSIN    DD   DSN=&SOURCE,DISP=(SHR,DELETE)\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'RENT,REUS,AMODE=31,RMODE=ANY')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIN   DD   *\n   INCLUDE CICSLINK(DFHELII)\n//         DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//CICSLINK DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR\n//SYSLIB   DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR\n//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR\n//         DD   DSN=&&ASMOBJ,DISP=SHR\n//SYSLMOD  DD   DSN=PP.XMITMA16.LOAD(XMITCICS),DISP=SHR\n./ ADD NAME=XMITINSX 0106-00336-10217-2314-00152-00149-00000-TSO057\n//TSO05765 JOB (T951V00),\n//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A\n//*\n//******************************************************************\n//*                                                                *\n//*  This job will compile and link XMITEXIT into                  *\n//*  batch and CICS load libraries                                 *\n//*                                                                *\n//*  Run only if you need an exit program                          *\n//*                                                                *\n//******************************************************************\n//*\n//******************************************************************\n//* HISTORY                                                        *\n//******************************************************************\n//*                                                                *\n//* 26 Nov 2000 1.1  written                                  AWR  *\n//*                                                                *\n//******************************************************************\n//*\n//*\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*\n//*  0) Modify XMITEXIT to do what you want\n//*\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        SFT.XMITMAIL.COBOL - to the XMITMAIL library\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITEXIT to be stored for batch jobs\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITEXIT to be stored for CICS\n//*\n//*        SYS1.SYSLEV. libraries - as appropriate\n//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate\n//*\n//*\n//*   3) ADD STEPLIBS IF NEEDED, ETC ETC\n//*\n//*\n//*   4) SUBMIT JOB\n//*\n//*\n//* expect RC 4\n//*\n//*\n//*\n//*   ******************************************************************\n//*   *                                                                *\n//*   *       BATCH EXIT MODULE                                        *\n//*   *                                                                *\n//*   ******************************************************************\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,\n// PARM=('NOOFFSET,NOSSRANGE,RENT',\n//       'NODYNAM,LIB,APOST,')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS330.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL\n//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITEXIT),DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//*\n//* PRE-LINKEDIT STEP:\n//*\n//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),REGION=7M,\n// PARM=''\n//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR\n//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),\n//             SPACE=(32000,(30,30)),\n//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)\n//SYSOUT   DD  SYSOUT=*\n//SYSPRINT DD  SYSOUT=*\n//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)\n//         DD  *\n//SYSLIB   DD  DUMMY\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,REUS,RENT')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITEXIT),DISP=SHR\n//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//*\n//*\n//*\n//*   ******************************************************************\n//*   *                                                                *\n//*   *        CICS EXIT MODULE                                        *\n//*   *                                                                *\n//*   ******************************************************************\n//*\n//*\n//*\n//* COBOL COMPILE.  Note no precompile\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),REGION=7M,\n// PARM=('NOOFFSET,NOSSRANGE,RENT,LIST',\n//       'NODYNAM,LIB,APOST,')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS330.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB  DD    DISP=SHR,DSN=PP.XMITMA16.COBOL\n//         DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHCOB,DISP=SHR\n//         DD   DSN=SYS1.SYSLEV.ACEESRC1,DISP=SHR\n//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITEXIT),DISP=SHR\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'RENT,REUS,AMODE=31,RMODE=ANY')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLIN   DD   *\n   INCLUDE CICSLINK(DFHELII)\n//         DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//CICSLINK DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR\n//SYSLIB   DD   DSN=CICSSYS.CTSLEVEL.CICS.SDFHLOAD,DISP=SHR\n//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR\n//SYSLMOD  DD   DSN=PP.XMITMA16.LOAD(XMITEXIT),DISP=SHR\n./ ADD NAME=XMITIVPH 0102-05343-10210-1506-00155-00150-00006-TSO057\n000001 CBL NOSSRANGE\n000002******************************************************************\n000003*                                                                *\n000004* XMITIVPH.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *\n000005*            FORMATTED MULTIPART E-MAIL, AND HTML                *\n000006*                                                                *\n000007******************************************************************\n000008\n000009******************************************************************\n000010* HISTORY                                                        *\n000020******************************************************************\n000030*                                                                *\n000040* 10 Dec 2005 1.2  New                                      AWR  *\n000050*                                                                *\n000060******************************************************************\n000070\n000080 IDENTIFICATION DIVISION.\n000090 PROGRAM-ID.\n000091         XMITIVPH .\n000092\n000093 ENVIRONMENT DIVISION.\n000094 DATA DIVISION.\n000095 WORKING-STORAGE SECTION.\n000096\n000097\n000098\n000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n000100\n000200    COPY XMITMAC.\n000300\n000400    01   XMITMAIL-TOS.\n000500         04   FILLER            PIC X(80) VALUE\n000600         'Andy_Robertson@JohnLewis.co.uk'.\n000700         04   FILLER            PIC X(80) VALUE\n000800         'pinlighter@btconnect.com'.\n000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001000\n001100    01   XMITMAIL-CCS.\n001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001300\n001400    01   XMITMAIL-BCCS.\n001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001600\n001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n001800         'IVP  E-mail format html '.\n001900\n002000    01   XMITMAIL-MSG.\n002100         04   MSG-LINE          PIC X(80)\n002200         OCCURS 999 INDEXED BY LINE-NO.\n002300\n002400\n002500\n002600\n002700\n002800    01   Q    PIC X     VALUE '\"'.\n002900\n003000    01   BND  PIC X(37) VALUE\n003010             'Mime.Part.XMITIP.24jul65lrhg.0x0zax1d'.\n003020\n003030\n003040\n003050 PROCEDURE DIVISION.\n003060\n003070\n003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION\n003090\n003100     call 'xmitbnd' using bnd\n003200\n003300\n003400     SET LINE-NO TO 1\n003500\n003600     MOVE 'Mime-Version: 1.0 '\n003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003800\n003900     MOVE ' ' to MSG-LINE(LINE-NO)\n004000     STRING  'Content-type: multipart/mixed; boundary='\n004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n004200             SET LINE-NO UP BY 1\n004300\n004400     MOVE ' '\n004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004600\n004700     MOVE 'This is a multi-part message in MIME format. '\n004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004900\n005000     MOVE ' ' TO MSG-LINE(LINE-NO)\n005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n005200     SET LINE-NO UP BY 1\n005300\n005400*    HTML\n005500\n005600\n005700     MOVE 'Content-Type: text/html; charset=\"iso-8859-1\"'\n005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005900\n006000     MOVE 'Content-Transfer-Encoding: 7bit '\n006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006200\n006300     MOVE ' '\n006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006500\n006600     MOVE ' '\n006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006800\n006810*** Actual html starts here\n006820\n006900     MOVE '<HTML><BODY><PRE>                            '\n007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007100\n007200     MOVE ' one two <b>three</b> four'\n007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007400\n007410     MOVE '     <H1> Header</h1>     '\n007420     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007430\n007440     MOVE    '         '\n007450     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007460\n007470     MOVE    'last line'\n007480     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007490     MOVE    '</pre>'\n007500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007600\n007610*** Actual html ends here\n007620\n007630\n007700     MOVE ' '  TO MSG-LINE(LINE-NO)\n007800     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n007900     SET LINE-NO UP BY 1\n008000\n008100\n008200\n008300\n008400\n008410     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)\n008420\n008430      CALL XMITMAIL-NAME USING\n008440          XMITMAIL-CONTROL\n008450          XMITMAIL-TOS\n008460          XMITMAIL-CCS\n008470          XMITMAIL-BCCS\n008480          XMITMAIL-SUBJECT\n008490          XMITMAIL-MSG\n008500\n008600\n008700\n008800     DISPLAY XMITMAIL-CONTROL\n008900     DISPLAY XMITMAIL-DIAGNOSTIC\n009000\n009100\n009200     STOP RUN.\n009300\n009400 copy xmitbnd .\n009500 END PROGRAM XMITIVPH.\n009600\n./ ADD NAME=XMITIVPR 0100-10204-10204-1631-00095-00095-00000-TSO057\n//TSO05765 JOB (T951V00),\n//          NOTIFY=TSO057,MSGCLASS=T,CLASS=A,SCHENV=COBOL\n//*\n//*\n//*\n//*      TO RUN THIS JOB\n//*      ---------------\n//*\n//*\n//*  1) CHANGE THE JOBCARD\n//*\n//*\n//*  2) CHANGE THE NAMES OF:\n//*\n//*        PP.XMITMA16.COBOL - to the XMITMAIL library\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITMAIL to be stored\n//*\n//*        PP.XMITMA16.LOAD   - to the load library where you want\n//*                             XMITCICS to be stored\n//*\n//*        SYS1.SYSLEV. libraries - as appropriate\n//*\n//*        CICSSYS.CTSLEVEL.CICS. libraries - as appropriate\n//*\n//*\n//*   3) ADD COMPILER STEPLIBS IF NEEDED, ETC ETC\n//*\n//*\n//*   4) CHECK YOU HAVE CUSTOMISED XMITMADF\n//*\n//*\n//*   5) SUBMIT JOB\n//*\n//*\n//* Expect RC 4\n//*\n//*\n//*\n//*   ******************************************************************\n//*   *                                                                *\n//*   *       BATCH MODULE                                             *\n//*   *                                                                *\n//*   ******************************************************************\n//*\n//*\n//C        EXEC PGM=IGYCRCTL,COND=(4,LT),\n// PARM=('NOOFFSET,SSRANGE,RENT,NOCICS',\n//       'NODYNAM,LIB,APOST,')\n//STEPLIB  DD   DISP=SHR,DSN=SYSPP.COBOS410.SIGYCOMP\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT2   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT3   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT4   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT5   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT6   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSUT7   DD   UNIT=SYSALLDA,SPACE=(6233,(150,300),,,ROUND)\n//SYSPRINT DD   SYSOUT=*\n//SYSLIB   DD   DISP=SHR,DSN=PP.XMITMA16.COBOL\n//SYSIN    DD   DSN=PP.XMITMA16.COBOL(XMITIVP1),DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(NEW,PASS),BLKSIZE=3120,\n//         UNIT=SYSALLDA,SPACE=(80,(1500,7750))\n//*\n//* PRE-LINKEDIT STEP:\n//*\n//PLKED   EXEC PGM=EDCPRLK,COND=(4,LT),\n// PARM=''\n//SYSMSGS  DD  DSNAME=SYS1.SYSLEV.SCEEMSGP(EDCPMSGE),DISP=SHR\n//SYSMOD   DD  DSNAME=&&OBJ,UNIT=SYSALLDA,DISP=(NEW,PASS),\n//             SPACE=(32000,(30,30)),\n//             DCB=(RECFM=FB,LRECL=80,BLKSIZE=3200)\n//SYSOUT   DD  SYSOUT=*\n//SYSPRINT DD  SYSOUT=*\n//SYSIN    DD  DSN=&&OBJ,DISP=(SHR,DELETE)\n//         DD  *\n//SYSLIB   DD  DUMMY\n//*\n//* LINKEDIT\n//*\n//LINK     EXEC PGM=HEWL,COND=(4,LT),\n// PARM=('XREF,LIST,MAP',\n// 'AMODE=31,RMODE=ANY,REUS,RENT')\n//SYSUT1   DD   UNIT=SYSALLDA,SPACE=(1024,(100,30))\n//SYSPRINT DD   SYSOUT=*\n//SYSLMOD  DD DSN=PP.XMITMA16.LOAD(XMITIVP1),DISP=SHR\n//SYSLIB   DD UNIT=SYSALLDA,SPACE=(1,(1,1,1)),BLKSIZE=32760,RECFM=U\n//         DD   DSN=SYS1.SYSLEV.SCEELKED,DISP=SHR\n//SYSLIN   DD   DSN=&&OBJ,DISP=(OLD,DELETE)\n//*\n//*\n//   EXEC PGM=XMITIVP1\n//STEPLIB  DD DSN=PP.XMITMA16.LOAD,DISP=SHR\n//SYSOUT   DD   SYSOUT=*\n//*\n./ ADD NAME=XMITIVP1 0109-00341-10210-1506-00087-00069-00025-TSO057\n000001 CBL NOSSRANGE\n000010******************************************************************\n000020*                                                                *\n000030* XMITIVP1.  DEMONSTRATES CALL USING PROCESS-OPTION 1, PLAIN-    *\n000040*            TEXT                                                *\n000050*                                                                *\n000060******************************************************************\n000070\n000080******************************************************************\n000090* HISTORY                                                        *\n000091******************************************************************\n000092*                                                                *\n000093* 06 Dec 2000 1.2  New                                      AWR  *\n000094*                                                                *\n000095******************************************************************\n000096\n000100 IDENTIFICATION DIVISION.\n000200 PROGRAM-ID.\n000300         XMITIVP1 .\n000400\n000500 ENVIRONMENT DIVISION.\n000600 DATA DIVISION.\n000700 WORKING-STORAGE SECTION.\n000800\n000900\n001000\n001100    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n001200\n001300    COPY XMITMAC.\n001400\n001500    01   XMITMAIL-TOS.\n001600         04   FILLER            PIC X(80) VALUE\n001700         'Andy_Robertson@JohnLewis.co.uk'.\n001800         04   FILLER            PIC X(80) VALUE\n001900         'pinlighter@btconnect.com'.\n002000*        04   FILLER            PIC X(80) VALUE\n002100*        'CTHULHU@Ryleh.com'.\n002200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n002300\n002400    01   XMITMAIL-CCS.\n002500*        04   FILLER            PIC X(80) VALUE\n002600*        'AZATHOTH@TheCenterOfInfinity.com'.\n002700*        04   FILLER            PIC X(80) VALUE\n002800*        'The_Black_Goat_With_1000_Young@TheWoods.com'.\n002900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n003000\n003100    01   XMITMAIL-BCCS.\n003200*        04   FILLER            PIC X(80) VALUE\n003300*        'Whatley@Dunwich.com'.\n003400*        04   FILLER            PIC X(80) VALUE\n003500*        'Wilmarth@Miskatonic_U.edu'.\n003600         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n003700\n003800    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n003900         'IVP e-mail format 1   '.\n004000\n004100    01   XMITMAIL-MSGS.\n004200         04   FILLER            PIC X(80) VALUE\n004300         'Whoop-de-do.          '.\n004400         04   FILLER            PIC X(80) VALUE\n004500         'The stars just came right!!'.\n004600         04   FILLER            PIC X(80) VALUE\n004610         '. Full.  stop!!!             '.\n004620         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n004700\n004800\n004900 PROCEDURE DIVISION.\n005000\n005100\n005200*    MOVE 'Y' TO XMITMAIL-DEBUG\n005300\n005400      CALL XMITMAIL-NAME USING\n005500          XMITMAIL-CONTROL\n005600          XMITMAIL-TOS\n005700          XMITMAIL-CCS\n005800          XMITMAIL-BCCS\n005900          XMITMAIL-SUBJECT\n006000          XMITMAIL-MSGS\n006100\n006200\n006300\n006400     DISPLAY XMITMAIL-CONTROL\n006500     DISPLAY XMITMAIL-DIAGNOSTIC\n006600     IF XMITMAIL-REPLY NOT = 'V' MOVE 16 TO RETURN-CODE\n006700     END-IF\n006800     STOP RUN.\n006900\n./ ADD NAME=XMITIVP2 0114-00341-10210-1506-00179-00109-00179-TSO057\n000001 CBL NOSSRANGE\n000010******************************************************************\n000020*                                                                *\n000030* XMITIVP2.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *\n000040*            FORMATTED MULTIPART E-MAIL, AND TEXT ATTACHMENT     *\n000051*                                                                *\n000052******************************************************************\n000053\n000054******************************************************************\n000055* HISTORY                                                        *\n000056******************************************************************\n000057*                                                                *\n000058* 01 Mar 2000 1.2  New                                      AWR  *\n000059*                                                                *\n000060******************************************************************\n000070\n000080 IDENTIFICATION DIVISION.\n000090 PROGRAM-ID.\n000091         XMITIVP2 .\n000092\n000093 ENVIRONMENT DIVISION.\n000094 DATA DIVISION.\n000095 WORKING-STORAGE SECTION.\n000096\n000097\n000098\n000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n000100\n000200    COPY XMITMAC.\n000300\n000400    01   XMITMAIL-TOS.\n000500         04   FILLER            PIC X(80) VALUE\n000600         'Andy_Robertson@JohnLewis.co.uk'.\n000700         04   FILLER            PIC X(80) VALUE\n000800         'pinlighter@btconnect.com'.\n000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001000\n001100    01   XMITMAIL-CCS.\n001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001300\n001400    01   XMITMAIL-BCCS.\n001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001600\n001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n001800         'IVP  E-mail format 2  + binary attachment '.\n001900\n002000    01   XMITMAIL-MSG.\n002100         04   MSG-LINE          PIC X(80)\n002200         OCCURS 999 INDEXED BY LINE-NO.\n002300\n002400\n002500\n002600\n002700\n002800    01   Q    PIC X     VALUE '\"'.\n002900\n003000    01   BND  PIC X(37) VALUE\n003010             'Mime.Part.XMITIP.24jul65lrhg.0x0zax1d'.\n003020\n003030\n003040\n003050 PROCEDURE DIVISION.\n003060\n003070\n003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION\n003090\n003100     call 'xmitbnd' using bnd\n003200\n003300\n003400     SET LINE-NO TO 1\n003500\n003600     MOVE 'Mime-Version: 1.0 '\n003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003800\n003900     MOVE ' ' to MSG-LINE(LINE-NO)\n004000     STRING  'Content-type: multipart/mixed; boundary='\n004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n004200             SET LINE-NO UP BY 1\n004300\n004400     MOVE ' '\n004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004600\n004700     MOVE 'This is a multi-part message in MIME format. '\n004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004900\n005000     MOVE ' ' TO MSG-LINE(LINE-NO)\n005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n005200     SET LINE-NO UP BY 1\n005300\n005400*    Plain text\n005500\n005600\n005700     MOVE 'Content-Type: text/plain; charset=\"iso-8859-1\"'\n005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005900\n006000     MOVE 'Content-Transfer-Encoding: 7bit '\n006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006200\n006300     MOVE ' '\n006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006500\n006600     MOVE ' '\n006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006800\n006900     MOVE '.line1   - initial period -                  '\n007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007100\n007200     MOVE 'line 2'\n007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007400\n007500     MOVE    'last line'\n007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007700\n007800     MOVE ' '  TO MSG-LINE(LINE-NO)\n007900     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n008000     SET LINE-NO UP BY 1\n008100\n008200\n008300*    text attachment\n008400\n008410\n008420     MOVE 'Content-Type: text/plain; '\n008430     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008440\n008441     MOVE '              name=\"testtext\"'\n008442     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008443\n008444     MOVE 'Content-Transfer-Encoding: 7bit '\n008445     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008446\n008447     MOVE 'Content-Disposition: attachment;             '\n008448     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008449\n008450     MOVE '   filename=\"test.txt\"                       '\n008451     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008452\n008453     MOVE 'Content-Description: f                       '\n008454     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008455\n008456     MOVE ' '\n008457     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008458\n008459     MOVE 'file line 1                                  '\n008460     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008470\n008471     MOVE 'file line 2                                  '\n008472     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008473\n008474     MOVE 'file last line                               '\n008475     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n008476\n008477     MOVE ' ' to MSG-LINE(LINE-NO)\n008478     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n008479     SET LINE-NO UP BY 1\n008480\n008481\n008482\n008483\n008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)\n008485\n008486      CALL XMITMAIL-NAME USING\n008487          XMITMAIL-CONTROL\n008488          XMITMAIL-TOS\n008489          XMITMAIL-CCS\n008490          XMITMAIL-BCCS\n008500          XMITMAIL-SUBJECT\n008600          XMITMAIL-MSG\n008700\n008800\n008900\n009000     DISPLAY XMITMAIL-CONTROL\n009100     DISPLAY XMITMAIL-DIAGNOSTIC\n009200\n009300\n009400     STOP RUN.\n009500\n009600 copy xmitbnd .\n009610 end program xmitivp2.\n009700\n./ ADD NAME=XMITIVP3 0105-00364-10210-1506-00084-00076-00012-TSO057\n000001 CBL NOSSRANGE\n000010******************************************************************\n000020*                                                                *\n000030* XMITIVP3.  Demonstrates XMITCICS under CICS                    *\n000050*                                                                *\n000051*            Must be translated, compiled and linked as is       *\n000052*            usual for a CICS program                            *\n000053*                                                                *\n000060******************************************************************\n000070\n000080******************************************************************\n000090* HISTORY                                                        *\n000091******************************************************************\n000092*                                                                *\n000093* 29 Dec 2000 1.2  New                                      AWR  *\n000094*                                                                *\n000095******************************************************************\n000096\n000100 IDENTIFICATION DIVISION.\n000200 PROGRAM-ID.\n000300         XMITIVP3 .\n000400\n000500 ENVIRONMENT DIVISION.\n000600 DATA DIVISION.\n000700 WORKING-STORAGE SECTION.\n000800\n000810\n000820 01   XMITCICS-COMM-AREA.\n000830   COPY XMITMACC.\n000840\n000850\n000860 LINKAGE SECTION.\n000870\n000880\n000890 PROCEDURE DIVISION.\n000900\n001600\n001700     MOVE  'Andy_Robertson@JohnLewis.co.uk'\n001800       TO  XMITMAIL-TO(1)\n001900\n001910     move  'pinlighter@btconnect.com'\n001920       TO  XMITMAIL-TO(2)\n001930\n002000     MOVE  HIGH-VALUES\n002100       TO  XMITMAIL-TO(3)\n002200\n002300\n002400     MOVE  HIGH-VALUES\n002500       TO  XMITMAIL-CC(1)\n002600\n002700\n002800     MOVE  HIGH-VALUES\n002900       TO  XMITMAIL-BCC(1)\n003000\n003100********* SECURE MODE ONLY\n003110     MOVE  'MC1'\n003120       TO  XMITMAIL-NJE-NODE\n003130\n003140\n003200     MOVE  'Test e-mail'\n003300       TO  XMITMAIL-SUBJECT\n003400\n003500\n003600     MOVE  'Hi there'\n003700       TO  XMITMAIL-MSG(1)\n003800\n003900     MOVE  ' '\n004000       TO  XMITMAIL-MSG(2)\n004100\n004200     MOVE  'This is a test e-mail'\n004300       TO  XMITMAIL-MSG(3)\n004400\n004500     MOVE  HIGH-VALUES\n004600       TO  XMITMAIL-MSG(4)\n004700\n004800\n004900\n005000     EXEC CICS LINK\n005100          PROGRAM('XMITCICS')\n005200          COMMAREA(XMITCICS-COMM-AREA)\n005300     END-EXEC\n005600\n005700     STOP RUN.\n005800\n./ ADD NAME=XMITIVP4 0121-05060-10210-1507-00167-00130-00167-TSO057\n000001 CBL NOSSRANGE\n000002******************************************************************\n000003*                                                                *\n000004* XMITIVP4.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *\n000005*            FORMATTED MULTIPART E-MAIL, AND SENDS BINARY DATA   *\n000006*            IN 64 BIT MIME FORMAT USING XMIT64 AND XMITMIME     *\n000007*                                                                *\n000008******************************************************************\n000009\n000010******************************************************************\n000020* HISTORY                                                        *\n000030******************************************************************\n000040*                                                                *\n000050* 01 Mar 2005 1.5  New                                      AWR  *\n000051*                                                                *\n000052******************************************************************\n000053\n000054 IDENTIFICATION DIVISION.\n000055 PROGRAM-ID.\n000056         XMITIVP4 .\n000057\n000058 ENVIRONMENT DIVISION.\n000059 DATA DIVISION.\n000060 WORKING-STORAGE SECTION.\n000070\n000080\n000090\n000091    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n000092\n000093    COPY XMITMAC.\n000094\n000095    01   XMITMAIL-TOS.\n000096         04   FILLER            PIC X(80) VALUE\n000097         'Andy_Robertson@JohnLewis.co.uk'.\n000098         04   FILLER            PIC X(80) VALUE\n000099         'pinlighter@btconnect.com'.\n000100         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n000200\n000300    01   XMITMAIL-CCS.\n000400         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n000500\n000600    01   XMITMAIL-BCCS.\n000700         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n000800\n000900    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n001000         'IVP  E-mail format 2  + binary attachment '.\n001100\n001200    01   XMITMAIL-MSG.\n001300         04   MSG-LINE          PIC X(80)\n001400         OCCURS 999 INDEXED BY LINE-NO.\n001500\n001600\n001700\n001800\n001900\n002000\n002100    01   Q    PIC X     VALUE '\"'.\n002200\n002300    01   BND  PIC X(37).\n002400\n002500    01   binary-object-name pic x(80) value 'sample.bin'.\n002600\n002700    01   binary-object  pic x(565) value all\n002800*        'a'.\n002900         'abcdABCE5678&%\u00a2\"77*(){}{]\u00a3]]+++=====)00pp'.\n003000\n003010    01   LINES-ADDED    PIC S9(8) COMP.\n003020\n003030\n003040\n003050\n003051 PROCEDURE DIVISION.\n003052\n003053\n003054     MOVE '2' TO XMITMAIL-PROCESS-OPTION\n003055\n003056     CALL 'XMITBND' using bnd\n003057\n003058     SET LINE-NO TO 1\n003059\n003060     MOVE 'Mime-Version: 1.0 '\n003070     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003080\n003090     MOVE ' ' to MSG-LINE(LINE-NO)\n003100     STRING  'Content-type: multipart/mixed; boundary='\n003200     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n003300             SET LINE-NO UP BY 1\n003400\n003500     MOVE ' '\n003600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003700\n003800     MOVE 'This is a multi-part message in MIME format. '\n003900     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004000\n004100     MOVE ' ' TO MSG-LINE(LINE-NO)\n004200     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n004300     SET LINE-NO UP BY 1\n004400\n004500*    Plain text\n004600\n004700\n004800     MOVE 'Content-Type: text/plain; charset=\"iso-8859-1\"'\n004900     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005000\n005100     MOVE 'Content-Transfer-Encoding: 7bit '\n005200     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005300\n005400     MOVE ' '\n005500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005600\n005700     MOVE ' '\n005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005900\n006000     MOVE '.line1   - initial period -                  '\n006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006200\n006300     MOVE 'line 2'\n006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006500\n006600     MOVE 'last line'\n006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006800\n006900     MOVE ' '  TO MSG-LINE(LINE-NO)\n007000     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n007100     SET LINE-NO UP BY 1\n007200\n007300\n007400*    binary attachment\n007500\n007600     CALL 'XMITMIME' USING\n007700         BY REFERENCE XMITMAIL-CONTROL\n007800         BY REFERENCE MSG-LINE(LINE-NO)\n007900         BY REFERENCE BINARY-OBJECT-NAME\n008000         BY REFERENCE BND\n008100         BY REFERENCE BINARY-OBJECT\n008200         BY CONTENT LENGTH OF BINARY-OBJECT\n008300         BY REFERENCE LINES-ADDED\n008400\n008410     IF XMITMAIL-REPLY NOT = 'V' GOBACK END-IF\n008420     SET LINE-NO UP BY LINES-ADDED\n008430\n008440*    all done\n008450\n008460\n008470     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)\n008480\n008490      CALL XMITMAIL-NAME USING\n008500          XMITMAIL-CONTROL\n008510          XMITMAIL-TOS\n008520          XMITMAIL-CCS\n008530          XMITMAIL-BCCS\n008540          XMITMAIL-SUBJECT\n008550          XMITMAIL-MSG\n008560\n008570\n008580\n008590     DISPLAY XMITMAIL-CONTROL\n008600     DISPLAY XMITMAIL-DIAGNOSTIC\n008700\n008800\n008900     STOP RUN.\n009000\n009100\n009200 copy xmitbnd.\n009300 copy xmitmime.\n009400\n009500 end program xmitivp4.\n./ ADD NAME=XMITIVP5 0101-05074-10210-1507-00151-00151-00001-TSO057\n000001 CBL NOSSRANGE\n000002******************************************************************\n000003*                                                                *\n000004* XMITIVP5.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *\n000005*            FORMATTED MULTIPART E-MAIL, AND HTML ATTACHMENT     *\n000006*                                                                *\n000007******************************************************************\n000008\n000009******************************************************************\n000010* HISTORY                                                        *\n000020******************************************************************\n000030*                                                                *\n000040* 11 Mar 2000 1.5  New                                      AWR  *\n000050*                                                                *\n000060******************************************************************\n000070\n000080 IDENTIFICATION DIVISION.\n000090 PROGRAM-ID.\n000091        'XMITIVP5'.\n000092\n000093 ENVIRONMENT DIVISION.\n000094 DATA DIVISION.\n000095 WORKING-STORAGE SECTION.\n000096\n000097\n000098\n000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n000100\n000200    COPY XMITMAC.\n000300\n000400    01   XMITMAIL-TOS.\n000500         04   FILLER            PIC X(80) VALUE\n000600         'Andy_Robertson@JohnLewis.co.uk'.\n000700         04   FILLER            PIC X(80) VALUE\n000800         'PINLIGHTER@BTCONNECT.COM'.\n000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001000\n001100    01   XMITMAIL-CCS.\n001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001300\n001400    01   XMITMAIL-BCCS.\n001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001600\n001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n001800         'IVP  E-mail format 2  + html attachment '.\n001900\n002000    01   XMITMAIL-MSG.\n002100         04   MSG-LINE          PIC X(80)\n002200         OCCURS 999 INDEXED BY LINE-NO.\n002300\n002400\n002500\n002600\n002700\n002800    01   Q    PIC X     VALUE '\"'.\n002900\n003000    01   BND  PIC X(37).\n003020\n003030\n003040\n003050 PROCEDURE DIVISION.\n003060\n003070\n003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION\n003090\n003100     call 'xmitbnd' using bnd\n003200\n003300\n003400     SET LINE-NO TO 1\n003500\n003600     MOVE 'Mime-Version: 1.0 '\n003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003800\n003900     MOVE ' ' to MSG-LINE(LINE-NO)\n004000     STRING  'Content-type: multipart/mixed; boundary='\n004100     Q BND Q DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n004200             SET LINE-NO UP BY 1\n004300\n004400     MOVE ' '\n004500     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004600\n004700     MOVE 'This is a multi-part message in MIME format. '\n004800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n004900\n005000     MOVE ' ' TO MSG-LINE(LINE-NO)\n005100     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n005200     SET LINE-NO UP BY 1\n005300\n005400*    HTml\n005500\n005600\n005700     MOVE 'Content-Type: text/html; charset=\"iso-8859-1\"'\n005800     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n005900\n006000     MOVE 'Content-Transfer-Encoding: 7bit '\n006100     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006200\n006300     MOVE ' '\n006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006500\n006600     MOVE ' '\n006700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006800\n006900     MOVE '<font face=\"Courier\" size=\"+2\" color=blue>   '\n007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007100\n007200     MOVE 'Blue  Line of text'\n007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007400\n007500     MOVE    '</font><br> '\n007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007700\n007710\n007720     MOVE '<font face=\"ariel\" size=\"+1\" color=red>   '\n007730     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007740\n007750     MOVE 'Red  Line of text'\n007760     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007770\n007780     MOVE    '</font><br> '\n007790     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007791\n007792\n007800     MOVE ' '  TO MSG-LINE(LINE-NO)\n007900     STRING  '--' BND DELIMITED SIZE INTO MSG-LINE(LINE-NO)\n008000     SET LINE-NO UP BY 1\n008100\n008200\n008482\n008483\n008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)\n008485\n008486      CALL XMITMAIL-NAME USING\n008487          XMITMAIL-CONTROL\n008488          XMITMAIL-TOS\n008489          XMITMAIL-CCS\n008490          XMITMAIL-BCCS\n008500          XMITMAIL-SUBJECT\n008600          XMITMAIL-MSG\n008700\n008800\n008900\n009000     DISPLAY XMITMAIL-CONTROL\n009100     DISPLAY XMITMAIL-DIAGNOSTIC\n009200\n009300\n009400     STOP RUN.\n009500\n009600 copy xmitbnd .\n009610 end program 'xmitivp5'.\n009620\n./ ADD NAME=XMITIVP7 0102-07142-10210-1507-00110-00110-00002-TSO057\n000001 CBL NOSSRANGE\n000002******************************************************************\n000003*                                                                *\n000004* XMITIVP7.  DEMONSTRATES CALL USING PROCESS-OPTION 2, USER-     *\n000005*            FORMATTED E-MAIL, PLAIN TEXT, WITH                  *\n000006*            IMPORTANCE:                                         *\n000007*                                                                *\n000008******************************************************************\n000009\n000010******************************************************************\n000011* HISTORY                                                        *\n000020******************************************************************\n000030*                                                                *\n000040* 01 Mar 2000 1.2  New                                      AWR  *\n000050*                                                                *\n000060******************************************************************\n000070\n000080 IDENTIFICATION DIVISION.\n000090 PROGRAM-ID.\n000091         XMITIVP7 .\n000092\n000093 ENVIRONMENT DIVISION.\n000094 DATA DIVISION.\n000095 WORKING-STORAGE SECTION.\n000096\n000097\n000098\n000099    01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n000100\n000200    COPY XMITMAC.\n000300\n000400    01   XMITMAIL-TOS.\n000500         04   FILLER            PIC X(80) VALUE\n000600         'Andy_Robertson@JohnLewis.co.uk'.\n000700         04   FILLER            PIC X(80) VALUE\n000800         'PINLIGHTER@BTCONNECT.COM'.\n000900         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001000\n001100    01   XMITMAIL-CCS.\n001200         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001300\n001400    01   XMITMAIL-BCCS.\n001500         04   FILLER            PIC X(80) VALUE HIGH-VALUES.\n001600\n001700    01   XMITMAIL-SUBJECT       PIC X(80) VALUE\n001800         'IVP  E-mail format 2   '.\n001900\n002000    01   XMITMAIL-MSG.\n002100         04   MSG-LINE          PIC X(80)\n002200         OCCURS 999 INDEXED BY LINE-NO.\n002300\n002400\n002500\n002600\n002700\n003040\n003050 PROCEDURE DIVISION.\n003060\n003070\n003080     MOVE '2' TO XMITMAIL-PROCESS-OPTION\n003090\n003200\n003300\n003400     SET LINE-NO TO 1\n003500\n003600     MOVE 'Importance: High'\n003700     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n003800\n005300\n005400*    Plain text so just end with a blank line\n005500\n005600\n006300     MOVE ' '\n006400     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n006500\n006800\n006810\n006820\n006830***** message starts here\n006840\n006850\n006900     MOVE 'line1   - initial line   -                  '\n007000     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007100\n007200     MOVE 'line 2'\n007300     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007400\n007500     MOVE    'last line'\n007600     TO MSG-LINE(LINE-NO) SET LINE-NO UP BY 1\n007700\n008482\n008483\n008484     MOVE HIGH-VALUES TO MSG-LINE(LINE-NO)\n008485\n008486      CALL XMITMAIL-NAME USING\n008487          XMITMAIL-CONTROL\n008488          XMITMAIL-TOS\n008489          XMITMAIL-CCS\n008490          XMITMAIL-BCCS\n008500          XMITMAIL-SUBJECT\n008600          XMITMAIL-MSG\n008700\n008800\n008900\n009000     DISPLAY XMITMAIL-CONTROL\n009100     DISPLAY XMITMAIL-DIAGNOSTIC\n009200\n009300\n009400     STOP RUN.\n009500\n./ ADD NAME=XMITMAC  0120-00328-02060-1221-00054-00025-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      *          CONTROL BLOCK FOR CALLING XMITMAIL                    *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                  AWR  *\n      * 26 Nov 2000 1.1  details moved to XMITMACF                AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n\n       01 XMITMAIL-CONTROL.\n\n            COPY XMITMACF.\n\n./ ADD NAME=XMITMACC 0113-00332-10203-1855-00073-00064-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      *          COMMAREA FOR LINK TO XMITCICS                         *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 Nov 2000 1.1  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n        02   XMITMAIL-CONTROL.\n            COPY XMITMACF.\n\n\n        02   XMITMAIL-TOS               PIC X(880) VALUE HIGH-VALUES.\n        02   FILLER REDEFINES XMITMAIL-TOS.\n            04   XMITMAIL-TO       PIC X(80) OCCURS 10.\n            04   XMITMAIL-TO-BUF   PIC X(80).\n\n        02   XMITMAIL-CCS               PIC X(880) VALUE HIGH-VALUES.\n        02   FILLER REDEFINES XMITMAIL-CCS.\n            04   XMITMAIL-CC       PIC X(80) OCCURS 10.\n            04   XMITMAIL-CC-BUF   PIC X(80).\n\n        02   XMITMAIL-BCCS              PIC X(880) VALUE HIGH-VALUES.\n        02   FILLER REDEFINES XMITMAIL-BCCS.\n            04   XMITMAIL-BCC      PIC X(80) OCCURS 10.\n            04   XMITMAIL-BCC-BUF  PIC X(80).\n\n\n        02   XMITMAIL-SUBJECT       PIC X(80) VALUE ' '.\n\n        02   XMITMAIL-MSGS.\n            04   XMITMAIL-MSG      PIC X(80) OCCURS 360.\n\n./ ADD NAME=XMITMACF 0130-00332-10217-2317-00098-00046-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      *          CONTROL BLOCK DETAILS                                 *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 NOV 2000 1.1  CREATED FROM XMITMAC                     AWR  *\n      * 06 DEC 2000 1.2  PROCESS-ENV FLAG ADDED                   AWR  *\n      * 02 AUG 2010 1.6  NJE-NODE ADDED FOR SECURE CALL           AWR  *\n      *                                                                *\n      ******************************************************************\n\n            04   XMITMAIL-CONTROL-FIELDS.\n\n                07   XMITMAIL-VER.\n\n                    10   XMITMAIL-VERSION         PIC X(8)\n                                                  VALUE '01.06'.\n\n                07   XMITMAIL-FLAGS.\n\n                    10   XMITMAIL-REPLY           PIC X VALUE ' '.\n                    10   XMITMAIL-PROCESS-OPTION  PIC X VALUE '1'.\n                    10   XMITMAIL-DEBUG           PIC X VALUE 'N'.\n                    10   XMITMAIL-PLATFORM        PIC X VALUE 'M'.\n                    10   XMITMAIL-ENV             PIC X VALUE ' '.\n                    10   XMITMAIL-FLAG-RESERVE6   PIC X VALUE ' '.\n                    10   XMITMAIL-FLAG-RESERVE7   PIC X VALUE ' '.\n                    10   XMITMAIL-FLAG-RESERVE8   PIC X VALUE ' '.\n\n                07   XMITMAIL-NUMBERS.\n\n                    10   XMITMAIL-LINE-LENGTH     PIC S9(8)\n                                                  COMP VALUE 80.\n                    10   XMITMAIL-MAX-MAILS       PIC S9(8)\n                                                  COMP VALUE 999.\n                    10   XMITMAIL-NUMBER-RESERVE3 PIC S9(8)\n                                                  COMP VALUE 0.\n                    10   XMITMAIL-NUMBER-RESERVE4 PIC S9(8)\n                                                  COMP VALUE 0.\n                    10   XMITMAIL-NUMBER-RESERVE5 PIC S9(8)\n                                                  COMP VALUE 0.\n                    10   XMITMAIL-NUMBER-RESERVE6 PIC S9(8)\n                                                  COMP VALUE 0.\n                    10   XMITMAIL-NUMBER-RESERVE7 PIC S9(8)\n                                                  COMP VALUE 0.\n                    10   XMITMAIL-NUMBER-RESERVE8 PIC S9(8)\n                                                  COMP VALUE 0.\n\n\n                07   XMITMAIL-FROM          PIC X(80) VALUE HIGH-VALUES.\n\n                07   XMITMAIL-RECEIPT       PIC X(80) VALUE HIGH-VALUES.\n\n                07   XMITMAIL-REPLYTO       PIC X(80) VALUE HIGH-VALUES.\n\n                07   XMITMAIL-DIAGNOSTIC    PIC X(80) VALUE ' '.\n\n                07   XMITMAIL-NJE-NODE      PIC X(8) VALUE ' '.\n\n            04   FILLER                 PIC X(192) VALUE LOW-VALUES.\n./ ADD NAME=XMITMACM 0127-00328-09341-1633-00311-00133-00000-TSO057\n\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * This is a COBOL program to allow batch programs to issue TSO/E *\n      * commands EVEN THOUGH THEY ARE NOT RUNNING UNDER THE TMP.       *\n      *                                                                *\n      * It does this by using the TSO environment service facility     *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                  AWR  *\n      * 04 Mar 2005 1.5  use BPXWDYN                              AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.  'XMITMACM'.\n\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       FILE SECTION.\n       WORKING-STORAGE SECTION.\n\n\n         01 W-N1                 PIC -----9.\n\n         01 BPXWDYN-NAME         PIC X(8) VALUE 'BPXWDYN'.\n\n         01 BPXWDYN-COMMAND.\n           04 BPXWDYN-COMMAND-LEN PIC S9(4) COMP VALUE 355.\n           04 BPXWDYN-COMMAND-TXT PIC X(255).\n           04 BPXWDYN-COMMAND-T2  PIC X(100) VALUE ' SHORTRC'.\n\n       LINKAGE SECTION.\n\n\n         COPY XMITMAC.\n\n         01 XMITMACM-COMMAND     PIC X(255).\n\n         01 XMITMACM-COMMAND-RC  PIC S9(8) COMP.\n\n       PROCEDURE DIVISION USING\n           XMITMAIL-CONTROL\n           XMITMACM-COMMAND\n           XMITMACM-COMMAND-RC.\n\n           MOVE XMITMACM-COMMAND TO BPXWDYN-COMMAND-TXT\n\n           CALL BPXWDYN-NAME USING BPXWDYN-COMMAND\n\n           IF RETURN-CODE > 4  OR RETURN-CODE < 0\n               MOVE 'N' TO XMITMAIL-REPLY\n               MOVE 0 TO XMITMACM-COMMAND-RC\n               MOVE RETURN-CODE TO W-N1\n               STRING\n               'BPXWDYN FAILED RC='\n               W-N1\n               DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n           ELSE\n               MOVE 'V' TO XMITMAIL-REPLY\n           END-IF\n\n           MOVE 0 TO RETURN-CODE\n\n           GOBACK.\n\n\n\n       END PROGRAM 'XMITMACM'.\n\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n      *\n      *\n      *\n      *\n      *\n      *\n      *\n      *\n      *\n      *\n      *\n      ******************************************************************\n      *                                                                *\n      * This is a COBOL program to allow batch programs to issue TSO/E *\n      * commands EVEN THOUGH THEY ARE NOT RUNNING UNDER THE TMP.       *\n      *                                                                *\n      * It does this by using the TSO environment service facility     *\n      *                                                                *\n      ******************************************************************\n      *\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n      *\n      *\n      *\n      *\n      *IDENTIFICATION DIVISION.\n      *PROGRAM-ID. XMITMACM\n      *\n      *\n      *\n      *\n      *ENVIRONMENT DIVISION.\n      *DATA DIVISION.\n      *FILE SECTION.\n      *WORKING-STORAGE SECTION.\n      *\n      *  01 TSOEV-PARM1          PIC S9(8) VALUE +0   COMP.\n      *  01 TSOEV-RETURN-CODE    PIC S9(8) VALUE +0   COMP.\n      *  01 TSOEV-REASON-CODE    PIC S9(8) VALUE +0   COMP.\n      *  01 TSOEV-ABEND-CODE     PIC S9(8) VALUE +0   COMP.\n      *  01 TSOEV-CPPL-ADDR      PIC S9(8) VALUE +0   COMP.\n      *\n      *  01 TSF-FLAGS            PIC S9(8)            COMP.\n      *  01 TSF-COMMAND          PIC X(255).\n      *  01 TSF-COMMAND-LEN      PIC S9(8) VALUE +255 COMP.\n      *  01 TSF-COMMAND-RC       PIC S9(8) VALUE +0   COMP.\n      *  01 TSF-REASON-CODE      PIC S9(8) VALUE +0   COMP.\n      *  01 TSF-COMMAND-ABEND-CODE PIC S9(8) VALUE +0 COMP.\n      *\n      *  01 CALL-UNAUTH          PIC S9(8) VALUE +65536 COMP.\n      *  01 REQUEST-DUMP         PIC S9(8) VALUE +256 COMP.\n      *  01 INVOKE-REXX          PIC S9(8) VALUE +1   COMP.\n      *\n      *  01 FIRST-TIME           PIC X VALUE 'Y'.\n      *\n      *  01 W-N1                 PIC 9(8).\n      *  01 W-N2                 PIC 9(8).\n      *  01 W-N3                 PIC 9(8).\n      *  01 N-IKJTSOEV           PIC X(8) VALUE 'IKJTSOEV'.\n      *  01 N-TSOLNK             PIC X(8) VALUE 'TSOLNK  '.\n      *\n      *LINKAGE SECTION.\n      *\n      *\n      *  COPY XMITMAC.\n      *\n      *  01 XMITMACM-COMMAND     PIC X(255).\n      *\n      *  01 XMITMACM-COMMAND-RC  PIC S9(8) COMP.\n      *\n      *PROCEDURE DIVISION USING\n      *    XMITMAIL-CONTROL\n      *    XMITMACM-COMMAND\n      *    XMITMACM-COMMAND-RC.\n      *\n      *    IF FIRST-TIME = 'Y'\n      *\n      *        CALL N-IKJTSOEV USING TSOEV-PARM1\n      *                              TSOEV-RETURN-CODE\n      *                              TSOEV-REASON-CODE\n      *                              TSOEV-ABEND-CODE\n      *                              TSOEV-CPPL-ADDR\n      *\n      *        IF RETURN-CODE > 0\n      *        AND NOT(\n      *        RETURN-CODE = 8\n      *        OR RETURN-CODE = 16\n      *        OR RETURN-CODE = 24\n      *        )\n      *            MOVE RETURN-CODE TO W-N1\n      *            MOVE TSOEV-REASON-CODE TO W-N2\n      *            MOVE TSOEV-ABEND-CODE TO W-N3\n      *            MOVE 'N' TO XMITMAIL-REPLY\n      *            MOVE 0 TO RETURN-CODE\n      *            STRING\n      *            'IKJTSOEV FAILED RC='\n      *            W-N1\n      *            ' RSNCD='\n      *            W-N2\n      *            ' ABNDCD='\n      *            W-N2\n      *            DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n      *            GOBACK\n      *        END-IF\n      *        MOVE 'N' TO FIRST-TIME\n      *    END-IF\n      *\n      *    MOVE 0 TO TSF-FLAGS\n      *    ADD CALL-UNAUTH TO TSF-FLAGS\n      *    ADD INVOKE-REXX TO TSF-FLAGS\n      *\n      *    MOVE XMITMACM-COMMAND TO TSF-COMMAND\n      *\n      *    MOVE 0 TO TSF-COMMAND-RC\n      *    MOVE 0 TO TSF-REASON-CODE\n      *    MOVE 0 TO TSF-COMMAND-ABEND-CODE\n      *\n      *    CALL N-TSOLNK USING TSF-FLAGS\n      *                        TSF-COMMAND\n      *                        TSF-COMMAND-LEN\n      *                        TSF-COMMAND-RC\n      *                        TSF-REASON-CODE\n      *                        TSF-COMMAND-ABEND-CODE\n      *\n   ****\n   ****    display ' '\n   ****    display 'tsolnk called'\n   ****    display '             '\n   ****    display 'FLAGS              ' TSF-FLAGS\n   ****    display 'COMMAND            ' TSF-COMMAND\n   ****    display 'COMMAND-LEN        ' TSF-COMMAND-LEN\n   ****    display 'COMMAND-RC         ' TSF-COMMAND-RC\n   ****    display 'REASON-CODE        ' TSF-REASON-CODE\n   ****    display 'COMMAND-ABEND-CODE ' TSF-COMMAND-ABEND-CODE\n   ****\n      *\n      *    IF RETURN-CODE > 4\n      *        MOVE 'N' TO XMITMAIL-REPLY\n      *        MOVE 0 TO XMITMACM-COMMAND-RC\n      *        MOVE RETURN-CODE TO W-N1\n      *        MOVE TSF-COMMAND-RC    TO W-N2\n      *        MOVE TSF-REASON-CODE   TO W-N3\n      *        STRING\n      *        'TSOLNK FAILED RC='\n      *        W-N1\n      *        ' COMMAND-RC='\n      *        W-N2\n      *        ' REASON-CODE='\n      *        W-N3\n      *        DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n      *    ELSE\n      *        MOVE 'V' TO XMITMAIL-REPLY\n      *        MOVE TSF-COMMAND-RC TO XMITMACM-COMMAND-RC\n      *        IF XMITMACM-COMMAND-RC > 4\n      *            MOVE 'N' TO XMITMAIL-REPLY\n      *            MOVE TSF-COMMAND-RC TO W-N1\n      *            STRING\n      *            'COMMAND FAILED RC='\n      *            W-N1\n      *            ' : '\n      *            XMITMACM-COMMAND\n      *            DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n      *        END-IF\n      *    END-IF\n      *\n      *    MOVE 0 TO RETURN-CODE\n      *\n      *    GOBACK.\n      *\n      *\n      *END PROGRAM XMITMACM.\n./ ADD NAME=XMITMADF 0137-00328-10210-1522-00179-00027-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * DEFAULT VALUES FOR XMITMAIL AND XMITCICS                       *\n      *                                                                *\n      * THIS MEMBER SHOULD BE CUSTOMISED BEFORE YOU COMPILE XMITMAIL   *\n      * AND XMITCICS BY RUNNING THE XMITINST JOB                       *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 Nov 2000 1.1  Updates for XMITCICS                     AWR  *\n      * 21 JUL 2010 1.6  SECURE FLAG ADDED                        AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n\n       01 XMITMAIL-DEFAULTS.\n\n\n\n                07   XMITMAIL-CUSTOMISE.\n\n\n\n      *\n      *             * -------------------------- *\n      *             * nje address of smtp server *\n      *             * -------------------------- */\n\n                    10   XMITMAIL-SMTP-ADDRESS  PIC X(80) VALUE 'SMTP'.\n\n\n\n\n      *             * -------------------------- */\n      *             * Define the Center which    */\n      *             * is the nje node name where */\n      *             * the smtp server is running.*\n      *             * -------------------------- *\n\n                    10   XMITMAIL-CENTER        PIC X(80) VALUE 'MC1'.\n\n\n\n\n      *\n      *             * --------------------------------------------------\n      *             * Setup the From Default\n      *             * If you don't want a \"FROM\" generated by default\n      *             * leave this blank\n      *             * --------------------------------------------------\n\n                    10   XMITMAIL-FROM-DEFAULT  PIC X(80) VALUE\n                       'postmaster@johnlewis.co.uk'.\n\n\n\n\n\n      *\n      *             * --------------------------------------------------\n      *             * The EXIT module.\n      *             *\n      *             * If this field is non-blank, the module named is\n      *             * dynamically called at the start of XMITMAIL,\n      *             * before any other processing has been done\n      *             *\n      *             * You may use this module (which must be present as\n      *             * loadable module in the LINKLIST/STEPLIB or DFHRPL)\n      *             * to dynamically change XMITMAIL parameters or to\n      *             * reject them\n      *             *\n      *             * To reject an e-mail, place \"X\" in XMITMAIL-REPLY\n      *             * and put a diagnostic in XMITMAIL-DIAGNOSTIC\n      *             *\n      *             * See sample member XMITEXIT on this library\n      *             *\n      *             *\n      *             * The COBOL statement used to call this module is:\n      *             *\n      *             *\n      *             * CALL XMITMAIL-EXIT-MOD USING\n      *             *         XMITMAIL-CONTROL\n      *             *         XMITMAIL-DEFAULTS\n      *             *         XMITMAIL-TO\n      *             *         XMITMAIL-CC\n      *             *         XMITMAIL-BCC\n      *             *         XMITMAIL-SUBJECT\n      *             *         XMITMAIL-MSG\n      *             *\n      *             * --------------------------------------------------\n\n                    10   XMITMAIL-EXIT-MOD   PIC X(8) VALUE '        '.\n\n\n\n\n\n      *\n      *             * --------------------------------------------------\n      *             *\n      *             * Normally the EXIT module is called only once\n      *             * just before the first e-mail.  If you want the\n      *             * EXIT module to be called for EVERY e-mail,\n      *             * you must reset this flag to \"Y\" (from within\n      *             * the EXIT - see XMITEXIT sample) EVERY time the\n      *             * EXIT module is called. If you do not reset this\n      *             * flag to \"Y\", XMITMAIL will stop calling the\n      *             * exit module\n      *             *\n      *             * --------------------------------------------------\n\n                    10   XMITMAIL-CALL-EXIT PIC X VALUE 'Y'.\n\n\n\n\n\n      *\n      *             * --------------------------------------------------\n      *             *\n      *             * This is a persistent workarea for the exit\n      *             * module.  Only needed if your exit module is ASM\n      *             *\n      *             * --------------------------------------------------\n\n                    10   XMITMAIL-EXIT-WORKAREA PIC X(80).\n\n\n\n      *\n      *             * --------------------------------------------------\n      *             *\n      *             * Set to Y to use SECURE (TSO TRANSMIT format)\n      *             * spool files\n      *             *\n      *             * --------------------------------------------------\n\n                    10   XMITMAIL-SECURE        PIC X VALUE 'N'.\n\n\n\n./ ADD NAME=XMITMAFM 0164-00328-10203-1807-00564-00379-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * XMITMAFM takes the input parameters and produces a single      *\n      * field with the output lines packed into it.                    *\n      *                                                                *\n      * Lines are all the same length, being = to the longest mail     *\n      * or control record                                              *\n      *                                                                *\n      * The end of the last line is signalled by 8O bytes high-values  *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                  AWR  *\n      * 22 Nov 2000 1.2  allow process-option 2                   AWR  *\n      * 17 Jan 2005 1.4  add DATE: header                         AWR  *\n      * 17 JUL 2010 1.6  TO FIXED LENGHTH FORM                    AWR  *\n      *                                                                *\n      ******************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITMAFM'.\n      *\n      *\n      *\n      *\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n\n\n\n       01   W-WORK.\n            04   W-OFFSET                PIC S9(8) COMP.\n            04   W-COUNT                 PIC S9(8) COMP.\n            04   XMITMAFM-CHARNO         PIC S9(8) COMP.\n            04   LAST-NONBLANK-XMITMAFM-CHARNO\n                                         PIC S9(8) COMP.\n            04   LINE-CHARNO             PIC S9(8) COMP.\n            04   ID-COUNT                PIC S9(8) COMP.\n            04   W-BUFFER                PIC S9(8) COMP.\n            04   W                       PIC X(80).\n            04   W1                      PIC X(80).\n            04   W2                      PIC X(80).\n            04   W3                      PIC X(80).\n\n       01   W-LINE                       PIC X(255).\n       01   W-LINE2                      PIC X(256).\n\n       01   W-FROM                       PIC X(80).\n       01   W-RECEIPT                    PIC X(80).\n       01   W-REPLYTO                    PIC X(80).\n\n       01   W-MONTHS\n             PIC X(36) VALUE\n           'JanFebMarAprMayJunJulAugSepOctNovDec'.\n       01   FILLER REDEFINES W-MONTHS.\n           04   W-MONTH PIC XXX OCCURS 12.\n\n       01   W-MONTH-X-X.\n           04   W-MONTH-X                PIC 99.\n\n       LINKAGE SECTION.\n\n       COPY XMITMAC.\n\n       COPY XMITMADF.\n\n       01   XMITMAIL-TOS.\n            04   XMITMAIL-TO       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-CCS.\n            04   XMITMAIL-CC       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-BCCS.\n            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-SUBJECT       PIC X(80).\n\n       01   XMITMAIL-MSGS.\n            04   XMITMAIL-MSG      PIC X(80)\n                   copy xmitsize.\n\n       01   XMITMAFM-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITMAIL-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n       01   XMITMAFM-RECL           PIC S9(8) COMP.\n       01   XMITMAFM-TOT-RECNO      PIC S9(8) COMP.\n\n\n       PROCEDURE DIVISION USING\n            XMITMAIL-CONTROL\n            XMITMAIL-DEFAULTS\n            XMITMAIL-TOS\n            XMITMAIL-CCS\n            XMITMAIL-BCCS\n            XMITMAIL-SUBJECT\n            XMITMAIL-MSGS\n            XMITMAFM-BACK\n            XMITMAFM-RECL\n            XMITMAFM-TOT-RECNO\n            .\n\n           MOVE 'E' TO XMITMAIL-REPLY\n           MOVE 1 TO XMITMAFM-CHARNO\n           MOVE 0 TO XMITMAFM-TOT-RECNO\n\n\n\n           COMPUTE W-BUFFER = LENGTH OF XMITMAFM-BACK -\n                             ((LENGTH OF W-LINE)*2)\n\n           EVALUATE TRUE\n\n           WHEN XMITMAIL-PROCESS-OPTION = '1'\n\n      *        Plain text\n\n               PERFORM CHECK-LINE-LENGTH\n               PERFORM DETERMINE-ADDRESSEES\n               PERFORM CREATE-HEADER\n               PERFORM ADD-BLANK\n               PERFORM MOVE-IN-MESSAGE-IPD\n               PERFORM END-ENVELOPE\n\n           WHEN XMITMAIL-PROCESS-OPTION = '2'\n\n      *        User formatted\n\n               PERFORM CHECK-LINE-LENGTH\n               PERFORM DETERMINE-ADDRESSEES\n               PERFORM CREATE-HEADER\n               PERFORM MOVE-IN-MESSAGE-IPD\n               PERFORM END-ENVELOPE\n\n           WHEN OTHER\n\n               MOVE 'P' TO XMITMAIL-REPLY\n               MOVE 'INVALID PROCESS-OPTION' TO XMITMAIL-DIAGNOSTIC\n               GOBACK\n\n           END-EVALUATE\n\n           MOVE 'V' TO XMITMAIL-REPLY\n           GOBACK.\n\n\n\n           .\n       CHECK-LINE-LENGTH.\n\n           IF XMITMAIL-LINE-LENGTH > LENGTH OF W-LINE\n           OR XMITMAIL-LINE-LENGTH < 10\n               MOVE 'L' TO XMITMAIL-REPLY\n               GOBACK\n           END-IF\n\n           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL\n           IF 80 > XMITMAFM-RECL\n               MOVE 80 TO XMITMAFM-RECL\n           END-IF\n           ADD 1 TO XMITMAFM-RECL\n      *    FOR POSS INITIAL PERIOD\n\n           .\n       DETERMINE-ADDRESSEES.\n\n      *    DECIDE VALUES OF FROM, RECEIPT, REPLYTO\n\n           MOVE XMITMAIL-FROM TO W-FROM\n           IF W-FROM = HIGH-VALUES OR SPACES\n               MOVE XMITMAIL-FROM-DEFAULT TO W-FROM\n           END-IF\n\n           MOVE XMITMAIL-REPLYTO TO W-REPLYTO\n\n           MOVE XMITMAIL-RECEIPT TO W-RECEIPT\n\n           .\n       CREATE-HEADER.\n\n      *    CREATE HEADER\n\n           MOVE ' ' TO W-LINE\n           STRING\n               'helo '\n                   DELIMITED SIZE\n               XMITMAIL-CENTER\n                   DELIMITED SIZE\n           INTO W-LINE\n           PERFORM ADD-LINE\n\n           IF NOT (W-FROM  = HIGH-VALUES OR SPACES)\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'mail from:<'\n                       DELIMITED SIZE\n                   W-FROM\n                       DELIMITED SPACE\n                   '>'\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n\n           END-IF\n\n           IF XMITMAIL-TO(1) = HIGH-VALUES OR SPACES\n               MOVE 'NO \"TO\" PROVIDED' TO XMITMAIL-DIAGNOSTIC\n               MOVE 'A' TO XMITMAIL-REPLY\n               GOBACK\n           END-IF\n\n\n           PERFORM VARYING ID-COUNT FROM 1 BY 1\n           UNTIL XMITMAIL-TO(ID-COUNT) = HIGH-VALUES OR SPACES\n\n               MOVE XMITMAIL-TO(ID-COUNT) TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'rcpt to:<'\n                       DELIMITED SIZE\n                   XMITMAIL-TO(ID-COUNT)\n                       DELIMITED SPACE\n                   '>'\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n\n           END-PERFORM\n\n\n           PERFORM VARYING ID-COUNT FROM 1 BY 1\n           UNTIL XMITMAIL-CC(ID-COUNT) = HIGH-VALUES OR SPACES\n\n               MOVE XMITMAIL-CC(ID-COUNT) TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'rcpt to:<'\n                       DELIMITED SIZE\n                   XMITMAIL-CC(ID-COUNT)\n                       DELIMITED SPACE\n                   '>'\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n\n           END-PERFORM\n\n\n           PERFORM VARYING ID-COUNT FROM 1 BY 1\n           UNTIL XMITMAIL-BCC(ID-COUNT) = HIGH-VALUES OR SPACES\n\n               MOVE XMITMAIL-BCC(ID-COUNT) TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'rcpt to:<'\n                       DELIMITED SIZE\n                   XMITMAIL-BCC(ID-COUNT)\n                       DELIMITED SPACE\n                   '>'\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n\n           END-PERFORM\n\n\n           MOVE 'data ' TO W-LINE\n           PERFORM ADD-LINE\n\n\n           MOVE ' ' TO W-LINE\n           STRING\n               'Sender:  '\n                   DELIMITED SIZE\n               W-FROM\n                   DELIMITED SIZE\n           INTO W-LINE\n           PERFORM ADD-LINE\n\n           MOVE FUNCTION CURRENT-DATE(5:2) TO W-MONTH-X-X\n\n           MOVE ' ' TO W-LINE\n           STRING\n               'Date:    '\n\n               FUNCTION CURRENT-DATE(7:2)\n               ' '\n               W-MONTH (W-MONTH-X)\n               ' '\n               FUNCTION CURRENT-DATE(1:4)\n               ' '\n               FUNCTION CURRENT-DATE(9:2)\n               ':'\n               FUNCTION CURRENT-DATE(11:2)\n               ':'\n               FUNCTION CURRENT-DATE(13:2)\n               ' '\n               FUNCTION CURRENT-DATE(17:5)\n\n                   DELIMITED SIZE\n\n           INTO W-LINE\n           PERFORM ADD-LINE\n\n\n           IF NOT (W-FROM = HIGH-VALUES OR SPACES)\n\n               MOVE W-FROM TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'From:    '\n                       DELIMITED SIZE\n                   W-FROM\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n           END-IF\n\n\n           IF NOT (W-REPLYTO = HIGH-VALUES OR SPACES)\n\n               MOVE W-REPLYTO TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'Reply-To: '\n                       DELIMITED SIZE\n                   W-REPLYTO\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n           END-IF\n\n\n           IF NOT (W-RECEIPT = HIGH-VALUES OR SPACES)\n\n               MOVE W-RECEIPT TO W\n               PERFORM CHECK-ID\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'Return-Receipt-To: '\n                       DELIMITED SIZE\n                   W-RECEIPT\n                       DELIMITED SIZE\n               INTO W-LINE\n               PERFORM ADD-LINE\n           END-IF\n\n\n           PERFORM VARYING ID-COUNT FROM 1 BY 1\n           UNTIL XMITMAIL-TO(ID-COUNT) = HIGH-VALUES OR SPACES\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'To:       '\n                       DELIMITED SIZE\n                   XMITMAIL-TO(ID-COUNT)\n                       DELIMITED SPACE\n               INTO W-LINE\n               IF ID-COUNT > 1 MOVE ' ' TO W-LINE(1:6) END-IF\n               PERFORM ADD-LINE\n\n           END-PERFORM\n\n\n           PERFORM VARYING ID-COUNT FROM 1 BY 1\n           UNTIL XMITMAIL-CC(ID-COUNT) = HIGH-VALUES OR SPACES\n\n               MOVE ' ' TO W-LINE\n               STRING\n                   'Cc:       '\n                       DELIMITED SIZE\n                   XMITMAIL-CC(ID-COUNT)\n                       DELIMITED SPACE\n               INTO W-LINE\n               IF ID-COUNT > 1 MOVE ' ' TO W-LINE(1:6) END-IF\n               PERFORM ADD-LINE\n\n           END-PERFORM\n\n\n\n           MOVE ' ' TO W-LINE\n           STRING\n               'X-Mailer: XMITMAIL COBOL subroutine on MVS'\n                   DELIMITED SIZE\n           INTO W-LINE\n           PERFORM ADD-LINE\n\n           MOVE ' ' TO W-LINE\n           STRING\n               'Subject: '\n                   DELIMITED SIZE\n               XMITMAIL-SUBJECT\n                   DELIMITED SIZE\n           INTO W-LINE\n           PERFORM ADD-LINE\n\n\n           .\n       ADD-BLANK.\n\n               MOVE ' ' TO W-LINE\n               PERFORM ADD-LINE\n\n\n           .\n       MOVE-IN-MESSAGE-IPD.\n\n\n\n      *    MOVE IN MESSAGE DOUBLING INITIAL PERIODS\n\n           MOVE 1 TO W-COUNT\n           PERFORM COMPUTE-W-OFFSET\n\n           PERFORM UNTIL\n           XMITMAIL-MSGS(W-OFFSET:XMITMAIL-LINE-LENGTH)\n           = HIGH-VALUE\n               MOVE XMITMAIL-MSGS(W-OFFSET:XMITMAIL-LINE-LENGTH)\n               TO W-LINE\n\n               IF W-LINE(1:1) = '.'\n                   MOVE W-LINE  TO W-LINE2\n                   MOVE W-LINE2 TO W-LINE(2:)\n               END-IF\n\n               PERFORM ADD-LINE\n               ADD 1 TO W-COUNT\n               PERFORM COMPUTE-W-OFFSET\n           END-PERFORM\n\n\n\n           .\n       END-ENVELOPE.\n\n\n      *    END\n\n           MOVE ' ' TO W-LINE\n           PERFORM ADD-LINE\n\n           MOVE '.' TO W-LINE\n           PERFORM ADD-LINE\n\n           MOVE 'QUIT ' TO W-LINE\n           PERFORM ADD-LINE\n\n\n           MOVE HIGH-VALUES TO XMITMAFM-BACK(XMITMAFM-CHARNO:255)\n\n\n\n\n\n\n           .\n       BUFFER-CHECK.\n           IF XMITMAFM-CHARNO > W-BUFFER\n           MOVE 'BUFFER OVERFLOW' TO XMITMAIL-DIAGNOSTIC\n           MOVE 'O' TO XMITMAIL-REPLY\n           GOBACK.\n\n\n           .\n       ADD-LINE.\n\n\n           MOVE W-LINE\n           TO XMITMAFM-BACK(XMITMAFM-CHARNO:XMITMAFM-RECL)\n\n           ADD XMITMAFM-RECL TO XMITMAFM-CHARNO\n\n           ADD 1 TO XMITMAFM-TOT-RECNO\n\n           PERFORM BUFFER-CHECK\n\n\n           .\n       CHECK-ID.\n\n           MOVE ' ' TO W1 W2 W3\n           UNSTRING W DELIMITED ' ' INTO W1 W2\n           IF W1(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF\n           IF W2(1:1) NOT = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF\n\n           MOVE ' ' TO W1 W2 W3\n           UNSTRING W DELIMITED '@' INTO W1 W2\n           IF W1(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF\n           IF W2(1:1) = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF\n           UNSTRING W2 DELIMITED '@' INTO W1 W3\n           IF W3 NOT = ' ' MOVE 'A' TO XMITMAIL-REPLY END-IF\n\n           IF XMITMAIL-REPLY = 'A'\n               STRING 'INVALID ADDRESS ' W DELIMITED SIZE\n               INTO XMITMAIL-DIAGNOSTIC\n               GOBACK\n           END-IF\n\n\n\n\n           .\n       COMPUTE-W-OFFSET.\n\n           COMPUTE W-OFFSET = ((W-COUNT - 1) *\n           XMITMAIL-LINE-LENGTH) + 1\n\n\n           .\n       END PROGRAM 'XMITMAFM'.\n\n./ ADD NAME=XMITMAIL 0199-00328-10264-1547-00315-00244-00000-TSO057\n\n      **************************************************************\n      *   XMITMAIL batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * SUBROUTINE TO SEND A SIMPLE E-MAIL BY SPOOLING OUTPUT TO       *\n      * SMTP.  RUNS IN BATCH OR UNDER TSO/ISPF.                        *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Nov 2000 1.0  written                                       *\n      * 22 Feb 2005 1.5  Call to XMITMACM fixed thx Bruce Coghill      *\n      *                                                                *\n      *                                                                *\n      ******************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITMAIL'.\n       ENVIRONMENT DIVISION.\n       INPUT-OUTPUT SECTION.\n       FILE-CONTROL.\n           SELECT OUTFILE ASSIGN TO XMITMAIL ORGANISATION SEQUENTIAL\n           FILE STATUS IS OUTFILE-STATUS.\n\n       DATA DIVISION.\n       FILE  SECTION.\n\n       FD   OUTFILE\n            RECORD VARYING 1 TO 256 DEPENDING OUTFILE-LENGTH\n            RECORDING MODE V\n            .\n\n       01   OUTFILE-LINE PIC X(256).\n*********   not 255 cos of poss initial double period\n\n\n       WORKING-STORAGE SECTION.\n\n\n       01   OUTFILE-STATUS         PIC XX.\n       01   OUTFILE-LENGTH         PIC 9(8) COMP.\n\n\n       01   XMITMACM-COMMAND       PIC X(255).\n       01   XMITMACM-COMMAND-RC    PIC S9(8) COMP VALUE 0.\n\n\n\n       01   XMITMAFM-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITMAIL-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n       01   XMITINMR-BACK.\n            04   FILLER            PIC X(800).\n            04   XMITINMR-MSGDUMY  PIC X(80)\n                   COPY XMITSIZE.\n\n       01   XMITMAFM-RECL         PIC S9(8) COMP.\n       01   XMITMAFM-TOT-RECNO    PIC S9(8) COMP.\n       01   XMITINMR-TOT-RECNO    PIC S9(8) COMP.\n\n       01   W-WORK.\n            04   XMITINMR-CHARNO   PIC S9(8) COMP.\n            04   XMITMAFM-CHARNO   PIC S9(8) COMP.\n            04   OUTFILE-CHARNO    PIC S9(8) COMP.\n            04   MAIL-COUNT        PIC S9(8) COMP VALUE 0.\n            04   W-LINE            PIC X(255).\n\n       01  USER-ID                        PIC X(8).\n       01  NJE-NODE                       PIC X(8).\n\n\n\n       COPY XMITMADF.\n\n\n       LINKAGE SECTION.\n\n       COPY XMITMAC.\n\n       01   XMITMAIL-TOS.\n            04   XMITMAIL-TO       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-CCS.\n            04   XMITMAIL-CC       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-BCCS.\n            04   XMITMAIL-BCC      PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-SUBJECT       PIC X(80).\n\n       01   XMITMAIL-MSGS.\n            04   XMITMAIL-MSG      PIC X(80)\n                                 copy xmitsize.\n\n       PROCEDURE DIVISION USING\n            XMITMAIL-CONTROL\n            XMITMAIL-TOS\n            XMITMAIL-CCS\n            XMITMAIL-BCCS\n            XMITMAIL-SUBJECT\n            XMITMAIL-MSGS\n            .\n\n           MOVE 'B' TO XMITMAIL-ENV\n\n\n\n           MOVE 'E' TO XMITMAIL-REPLY\n           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC\n\n           IF XMITMAIL-MAX-MAILS NOT = 0\n               IF MAIL-COUNT > XMITMAIL-MAX-MAILS\n                   MOVE 'M' TO XMITMAIL-REPLY\n                   MOVE 'XMITMAIL-MAX-MAILS EXCEEDED '\n                   TO XMITMAIL-DIAGNOSTIC\n                   GOBACK\n               END-IF\n           END-IF\n\n\n           MOVE XMITMAIL-LINE-LENGTH TO XMITMAFM-RECL\n           IF 80 > XMITMAFM-RECL\n               MOVE 80 TO XMITMAFM-RECL\n           END-IF\n           ADD 1 TO XMITMAFM-RECL\n      *    FOR POSS INITIAL PERIOD\n\n           IF XMITMAIL-SECURE= 'Y'\n               CALL 'XMITNODE' USING NJE-NODE\n               CALL 'XMITUID'  USING USER-ID\n           END-IF\n\n           PERFORM CALL-EXIT\n\n           PERFORM FORMAT-MESSAGE\n           PERFORM ALLOC-OUTFILE\n           PERFORM OPEN-OUTFILE\n           PERFORM WRITE-MESSAGE\n           PERFORM CLOSE-OUTFILE\n           PERFORM FREE-OUTFILE\n\n           ADD 1 TO MAIL-COUNT\n\n\n\n\n           MOVE 'V' TO XMITMAIL-REPLY\n           MOVE ' ' TO XMITMAIL-DIAGNOSTIC\n           MOVE 0 TO RETURN-CODE\n           GOBACK\n\n           .\n\n\n\n           .\n       OPEN-OUTFILE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY ' '\n               DISPLAY '....  SPOOL FILE STARTS  .... '\n           ELSE\n               OPEN OUTPUT OUTFILE\n               IF OUTFILE-STATUS NOT = '00'\n                   STRING 'XMITMAIL: OPEN FOR DD \"XMITMAIL\" '\n                   'FAILED FILE STATUS = ' OUTFILE-STATUS\n                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n                   MOVE 'I' TO XMITMAIL-REPLY\n                   MOVE 0 TO RETURN-CODE\n                   GOBACK\n               END-IF\n           END-IF\n\n\n\n\n\n\n           .\n       WRITE-LINE-SECURE.\n           PERFORM WRITE-LINE\n\n\n\n           .\n       WRITE-LINE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY W-LINE\n           ELSE\n               MOVE W-LINE TO OUTFILE-LINE\n               WRITE OUTFILE-LINE\n               IF OUTFILE-STATUS NOT = '00'\n                   STRING 'XMITMAIL: WRITE FOR DD \"XMITMAIL\" '\n                   'FAILED FILE STATUS = ' OUTFILE-STATUS\n                   DELIMITED SIZE INTO XMITMAIL-DIAGNOSTIC\n                   MOVE 'I' TO XMITMAIL-REPLY\n                   MOVE 0 TO RETURN-CODE\n                   GOBACK\n               END-IF\n           END-IF\n\n\n\n           .\n       CLOSE-OUTFILE.\n           IF XMITMAIL-DEBUG = 'Y'\n               DISPLAY '....  SPOOL FILE ENDS  .... '\n               DISPLAY ' '\n           ELSE\n               CLOSE OUTFILE\n           END-IF\n\n\n\n           .\n       ALLOC-OUTFILE.\n           IF XMITMAIL-DEBUG NOT = 'Y'\n               MOVE ' '\n               TO XMITMACM-COMMAND\n\n               STRING\n                    'ALLOC FI(XMITMAIL) SYSOUT(A) DEST('\n                      DELIMITED SIZE\n                      XMITMAIL-SMTP-ADDRESS\n                      DELIMITED SPACE\n                      ')'\n                      DELIMITED SIZE\n               INTO XMITMACM-COMMAND\n********       STRING\n********            \"ALLOC FI(XMITMAIL) DSN('INST.TSO057.NOTE') \"\n********            DELIMITED SIZE\n********            'SHR                      '\n********            DELIMITED SIZE\n********       INTO XMITMACM-COMMAND\n********       IF XMITMAIL-SECURE = 'Y'\n********       STRING\n********            \"ALLOC FI(XMITMAIL) DSN('INST.TSO057.SECURE') \"\n********            DELIMITED SIZE\n********            'SHR                      '\n********            DELIMITED SIZE\n********       INTO XMITMACM-COMMAND\n********       END-IF\n               CALL 'XMITMACM' USING\n                   XMITMAIL-CONTROL\n                   XMITMACM-COMMAND\n                   XMITMACM-COMMAND-RC\n               IF XMITMAIL-REPLY NOT = 'V'\n                   MOVE 0 TO RETURN-CODE\n                   GOBACK\n               END-IF\n           END-IF\n\n\n\n           .\n       FREE-OUTFILE.\n           IF XMITMAIL-DEBUG NOT = 'Y'\n               MOVE 'FREE FI(XMITMAIL) '\n               TO XMITMACM-COMMAND\n\n               CALL 'XMITMACM' USING\n                   XMITMAIL-CONTROL\n                   XMITMACM-COMMAND\n                   XMITMACM-COMMAND-RC\n           END-IF\n\n           .\n\n\n       COPY XMITCOMM.\n\n       COPY XMITMACM.\n\n       COPY XMITMAFM.\n\n       COPY XMITINMR.\n\n       END PROGRAM 'XMITMAIL'.\n\n./ ADD NAME=XMITMIME 0104-05062-05062-1706-00186-00161-00000-TSO057\n\n      **************************************************************\n      *   XMITSMS batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n               XMITMIME .\n\n      ******************************************************************\n      *                                                                *\n      * XMITMIME.  Create mime attachment                              *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 06 Mar 2005 1.5  New                                      AWR  *\n      *                                                                *\n      ******************************************************************\n\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n       01   XMITMAIL-MSG-OFFSET PIC S9(8).\n       01   MIMELINE-LENGTH    PIC S9(8).\n       01   MIMELINE-OFFSET    PIC S9(8).\n       01   MIMELINES-X.\n           04   MIMELINES          PIC X(300000).\n           04   MIME-BUFFER        PIC X(300).\n\n       01   W-1                PIC S9(8).\n\n       LINKAGE         SECTION.\n\n\n          COPY XMITMAC.\n\n       01   XMITMAIL-MSG       PIC X(320000).\n\n       01   ATTACHMENT-NAME        PIC X(80).\n\n       01   XMITMAIL-BND          PIC X(37).\n\n       01   BINARY-OBJECT         PIC X.\n       01   BINARY-OBJECT-LENGTH  PIC S9(8) COMP.\n       01   LINES-ADDED           PIC S9(8) COMP.\n\n\n       PROCEDURE DIVISION using\n            XMITMAIL-CONTROL\n            XMITMAIL-MSG\n            ATTACHMENT-NAME\n            XMITMAIL-BND\n            BINARY-OBJECT\n            BINARY-OBJECT-LENGTH\n            LINES-ADDED\n              .\n\n\n           MOVE 'E' TO XMITMAIL-REPLY\n\n           MOVE 76 TO MIMELINE-LENGTH\n\n           IF MIMELINE-LENGTH NOT < XMITMAIL-LINE-LENGTH\n               COMPUTE\n               MIMELINE-LENGTH = XMITMAIL-LINE-LENGTH\n           END-IF\n\n           MOVE 1 TO XMITMAIL-MSG-OFFSET\n\n           COMPUTE W-1 = (3 * (LENGTH OF MIMELINES)/4)\n\n           IF BINARY-OBJECT-LENGTH NOT < W-1\n               MOVE 'O' TO XMITMAIL-REPLY\n               MOVE 'BINARY OBJECT TOO BIG' TO XMITMAIL-DIAGNOSTIC\n               GOBACK\n           END-IF\n\n           IF BINARY-OBJECT-LENGTH < 1\n               MOVE 'O' TO XMITMAIL-REPLY\n               MOVE 'BINARY OBJECT < 1 byte' TO XMITMAIL-DIAGNOSTIC\n               GOBACK\n           END-IF\n\n           MOVE ' ' TO MIMELINES-X\n\n           CALL 'XMIT64'  USING BINARY-OBJECT\n                                BINARY-OBJECT-LENGTH\n                                MIMELINES\n\n           MOVE 1 TO XMITMAIL-MSG-OFFSET\n\n\n           MOVE 'Content-Type: application/octet-stream;     '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE ' '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           STRING\n                '              name=\"'   delimited size\n                attachment-name           delimited space\n                '\"'   delimited size\n           INTO\n              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE 'Content-Transfer-Encoding: base64           '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE 'Content-Disposition: attachment;            '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE ' '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           STRING\n                '          filename=\"'   delimited size\n                attachment-name           delimited space\n                '\"'   delimited size\n           INTO\n              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE ' '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           STRING\n                'Content-Description: \"'  delimited size\n                attachment-name           delimited space\n                '\"'   delimited size\n           INTO\n              XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           MOVE ' '\n           TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n           PERFORM VARYING MIMEline-OFFSET from 1 by MIMELINE-LENGTH\n           UNTIL MIMELINES(MIMELINE-OFFSET:MIMELINE-LENGTH) =  ' '\n             MOVE  MIMELINEs(MIMELINE-OFFSET:MIMELINE-LENGTH)\n             TO XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n             ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n           END-PERFORM\n\n           MOVE ' ' to\n           XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           STRING  '--' XMITMAIL-BND DELIMITED SIZE INTO\n           XMITMAIL-MSG(XMITMAIL-MSG-OFFSET:XMITMAIL-LINE-LENGTH)\n           ADD XMITMAIL-LINE-LENGTH TO XMITMAIL-MSG-OFFSET\n\n\n           COMPUTE LINES-ADDED = XMITMAIL-MSG-OFFSET /\n                                 XMITMAIL-LINE-LENGTH\n\n           MOVE 'V' TO XMITMAIL-REPLY\n\n\n           GOBACK  .\n\n       copy xmit64 .\n       end program xmitmime.\n\n./ ADD NAME=XMITNODE 0115-10207-10208-1727-00204-00005-00204-TSO057\nXMITNODE CSECT\nXMITNODE AMODE 31\nXMITNODE RMODE ANY\n\nR0     EQU   0\nR1     EQU   1\nR2     EQU   2\nR3     EQU   3\nR4     EQU   4\nR5     EQU   5\nR6     EQU   6\nR7     EQU   7\nR8     EQU   8\nR9     EQU   9\nR10    EQU   10\nR11    EQU   11\nR12    EQU   12\nR13    EQU   13\nR14    EQU   14\nR15    EQU   15\n\n       USING *,R15\n       SAVE (14,12),,'XMITNODE VER 1.6 &SYSDATE &SYSTIME '\n       DROP  R15\n       USING XMITNODE,R12      SET UP CSECT ADDRESSABILITY\n       LR    R12,R15             LOAD BASE REGISTER\n\n       L     R0,INSTWORK_DATALEN_A\n       GETMAIN RU,LV=(0),LOC=BELOW   STORAGE FOR DATA DSECT, ADDR IN R1\n       USING INSTWORK_DATA,R1\n       ST    R13,INSTWORK_SAVEBK CHAIN BACK\n       ST    R1,INSTWORK_SAVEFW-INSTWORK_SAVE(R13) CHAIN FOREWARD\n       LR    R15,R1\n       LM    R0,R1,INSTWORK_SAVER0-INSTWORK_SAVE(R13) RESTORE R0 R1\n       LR    R13,R15             LOAD REGISTER 13 ADDR GETMAINED SA\n       DROP  R1\n       USING INSTWORK_DATA,R13   SET UP DATA DSECT ADDR.\n       B     *+8\nINSTWORK_DATALEN_A DC A(INSTWORK_DATALEN)\n\n\n\n\n*\n*  INFORMATION RETRIEVED FROM JES VIA IEFSSREQ\n         L     R7,0(R1)\n\n         XC    SSD1,SSD1\n         XC    SSD2,SSD2\n         MVC   ASSOB(SSVIDATA-ASSOB),AZZOB\n\n         LA    R1,SSOB1\n         ST    R1,ASSOB\n         LA    R1,SSVI1\n         ST    R1,SSOBPTR\n\n\n         LA    R1,ASSOB\n         IEFSSREQ ,\n         LTR   R15,R15\n         JNZ   RVCALL\n*\n         SR    R0,R0               NO REASON CODE\n         L     R15,SSOB1+SSOBRETN-SSOB\n         LTR   R15,R15\n         BNZ   RVCALL\n*\n*  PARSE THE SSVI DATA RETURNED BY IEFSSREQ\n*  STRATEGY IS TO USE THE POINTERS TO BUMP DOWN TO THE \"SYSTEM DATA,\"\n*  THE SCAN A CHARACTER AT A TIME LOOKING FOR COMMAS, AND EACH TIME A\n*  COMMA IS FOUND SEE IF THE FOLLOWING STRING IS \"JES_NODE=\"\n         LA    R3,SSVI1\n         A     R3,SSVISDOF-SSVI(,R3)    OFFSET TO SYSTEM DATA\n         LH    R2,0(,R3)           LENGTH OF SYSTEM DATA\n*  QUESTION: DOES THIS LENGTH INCLUDE ITS OWN HALFWORD?\n*  IT'S NOT REAL CRITICAL AS THIS IS LOCAL STORAGE AND NO S0C4 POSSIBLE\n         LA    R3,2(,R3)           OKAY, SHOULD NOW POINT AT 1ST COMMA\n*\n* LOOP LOOKING FOR COMMA\nNODE1LP  EQU   *\n         CLI   0(R3),C','\n         JNE   NODELP1X\n*\n*  FOUND A COMMA\n         CLC   1(9,R3),=CL9'JES_NODE='\n         JNE   NODELP1X\n*\n*  FOUND THE RIGHT TAG                      012345678901\n         LA    R9,11(,R3)          GET PAST ,JES_NODE=\n         J     NODEFND\n*\n*  KEEP GOING\nNODELP1X EQU   *\n         LA    R3,1(,R3)           NEXT CHARACTER\n         BRCT  R2,NODE1LP\n*\n*  NOT FOUND\n         LA    R9,=CL8'????????'   ???\n         MVC  0(8,R7),0(R9)\n         LA    R15,8\n         B     X\nNODEFND  DS    0H\n         MVC  0(8,R7),0(R9)\n         LA    R15,0\n         B     X\nRVCALL   LA    R9,=CL8'????????'   ???\n         MVC  0(8,R7),0(R9)\n\n\n\n\n\nX        DS    0H\n\n         LR    R2,R15              SAVE R15\n         LR    R1,R13              GET FREEMAIN ADDRESS\n         L     R13,INSTWORK_SAVEBK R13 NOW OLD REG 13\n         L     R0,=A(INSTWORK_DATALEN) SET GETMAIN LEN\n         FREEMAIN RU,LV=(0),A=(1)   FREE DATA DSECT STORAGE\n         LR    R15,R2              RC IN R15\n         L     R14,12(R13)         RESTORE R14\n         LM    R0,R12,20(R13)      RESTORE R0-R14\n         BSM   0,R14\n\n*\nAZZOB    DC    A(ZZOB1)\n*\nZZOB1    DC    0F'0'\n         DC    CL4'SSOB'\n         DC    Y(SSOBX-SSOB1)      LENGTH\n         DC    Y(SSOBSSVI)         VERSION REQUEST = 54\n         DC    A(0)                USE LIFE OF JOB SSIB\nZZOB1RET DC    F'0'\nZZOBPTR  DC    A(ZZVI1)\n         DC    2F'0'\nZZOBX    EQU   *                   END OF ZZOB\n*\nZZVI1    DC    0F'0'\n         DC    Y(SSVIX-SSVI1)      LENGTH\n         DC    AL1(SSVIVTWO)       VERSION\n         DC    X'0'\n         DC    CL4'SSVI'\nZZVIDATA EQU   *\n         DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY\n         DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY\nZZVIX    EQU   *                   END OF SSVI\n         LTORG\n\n\n\n\n\n         LTORG\n         DS   0D\n\nINSTWORK_DATA   DSECT\nINSTWORK_SAVE   DS 18F             SAVE AREA FOR REGISTERS ON ENTRY\n                ORG   INSTWORK_SAVE\nINSTWORK_SAVEXX DS F\nINSTWORK_SAVEBK DS F\nINSTWORK_SAVEFW DS F\nINSTWORK_SAVER14 DS F\nINSTWORK_SAVER15 DS F\nINSTWORK_SAVER0 DS F\nINSTWORK_SAVER1 DS F\n         ORG\n\n*  AREAS USED FOR IEFSSREQ\nASSOB    DC    A(SSOB1)\n*\nSSOB1    DC    0F'0'\n         DC    CL4'SSOB'\n         DC    Y(SSOBX-SSOB1)      LENGTH\n         DC    Y(SSOBSSVI)         VERSION REQUEST = 54\n         DC    A(0)                USE LIFE OF JOB SSIB\nSSOB1RET DC    F'0'\nSSOBPTR  DC    A(SSVI1)\n         DC    2F'0'\nSSOBX    EQU   *                   END OF SSOB\n*\nSSVI1    DC    0F'0'\n         DC    Y(SSVIX-SSVI1)      LENGTH\n         DC    AL1(SSVIVTWO)       VERSION\n         DC    X'0'\n         DC    CL4'SSVI'\nSSVIDATA EQU   *\nSSD1     DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY\nSSD2     DC    XL256'0'            LENGTH SOMEWHAT ARBITRARY\nSSVIX    EQU   *                   END OF SSVI\n         DS    CL22\n\n         DS   0D\nINSTWORK_DATALEN EQU *-INSTWORK_DATA\n\n            IEFSSOBH\n\n            IEFSSVI DSECT=YES\n\n            IEFJSSIB\n\n            CVT DSECT=YES\n\n            IEFJESCT\n          END\n./ ADD NAME=XMITSIZE 0103-05074-05179-1112-00014-00001-00000-TSO057\n      ******************************************************************\n      *                                                                *\n      *   THIS IS THE MAX MESSAGE SIZE THAT CAN BE                     *\n      *   HANDLED BY XMITMAIL IN BATCH, EXPRESSED AS 80 BYTE RECORDS.  *\n      *                                                                *\n      *   IT IS SET TO 4000 -> 320,000 BYTES.                          *\n      *                                                                *\n      *   YOU MAY TAILOR IT AS YOU WISH BEFORE COMPILING XMITMAIL      *\n      *                                                                *\n      *   XMITCICS IS CONSTRAINED BY THE 32K COMMAREA LIMIT AND THIS   *\n      *   CAN NOT BE CHANGED BY ALTERING THIS COPYBOOK                 *\n      *                                                                *\n      ******************************************************************\n                     OCCURS 4000.\n./ ADD NAME=XMITSMS  0107-02361-05074-1521-00143-00143-00000-TSO057\n\n      **************************************************************\n      *   XMITSMS batch e-mail subroutine\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n\n\n\n\n\n\n\n\n      ******************************************************************\n      *                                                                *\n      * SAMPLE PROGRAM TO SEND A MESSAGE TO AN EMAIL-TO-SMS GATEWAY    *\n      * CUSTOMISE AS SUITABLE                                          *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 22 Dec 2002 1.0  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMITSMS'.\n       ENVIRONMENT DIVISION.\n\n\n       WORKING-STORAGE SECTION.\n\n\n\n\n       01   W-WORK.\n            04   XMITMAFM-CHARNO   PIC S9(8) COMP.\n            04   OUTFILE-CHARNO    PIC S9(8) COMP.\n            04   MAIL-COUNT        PIC S9(8) COMP VALUE 0.\n            04   W-LINE            PIC X(255).\n\n\n\n       01   XMITMAIL-TOS.\n            04   XMITMAIL-TO       PIC X(80) OCCURS 100.\n\n       01   XMITMAIL-CCS.\n            04   XMITMAIL-CC       PIC X(80) OCCURS 10.\n\n       01   XMITMAIL-BCCS.\n            04   XMITMAIL-BCC      PIC X(80) OCCURS 10.\n\n       01   XMITMAIL-SUBJECT       PIC X(80).\n\n\n       COPY XMITMADF.\n\n\n          01   XMITMAIL-NAME         PIC X(8) VALUE 'XMITMAIL'.\n\n       LINKAGE SECTION.\n\n\n       COPY XMITMAC.\n\n       01   XMITSMS-NUMBERS.\n            04   XMITMAIL-NUMBER   PIC X(80) OCCURS 100.\n\n       01   XMITSMS-MSGS.\n            04   XMITSMS-MSG      PIC X(80)\n                   COPY XMITSIZE.\n\n\n\n       PROCEDURE DIVISION USING\n            XMITMAIL-CONTROL\n            XMITSMS-NUMBERS\n            XMITSMS-MSGS\n            .\n\n\n           MOVE 'E' TO XMITMAIL-REPLY\n           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC\n\n\n           MOVE LOW-VALUES TO\n\n                XMITMAIL-TOS\n                XMITMAIL-CCS\n                XMITMAIL-BCCS\n\n\n\n           MOVE ' '        TO\n\n                XMITMAIL-SUBJECT\n\n\n           PERFORM VARYING MAIL-COUNT FROM 1 BY 1 UNTIL\n           XMITSMS-NUMBER(MAIL-COUNT) = LOW-VALUES\n                MOVE ' ' TO XMITMAIL-TO(MAIL-COUNT)\n                STRING XMITSMS-NUMBER(MAIL-COUNT) DELIMITED SPACE\n                '@FAX.CO.UK' DELIMITED SIZE\n                INTO XMITMAIL-TO(MAIL-COUNT)\n           END-PERFORM\n\n            CALL XMITMAIL-NAME USING\n                XMITMAIL-CONTROL\n                XMITMAIL-TOS\n                XMITMAIL-CCS\n                XMITMAIL-BCCS\n                XMITMAIL-SUBJECT\n                XMITSMS-MSGS\n\n\n\n\n           GOBACK.\n\n./ ADD NAME=XMITUID  0105-10207-10207-1118-00060-00023-00041-TSO057\nXMITUID CSECT\nXMITUID AMODE 31\nXMITUID RMODE ANY\nR0     EQU   0\nR1     EQU   1\nR2     EQU   2\nR3     EQU   3\nR4     EQU   4\nR5     EQU   5\nR6     EQU   6\nR7     EQU   7\nR8     EQU   8\nR9     EQU   9\nR10    EQU   10\nR11    EQU   11\nR12    EQU   12\nR13    EQU   13\nR14    EQU   14\nR15    EQU   15\n       USING *,R15\n         B     34(0,15)\n         DC    AL1(29)\n         DC    CL8'XMITUID '\n         DC    CL8'VER 1 07'\n         DC    CL8'/26/10 1'\n         DC    CL5'1.12 '\n         STM   14,12,12(13)\n       DROP  R15\n       USING XMITUID,R12\n       LR    R12,R15\n          L    R2,0(R1)\n          USING PSA,0         (PSA)\n          L    R1,PSATOLD   R1->TCB\n          USING TCB,R1        (TCB)\n          ICM  R1,15,TCBSENV  HAVE ACEE?\n          BNZ  HAVEACEE     YES, USE IT\n          L    R1,PSAAOLD   R1->ASCB\n          USING ASCB,R1       (ASCB)\n          L    R1,ASCBASXB  R1->ASXB\n          USING ASXB,R1       (ASXB)\n          ICM  R1,15,ASXBSENV HAVE ACEE?\n          BNZ  HAVEACEE     YES, USE IT\n          B    EXIT\nHAVEACEE  DS   0H\n          USING ACEE,R1       (ACEE)\n          MVC  0(8,R2),ACEEUSRI  GET USERID\nEXIT      DS   0H\n          L     R14,12(R13)\n          LM    R0,R12,20(R13)\n          SLR   R15,R15\n          BSM   0,R14\n\n\n\n          IHAPSA\n          IKJTCB\n          IHAASCB\n          IHAASXB\n          IHAACEE\n          END\n./ ADD NAME=XMIT64   0102-05091-05094-1406-00211-00225-00000-TSO057\n\n\n      **************************************************************\n      *   XMIT64\n      *   Copyright (C) 2000  Andy Robertson\n      *\n      *   This program is free software; you can redistribute\n      *   it and/or modify it under the terms of the GNU\n      *   General Public License as published by the Free\n      *   Software Foundation; either version 2 of the\n      *   License, or (at your option) any later version.\n      *\n      *   This program is distributed in the hope that it\n      *   will be useful, but WITHOUT ANY WARRANTY; without\n      *   even the implied warranty of MERCHANTABILITY or\n      *   FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n      *   General Public License for more details.\n      *\n      *   You should have received a copy of the GNU General\n      *   Public License along with this program; if not,\n      *   write to the Free Software Foundation, Inc., 675\n      *   Mass Ave, Cambridge, MA 02139, USA.\n      *\n      **************************************************************\n\n\n       IDENTIFICATION DIVISION.\n       PROGRAM-ID.\n              'XMIT64'.\n\n      ******************************************************************\n      *                                                                *\n      * CONVERT TO 64-bit mime                                         *\n      *                                                                *\n      ******************************************************************\n\n       ENVIRONMENT DIVISION.\n       DATA DIVISION.\n       WORKING-STORAGE SECTION.\n       01   W-CHAR-OFFSET PIC S9(8) COMP.\n       01   W-64-OFFSET PIC S9(8) COMP.\n\n       01   W-TRIAD-X.\n            04 W-TRIAD       PIC S9(8) COMP.\n\n       01   W-W    .\n            04 W-REMAIN      PIC S9(8) COMP.\n            04 W-no-of-triads PIC S9(8) COMP.\n\n       01   W-mimechars.\n            04 FILLER PIC X VALUE 'A'.\n            04 FILLER PIC X VALUE 'B'.\n            04 FILLER PIC X VALUE 'C'.\n            04 FILLER PIC X VALUE 'D'.\n            04 FILLER PIC X VALUE 'E'.\n            04 FILLER PIC X VALUE 'F'.\n            04 FILLER PIC X VALUE 'G'.\n            04 FILLER PIC X VALUE 'H'.\n            04 FILLER PIC X VALUE 'I'.\n            04 FILLER PIC X VALUE 'J'.\n            04 FILLER PIC X VALUE 'K'.\n            04 FILLER PIC X VALUE 'L'.\n            04 FILLER PIC X VALUE 'M'.\n            04 FILLER PIC X VALUE 'N'.\n            04 FILLER PIC X VALUE 'O'.\n            04 FILLER PIC X VALUE 'P'.\n            04 FILLER PIC X VALUE 'Q'.\n            04 FILLER PIC X VALUE 'R'.\n            04 FILLER PIC X VALUE 'S'.\n            04 FILLER PIC X VALUE 'T'.\n            04 FILLER PIC X VALUE 'U'.\n            04 FILLER PIC X VALUE 'V'.\n            04 FILLER PIC X VALUE 'W'.\n            04 FILLER PIC X VALUE 'X'.\n            04 FILLER PIC X VALUE 'Y'.\n            04 FILLER PIC X VALUE 'Z'.\n            04 filler pic x value 'a'.\n            04 filler pic x value 'b'.\n            04 filler pic x value 'c'.\n            04 filler pic x value 'd'.\n            04 filler pic x value 'e'.\n            04 filler pic x value 'f'.\n            04 filler pic x value 'g'.\n            04 filler pic x value 'h'.\n            04 filler pic x value 'i'.\n            04 filler pic x value 'j'.\n            04 filler pic x value 'k'.\n            04 filler pic x value 'l'.\n            04 filler pic x value 'm'.\n            04 filler pic x value 'n'.\n            04 filler pic x value 'o'.\n            04 filler pic x value 'p'.\n            04 filler pic x value 'q'.\n            04 filler pic x value 'r'.\n            04 filler pic x value 's'.\n            04 filler pic x value 't'.\n            04 filler pic x value 'u'.\n            04 filler pic x value 'v'.\n            04 filler pic x value 'w'.\n            04 filler pic x value 'x'.\n            04 filler pic x value 'y'.\n            04 filler pic x value 'z'.\n            04 FILLER PIC X VALUE '0'.\n            04 FILLER PIC X VALUE '1'.\n            04 FILLER PIC X VALUE '2'.\n            04 FILLER PIC X VALUE '3'.\n            04 FILLER PIC X VALUE '4'.\n            04 FILLER PIC X VALUE '5'.\n            04 FILLER PIC X VALUE '6'.\n            04 FILLER PIC X VALUE '7'.\n            04 FILLER PIC X VALUE '8'.\n            04 FILLER PIC X VALUE '9'.\n            04 FILLER PIC X VALUE '+'.\n            04 FILLER PIC X VALUE '/'.\n       linkage         section.\n\n       01   f-char        pic x.\n       01   f-length      pic s9(8) comp.\n       01   f-64          pic x.\n\n\n       procedure division using f-char f-length f-64\n             .\n\n           if f-length < 1 goback end-if\n\n           divide f-length by 3 giving w-no-of-triads\n\n           move 1 to w-char-offset\n           move 1 to w-64-offset\n\n           perform until w-no-of-triads < 1\n               move 0 to w-triad\n               move f-char(w-char-offset:3) to w-triad-x(2:3)\n               add 3 to w-64-offset\n\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset - 1\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset - 1\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset - 1\n               move w-triad to w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-char-offset = w-char-offset + 3\n               compute  w-64-offset = w-64-offset + 4\n               compute  w-no-of-triads = w-no-of-triads - 1\n           end-perform\n\n           compute w-remain = f-length - w-char-offset + 1\n\n           evaluate true\n           when w-remain = 0\n               goback\n           when w-remain = 1\n               move 0 to w-triad\n               move f-char(w-char-offset:1) to w-triad-x(4:1)\n               add 1 to w-64-offset\n\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset - 1\n               move w-triad to w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset + 2\n               move '=='                  to f-64(w-64-offset:2)\n\n           when w-remain = 2\n               move 0 to w-triad\n               move f-char(w-char-offset:2) to w-triad-x(3:2)\n               add 2 to w-64-offset\n\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset - 1\n               divide w-triad by 64 giving w-triad remainder w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n               compute  w-64-offset = w-64-offset - 1\n\n               move w-triad to w-remain\n               add 1 to w-remain\n               move w-mimechars(w-remain:1) to f-64(w-64-offset:1)\n\n               compute  w-64-offset = w-64-offset + 3\n               move '='                  to f-64(w-64-offset:1)\n           end-evaluate\n\n\n\n\n           goback  .\n\n       END PROGRAM 'XMIT64'.\n", "mimetype": "text/plain", "datatype": "ebcdic", "extension": ".txt"}, "XMITMAIN": {"ttr": 9217, "alias": false, "halfwords": 30, "notes": 0, "parms": "b'\\x01I\\x00\\x00\\x01\\x003?\\x01\\x003?\\x10\\x02\\x00$\\x00\\x13\\x00\\x00\\xe3\\xe2\\xd6\\xf0\\xf5\\xf7@@@@'", "ispf": {"version": "01.73", "flags": 0, "createdate": "2000-11-28T00:00:00", "modifydate": "2000-11-28T10:02:00", "lines": 36, "newlines": 19, "modlines": 0, "user": "TSO057"}, "text": "      ******************************************************************\n      *                                                                *\n      * COMMON MAINLINE FOR XMITMAIL AND XMITCICS                      *\n      *                                                                *\n      ******************************************************************\n\n      ******************************************************************\n      * HISTORY                                                        *\n      ******************************************************************\n      *                                                                *\n      * 26 Nov 2000 1.1  written                                  AWR  *\n      *                                                                *\n      ******************************************************************\n\n\n\n\n           MOVE 'E' TO XMITMAIL-REPLY\n           MOVE 'UNDEFINED ERROR ' TO XMITMAIL-DIAGNOSTIC\n\n           PERFORM CALL-EXIT\n\n           PERFORM FORMAT-MESSAGE\n           PERFORM ALLOC-OUTFILE\n           PERFORM OPEN-OUTFILE\n           PERFORM WRITE-MESSAGE\n           PERFORM CLOSE-OUTFILE\n           PERFORM FREE-OUTFILE\n\n           MOVE 'V' TO XMITMAIL-REPLY\n           MOVE ' ' TO XMITMAIL-DIAGNOSTIC\n           MOVE 0 TO RETURN-CODE\n           GOBACK\n\n           .\n\n", "mimetype": "text/plain", "datatype": "unknown-8bit", "extension": ".txt"}}}}, "SCRIPTOPTIONS": {"filename": "./CBT491/FILE491.XMI", "LRECL": 80, "loglevel": 30, "outputfolder": "CBT491", "encoding": "cp1140", "unnum": true, "quiet": false, "force": false, "binary": false, "modifydate": true}}