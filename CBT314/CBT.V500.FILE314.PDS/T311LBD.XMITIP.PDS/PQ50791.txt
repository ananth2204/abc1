Item PQ50791

  APAR Identifier ...... PQ50791      Last Changed ........ 01/09/28
  ADD SMTP CONFIGURATION SUPPORT TO PREVENT GENERATION OF SOURCE
  ROUTE RECORDS IN RETURN PATH INFORMATION

  Symptom ...... NF NEW FUNCTION      Status ........... CLOSED  UR1
  Severity ................... 4      Date Closed ......... 01/09/07
  Component .......... 5655HAL00      Duplicate of ........
  Reported Release ......... 50A      Fixed Release ............ 999
  Component Name TCP/IP V3 MVS        Special Notice
  Current Target Date ..              Flags
  SCP ...................
  Platform ............

  Status Detail: SHIPMENT - Packaged solution is available for
                            shipment.

  PE PTF List:

  PTF List:
  Release 120   : UQ57614 available 01/09/28 (1000 )
  Release 50A   : UQ57615 available 01/09/28 (1000 )


  Parent APAR:
  Child APAR list:


  ERROR DESCRIPTION:
  Mail destined for some remote mailers cannot be delivered
  because the remote mailer will not accept the note if it
  included source-route format return path information. Some
  mailers can be configured to disallow the source-route format
  return path.
  This APAR will add the capability to configure SMTP's use of the
  source-route format in return path information (on the MAIL
  FROM command of the SMTP protocol). The removal of these source
  routes may make the return path unusable. That is potentially a
  problem when the originating host is not directly accessible to
  any mail transfer agent that must generate error mail to the
  originating host.

  ADDITIONAL SYMTPOMS:
  Mail may be rejected by remote SMTP servers that are configured
  to disallow souce routing/relay headers.  Mail is often rejected
  with a SMTP 501 reply code such as:
  501 Syntax Error

  KEYWORDS:
  RFC821 RELAY HEADER SOURCE ROUTING SMTP 501 SYNTAX ERROR

  LOCAL FIX:

  PROBLEM SUMMARY:
  ****************************************************************
  * USERS AFFECTED: All users of the IBM Communications Server   *
  *                 for OS/390 Release 10 and z/OS Version 1     *
  *                 Release 2 IP: SMTP                           *
  ****************************************************************
  * PROBLEM DESCRIPTION: Some mail cannot be delivered because   *
  *                      it contains source routes in the        *
  *                      return path information.                *
  ****************************************************************
  * RECOMMENDATION:                                              *
  ****************************************************************
  Source routes may be present on the MAIL FROM: or RCPT TO:
  SMTP commands processed by SMTP. How and when mailers do
  this is documented in the base RFCs 821 and 822. Currently,
  some remote SMTP servers have been rejecting source routing
  information with the reply code '501 syntax error'. Although
  technically the source routing string is proper syntax; the
  customer needs SMTP to have the flexibility of not adding to
  or passing source routing strings. This will allow the remote
  SMTP server to accept the mail.
  +-------------------------------------------------------------+
  + Please check our Communications Server for OS/390 homepages +
  + for common networking tips and fixes.  The URL for these    +
  + homepages can be found in Informational APAR II11334.       +
  +-------------------------------------------------------------+

  PROBLEM CONCLUSION:

  TEMPORARY FIX:

  COMMENTS:
  SMTP code has been modified to handle a new configuration
  parameter NOSOURCEROUTE. The NOSOURCEROUTE statement allows the
  customer to specify if SMTP should generate and pass source
  routing address strings which can be part of both MAIL FROM:
  and the RCPT TO: SMTP protocol commands.

  Additional Keyword: CS390817200

  The following documentation changes have been made:

  ================================================================
  IBM Communications Server
  IP Configuration Guide
  Document Number SC31-8725-01
  Document Number SC31-8775-01 (z/OS only)

  and

  IBM Communications Server
  IP Configuration Reference
  Document Number SC31-8726-01
  Document Number SC31-8776-01 (z/OS only)

  Chapter "Configuring the SMTP Server", Step 6 Summary of SMTP
  Configuration Statements, add the NOSOURCEROUTE statement and
  the description "Enables SMTP to NOT generate source routing
  addressing strings on certain RFC 821 SMTP commands".

  Chapter "Summary of SMTP Configuration Statements", add the
  NOSOURCEROUTE Statement

    Use the NOSOURCEROUTE statement to control whether this SMTP
    will generate and pass a source routing string for the
    originator address (MAILCMD) or for the recipient address
    (RCPTCMD). Setting the parameter to ENABLED will cause no
    source routing addresses to be generated for both the MAIL
    FROM: and RCPT TO: SMTP commands. A source route is a path
    that contains a source routing list of hosts and a destination
    mailbox. The list of hosts is the route information. It
    describes how the mail is to arrive at its final destination.
    The mail is passed from one host in the list to the next until
    it is delivered to the intended recipient.

    Source routing addressing string has the following format:
       @host1,@host2,@host3:myuserid@myhost
    where myuserid@myhost is considered the mailbox information.

    NOSOURCEROUTE DISABLED is the default and indicates that
    source route on the MAIL FROM: and RCPT TO: commands will be
    honored.

    Syntax

        --NOSOURCEROUTE--DISABLED--------
        |                               |
    >>--------------------------------------------->
        |                               |
        --NOSOURCEROUTE--MAILCMD---------
        |                               |
        --NOSOURCEROUTE--RCPTCMD---------
        |                               |
        --NOSOURCEROUTE--ENABLED---------

    Parameters
    DISABLED   Source routing address strings will be generated
               for both the MAIL FROM: and the RCPT TO: SMTP
               commands based on the source routing rules
               documented in RFC 821.
               This is the default should nothing be specified
               or if what is specified is not a valid parameter.

    MAILCMD    Source routing address strings will NOT be
               generated for the MAIL FROM: SMTP command. This
               means that the return path will only contain
               the mailbox information. However the RCPT TO:
               SMTP command will maintain source routing
               addressing based on the source routing rules
               documented in RFC 821.

    RCPTCMD    Source routing address strings will NOT be
               generated for the RCPT TO: SMTP command. This
               means that the send path will only contain
               the mailbox information. However the MAIL FROM:
               SMTP command will maintain source routing
               addressing based on the source routing rules
               documented in RFC 821.

    ENABLED    Source routing address strings will NOT be
               generated for both the MAIL FROM: and the
               RCPT TO: SMTP commands only the mailbox
               information will be provided.

    Examples
               To stop SMTP from adding its host identifier
               in front of the mailbox information on the
               return path passed on the MAIL FROM: SMTP
               command the following statement is coded:

               NOSOURCEROUTE   MAILCMD


    Usage Note
    The removal of these source routes may make the return path
    unusable. That is potentially a problem when the originating
    host is not directly accessible to any mail transfer agent
    that must generate error mail to the originating host.

    The removal of these source routes may make understanding of
    which route is used to deliver the mail difficult for


    debugging situations. However, if the delivered piece of
    mail can be viewed then receive lines can be used instead.

    Only 1 NOSOURCEROUTE statement should be coded. If there is
    more than 1 NOSOURCEROUTE statement in the SMTPCONF data set
    then only the last statement is used.

    Related Topics
         None

  ================================================================

  IBM Communications Server
  IP Messages:
  Volume 1 (EZA)
  Document Number SC31-8517-07
  Document Number SC31-8783-01 (z/OS only)

    --------------------------------------------------------------

    EZA5569I No Source Routing              : <parameter>

    Explanation: The NOSOURCEROUTE statement in the
    hlq.SMTP.CONFIG file has been set. Depending on the parameter
    following the statement, SMTP will modify its behavior
    regarding source routing addressing strings which can be
    passed on both the MAIL FROM: and RCPT TO: SMTP commands.

      Parameter is an input string whose valid options are
      DISABLED, MAILCMD, RCPTCMD or ENABLED

    See OS/390 Communications Server: IP Configuration Reference
    for more information about the NOSOURCEROUTE configuration
    statement.

    System Action: SMTP continues.

    User or Operator Response: None.

    System Programmer Response: None.

    Source Data Set: SMTP

    Procedure Name: OpenOutputStreams

    --------------------------------------------------------------

    EZA5570E INCORRECT VALUE <Parameter> SPECIFIED FOR
    NOSOURCEROUTE STATEMENT - THE DEFAULT VALUE OF DISABLED WILL
    BE USED

    Explanation: The input parameter following the NOSOURCEROUTE
    statement is invalid. The default value of DISABLED will be
    used instead. This means that the SMTP server will generate
    and pass source route addressing strings on both the MAIL


    FROM: and the RCPT TO: SMTP commands.

      Parameter shows a maximum of ten characters of the invalid
      input parameter.

    See OS/390 Communications Server: IP Configuration Reference
    for more information about the NOSOURCEROUTE configuration
    statement.

    System Action: SMTP continues

    User or Operator Response: None

    System Programmer Response: Change the parameter associated
    with the NOSOURCEROUTE configuration statement to a valid one.
    Stop and restart SMTP to activate the new parameter setting.


    Source Data Set: SMTP

    Procedure Name: ProcessConfigFile

  ================================================================


  MODULES/MACROS:   EZAAA00H EZABB01X EZABB020 EZABB025 EZAEB01B


  SRLS:      SC31877501 SC31877601 SC31878301 SC31872501
  SC31872601 SC31851707


  RTN CODES:


  CIRCUMVENTION:


  MESSAGE TO SUBMITTER:
