Queue management

Queue management under VM can be a little difficult at times.
The enclosed listing of one EXEC file and two XEDIT files will
enable general users and systems programmers easily to perform
tasks for any queue type, such as viewing the contents of a file,
deleting one or more files, or saving one or more files on the A
disk.  If PRT queue tasks are being performed, additional
functions such as printing one or more entries, flushing the active
print-out, giving the printer back to VSE, and viewing pages left
on the active print-out, are also easily done.

To use the program just key in 'QQ XXX', where 'XXX' stands for
the type of queue desired (PRT, RDR, or PUN).  This will give
the user a screen consisting of a listing of all those queue files.
Two reserved lines at the bottom document PF keys and
commands.  The command should be entered next to the desired
file or files.  Commands can be mixed and multiple.  For
example, in the list queue you could enter an 'S' next to the first
entry, a 'D' on the second and third and a 'P' on the fourth.  After
pressing the enter key, each of these functions will be carried out.

Also, if using the list queue, you could press PF12 to print all
class 'A' entries; if you wanted to flush and hold one of the print-
outs, PF11 would do this.  PF10 must be pressed to issue a drain
command and give the printer back to the VSE.  All active print-
outs are displayed on line 3 in reverse video showing the pages
left.


Figure 1 is an example of what the screen looks like.

QQ EXEC
&TRACE
&IF &N ¬= 1 &GOTO -ERROR
&Q = &1
&IF &Q = PRT &GOTO -PROCEED
&IF &Q = RDR &GOTO -PROCEED
&IF &Q = PUN &GOTO -PROCEED
&GOTO -ERROR
-PROCEED
CMS SET CMSTYPE HT
CP SET IMSG OFF
CP SET MSG OFF
CP SPOOL CON START NOTERM
MAKEBUF
&STACK &Q
XEDIT PRT LST A1 (PROFILE QQQ
CP SPOOL CON STOP TERM
CP CLOSE CON PUR
ERASE &Q LIST A1
CP SET IMSG ON
CP SET MSG ON
CMS SET CMSTYPE RT
-EXIT
DROPBUF
&EXIT
-ERROR
&TYPE PLEASE TRY AGAIN
&TYPE SPECIFY ONE OF THESE ARGUMENTS:  'PRT' 'RDR' 'PUN'
&GOTO -EXIT
QQQ XEDIT
&TRACE
&EMSG = NONE
&READ VARS &Q
-TOP
MAKEBUF
EXECIO * CP (STRING Q &Q ALL
SENTRIES
&LINES = &RC
&LOOP -ENDGET &LINES
&READ VARS &A &B &C &D &E &F &G &H &T &I &J &K
&IF .&A = . &A = &BLANK
&IF .&T = . &T = &BLANK
&IF .&B = . &B = &BLANK
&IF .&C = . &C = &BLANK
&IF .&D = . &D = &BLANK
&IF .&E = . &E = &BLANK
&IF .&F = . &F = &BLANK
&IF .&G = . &G = &BLANK
&IF .&H = . &H = &BLANK
&IF .&I = . &I = &BLANK
&IF .&J = . &J = &BLANK
&IF .&K = . &K = &BLANK
&A = &LEFT  OF &A 8
&B = &LEFT  OF &B 4
&C = &LEFT  OF &C 1
&D = &LEFT  OF &D 3
&E = &LEFT  OF &E 8
&F = &LEFT  OF &F 3
&G = &LEFT  OF &G 4
&H = &LEFT  OF &H 5
&I = &LEFT  OF &I 8
&J = &LEFT  OF &J 8
&K = &LEFT  OF &K 8
&T = &LEFT  OF &T 5
EXECIO 1 DISKW &Q LIST A1 (STRING &A &B &C &D &E &F &G &H &T &I &J &K
-ENDGET
DROPBUF
MAKEBUF
&STACK &Q
&STACK &EMSG
X &Q LIST A1 (PROFILE QQ
&READ VARS &REFRESH
&READ STRING &EMSG
&IF &REFRESH = YES &GOTO -TOP
QQUIT
&EXIT
QQ XEDIT
&TRACE
* GET QUEUETYPE
&READ VARS &Q
&READ STRING &EMSG
&CALL - &Q
&REFRESH = NO
&COLNO = 5
&SAVE = NO
* GET 00C ATTRIBUTES
MAKEBUF
EXECIO 1 CP (STRING Q V 00C
&READ VARS &X &X &X &RDRCL &RDRCONT &RDRHOLD &X &X
DROPBUF
* GET OWNERID
MAKEBUF
IDENTIFY (LIFO
&READ BARS &OWNERID
DROPBUF
CP SET EMSG ON
COMMAND TRANSFER TERMINAL
&READ VARS &TERM
&IF &TERM = TYPEWRITER &CALL -ENDMACRO
MAKEBUF
COMMAND TRANSFER LSCREEN
&READ VARS &SCREEN
&PANEL = 0
* SET UP INITIAL XEDIT ENVIRONMENT
&CASE U
&COMMAND MAKEBUF
COMMAND LEFT 3
COMMAND DEL 2
COMMAND SET CMDL BOT
COMMAND SET COLOR MSG &COLOR3 NON NOHIGH
COMMAND SET COLOR FILEAREA &COLOR5 NON NOHIGH
COMMAND SET COLOR CURL &COLOR5 NON NOHIGH
&IF &SCREEN = 32 COMMAND SET CURL ON M-14
&IF &SCREEN = 24 COMMAND SET CURL ON M-10
COMMAND SET TOFEOF OFF
COMMAND SET WRAP ON
COMMAND SET STAY ON
COMMAND SET SCALE OFF
COMMAND SET LINEND OFF
COMMAND SET PREFIX OFF
COMMAND SET CASE MIXED IGNORE
&I = 1
&LOOP 2 UNTIL &I > 24
COMMAND SET PF&I *
&I = &I + 1
SET PA2 NULLKEY
* SET VARIABLES AND ENTER PANEL ROUTINE
-BEGIN
CP SPOOL CON START NOTERM
&ACTIVE = NO
&IF &Q = PRT &CALL -ACTIVE
&PRINT = NO
&VIEW = NO
&OTHERID = JUNK
&OTHERNUM = JUNK
&CALL -PANEL
&EMSG = NONE
COMMAND READ NOCHANGE TAG
&COMMAND SENTRIES
&NUMLINE = &RC
&LOOP -END &NUMLINE
&READ ARGS
&IF &1 = PFK &GOTO -PFK
&IF &1 = ETK &GOTO -END
&IF &1 = FIL &GOTO -FIL
&IF &1 = CMD &GOTO -CMD
&GOTO -END
-CMD
CP SPOOL CON TERM
COMMAND &2 &3 &4 &5 &6 &7 &8
CP SPOOL CON NOTERM
&GOTO -BEGIN
-FIL
&CL = &7
&RECORDS = &9
&HOLD = &11
&OTHERID = &5
&OTHERNUM = &6
&FROM = &8
&COLNO = &2
&IF &Q = PRT &IF &4 = LZ &CALL -LASER
&IF &Q = PRT &IF &4 = P3 &CALL -PRT3
&IF &4 = V &GOTO -VIEW
&IF &Q = PRT &IF &4 = P &CALL -PRINT
&IF &4 = D &CALL -DELETE
&IF &4 = S &CALL -SAVE
&IF &Q = RDR &IF &FROM = PUN &IF &4 = RP &CALL -REPLACE
&IF &4 ¬= V &IF &4 ¬= P &IF &4 ¬= D &IF &4 ¬= S
                       &IF &4 ¬= RP &EMSG = &STRING OF INCORRECT COMMAND
&IF &Q = PRT &IF &4 = P3 &EMSG = &STRING OF &OTHERID &OTHERNUM PRINTING ON PRT3
&IF &Q ¬= PRT &IF &4 = P &EMSG = &STRING OF CANNOT PRINT FROM &Q LIST
&IF &FROM ¬= PUN &IF &4 = RP &EMSG = &STRING OF TYPE &FROM INVALID
&IF &Q = PRT &IF &4 = RP  &EMSG = &STRING OF VALID ONLY PUN & RDR LIST
&GOTO -END
-PFK
&IF &2 = 1 &GOTO -HELP
&IF &2 = 2 &GOTO -REFRESH
&IF &2 = 3 &GOTO -ENDALL
&IF &2 = 5 COMMAND CMS RSCS
&IF &2 = 7 COMMAND BA
&IF &2 = 8 COMMAND FO
&IF &Q = PRT &IF &2 = 4 &GOTO -PURT
&IF &Q = PRT &IF &2 = 10 &GOTO -RESET
&IF &Q = PRT &IF &2 = 11 &GOTO -FLUSHOLD
&IF &Q = PRT &IF &2 = 12 &CALL -PRINTALL
&IF &Q ¬= PRT &IF &2 =  4 &EMSG = &STRING OF PF &2 INVALID FROM &Q LIST
&IF &Q ¬= PRT &IF &2 = 10 &EMSG = &STRING OF PF &2 INVALID FROM &Q LIST
&IF &Q ¬= PRT &IF &2 = 11 &EMSG = &STRING OF PF &2 INVALID FROM &Q LIST
&IF &Q ¬= PRT &IF &2 = 12 &EMSG = &STRING OF PF &2 INVALID FROM &Q LIST
&IF &2 = 6 &EMSG = &STRING OF PF &2 IS INVALID
&IF &2 = 9 &EMSG = &STRING OF PF &2 IS INVALID
&PK = &2
&IF &2 = 7 &GOTO -BEGIN
&IF &2 = 8 &GOTO -BEGIN
-END
&IF &Q = PRT &IF &PRINT = YES &CALL -PRINTVM
&IF &REFRESH = YES &GOTO -REFRESH
&GOTO -BEGIN
* PANEL ROUTINE FOR ALL QUEUE TYPES
-PANEL
&COMMAND CONWAIT
&COMMAND DESBUF
MAKEBUF
EXECIO * CP (STRING Q TIME
&READ VARS * * &TIM * * &DAT
&READ VARS * * * * *
DROPBUF
&T = &STRING OF                     VM &Q QUEUE  &TIM  &DAT
COMMAND SET RESERVED 1 &COLOR1 UND HIGH &T
COMMAND SET RESERVED 2 &COLOR1 NON HIGH &BLANK
&X = &STRING OF CD OWNERID  FILE CLASS RECORDS
                                     CPV HOLD DATE  TIME  NAME TYPE DIST
COMMAND SET RESERVED 3 &COLOR2 UND HIGH &X
COMMAND SET RESERVED 4 &COLOR2 NON NOHIGH &BLANK
&IF &Q = PRT &IF &ACTIVE = YES COMMAND SET RESERVED 4 &COLOR5 REV HIGH
&A
&LINENO = &SCREEN - 2
COMMAND SET RESERVED &LINENO &COLOR3 UND HIGH &B1
&LINENO = &LINENO + 1
COMMAND SET RESERVED &LINENO & COLOR4 UND HIGH &B2
COMMAND CURSOR SCR &COLNO 1
&IF &EMSG ¬= NONE COMMAND EMSG &EMSG
&RETURN
* SAVE QUEUE ENTRY FILENAME WILL BE FILENUMBER FILETYPE WILL BE ENTRY NAME
-SAVE
&CALL -TAKE
&IF &FROM = PUN &IF &Q = RDR &CALL -RECEIVE
&IF &FROM ¬= PUN CMS READ &OTHERNUM &OTHERID
&IF &FROM ¬= PUN &IF &RC ¬= 0 &EMSG = &STRING OF ERROR READING FILE
&IF &FROM ¬= PUN &IF &RC = 0 &EMSG = &STRING OF &OTHERNUM &OTHERID SAVED
&IF &Q = PUN &IF &FROM = PUN CMS READ &OTHERNUM &OTHERID
&IF &RC = 0 &IF &Q = PUN &IF &FROM = PUN
                             &EMSG = &STRING OF &OTHERNUM &OTHERID SAVED
&IF &RC ¬= 0 &IF &FROM  = PUN &IF &Q = PUN
                                   &EMSG = &STRING OF ERROR READING FILE
&CALL -GIVE
&RETURN
-VIEW
&PKRC = 0
&SAVE = YES
&CALL -TAKE
&IF &Q = RDR &IF &FROM = PUN &CALL -PEEK
&IF &Q = PUN &IF &FROM = PUN CMS READ &OTHERID &OTHERNUM
&IF &RC ¬= 0 &EMSG = &STRING OF ERROR READING FILE
&IF &FROM ¬= PUN CMS READ &OTHERID &OTHERNUM
&IF &RC ¬= 0 &EMSG = &STRING OF ERROR READING FILE
&CALL -GIVE
&IF &Q = PUN &IF &FROM = PUN &GOTO -BEGVIEW
&IF &PKRC = 0 &IF &FROM = PUN &GOTO -BEGIN
-BEGVIEW
MAKEBUF
&STACK COMMAND SET PREF OFF
&STACK COMMAND SET COLOR FILEAREA &COLOR5 NON NOHIGH
&STACK COMMAND SET COLOR TOFEOF &COLOR2 NON NOHIGH
&STACK COMMAND SET COLOR CURL &COLOR2 NON NOHIGH
&STACK COMMAND SET CMDL TOP
&STACK COMMAND SET PF3 QQUIT
&STACK COMMAND SET PF5 LEFT 20
&STACK COMMAND SET PF6 RIGHT 20
CMS XEDIT &OTHERID &OTHERNUM
&IF &RC ¬= 0 &EMSG = &STRING OF FILE TOO LARGE TO VIEW
CMS ERASE &OTHERID &OTHERNUM
&GOTO -BEGIN
* PRINT DESIRED ENTRY FROM PRT QUEUE
-PRINT
&PRINT = YES
CP CH &OTHERID PRT &OTHERNUM CL V
&RETURN
-PRT3
&CALL -TAKE
CP SPOOL PRT RSCS
CP TAG DEV 00E PRT3
MAKEBUF
EXECIO &RECORDS CARD
EXECIO 65 PRINT (STRING &BLANK
&NPRT3 = 0
&LOOP -ENDPRT3 &RECORDS
EXECIO 1 PRINT
&NPRT3 = &NPRT3 + 1
&IF &NPRT3 = 56 EXECIO 10 PRINT (STRING & BLANK
&IF &NPRT3 = 56 &NPRT3 = 0
-ENDPRT3
DROPBUF
CP CLOSE PRT
CP SPOOL PRT OFF
CP SPOOL PRT CL A
CP TAG DEV 00E 00E
&CALL -GIVE
&RETURN
-LASER
&CALL -TAKE
CP SPOOL PRT RSCS
CP TAG DEV 00E LASER1
MAKEBUF
EXECIO &RECORDS CARD
EXECIO 65 PRINT (STRING &BLANK
&NPRT3 = 0
&LOOP -ENDLASR &RECORDS
EXECIO 1 PRINT
&NPRT3 = &NPRT3 + 1
&IF &NPRT3 = 56 EXECIO 10 PRINT (STRING & BLANK
&IF &NPRT3 = 56 &NPRT3 = 0
-ENDLASR
DROPBUF
CP CLOSE PRT
CP SPOOL PRT OFF
CP SPOOL PRT CL A
CP TAG DEV 00E 00E
&CALL -GIVE
&RETURN
-RECEIVE
CMS RECEIVE
&IF &RC ¬=0 &EMSG = &STRING OF FILE ALREADY EXISTS - ENTER 'RP' TO REPLACE
&RETURN
-PEEK
CMS PEEK
&PKRC = &RC
&IF &PKRC ¬= 0 CMS READ &OTHERID &OTHERNUM
&RETURN
-REPLACE
&CALL -TAKE
CMS RECEIVE (REPLACE)
&IF &RC = 0 &EMSG = &STRING OF FILE REPLACE
&IF &RC ¬= 0 &EMSG = &STRING OF ERROR
&CALL -GIVE
&RETURN
-PRINTVM
MAKEBUF
EXECIO * CP (STRING Q PRT
SENTRIES
&LINES = &RC
&READ VARS &NAME &NUM
&LINES = &LINES - 1
& LOOP 2 &LINES
&READ VARS &OTHERID &OTHERNUM
CP CH &OTHERID PRT &OTHERNUM HOLD
DROPBUF
* PRINT CLASS V FILES
MAKEBUF
EXECIO * CP (STRING Q PRT
SENTRIES
&LINES = &RC
&READ VARS &OTHERID &OTHERNUM &CL
&LINES = &LINES - 1
&LOOP 2 &LINES
&READ VARS &OTHERID &OTHERNUM &CL
&IF &CL = V &CALL -CHANGE
&CALL -PRINTALL
&RETURN
-CHANGE
CP CH &OTHERID PRT &OTHERNUM NOHOLD CL A
&RETURN
* PRINT ALL NOHOLD FILES IN PRT QUEUE
-PRINTALL
CP DET E VSEIPO
CP START E
&EMSG = &STRING OF 00E TAKEN FROM VSEIPO
&REFRESH = YES
&RETURN
* THIS WILL DRAIN E AND RESET SYSTEM HOLD ENTRIES IN PRT QUEUE
-RESET
CP DRAIN E
MAKEBUF
EXECIO * CP (STRING Q PRT
SENTRIES
&LINES = &RC
&READ VARS &NAME &NUM
&LINES = &LINES - 1
&LOOP 3 &LINES
&READ VARS &OTHERID &OTHERNUM &X &X &X &X &HOLD
&IF &HOLD = SYS &CALL -FREE
CP CH &OTHERID PRT &OTHERNUM NOHOLD
CP ATT E VSEIPO
&IF &Q = PRT &IF &ACTIVE = YES &IF &2 = 10 &EMSG = &STRING OF 00E DRAINED
&IF &Q = PRT &IF &ACTIVE = NO  &IF &2 = 10
                 &EMSG = &STRING OF 00E DRAINED AND REATTACHED TO VSEIPO
&GOTO -REFRESH
* THIS WILL PURGE ALL PRT QUEUE ENTRIES WITH A CLASS OF T
-PURT
MAKEBUF
EXECIO * CP (STRING Q PRT
SENTRIES
&LINES = &RC
&READ VARS &NAME &NUM
&LINES = &LINES - 1
&LOOP 2 &LINES
&READ VARS &OTHERID &OTHERNUM &OTHERCL
&IF &OTHERCL = T &CALL -DELETE
&GOTO -REFRESH
& DELETE THE DESIRED ENTRY FROM ANY QUEUE
-DELETE
CP PUR &OTHERID &Q &OTHERNUM
&IF &RC ¬= 0 CP PUR &Q &OTHERNUM
&REFRESH = YES
&RETURN
* UNIVERSAL HELP FEATURE
-HELP
MAKEBUF
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF              COMBINED VM QUEUE MANAGEMENT HELP SCREEN
&STACK &T
&T = &STRING OF              ----------------------------------------
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF                             PF KEY FUNCTIONS
&STACK &T
&T = &STRING OF                             ----------------
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF PF1 - PRESS THIS KEY ANYTIME TO DISPLAY THIS HELP
SCREEN.
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF PF2 - PRESS THIS KEY TO VIEW THE MOST CURRENT STATUS
&STACK &T
&T = &STRING OF       OF THE VIRTUAL  &Q      QUEUE.
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF PF3 - PRESS THIS KEY TO END THE VM &Q     LIST.
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF PF4 - THIS WILL PURGE ALL PRINT FILES WITH A CLASS OF T.
&STACK &T
&T = &STRING OF &BLANK
&STACK &T
&T = &STRING OF PF10 - PRESS THIS KEY TO CHANGE ALL PRINTER FILES BACK
&STACK &T
&T = &STRING OF     TO NOHOLD.  USE THIS AFTER ALL FILES ARE PRINTED.
&STACK &T
&T = &STRING OF     THIS WILL ALSO DRAIN 00E AND GIVE IT BACK TO VSEIPO.
&STACK &T
&T = &STRING OF     IF THERE IS AN ACTIVE FILE DISPLAYED AFTER PRESSING
&STACK &T
&T = &STRING OF     PF10, 00E IS DRAINED, BUT DOES NOT BELONG TO
&STACK &T
&T = &STRING OF     VSEIPO YET.  PRESS PF10 AGAIN TO RESOLVE THIS.
&STACK &T

This article will be concluded next month when the rest of the
code for the EXEC will be published.


Ray Dubcak
Computer Operator
Ralph Wilson Plastics (USA)  ) Ray Dubcak 1989

