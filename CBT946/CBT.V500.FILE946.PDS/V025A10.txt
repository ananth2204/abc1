 HEXIT001 - JES2/SP Exit #001
The JES2/SP Exit #001 output separator exit enables output to be spooled to
other virtual machines or across an RSCS network.  The Exit is invoked by
JES2/SP at the beginning and after the end of every job output element being
printed or punched.
Depending on the information coded in a job's JOB, JOBPARM, OUTPUT statement or
SYSOUT JCL parameter the exit can:
y    Spool the output for local VM processing (print or punch).
y    Spool the output across an RSCS network.
y    Spool the output to a particular virtual machine running under control of
the same VM system.
When output is not spooled for local VM processing the Exit suppresses JES2
separator printing.
All messages generated by the exit are self-explanatory and start with $EXIT001
text for ease of recognition.
Return codes presented to JES2/SP are documented in JES2 User Modifications and
Macros (LC23-0067).
After enabling, either at JES2 initialisation time or by the operator, Exit
receives control at the beginning and after the end of every printed/punched
output element.
Depending on the following criteria Exit takes the following actions:
1    FORMS=RSCS coded in JOBPARM, SYSOUT or OUTPUT statement.  The output will
be spooled to the RSCS machine (symbolic name used in source code).  The output
element(s) will be spooled to the reader class of RSCS equal to its JES2 output
class.
     The affected virtual device will be tagged as follows:
     TAG DEV CUU <node> <machine>
     where:
     <node>    = Programmer's name value
     <machine> = NOTIFY parameter value
     It will be closed with the following name:
     <filename> <filetype>
     <filename>     =    Jobname
     <filetype>     =    RSC followed by JES2 Job serial number with
               leading zeros.
     If an error occurs in the SPOOL, TAG or CLOSE CP command a message will be
issued to the operator's console controlling unit record devices pool
(ROUTCDE=7) and the output will be spooled to the VM system with a request to
hold the output.  The operator should decide where to spool the output to.
2    FORMS=RSCS not coded in JOBPARM and/or not in the output element.  The
output element(s) will be spooled to the virtual machine with the name specified
by the NOTIFY parameter.
     If the machine specified is not found in the VM directory, the output will
be spooled for local VM processing.  The output of the job will be spooled to
the virtual machine reader with  a class equal to its JES2 output class.
     The output will be spooled with the following name:
     <filename> <filetype>
     <filename>     =    NOTIFY parameter value; if absent it uses
                Jobname
     <filetype>     =    first 8 characters of the Programmer's name field (if
valid for VM CLOSE); if Programmer's name is missing or invalid for the VM CLOSE
command it uses JOB followed by the JES2 Job serial number filled with leading
zeros.
The message indicating VM CLOSE error will eventually be issued to the unit
record pool console.
EXAMPLES
Routing all the Job output across RSCS network:
     //JOBABC JOB (....),GCCVM102,...,NOTIFY=VTSDZKB
     /*JOBPARM FORMS=RSCS
Routing single Job output element across RSCS network:
     //JOBABC JOB (....),GCCVM102....,NOTIFY=VTSDZKB
     //TORSCS DD SYSOUT=A(,,RSCS)
Routing Job output to the virtual machine:
     //JOBABC JOB (....),'TO VIRTUAL',...,NOTIFY=VTSDZKB
       ....
     //TORSCS DD SYSOUT=(A,,RSCS)
 PROGRAMMING CONSIDERATIONS
Compilation
The Exit code supports JES2/SP releases 1.3.4, 1.3.6 and 2.  The macros
supporting JES2/SP parameters and areas are selected using conditional assembly
properties of Assembler XF or H.
The release to be supported is given to the Assembler by SYSPARM information
from the PARM field, being compatible with $MODULE macro SYSPARM expectations:
     SYSPARM((NOGEN,NOGEN,NODATA,NOGEN,NOGEN,134))
     SYSPARM((NOGEN,NOGEN,NODATA,NOGEN,NOGEN,136))
     SYSPARM((NOGEN,NOGEN,NODATA,NOGEN.NOGEN,120))
     for Release 1.3.4, 1.3.6 and 2, respectively.
Execution Logic
The Exit uses the VM DIAGNOSE interface to present CP commands to VM under which
it works.  If the Exit detects that it is not running under VM, no action is
taken.
The CP commands used by the exit are:
y    TAG
y    SPOOL
y    CLOSE.
HEXIT001 ASSEMBLE
* EXITS COMPILATION PROVIDING THE MEANS TO SELECT THE PROPER JES2/SP
* COMPILATION PARAMETERS AND JES2/SP MACROS NECESSARY TO PROPERLY
* COMPILE JES2/SP EXITS.
*  $MODULE WITH NECESSARY JES2/SP MAPPING MACROS AND $ENTRY MACRO
* ARE GENERATED. MODULE NAME AND ENTRY NAME ARE DEFINED.
* MACRO FORMAT IS AS FOLLOWS:
*               HX#PRLOG <EXITNAME>
*    WHERE <EXITNAME> IS HEXITNNN WHERE NNN IS THE EXIT NUMBER
* MISSING <EXITNAME> WILL TERMINATE THE COMPILATION
*  THE MACRO CODE ASSUMES THAT SYMBOLIC JES/SP RELEASE
* IS GIVEN AS THE SIXTH ELEMENT IN JES2 SYSPARM PASSED TO ASSEMBLER
* DURING THE COMPILATION.
*  THE FIRST FIVE PARAMETERS ARE TRANSPARENT TO THE MACRO AND ARE
* DECODED BY $MODULE JES2/SP MACRO.
*  THE MACRO REPEATS THE SIX PARAMETERS SPECIFIED BY THE MEANS
*  OF THE MNOTE.
         MACRO
         HX#PRLOG &HXT
         GBLC  &JES2VER
         LCLC  &ELMTS(10),&HXN
         LCLA  &A1,&A2,&A3,&AX
&A1      SETA  2               JUMP OVER OPENING BRACE
&A3      SETA  1
         AIF   (K'&SYSPARM EQ 0).NOEL
.LPG     ANOP
&A2      SETA  0
&AX      SETA  &A1
.LP1     ANOP
         AIF   ('&SYSPARM'(&A1,1) EQ ',').KOEL
&A1      SETA  &A1+1
&A2      SETA  &A2+1
         AIF   (&A1 LT K'&SYSPARM).LP1
.KOEL    ANOP
         AIF   (&A2 EQ 0).KL1
&ELMTS(&A3) SETC '&SYSPARM'(&AX,&A2)
.KL1     ANOP
&A1      SETA  &A1+1
&A3      SETA  &A3+1
         AIF   (&A1 GT K'&SYSPARM).KOAN
         AGO   .LPG
.NOEL    ANOP
         MNOTE *,'NO SYSPARM SPECIFIED REL 136 ASSUMED'
&JES2VER SETC  '136'
         AGO   .HCOP
.KOAN    ANOP
         MNOTE *,'JES2 COMPILATION PARAMETERS SPECIFIED:'
          MNOTE *,' 01 -  &ELMTS(1)'
         MNOTE *,' 02 -  &ELMTS(2)'
         MNOTE *,' 03 -  &ELMTS(3)'
         MNOTE *,' 04 -  &ELMTS(4)'
         MNOTE *,' 05 -  &ELMTS(5)'
         AIF   (K'&ELMTS(6) EQ 0).NEL6
&JES2VER SETC  '&ELMTS(6)'
         MNOTE *,'JES2/SP VERSION &JES2VER SPECIFIED'
         AGO   .HCOP
.NEL6    ANOP
         MNOTE *,'JES2 VERSION NOT SPECIFIED REL 136 ASSUMED'
&JES2VER SETC  '136'
.HCOP    ANOP
         PRINT OFF
         AIF   ('&JES2VER' NE '136').N136
         COPY  $HASPGBL
         AGO   .MCEND
.N136    ANOP
         AIF   ('&JES2VER' NE '134').N134
         COPY  $HASPGBL
         AGO   .MCEND
.N134    ANOP
         AIF   ('&JES2VER' NE '120').N120
         COPY  $HASPGEN
         AGO   .MCEND
.N120    ANOP
         PRINT ON
         MNOTE 12,'** &JES2VER UNSUPPORTED JES2 VERSION SPECIFIED **'
         MNOTE 12, '********* COMPILATION TERMINATED ************'
         END
         MEXIT
MCEND    ANOP
         PRINT ON
         AIF   ('&HXT' NE '').MODSUP
         MNOTE 12,'***********   EXIT NAME MISSING    ***********'
         MNOTE 12,'*********** COMPILATION TERMINATED ***********'
         END
         MEXIT
.MODSUP  ANOP
         MNOTE *,'EXIT NAME &HXT SPECIFIED'
&HXN     SETC '&HXT' (6,3)
         AIF   ('&JES2VER' EQ '134').JES134
         AIF   ('&JES2VER' EQ '136').JES136
&HXT     $MODULE                  HASP MODULE INFORMATION TABLE  SPR2
         $BUFFER
         $COMWORK        EXIT005
         $ERPL
         $JCT
         $CAT
         $CMB            EXIT005
         $DCT            EXIT004
         $PCE
         $JQE
         $JOE            EXIT005
         $HCT
         $MIT
         $PDDB           EXIT001
         $UCB            EXIT001
         $PPPWORK        EXIT001
         $MODMAP         EXIT005
HA$X&HXN $ENTRY CSECT=YES,BASE=(R12) DEFINE ENTRY POINT
         AGO    .JESXXX
Krzysztof Bytnerowicz
Regional Software Specialist
National Advanced Systems (Australia)   ) Krzysztof Bytnerowicz 1988

