*          DATA SET CBT840     AT LEVEL 001 AS OF 09/29/77
         MACRO                                                          00001
&N       DTIME &FIELD                                                   00002
&N       TIME  DEC                                                      00003
         CNOP  0,4                                                      00004
         STM   0,1,*+8                                                  00005
         B     *+12                                                     00006
         DC    2F'0'                                                    00007
         EDIT  TO=&FIELD,FROM=*-14,MASK=' 99/99/99.99F ZZ99.999'        00008
         MEND                                                           00009
         MACRO                                                          00010
&NAME    EDIT  &TO=,&FROM=,&MASK=                                       00011
.*                                                                      00012
.*             MACRO-ID. 'EDIT'.                                        00013
.*             AUTHOR.   DON HIGGINS.                                   00014
.*             DATE WRITTEN.  07/18/70.                                 00015
.*             REMARKS.                                                 00016
.*                  FUNCTION - GENERATE MASK AND/OR INSTRUCTIONS TO     00017
.*                             EDIT PACKED DECIMAL DATA FOR PRINTING.   00018
.*                  OPERANDS                                            00019
.*                   TO=   LABEL OF DISPLAY FIELD INTO WHICH THE EDITED 00020
.*                         DATA WILL BE PLACED IF SPECIFIED.            00021
.*                   FROM= LABEL OF PACKED DECIMAL DATA TO BE EDITED    00022
.*                         IF SPECIFIED.                                00023
.*                   MASK= STRING OF UP TO 48 CHARACTERS IN SINGLE      00024
.*                         QUOTES DEFINING EDIT MASK SIMILAR            00025
.*                         TO A COBOL PICTURE.  THIS OPERAND IS         00026
.*                         REQUIRED.  IF THE OTHER TWO OPERANDS ARE NOT 00027
.*                         DEFINED, A DC WITH THE DESIRED MASK IS       00028
.*                         GENERATED.  SPECIAL EDIT CHARACTERS ARE AS   00029
.*                         FOLLOWS:                                     00030
.*                            Z - DIGIT SELECT WITH ZERO SURPRESSION    00031
.*                            9 - DIGIT SELECT WITHOUT ZERO SURPRESSION 00032
.*                            F - FIELD SELECT RESETS SIGNIFICANCE TO   00033
.*                                ALLOW MULTIPLE FIELD EDITING          00034
.*                            $ - DIGIT SELECT WITH ZERO SURPRESSION    00035
.*                                AND FLOATING DOLLAR SIGN.             00036
.*                  NOTES:                                              00037
.*                   1.  THE FIRST MASK CHARACTER IS USED AS THE FILL   00038
.*                       CHARACTER IN ALL FIELDS.                       00039
.*                   2.  THE FOLLOWING EXAMPLE WOULD EDIT BOTH THE TIME 00040
.*                       AND DATE OBTAINED USING THE TIME MACRO         00041
.*                            .                                         00042
.*                            TIME DEC                                  00043
.*                            STM  0,1,PDATA                            00044
.*                            EDIT TO=LINE+10,FROM=PDATA,               00045
.*                                 MASK=' 99/99/99.99F ZZ99.999'        00046
.*                            .                                         00047
.*                       PDATA DS  2F     (HHMMSSTH00YYDDDC)            00048
.*                       LINE  DC  CL133' '                             00049
.*                            .                                         00050
.*                   3.  THE FOLLOWING EXAMPLE WOULD GENERATE A DC      00051
.*                       LABELED MASKPAY TO BE USED AS A MASK FOR       00052
.*                       EDITING DIFFERENT FILEDS.                      00053
.*                            .                                         00054
.*                       MASKPAY   EDIT MASK=' Z,ZZZ,ZZ9.99 CR'         00055
.*                            .                                         00056
.*                   4.  THE MASK CHARACTERS DETERMINE EXPLICIT LENGTH. 00057
.*                   5.  MULTIPLE FIELDS CANNOT CONTAIN FLOATING        00058
.*                       DOLLAR SIGNS.                                  00059
.*                                                                      00060
         LCLA  &LMASK,&SIGNF,&NEXT,&FIELDS,&FLOAT                       00061
         LCLC  &C,&C1,&C2,&C3,&C4,&C5,&C6                               00062
         AIF   (T'&MASK NE 'U').BADMASK                                 00063
&LMASK   SETA  K'&MASK-2                                                00064
         AIF   (&LMASK GT 48).BADMASK                                   00065
         AIF   (&LMASK LT 1).BADMASK                                    00066
         AIF   ('&MASK'(1,1) NE '''').BADMASK                           00067
         AIF   ('&MASK'(&LMASK+2,1) NE '''').BADMASK                    00068
.LOOP    ANOP                                                           00069
&NEXT    SETA  &NEXT+1                                                  00070
         AIF   (&NEXT GT &LMASK).GEN                                    00071
&C       SETC  '&MASK'(&NEXT+1,1)                                       00072
         AIF   ('&C' EQ '9').NINE                                       00073
         AIF   ('&C' EQ 'Z').ZZZZ                                       00074
         AIF   ('&C' EQ '$').DOLLAR                                     00075
         AIF   ('&C' EQ 'F').FIELD                                      00076
.AD1     AIF   ('&C1' GT '9999999').AD2                                 00077
&C1      SETC  '&C1&C'                                                  00078
         AGO   .LOOP                                                    00079
.AD2     AIF   ('&C2' GT '9999999').AD3                                 00080
&C2      SETC  '&C2&C'                                                  00081
         AGO   .LOOP                                                    00082
.AD3     AIF   ('&C3' GT '9999999').AD4                                 00083
&C3      SETC  '&C3&C'                                                  00084
         AGO   .LOOP                                                    00085
.AD4     AIF   ('&C4' GT '9999999').AD5                                 00086
&C4      SETC  '&C4&C'                                                  00087
         AGO   .LOOP                                                    00088
.AD5     AIF   ('&C5' GT '9999999').AD6                                 00089
&C5      SETC  '&C5&C'                                                  00090
         AGO   .LOOP                                                    00091
.AD6     AIF   ('&C6' GT '9999999').BADMASK                             00092
&C6      SETC  '&C6&C'                                                  00093
         AGO   .LOOP                                                    00094
.NINE    AIF   (&SIGNF EQ 0).SETSIG                                     00095
.ZZZZ    ANOP                                                           00096
&C       SETC  ''       (11-0-1-8-9)=X'20'  DIGIT SELECT               00097
         AGO   .AD1                                                     00098
.DOLLAR  ANOP                                                           00099
&FLOAT   SETA  1                                                        00100
         AGO   .ZZZZ                                                    00101
.FIELD   ANOP                                                           00102
&C       SETC  ''       (0-2-9)=X'22'       FIELD SELECT               00103
&SIGNF   SETA  0                                                        00104
&FIELDS  SETA  1                                                        00105
         AGO   .AD1                                                     00106
.SETSIG  ANOP                                                           00107
&C       SETC  ''       (0-1-9)=X'21'       SIGNIFICANCE STARTER       00108
&SIGNF   SETA  &NEXT                                                    00109
         AGO   .AD1                                                     00110
.GEN     AIF   (T'&TO EQ 'O').GENDC                                     00111
         AIF   (T'&FROM EQ 'O').BADFROM                                 00112
         AIF   (&FLOAT EQ 1).GENFL                                      00113
&NAME    MVC   &TO.(&LMASK.),=CL&LMASK.'&C1&C2&C3&C4&C5&C6'             00114
         ED    &TO.(&LMASK.),&FROM                                      00115
         MEXIT                                                          00116
.GENDC   AIF   (T'&FROM NE 'O').BADTO                                   00117
&NAME    DC    CL&LMASK.'&C1&C2&C3&C4&C5&C6'                            00118
         MEXIT                                                          00119
.GENFL   AIF   (&FIELDS NE 0).BADMIX                                    00120
         AIF   (&SIGNF  GT 0).GENLA                                     00121
&NAME    LA    1,1                                                      00122
         MVC   &TO.(&LMASK.),=CL&LMASK.'&C1&C2&C3&C4&C5&C6'             00123
         EDMK  &TO.(&LMASK.),&FROM                                      00124
         BCT   1,*+8                                                    00125
         B     *+8                                                      00126
         MVI   0(1),C'$'                                                00127
         MEXIT                                                          00128
.GENLA   ANOP                                                           00129
&NAME    LA    1,&TO.+&SIGNF                                            00130
         MVC   &TO.(&LMASK.),=CL&LMASK.'&C1&C2&C3&C4&C5&C6'             00131
         EDMK  &TO.(&LMASK.),&FROM                                      00132
         BCTR  1,0                                                      00133
         MVI   0(1),C'$'                                                00134
         MEXIT                                                          00135
.BADMIX  MNOTE 0,'MULTIPLE FIELDS CANNOT CONTAIN FLOATING DOLLAR SIGNS' 00136
         MEXIT                                                          00137
.BADMASK MNOTE 0,'INVALID MASK (1-48 CHARACTERS IN SINGLE QUOTES)'      00138
         MEXIT                                                          00139
.BADTO   MNOTE 0,'MISSING TO FIELD'                                     00140
         MEXIT                                                          00141
.BADFROM MNOTE 0,'MISSING FROM FIELD'                                   00142
         MEXIT                                                          00143
         MEND                                                           00144
         MACRO                                                          00145
         EQUREGS &LIMITS                                                00146
.*                                                                      00147
.*             MACRO-ID. 'EQUREGS'.                                     00148
.*             AUTHOR. DON HIGGINS.                                     00149
.*             DATE WRITTEN. 08/04/70.                                  00150
.*             REMARKS.                                                 00151
.*                 THIS MACRO GENERATES EQU STATEMENTS FOR 1 TO 16      00152
.*                 SYMBOLIC REGISTER NAMES OF THE FORM R0 UP TO R15     00153
.*             THE REGISTER EQU DESIRED CAN BE SPECIFIED IN THE FORM    00154
.*             OF  (0,15), (14,1), (2,6), ETC.                          00155
         LCLA  &LOW,&HIGH                                               00156
         AIF   (N'&SYSLIST EQ 1).GETLIM                                 00157
.DEFAULT ANOP                                                           00158
&LOW     SETA  0                                                        00159
&HIGH    SETA  15                                                       00160
.GEN     ANOP                                                           00161
R&LOW    EQU   &LOW                                                     00162
         AIF   (&LOW EQ &HIGH).DONE                                     00163
&LOW     SETA  &LOW+1                                                   00164
         AIF   (&LOW LE 15).GEN                                         00165
&LOW     SETA  0                                                        00166
         AGO   .GEN                                                     00167
.GETLIM  AIF   (N'&SYSLIST(1) NE 2).DEFAULT                             00168
         AIF   (T'&SYSLIST(1,1) NE 'N').DEFAULT                         00169
         AIF   (T'&SYSLIST(1,2) NE 'N').DEFAULT                         00170
&LOW     SETA  &SYSLIST(1,1)                                            00171
         AIF   (&LOW LT 0).DEFAULT                                      00172
         AIF   (&LOW GT 15).DEFAULT                                     00173
&HIGH    SETA  &SYSLIST(1,2)                                            00174
         AIF   (&HIGH LT 0).DEFAULT                                     00175
         AIF   (&HIGH GT 15).DEFAULT                                    00176
         AGO   .GEN                                                     00177
.DONE    MEXIT                                                          00178
         MEND                                                           00179
         MACRO                                                          00180
         FILL   &TAG,&FILL=C' '                                         00181
         LCLA  &LTAG                                                    00182
.*             AUTHOR.   DON HIGGINS.                                   00183
.*             DATE.     09/16/71.                                      00184
.*             REMARKS.  FILL REMAINDER OF AREA WITH FILL CHARACTER.    00185
&LTAG    SETA  L'&TAG                                                   00186
         DC    (&LTAG)&FILL                                             00187
         ORG   &TAG+&LTAG                                               00188
         MEND                                                           00189
         MACRO                                                          00190
&NAME    IOB   &FLAGS=,&ECB=,&CCW=,&DCB=,&ID=                           00191
.*             AUTHOR.   DON HIGGINS.                                   00192
.*             DATE.     11/23                                          00193
.*             REMARKS.  INPUT/OUTPUT CONTROL BLOCK MACRO.              00194
.*                       REF. SYS. PROG. GUIDE C28-6550-6 PG 139        00195
.*                                                                      00196
&NAME    DS    0F                                                       00197
         DC    &FLAGS         FLAGS 1  0-CD 1-CC 6-NOT REL 23457-RESV   00198
         DC    XL1'00'        FLAGS 2  RESERVED                         00199
SNS&ID   DC    XL2'00'        FIRST TWO SENSE BYTES AFTER UNIT CHECK    00200
         DC    XL1'00'        ECB CODE                                  00201
ECB&ID   DC    AL3(&ECB)      EVENT CONTROL BLOCK ADDRESS               00202
         DC    XL1'00'        FLAGS 3 RESERVED                          00203
CSW&ID   DC    XL7'00'        CHANNEL STATUS WORD (LOW ORDER 7 BYTES)   00204
         DC    XL1'00'        SIO CODE (INS LENGTH X CONDITION CODE)    00205
CCW&ID   DC    AL3(&CCW)      CHANNEL COMMAND WORD ADDRESS              00206
         DC    XL1'00'        RESERVED                                  00207
DCB&ID   DC    AL3(&DCB)      DATA CONTROL BLOCK ADDRESS                00208
         DC    XL1'00'        REPOSITION MODIFIER                       00209
         DC    AL3(0)         RESTART ADDRESS                           00210
         DC    H'0'           BLOCK COUNT INCREMENT                     00211
         DC    H'0'           ERROR COUNTS                              00212
         DC    XL1'00'        M - EXTENT ENTRY IN DEB                   00213
         DC    XL7'00'        SEEK ADDRESS BBCCHHR                      00214
         MEND                                                           00215
         MACRO                                                          00216
&N       PENTRY                                                         00217
.*             AUTHOR.   DON HIGGINS.                                   00218
.*             DATE.     01/06/75.                                      00219
.*             REMARKS.  PERFORM ROUTINE ENTRY POINT WITH TRACE OPTION. 00220
.*                       SEE PTRACE MACRO FOR TRACE INFO.               00221
         GBLB  &PTRACE                                                  00222
         GBLC  &PTNAME                                                  00223
         GBLC  &PENAME                                                  00224
&PENAME  SETC  '&N'                                                     00225
         DC    0H'0',CL8'&N'                                            00226
         B     *+4                                                      00227
&N       EQU   *                                                        00228
         AIF   (&PTRACE EQ 0).NOTRACE                                   00229
         PM    &PTNAME                                                  00230
.NOTRACE ANOP                                                           00231
         MEND                                                           00232
         MACRO                                                          00233
&N       PERFORM &PENTRY                                                00234
&N       MVC   &PENTRY-2(2),*+10                                        00235
         B     &PENTRY                                                  00236
         DC    S(*+2)                                                   00237
         MEND                                                           00238
         MACRO                                                          00239
&N       PEXIT                                                          00240
         GBLC  &PENAME                                                  00241
&N       B     &PENAME-4                                                00242
         MEND                                                           00243
         MACRO                                                          00244
&NAME    SCALL &SUBNAME,&ARGLIST                                        00245
.*             AUTHOR.   DON HIGGINS.                                   00246
.*             DATE.     11/09/70.                                      00247
.*             REMARKS.  SHORT FORM OF IBM CALL MACRO WITH NO VL.       00248
         AIF   (T'&ARGLIST EQ 'O').NOARG                                00249
&NAME    LA    1,=A&ARGLIST        LOAD ARGUMENT LIST ADDRESS           00250
         L     15,=V(&SUBNAME)     LOAD SUBPROGRAM ENTRY ADDRESS        00251
         BALR  14,15               BRANCH AND LINK                      00252
         MEXIT                                                          00253
.NOARG   ANOP                                                           00254
&NAME    L     15,=V(&SUBNAME)     LOAD SUBPROGRAM ENTRY ADDRESS        00255
         BALR  14,15               BRANCH AND LINK                      00256
         MEND                                                           00257
         MACRO                                                          00258
&NAME    SUBENTRY &CSECT=YES,&BASES=(13),                              X00259
               &RENT=NO,&RWA=,&RWALNG=0,&SP=0                           00260
         LCLA  &NBASE,&S,&OFFSET                                        00261
.*             MACRO-ID. 'SUBENTRY'                                     00262
.*             AUTHOR.   DON HIGGINS.                                   00263
.*             DATE WRITTEN.  07/28/70.                                 00264
.*             REMARKS.  THIS MACRO GENERATES THE CODE TO ESTABLISH A   00265
.*                       CSECT WITH SAVE AREA AND BASE REGISTER USING   00266
.*                       STANDARD OS LINKAGE CONVENTIONS.               00267
.*             REV1 11/14/74 ADD REENTRANT OPTION WITH WORK AREA        00268
.*                 1.  FOR REENTRANT LINKAGE YOU MUST SPECIFY           00269
.*                     A.  RENT=YES                                     00270
.*                     B.  AT LEAST ONE BASE REGISTER OTHER THAN 13     00271
.*                         SUCH AS BASES=(R12)                          00272
.*                 2.  OPTIONALLY YOU CAN SPECIFY A DSECT NAME AND      00273
.*                     LENGTH FOR A WORK AREA BUILT BEHIND SAVE AREA.   00274
.*                     FOR EXAMPLE  RWADSECT=MYWORK,RWALNG=8            00275
.*                     NOTE THAT THIS WORK AREA LENGTH MUST ALSO BE     00276
.*                     SPECIFIED AT SUBEXIT TIME TO CORRECTLY CALCULATE 00277
.*                     THE FREEMAIN LENGTH.                             00278
.*             REV2 02/10/76 DSH - ADD SUBPOOL OPTION                   00279
         AIF   ('&CSECT'(1,1) EQ 'N').NOCSECT                           00280
&NAME    CSECT                                                          00281
         AGO   .STM                                                     00282
.NOCSECT ANOP                                                           00283
&NAME    DS    0D                                                       00284
.STM     ANOP                                                           00285
         AIF   ('&RENT'(1,1) EQ 'N').NORENT                             00286
.RENT    ANOP                                                           00287
         STM   14,12,12(13)                                             00288
         BAL   &BASES(1),16(15)                                         00289
         USING &NAME+8,&BASES(1)                                        00290
         DC    CL8'&NAME'                                               00291
         LA    0,72+&RWALNG                                             00292
         AIF   ('&SP' EQ '0').SKIPSP                                    00293
         LA    1,&SP                                                    00294
         SLL   1,24                                                     00295
         OR    0,1                                                      00296
.SKIPSP  ANOP                                                           00297
         GETMAIN R,LV=(0)                                               00298
         ST    1,8(13)                                                  00299
         ST    13,4(1)                                                  00300
         LM    14,1,12(13)                                              00301
         L     13,8(13)                                                 00302
         AIF   ('&RWALNG' EQ '0').GEN                                   00303
         USING &RWA-72,13                                               00304
         AGO   .GEN                                                     00305
.NORENT  ANOP                                                           00306
         STM   14,12,12(13)                                             00307
         BAL   15,88(15)                                                00308
         DC    9D'0'                                                    00309
         DC    CL8'&NAME'                                               00310
         ST    15,8(13)                                                 00311
         ST    13,4(15)                                                 00312
         LR    13,15                                                    00313
         AIF   (T'&BASES(1) NE 'N').CHKR13                              00314
         AIF   (&BASES(1) EQ 13).GENB13                                 00315
         AGO   .GENBX                                                   00316
.CHKR13  ANOP                                                           00317
         AIF   ('&BASES'(2,3) EQ 'R13').GENB13                          00318
.GENBX   ANOP                                                           00319
         LR    &BASES(1),13                                             00320
         USING &NAME+8,&BASES(1)                                        00321
         AGO   .GEN                                                     00322
.GENB13  ANOP                                                           00323
         USING &NAME+8,13                                               00324
.GEN     ANOP                                                           00325
&NBASE   SETA  N'&BASES                                                 00326
&S       SETA  1                                                        00327
.L1      ANOP                                                           00328
&S       SETA  &S+1                                                     00329
         AIF   (&S GT &NBASE).EXIT                                      00330
&OFFSET  SETA  &OFFSET+4095                                             00331
         LA    &BASES(&S),4095(&BASES(&S-1))                            00332
         USING &NAME+8+&OFFSET,&BASES(&S)                               00333
         AGO   .L1                                                      00334
.EXIT    ANOP                                                           00335
         MEND                                                           00336
         MACRO                                                          00337
&NAME    SUBEXIT &RC=0,&RENT=NO,&RWALNG=0,&SP=0                         00338
.*             MACRO-ID. 'SUBEXIT'.                                     00339
.*             AUTHOR.   DON HIGGINS.                                   00340
.*             DATE WRITTEN.  07/28/70.                                 00341
.*             REMARKS.  THIS MACRO GENERATES THE CODE TO RESTORE       00342
.*                       REGISTERS AND RETURN FROM A CSECT.  A RETURN   00343
.*                       CODE OF ZERO IS RETURNED UNLESS A DIFFERENT    00344
.*                       CODE IS SPECIFIED USING THE KEY WORD RC=.      00345
.*             REV1 11/14/74 ADD REENTRANT OPTION. SEE SUBENTRY.        00346
.*             REV2 12/09/74 ADD REG OPTION FOR RC OPERAND.             00347
.*             REV3 02/10/76 DSH - ADD SUBPOOL OPTION                   00348
         AIF   ('&RC'(1,1) EQ '(').RCREG                                00349
         LA    15,&RC                                                   00350
         AGO   .CHKRENT                                                 00351
.RCREG   ANOP                                                           00352
         LR    15,&RC                                                   00353
.CHKRENT ANOP                                                           00354
         AIF   ('&RENT'(1,1) EQ 'N').NORENT                             00355
.RENT    ANOP                                                           00356
&NAME    L     13,4(13)                                                 00357
         STM   15,1,16(13)                                              00358
         LA    0,72+&RWALNG                                             00359
         AIF   ('&SP' EQ '0').SKIPSP                                    00360
         LA    1,&SP                                                    00361
         SLL   1,24                                                     00362
         OR    0,1                                                      00363
.SKIPSP  ANOP                                                           00364
         L     1,8(13)                                                  00365
         FREEMAIN R,LV=(0),A=(1)                                        00366
         LM    14,12,12(13)                                             00367
         BR    14                                                       00368
         AGO   .EXIT                                                    00369
.NORENT  ANOP                                                           00370
&NAME    L     13,4(13)                                                 00371
         L     14,12(13)                                                00372
         LM    2,12,28(13)                                              00373
         BR    14                                                       00374
.EXIT    ANOP                                                           00375
         MEND                                                           00376
         MACRO                                                          00377
&N       SYSIN                                                          00378
&N       DCB   DSORG=PS,MACRF=GM,DDNAME=&N,RECFM=FB,LRECL=80            00379
         MEND                                                           00380
         MACRO                                                          00381
&N       SYSPRINT                                                       00382
&N       DCB   DSORG=PS,MACRF=PM,DDNAME=&N,RECFM=FA,BLKSIZE=133         00383
         MEND                                                           00384
         MACRO                                                          00385
&NAME    TAG                                                            00386
&NAME    DS    0H                                                       00387
         MEND                                                           00388
         MACRO                                                          00389
&M       MOVE  &A,&B                                                    00390
         LCLA  &S,&L                                                    00391
&L       SETA  L'&A                                                     00392
.LOOP    ANOP                                                           00393
         AIF   (&L LE 256).LAST                                         00394
&M       MVC   &A+&S.(256),&B+&S                                        00395
&S       SETA  &S+256                                                   00396
&L       SETA  &L-256                                                   00397
         AGO   .LOOP                                                    00398
.LAST    ANOP                                                           00399
         MVC   &A+&S.(&L),&B+&S                                         00400
         MEND                                                           00401
         MACRO                                                          00402
&N       LT    &R,&X                                                    00403
&N       L     &R,&X                                                    00404
         LTR   &R,&R                                                    00405
         MEND                                                           00406
         MACRO                                                          00407
         EQUAL                                                          00408
*              COMMON EQU'S AND LITERALS                                00409
*                                                                       00410
*              EQU'S FOR REGISTERS                                      00411
         EQUREGS                                                        00412
*              EQU'S FOR IMMEDIATE DATA INSTRUCTIONS                    00413
         EQUI                                                           00414
*              LITERAL POOL                                             00415
*              EQU'S FOR BRANCH ON CONDITIONS                           00416
         EQUBC                                                          00417
         LTORG                                                          00418
         MEND                                                           00419
         MACRO                                                          00420
         EQUI                                                           00421
         GBLA  &N,&V(20)                                                00422
.LOOP    ANOP                                                           00423
         AIF   (&N EQ 0).EXIT                                           00424
#&V(&N)  EQU   &V(&N)                                                   00425
&N       SETA  &N-1                                                     00426
         AGO   .LOOP                                                    00427
.EXIT    MEND                                                           00428
         MACRO                                                          00429
         XREFI &I                                                       00430
         GBLA  &N,&V(20)                                                00431
         LCLA  &S,&K,&NK                                                00432
&NK      SETA  N'&I                                                     00433
.LOOP1   ANOP                                                           00434
&K       SETA  &K+1                                                     00435
         AIF   (&K GT &NK).EXIT                                         00436
         AIF   (&N EQ 0).ADD                                            00437
&S       SETA  0                                                        00438
.LOOP2   ANOP                                                           00439
&S       SETA  &S+1                                                     00440
         AIF   (&I(&K) EQ &V(&S)).REF                                   00441
         AIF   (&S LT &N).LOOP2                                         00442
.ADD     ANOP                                                           00443
         AIF   (&N EQ 20).ERR                                           00444
&N       SETA  &N+1                                                     00445
&V(&N)   SETA  &I(&K)                                                   00446
.REF     ANOP                                                           00447
         AGO   .LOOP1                                                   00448
.ERR     MNOTE 4,'IMMEDIATE DATA XREF TABLE OVERFLOW'                   00449
.EXIT    MEND                                                           00450
         MACRO                                                          00451
&N       LI    &R,&I                                                    00452
         AIF   (&I LT 1).ERR                                            00453
         AIF   (&I GT 32767).ERR                                        00454
         XREFI &I                                                       00455
         AIF   (&I GT 4095).LHI                                         00456
&N       LA    &R,#&I                                                   00457
         MEXIT                                                          00458
.LHI     ANOP                                                           00459
&N       LH    &R,*+6                                                   00460
         DC    X'4700',AL2(#&I)                                         00461
         MEXIT                                                          00462
.ERR     MNOTE 4,'IMMEDIATE DATA NOT 1-32767'                           00463
         MEND                                                           00464
         MACRO                                                          00465
&N       AI    &R,&I                                                    00466
         AIF   (&I LT 1).ERR                                            00467
         AIF   (&I GT 32767).ERR                                        00468
         XREFI &I                                                       00469
&N       AH    &R,*+6                                                   00470
         DC    X'4700',AL2(#&I)                                         00471
         MEXIT                                                          00472
.ERR     MNOTE 4,'IMMEDIATE DATA NOT 1-32767'                           00473
         MEND                                                           00474
         MACRO                                                          00475
&N       SI    &R,&I                                                    00476
         AIF   (&I LT 1).ERR                                            00477
         AIF   (&I GT 32767).ERR                                        00478
         XREFI &I                                                       00479
         AIF   (&I GT 2).SHI                                            00480
&N       BCTR  &R,0                                                     00481
         DC    0AL2(#&I)                                                00482
         AIF   (&I EQ 1).EXIT                                           00483
         BCTR  &R,0                                                     00484
.EXIT    MEXIT                                                          00485
.SHI     ANOP                                                           00486
&N       SH    &R,*+6                                                   00487
         DC    X'4700',AL2(#&I)                                         00488
         MEXIT                                                          00489
.ERR     ANOP                                                           00490
         MNOTE 4,'IMMEDIATE DATA NOT 1-32767'                           00491
         MEND                                                           00492
         MACRO                                                          00493
&N       TB    &FIELD,&BITS                                             00494
         LCLA  &NBITS,&B(8),&S                                          00495
&NBITS   SETA  N'&BITS                                                  00496
         AIF   (&NBITS LT 1).ERR                                        00497
         AIF   (&NBITS GT 8).ERR                                        00498
.LOOP    ANOP                                                           00499
&S       SETA  &BITS(&NBITS)                                            00500
         AIF   (&S LT 0).ERR                                            00501
         AIF   (&S GT 7).ERR                                            00502
&B(&S+1) SETA  1                                                        00503
&NBITS   SETA  &NBITS-1                                                 00504
         AIF   (&NBITS GT 0).LOOP                                       00505
&N       TM    &FIELD,B'&B(1)&B(2)&B(3)&B(4)&B(5)&B(6)&B(7)&B(8)'       00506
         MEXIT                                                          00507
.ERR     MNOTE 8,'INVALID BIT SPECIFICATION'                            00508
         MEND                                                           00509
         MACRO                                                          00510
&N       SB    &FIELD,&BITS                                             00511
         LCLA  &NBITS,&B(8),&S                                          00512
&NBITS   SETA  N'&BITS                                                  00513
         AIF   (&NBITS LT 1).ERR                                        00514
         AIF   (&NBITS GT 8).ERR                                        00515
.LOOP    ANOP                                                           00516
&S       SETA  &BITS(&NBITS)                                            00517
         AIF   (&S LT 0).ERR                                            00518
         AIF   (&S GT 7).ERR                                            00519
&B(&S+1) SETA  1                                                        00520
&NBITS   SETA  &NBITS-1                                                 00521
         AIF   (&NBITS GT 0).LOOP                                       00522
&N       OI    &FIELD,B'&B(1)&B(2)&B(3)&B(4)&B(5)&B(6)&B(7)&B(8)'       00523
         MEXIT                                                          00524
.ERR     MNOTE 8,'INVALID BIT SPECIFICATION'                            00525
         MEND                                                           00526
         MACRO                                                          00527
&N       ZB    &FIELD,&BITS                                             00528
         LCLA  &NBITS,&B(8),&S                                          00529
&NBITS   SETA  N'&BITS                                                  00530
         AIF   (&NBITS LT 1).ERR                                        00531
         AIF   (&NBITS GT 8).ERR                                        00532
.LOOP    ANOP                                                           00533
&S       SETA  &BITS(&NBITS)                                            00534
         AIF   (&S LT 0).ERR                                            00535
         AIF   (&S GT 7).ERR                                            00536
&B(&S+1) SETA  1                                                        00537
&NBITS   SETA  &NBITS-1                                                 00538
         AIF   (&NBITS GT 0).LOOP                                       00539
&N       NI    &FIELD,X'FF'-B'&B(1)&B(2)&B(3)&B(4)&B(5)&B(6)&B(7)&B(8)' 00540
         MEXIT                                                          00541
.ERR     MNOTE 8,'INVALID BIT SPECIFICATION'                            00542
         MEND                                                           00543
         MACRO                                                          00544
&N       XCH   &A,&B                                                    00545
&N       XC    &A,&B                                                    00546
         XC    &B,&A                                                    00547
         XC    &A,&B                                                    00548
         MEND                                                           00549
         MACRO                                                          00550
&N       XCHR  &A,&B                                                    00551
&N       XR    &A,&B                                                    00552
         XR    &B,&A                                                    00553
         XR    &A,&B                                                    00554
         MEND                                                           00555
         MACRO                                                          00556
&N       ZR    &R                                                       00557
&N       SR    &R,&R                                                    00558
         MEND                                                           00559
         MACRO                                                          00560
&N       AAI   &R,&I                                                    00561
         AIF   (&I LT 1).ERR                                            00562
         AIF   (&I GT 32767).ERR                                        00563
         XREFI &I                                                       00564
         AIF   (&I GT 4095).AHI                                         00565
&N       LA    &R,#&I.(&R)                                              00566
         MEXIT                                                          00567
.AHI     ANOP                                                           00568
&N       AH    &R,*+6                                                   00569
         DC    X'4700',AL2(#&I)                                         00570
         MEXIT                                                          00571
.ERR     MNOTE 4,'IMMEDIATE DATA NOT 1-32767'                           00572
         MEND                                                           00573
         MACRO                                                          00574
&N       SRC   &R                                                       00575
         LTR   &R,&R                                                    00576
         MEND                                                           00577
         MACRO                                                          00578
&N       ZHB   &R                                                       00579
&N       LA    &R,0(&R)                                                 00580
         MEND                                                           00581
         MACRO                                                          00582
         SPOOLDAT                                                       00583
.*             AUTHOR.   DON HIGGINS.                                   00584
.*             DATE.     03/12/73.                                      00585
.*             REMARKS.  DEFINE HASP 3.1 CHECKPOINT DATA AREAS ON 2314. 00586
.*             REFERENCES.                                              00587
.*                 1.    GY27-7255 HASP V4 PLM                          00588
.*                 2.    GC27-6992 HASP SYS. PGMR. GUIDE                00589
.*                 3.    SEE GU019800 FOR SAMPLE PROGRAM USING THIS.    00590
.*             REV1 01/28/74 - REVISE FOR 3330 DISKS.                   00591
.*             REV2 01/09/75 - REVISE FOR HASP V4.0 (VS2-R1.7)          00592
*              REV3 /                                                   00593
*              REV3 03/15/76 DSH - MAKE CHECKPOINT MTTRS RELATIVE       00594
*                                                                       00595
*              THE FOLLOWING STATEMENTS MUST PRECEED THIS MACRO         00596
*                                                                       00597
*              COPY $GLOBAL                                             00598
*              COPY $HASPGEN                                            00599
*              $HASPCB JOT,PRC (OTHER CONTROL BLOCKS ARE OPTIONAL)      00600
*                                                                       00601
*              SEE GY27-7255 HASP PLM 7-49 FOR FURTHER INFO.            00602
*                                                                       00603
         GBLA  &MAXJOBS  MAXIMUM JOBS ALLOWED IN HASP SYSTEM AT ONCE    00604
         GBLA  &NUMPRC   NUMBER OF PRINT/PUNCH CHECKPOINT RECORDS       00605
         GBLA  &JITSIZE  JOB INFORMATION TABLE ELEMENT SIZE             00606
*                                                                       00607
*              CHECKPOINT MTTRS                                         00608
*                                                                       00609
*                   THESE MTTRS ARE CODED AS RELATIVE TRACK AND         00610
*                   ARE CONVERTED TO ABSOLUTE TRACK BY HASPXDAP         00611
*                   (GU019600) ON FIRST CALL.                           00612
*                   HIGH BIT ON INDICATES RELATIVE TRACK.               00613
*                                                                       00614
CKP1MTTR DC    X'80000001'    JOBQUE AND MISC. ON FIRST TRACK           00615
CKP2MTTR DC    X'80000101'    JIT                                       00616
CKP3MTTR DC    X'80000201'    JOT                                       00617
*                                                                       00618
*              CHECKPOINT RECORD AREAS                                  00619
*                                                                       00620
CKP1REC  DS    0D        JOB QUEUE AND MISC INFO                        00621
$JOBQUE  DC    (&MAXJOBS)XL16'00'                                       00622
$SAVEBEG DS    0F                                                       00623
$JOBQPTR DC    A(*-*)    CORE ADDRESS OF HASP JOB QUEUE                 00624
$JQFREE  DC    A(*-*)    FREE QUEUE CHAIN                               00625
$JQENT   DC    A(*-*)    ACTIVE QUEUE CHAIN                             00626
$DATAKEY DC    F'0'      MASTER PERIPHERAL DATA SET KEY                 00627
$JOBNO   DC    H'0'      HASP JOB NUMBER                                00628
$MSGRPNO DC    H'0'      LAST CONSOLE MESSAGE TRACK GROUP               00629
$DACKPT  DC    1XL6'0'   DA CHECKPOINT FOR WARM START                   00630
$SAVEEND EQU   *                                                        00631
$SAVELEN EQU   $SAVEEND-$SAVEBEG                                        00632
$PRCRECS DC    (&NUMPRC)XL(PRCSIZE)'00'                                 00633
CKP1LNG  EQU   *-CKP1REC                                                00634
CKP2REC  DS    0D        JOB INFORMATION TABLE                          00635
$JIT     DC    (&MAXJOBS)XL(&JITSIZE)'00'                               00636
CKP2LNG  EQU   *-CKP2REC                                                00637
CKP3REC  DS    0D        JOB OUTPUT TABLE                               00638
$JOTREC  DC    (JOTSIZE)X'00'                                           00639
CKP3LNG  EQU   *-CKP3REC                                                00640
         MEND                                                           00641
         MACRO                                                          00642
&N       XCP   &IOB,&CCW,&ERR                                           00643
&N       LA    R0,&CCW                                                  00644
         ST    R0,&IOB+16                                               00645
         EXCP  &IOB                                                     00646
         L     R1,&IOB+4                                                00647
         WAIT  ECB=(1)                                                  00648
         TM    &IOB+12,X'03'                                            00649
         BNZ   &ERR                                                     00650
         TM    &IOB+13,X'FF'                                            00651
         BNZ   &ERR                                                     00652
         MEND                                                           00653
         MACRO                                                          00654
&N       MC    &S1,&I2                                                  00655
&N       CLI   &S1,&I2                                                  00656
         ORG   *-4                                                      00657
         DC    X'AF'                                                    00658
         ORG   *+3                                                      00659
         MEND                                                           00660
         MACRO                                                          00661
&N       CDS   &R1,&R3,&S                                               00662
&N       LM    &R1,&R3,&S                                               00663
         ORG   *-4                                                      00664
         DC    X'BB'                                                    00665
         ORG   *+3                                                      00666
         MEND                                                           00667
         MACRO                                                          00668
&N       CS    &R1,&R3,&S2                                              00669
&N       LM    &R1,&R3,&S2                                              00670
         ORG   *-4                                                      00671
         DC    X'BA'                                                    00672
         ORG   *+3                                                      00673
         MEND                                                           00674
         MACRO                                                          00675
         IF                                                             00676
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           00677
         GBLA  &ELSEIF(10)                                              00678
         LCLA  &N,&M,&S,&LAB1,&L,&I                                     00679
         LCLC  &OP,&OPR                                                 00680
         LCLB  &TESTSW                                                  00681
.*             AUTHOR.   DON HIGGINS.                                   00682
.*             DATE.     03/27/74.                                      00683
.*             REMARKS.  CONTROL STRUCTURE FOR CONDITIONAL EXECUTION.   00684
.*             REV1 05/23/76 DSH - SUPPORT ELSEIF.                      00685
         AIF   (&LEVEL EQ 10).ERR1                                      00686
&LEVEL   SETA  &LEVEL+1                                                 00687
&ELSEIF(&LEVEL) SETA 0                                                  00688
&SEQ(&LEVEL) SETA 1                                                     00689
&LAB     SETA  &LAB+1                                                   00690
&ELSE(&LEVEL) SETA &LAB                                                 00691
&N       SETA N'&SYSLIST                                                00692
.NEXTAND ANOP                                                           00693
&TESTSW  SETB  0                                                        00694
.TEST    ANOP                                                           00695
&S       SETA  &S+1                                                     00696
         AIF   (&S GT &N).ERR2                                          00697
&M       SETA  N'&SYSLIST(&S)                                           00698
         AIF   (&M EQ 1).TESTEND                                        00699
         AIF   (&M LT 2).ERR3                                           00700
         AIF   (&M GT 5).ERR4                                           00701
&I       SETA  2                                                        00702
&OPR     SETC  ''                                                       00703
&OP      SETC  '&SYSLIST(&S,1)'                                         00704
         AIF   (&M GT 2).TESTOPR                                        00705
         &OP                                                            00706
         AGO   .TESTEND                                                 00707
.TESTOPR ANOP                                                           00708
         AIF   ('&SYSLIST(&S,&I)'(1,1) NE '''').NOLIT                   00709
&L       SETA  K'&SYSLIST(&S,&I)                                        00710
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'(2,&L-2)                         00711
         AGO   .NEXTOPR                                                 00712
.NOLIT   ANOP                                                           00713
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'                                 00714
.NEXTOPR ANOP                                                           00715
&I       SETA  &I+1                                                     00716
         AIF   (&I EQ &M).TESTGEN                                       00717
&OPR     SETC  '&OPR'.','                                               00718
         AGO   .TESTOPR                                                 00719
.TESTGEN ANOP                                                           00720
         &OP   &OPR                                                     00721
.TESTEND ANOP                                                           00722
         AIF   (&TESTSW EQ 1).ORBC                                      00723
.AMBC    ANOP                                                           00724
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               00725
.CONNECT ANOP                                                           00726
&S       SETA  &S+1                                                     00727
         AIF   (&S GT &N).EXIT                                          00728
&M       SETA  N'&SYSLIST(&S)                                           00729
         AIF   (&M NE 1).ERR5  BAD CONNECTOR                            00730
         AIF   ('&SYSLIST(&S)' EQ 'AND').NEXTAND                        00731
         AIF   ('&SYSLIST(&S)' NE 'OR').ERR5  BAD CONNECTOR             00732
.NEXTOR   ANOP                                                          00733
&LAB1    SETA  &LAB+1                                                   00734
         B     IF0&LAB1  SKIP TEST IF LAST ONE TRUE                     00735
IF0&LAB   EQU *          DO TEST IF LAST ONE FALSE                      00736
&LAB     SETA  &LAB+2                                                   00737
&ELSE(&LEVEL) SETA &LAB                                                 00738
&TESTSW  SETB  1                                                        00739
         AGO   .TEST                                                    00740
.ORBC    ANOP                                                           00741
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               00742
IF0&LAB1 EQU *                                                          00743
         AGO   .CONNECT                                                 00744
.ERR1    MNOTE 8,'IF - LEVEL OVERFLOW'                                  00745
         AGO   .EXIT                                                    00746
.ERR2    MNOTE 8,'IF - MISSING TEST LIST'                               00747
         AGO   .EXIT                                                    00748
.ERR3    MNOTE 8,'IF - TEST LIST TOO SHORT'                             00749
         AGO   .EXIT                                                    00750
.ERR4    MNOTE 8,'IF - TEST LIST TOO LONG'                              00751
         AGO   .EXIT                                                    00752
.ERR5    MNOTE 8,'IF - INVALID CONNECTOR'                               00753
.EXIT    ANOP                                                           00754
         MEND                                                           00755
         MACRO                                                          00756
         THEN  &OPT                                                     00757
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           00758
.*             AUTHOR.   DON HIGGINS.                                   00759
.*             DATE.     03/27/74.                                      00760
.*             REMARKS.  MACRO TO ALLOW STRUCTURED PROGRAMMING USING    00761
.*                       IF, THEN, ELSE, AND DO UP TO TEN LEVELS DEEP   00762
.*                       AND NO BRANCH INSTRUCTIONS. SEE IF MACRO.      00763
         AIF   (&LEVEL EQ 0).ERR0                                       00764
         AIF   ('&OPT' EQ 'BEGIN').BEGIN                                00765
         AIF   ('&OPT' EQ 'END').END                                    00766
         MNOTE 4,'THEN - INVALID OPERAND - IGNORED'                     00767
         AGO   .EXIT                                                    00768
.BEGIN   ANOP                                                           00769
         AIF   (&SEQ(&LEVEL) NE 1).ERR1                                 00770
&SEQ(&LEVEL) SETA 2                                                     00771
         AGO   .EXIT                                                    00772
.END     ANOP                                                           00773
         AIF   (&SEQ(&LEVEL) NE 2).ERR2                                 00774
&SEQ(&LEVEL) SETA 3                                                     00775
         AGO   .EXIT                                                    00776
.ERR0    MNOTE 8,'THEN - MISSING IF'                                    00777
         AGO   .EXIT                                                    00778
.ERR1    MNOTE 4,'THEN BEGIN - OUT OF SEQUENCE'                         00779
         AGO   .EXIT                                                    00780
.ERR2    MNOTE 4,'THEN END - OUT OF SEQUENCE'                           00781
.EXIT    ANOP                                                           00782
         MEND                                                           00783
         MACRO                                                          00784
         ELSE  &OPT                                                     00785
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           00786
         GBLA  &ELSEIF(10)                                              00787
.*             AUTHOR.   DON HIGGINS.                                   00788
.*             DATE.     03/27/74.                                      00789
.*             REMARKS.  MACRO TO ALLOW STRUCTURED PROGRAMMING USING    00790
.*                       IF, THEN, ELSE, AND DO UP TO TEN LEVELS DEEP   00791
.*                       AND NO BRANCH INSTRUCTIONS. SEE IF MACRO.      00792
.*             REV1 05/23/76 DSH - SUPPORT ELSEIF                       00793
         AIF   (&LEVEL EQ 0).ERR0                                       00794
         AIF   (T'&OPT EQ 'O').BEGIN                                    00795
         AIF   ('&OPT' EQ 'BEGIN').BEGIN                                00796
         AIF   ('&OPT' EQ 'END').END                                    00797
         AIF   ('&OPT' EQ 'CONTINUE').CONT                              00798
         MNOTE 8,'ELSE - INVALID OPERAND'                               00799
         AGO   .EXIT                                                    00800
.BEGIN   ANOP                                                           00801
         AIF   (&SEQ(&LEVEL) GT 3).ERR1                                 00802
&LAB     SETA  &LAB+1                                                   00803
         B     IF0&LAB                                                  00804
IF0&ELSE(&LEVEL) EQU *                                                  00805
&ELSE(&LEVEL) SETA &LAB                                                 00806
&SEQ(&LEVEL) SETA 4                                                     00807
         AGO .EXIT                                                      00808
.END     ANOP                                                           00809
         AIF   (&SEQ(&LEVEL) NE 4).ERR2                                 00810
.DEQUE   ANOP                                                           00811
IF0&ELSE(&LEVEL) EQU *                                                  00812
&LEVEL   SETA &LEVEL-1                                                  00813
         AIF   (&ELSEIF(&LEVEL+1) EQ 1).DEQUE                           00814
         AGO   .EXIT                                                    00815
.CONT    ANOP                                                           00816
         AIF   (&SEQ(&LEVEL) GT 3).ERR3                                 00817
         AGO   .DEQUE                                                   00818
.ERR0    MNOTE 8,'ELSE - MISSING IF'                                    00819
         AGO   .EXIT                                                    00820
.ERR1    MNOTE 8,'ELSE BEGIN - OUT OF SEQUENCE'                         00821
         AGO   .EXIT                                                    00822
.ERR2    MNOTE 8,'ELSE END - OUT OF SEQUENCE'                           00823
         AGO   .EXIT                                                    00824
.ERR3    MNOTE 8,'ELSE CONTINUE - OUT OF SEQUENCE'                      00825
.EXIT    ANOP                                                           00826
         MEND                                                           00827
         MACRO                                                          00828
         DO                                                             00829
         GBLA  &DO(10),&DOSEQ(10),&DOLVL,&DOLAB                         00830
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           00831
         LCLA  &N,&M,&S,&LAB1,&L,&I                                     00832
         LCLA  &UNTIL                                                   00833
         LCLC  &OP,&OPR                                                 00834
         LCLB  &TESTSW                                                  00835
.*             AUTHOR.   DON HIGGINS.                                   00836
.*             DATE.     03/27/74.                                      00837
.*             REMARKS.  MACRO TO ALLOW STRUCTURED PROGRAMMING USING    00838
.*                       IF, THEN, ELSE, AND DO UP TO TEN LEVELS DEEP   00839
.*                       AND NO BRANCH INSTRUCTIONS. SEE IF MACRO.      00840
         AIF   (&DOLVL EQ 10).ERR1                                      00841
&N       SETA  N'&SYSLIST                                               00842
         AIF   (&N LT 1).ERR2                                           00843
         AIF   ('&SYSLIST(1)' EQ 'END').END                             00844
         AIF   ('&SYSLIST(1)' EQ 'FOREVER').WHILE                       00845
         AIF   (&N LT 2).ERR2                                           00846
         AIF   ('&SYSLIST(1)' EQ 'WHILE').WHILE                         00847
         AIF   ('&SYSLIST(1)' NE 'UNTIL').ERR3                          00848
.UNTIL   ANOP                                                           00849
&DOLVL   SETA  &DOLVL+1                                                 00850
&UNTIL   SETA  &DOLAB+1                                                 00851
&DOLAB   SETA  &DOLAB+2                                                 00852
         B     DO&UNTIL                                                 00853
         AGO   .COMM                                                    00854
.WHILE   ANOP                                                           00855
&DOLVL   SETA  &DOLVL+1                                                 00856
&DOLAB   SETA  &DOLAB+1                                                 00857
.COMM    ANOP                                                           00858
&DOSEQ(&DOLVL) SETA 1                                                   00859
&DO(&DOLVL) SETA &DOLAB                                                 00860
DO&DOLAB EQU   *                                                        00861
         AIF   (&LEVEL EQ 10).ERR1                                      00862
&LEVEL   SETA  &LEVEL+1                                                 00863
&SEQ(&LEVEL) SETA 1                                                     00864
&LAB     SETA  &LAB+1                                                   00865
&ELSE(&LEVEL) SETA &LAB                                                 00866
         AIF   ('&SYSLIST(1)' EQ 'FOREVER').EXIT                        00867
&S       SETA  1                                                        00868
.NEXTAND ANOP                                                           00869
&TESTSW  SETB  0                                                        00870
.TEST    ANOP                                                           00871
&S       SETA  &S+1                                                     00872
         AIF   (&S GT &N).ERR2                                          00873
&M       SETA  N'&SYSLIST(&S)                                           00874
         AIF   (&M LT 2).ERR3                                           00875
         AIF   (&M GT 5).ERR3                                           00876
&I       SETA  2                                                        00877
&OPR     SETC  ''                                                       00878
&OP      SETC  '&SYSLIST(&S,1)'                                         00879
         AIF   (&M GT 2).TESTOPR                                        00880
         &OP                                                            00881
         AGO   .TESTEND                                                 00882
.TESTOPR ANOP                                                           00883
         AIF   ('&SYSLIST(&S,&I)'(1,1) NE '''').NOLIT                   00884
&L       SETA  K'&SYSLIST(&S,&I)                                        00885
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'(2,&L-2)                         00886
         AGO   .NEXTOPR                                                 00887
.NOLIT   ANOP                                                           00888
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'                                 00889
.NEXTOPR ANOP                                                           00890
&I       SETA  &I+1                                                     00891
         AIF   (&I EQ &M).TESTGEN                                       00892
&OPR     SETC  '&OPR'.','                                               00893
         AGO   .TESTOPR                                                 00894
.TESTGEN ANOP                                                           00895
         &OP   &OPR                                                     00896
.TESTEND ANOP                                                           00897
         AIF   (&TESTSW EQ 1).ORBC                                      00898
.AMBC    ANOP                                                           00899
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               00900
.CONNECT ANOP                                                           00901
&S       SETA  &S+1                                                     00902
         AIF   (&S GT &N).CHKUNTL                                       00903
&M       SETA  N'&SYSLIST(&S)                                           00904
         AIF   (&M NE 1).ERR3  BAD CONNECTOR                            00905
         AIF   ('&SYSLIST(&S)' EQ 'AND').NEXTAND                        00906
         AIF   ('&SYSLIST(&S)' NE 'OR').ERR3  BAD CONNECTOR             00907
.NEXTOR   ANOP                                                          00908
&LAB1    SETA  &LAB+1                                                   00909
         B     IF0&LAB1  SKIP TEST IF LAST ONE TRUE                     00910
IF0&LAB   EQU *          DO TEST IF LAST ONE FALSE                      00911
&LAB     SETA  &LAB+2                                                   00912
&ELSE(&LEVEL) SETA &LAB                                                 00913
&TESTSW  SETB  1                                                        00914
         AGO   .TEST                                                    00915
.ORBC    ANOP                                                           00916
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               00917
IF0&LAB1 EQU *                                                          00918
         AGO   .CONNECT                                                 00919
.CHKUNTL ANOP                                                           00920
         AIF   (&UNTIL EQ 0).EXIT                                       00921
&LAB     SETA  &LAB+1                                                   00922
         B     IF0&LAB                                                  00923
IF0&ELSE(&LEVEL) EQU *                                                  00924
&ELSE(&LEVEL) SETA &LAB                                                 00925
DO&UNTIL EQU *                                                          00926
         AGO   .EXIT                                                    00927
.END     ANOP                                                           00928
         AIF   (&N GT 1).ERR3                                           00929
         AIF   (&DOLVL EQ 0).ERR4                                       00930
         AIF   (&DOSEQ(&DOLVL) NE 1).ERR4                               00931
&DOSEQ(&DOLVL) SETA 0                                                   00932
         B     DO&DO(&DOLVL)                                            00933
&DOLVL   SETA  &DOLVL-1                                                 00934
IF0&ELSE(&LEVEL) EQU *                                                  00935
&LEVEL   SETA  &LEVEL-1                                                 00936
         AGO   .EXIT                                                    00937
.ERR1    MNOTE 8,'DO - LEVEL OVERFLOW'                                  00938
         AGO   .EXIT                                                    00939
.ERR2    MNOTE 8,'DO - MISSING OPERAND'                                 00940
         AGO   .EXIT                                                    00941
.ERR3    MNOTE 8,'DO - INVALID OPERAND'                                 00942
         AGO   .EXIT                                                    00943
.ERR4    MNOTE 8,'DO - END OUT OF SEQUENCE'                             00944
.EXIT    ANOP                                                           00945
         MEND                                                           00946
         MACRO                                                          00947
         EQUBC                                                          00948
H        EQU   2                                                        00949
L        EQU   4                                                        00950
E        EQU   8                                                        00951
NH       EQU   13                                                       00952
NL       EQU   11                                                       00953
NE       EQU   7                                                        00954
O        EQU   1                                                        00955
P        EQU   2                                                        00956
M        EQU   4                                                        00957
Z        EQU   8                                                        00958
NP       EQU   13                                                       00959
NM       EQU   11                                                       00960
NZ       EQU   7                                                        00961
NO       EQU   14                                                       00962
EQ       EQU   8                                                        00963
GT       EQU   2                                                        00964
LT       EQU   4                                                        00965
GE       EQU   11                                                       00966
LE       EQU   13                                                       00967
         MEND                                                           00968
         MACRO                                                          00969
&N       FI                                                             00970
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           00971
         AIF   (&SEQ(&LEVEL) NE 4).CONT                                 00972
&N       ELSE  END                                                      00973
         MEXIT                                                          00974
.CONT    ANOP                                                           00975
&N       ELSE  CONTINUE                                                 00976
         MEND                                                           00977
         MACRO                                                          00978
&N       PM    &PENTRY                                                  00979
&N       MVC   &PENTRY-2(2),*+10                                        00980
         B     &PENTRY                                                  00981
         DC    S(*+2)                                                   00982
         MEND                                                           00983
         MACRO                                                          00984
&N       OD                                                             00985
&N       DO    END                                                      00986
         MEND                                                           00987
         MACRO                                                          00988
&N       DOCASE &INDEX                                                  00989
         GBLA  &DOCLVL,&DOCNO(10),&CASENO(10),&DOCELSE(10),&DOCNT       00990
.*             AUTHOR.   DON HIGGINS.                                   00991
.*             DATE.     07/02/74.                                      00992
.*             REMARKS.  SELECTION CONTROL STRUCTURE.                   00993
.*                       SEE DOCASE, CASE, ESAC, AND ESACOD.            00994
.*                       SEE 'STRUCTURED FORTRAN TRANSLATOR' IN         00995
.*                       IN 1975 FEBRUARY ACM SIGPLAN NOTICES.          00996
         AIF   (T'&INDEX EQ 'U').REG                                    00997
&N       ZR    R15                                                      00998
         IC    R15,&INDEX                                               00999
         AGO   .PROC                                                    01000
.REG     ANOP                                                           01001
&N       LR    R15,&INDEX                                               01002
.PROC    ANOP                                                           01003
         AIF   (&DOCLVL EQ 10).ERR1                                     01004
&DOCLVL  SETA  &DOCLVL+1                                                01005
&DOCNT   SETA  &DOCNT+1                                                 01006
&DOCNO(&DOCLVL) SETA &DOCNT                                             01007
&CASENO(&DOCLVL) SETA 0                                                 01008
&DOCELSE(&DOCLVL) SETA 0                                                01009
         IC    R15,CASEI&DOCNO(&DOCLVL).(R15)                           01010
         L     R15,CASEA&DOCNO(&DOCLVL).(R15)                           01011
         BR    R15                                                      01012
CASEI&DOCNO(&DOCLVL) DC 256X'00'                                        01013
         MEXIT                                                          01014
.ERR1    MNOTE 8,'DOCASE NESTED LEVELS EXCEEDED'                        01015
         MEND                                                           01016
         MACRO                                                          01017
         CASE                                                           01018
         GBLA  &DOCLVL,&DOCNO(10),&CASENO(10),&DOCELSE(10),&DOCNT       01019
         LCLA  &N,&M,&L,&H                                              01020
.*             AUTHOR.   DON HIGGINS.                                   01021
.*             DATE.     07/02/74.                                      01022
.*             REMARKS.  SELECTION CONTROL STRUCTURE.                   01023
.*                       SEE DOCASE, CASE, ESAC, AND ESACOD.            01024
.*                       SEE 'STRUCTURED FORTRAN TRANSLATOR' IN         01025
.*                       IN 1975 FEBRUARY ACM SIGPLAN NOTICES.          01026
.*             REV1 05/24/76 DSH - ALLOW SYMBOLIC FOR CASE VALUE.       01027
         AIF   (&DOCLVL LT 1).ERR1                                      01028
&N       SETA  N'&SYSLIST                                               01029
         AIF   (&N GT 1).CHKN                                           01030
&N       SETA  N'&SYSLIST(1)                                            01031
         AIF   (&N GT 1).CHKN                                           01032
         AIF   ('&SYSLIST(1)' EQ 'ELSE').ELSE                           01033
         AIF   ('&SYSLIST(1)' NE 'MISC').CHKN                           01034
.ELSE    AIF   (&DOCELSE(&DOCLVL) GT 0).ERR3                            01035
&DOCELSE(&DOCLVL) SETA 1                                                01036
DC&DOCNO(&DOCLVL)ELSE DS 0H                                             01037
         MEXIT                                                          01038
.CHKN    ANOP                                                           01039
         AIF   (&CASENO(&DOCLVL) EQ 63).ERR7                            01040
&CASENO(&DOCLVL) SETA &CASENO(&DOCLVL)+1                                01041
.MLOOP   ANOP                                                           01042
&M       SETA  &M+1                                                     01043
         AIF   (&M GT &N).GENL                                          01044
&L       SETA  N'&SYSLIST(&M)                                           01045
         AIF   (&L LT 1).MLOOP                                          01046
         AIF   (&L GT 2).ERR4                                           01047
         AIF   (&L EQ 1).GEN1                                           01048
         AIF   (T'&SYSLIST(&M,1) NE 'N').ERR5                           01049
         AIF   (T'&SYSLIST(&M,2) NE 'N').ERR5                           01050
&L       SETA  &SYSLIST(&M,1)                                           01051
&H       SETA  &SYSLIST(&M,2)                                           01052
         AIF   (&L GT &H).ERR6                                          01053
         AIF   (&H GT 255).ERR6                                         01054
         AIF   (&L LT 1).ERR6                                           01055
         ORG   CASEI&DOCNO(&DOCLVL)+&L                                  01056
         DC    (&H-&L+1)AL1(&CASENO(&DOCLVL)*4)                         01057
         AGO   .MLOOP                                                   01058
.GEN1    ANOP                                                           01059
         ORG   CASEI&DOCNO(&DOCLVL)+&SYSLIST(&M)                        01060
         DC    AL1(&CASENO(&DOCLVL)*4)                                  01061
         AGO   .MLOOP                                                   01062
.GENL    ANOP                                                           01063
         ORG                                                            01064
DC&DOCNO(&DOCLVL)C&CASENO(&DOCLVL) DS 0H                                01065
         MEXIT                                                          01066
.ERR1    MNOTE 8,'CASE - MISSING DOCASE'                                01067
         MEXIT                                                          01068
.ERR2    MNOTE 8,'CASE - INVALID OPERAND'                               01069
         MEXIT                                                          01070
.ERR3    MNOTE 8,'CASE - DUPLICATE ELSE CASE'                           01071
         MEXIT                                                          01072
.ERR4    MNOTE 8,'CASE - MORE THAN 2 SUBLIST OPERANDS'                  01073
         MEXIT                                                          01074
.ERR5    MNOTE 8,'CASE - OPERAND NOT SELF DEFINING TERM'                01075
         MEXIT                                                          01076
.ERR6    MNOTE 8,'CASE - OPERAND NOT IN RANGE 1-255'                    01077
         MEXIT                                                          01078
.ERR7    MNOTE 8,'CASE - MAXIMUM OF 63 CASES EXCEEDED'                  01079
         MEXIT                                                          01080
         MEND                                                           01081
         MACRO                                                          01082
&N       ESAC                                                           01083
         GBLA  &DOCLVL,&DOCNO(10),&CASENO(10),&DOCELSE(10),&DOCNT       01084
.*             AUTHOR.   DON HIGGINS.                                   01085
.*             DATE.     07/02/74.                                      01086
.*             REMARKS.  SELECTION CONTROL STRUCTURE.                   01087
.*                       SEE DOCASE, CASE, ESAC, AND ESACOD.            01088
.*                       SEE 'STRUCTURED FORTRAN TRANSLATOR' IN         01089
.*                       IN 1975 FEBRUARY ACM SIGPLAN NOTICES.          01090
&N       B     DC&DOCNO(&DOCLVL).END                                    01091
         MEND                                                           01092
         MACRO                                                          01093
         ESACOD                                                         01094
         GBLA  &DOCLVL,&DOCNO(10),&CASENO(10),&DOCELSE(10),&DOCNT       01095
.*             AUTHOR.   DON HIGGINS.                                   01096
.*             DATE.     07/02/74.                                      01097
.*             REMARKS.  SELECTION CONTROL STRUCTURE.                   01098
.*                       SEE DOCASE, CASE, ESAC, AND ESACOD.            01099
.*                       SEE 'STRUCTURED FORTRAN TRANSLATOR' IN         01100
.*                       IN 1975 FEBRUARY ACM SIGPLAN NOTICES.          01101
         LCLA  &C                                                       01102
         AIF   (&DOCLVL LT 1).ERR1                                      01103
CASEA&DOCNO(&DOCLVL) DS 0F                                              01104
         AIF   (&DOCELSE(&DOCLVL) GT 0).GENELSE                         01105
         DC    A(DC&DOCNO(&DOCLVL).END)                                 01106
         AGO   .GENCASE                                                 01107
.GENELSE ANOP                                                           01108
         DC    A(DC&DOCNO(&DOCLVL).ELSE)                                01109
.GENCASE ANOP                                                           01110
&C       SETA  &C+1                                                     01111
         AIF   (&C GT &CASENO(&DOCLVL)).GEND                            01112
         DC    A(DC&DOCNO(&DOCLVL).C&C)                                 01113
         AGO   .GENCASE                                                 01114
.GEND    ANOP                                                           01115
DC&DOCNO(&DOCLVL).END EQU *                                             01116
&DOCLVL SETA &DOCLVL-1                                                  01117
         MEXIT                                                          01118
.ERR1    MNOTE 8,'ESACOD - MISSING DOCASE'                              01119
         MEND                                                           01120
         MACRO                                                          01121
&NAME    LOGICAL                                                        01122
.*             PGMID.    LOGICAL VARIABLE DEFINITION AND ENUMERATION    01123
.*             AUTHOR.   DON HIGGINS.                                   01124
.*             DATE.     09/27/74.                                      01125
.*             REMARKS.  DEFINES A LOGICAL VARIABLE AS A ONE BYTE       01126
.*                       AL1 FIELD WITH AN INITIAL VALUE AND STORES     01127
.*                       IN GLOBAL TABLE POSSIBLE VALUES BY NAME.       01128
.*                       ALL NAMES ARE EQUATED TO UNIQUE VALUES FOR     01129
.*                       USE IN TEST AND SET STATEMENTS.                01130
         GBLC  &LOGICN(100)                                             01131
         GBLA  &LOGICV                                                  01132
         LCLA  &N,&S,&SL                                                01133
&N       SETA  N'&SYSLIST(2)                                            01134
.L1      ANOP                                                           01135
&S       SETA  &S+1                                                     01136
         AIF   (&S GT &N).GENDC                                         01137
&SL      SETA  0                                                        01138
.L2      ANOP                                                           01139
&SL      SETA  &SL+1                                                    01140
         AIF   (&SL GT &LOGICV).GENEQU                                  01141
         AIF   ('&SYSLIST(2,&S)' EQ '&LOGICN(&SL)').L1                  01142
         AGO   .L2                                                      01143
.GENEQU  ANOP                                                           01144
&LOGICV  SETA  &LOGICV+1                                                01145
&LOGICN(&LOGICV) SETC '&SYSLIST(2,&S)'                                  01146
&SYSLIST(2,&S) EQU &LOGICV                                              01147
         AGO   .L1                                                      01148
.GENDC   ANOP                                                           01149
&NAME    DC    AL1(&SYSLIST(1))                                         01150
         MEND                                                           01151
         MACRO                                                          01152
&VLABEL  DCWV  &VNAME                                                   01153
.*             AUTHOR.   DON HIGGINS.                                   01154
.*             DATE.     11/03/74.                                      01155
.*             REMARKS.  DEFINE VERY WEAK V TYPE ADDRESS WHICH IS       01156
.*                       SET BY DYNAMICALLY LOADING NAMED MODULE        01157
.*                       THE FIRST TIME THE V ADDRESS IS USED.          01158
DCWV&SYSNDX DS 0H                                                       01159
         USING DCWV&SYSNDX,R15     ENTER HERE ON FIRST USE OF VLABEL    01160
         STM   R14,R2,&VLABEL+12   SAVE REGS USED BY LOAD               01161
         LR    R2,R15              NEW BASE                             01162
         DROP  R15                                                      01163
         USING DCWV&SYSNDX,R2                                           01164
         FINDCDE EPLOC=&VLABEL+4                                        01165
         IF    (LTR,R1,R1,Z)                                            01166
               LOAD EPLOC=&VLABEL+4                                     01167
         ELSE                                                           01168
               L    R0,16(R1) GET CDE ENTRY                             01169
         FI                                                             01170
         ST    R0,&VLABEL          STORE ENTRY POINT IN VLABEL          01171
         LR    R15,R0              SET R15 TO CORRECT ENTRY POINT       01172
         L     R14,&VLABEL+12      RESTORE REGS                         01173
         LM    R0,R2,&VLABEL+20                                         01174
         BR    R15                 ENTER VNAME FIRST TIME               01175
&VLABEL  DC    A(DCWV&SYSNDX)      VERY WEAK V ADDRESS                  01176
         DC    CL8'&VNAME'         NAME OF MODULE                       01177
         DC    5F'0'               SAVE AREA                            01178
         MEND                                                           01179
         MACRO                                                          01180
&N       LOADTCB &R                                                     01181
&N       L     &R,16     CVT                                            01182
         L     &R,0(&R)  TCB WORDS                                      01183
         L     &R,4(&R)  TCB                                            01184
         MEND                                                           01185
         MACRO                                                          01186
&N       LOADTIOT &R                                                    01187
&N       LOADTCB &R                                                     01188
         L     &R,12(&R) TIOT ADDRESS FROM TCB                          01189
         MEND                                                           01190
         MACRO                                                          01191
&N       FINDDD &DDNAME                                                 01192
.*             AUTHOR.   DON HIGGINS.                                   01193
.*             DATE.     11/06/74.                                      01194
.*             REMARKS.  SET R1 TO ADDRESS OF TIOT DDNAME ENTRY OR 0.   01195
.*             EXAMPLE.  FINDDD =CL8'CALLLIB'                           01196
&N       LOADTIOT R14                                                   01197
         AAI   R14,24                                                   01198
         LA    R15,&DDNAME                                              01199
         ZR    R0                                                       01200
         ZR    R1                                                       01201
         IC    R0,0(R14)                                                01202
         DO    WHILE,(LTR,R0,R0,P)                                      01203
               IF   (CLC,4(8,R14),0(R15),EQ)                            01204
                    LR   R1,R14                                         01205
                    ZR   R0                                             01206
               ELSE                                                     01207
                    AR   R14,R0                                         01208
                    IC   R0,0(R14)                                      01209
               FI                                                       01210
         OD                                                             01211
         MEND                                                           01212
         MACRO                                                          01213
&NAME    ACCEPT &REC,&DDNAME=SYSIN                                      01214
.*             AUTHOR.   DON HIGGINS.                                   01215
.*             DATE.     11/19/74.                                      01216
.*             REMARKS.  ACCEPT RECORD IF DD AVAILABLE.                 01217
.*                       REC MAY GE REGISTER OR LABEL OF RECORD AREA.   01218
.*                      R15=0 SUCCESSFUL READ.                          01219
.*                      R15=4 EOF OR NO DD FOUND.                       01220
&NAME    TAG                                                            01221
ACC1&SYSNDX B  *+4                                                      01222
         FINDDD =CL8'&DDNAME'                                           01223
         IF    (LTR,R1,R1,Z)                                            01224
               WTO  '&DDNAME NOT FOUND'                                 01225
ACC2&SYSNDX    LA   R15,4                                               01226
               MVC  ACC1&SYSNDX+2(2),=S(ACC2&SYSNDX)                    01227
               B    ACC4&SYSNDX                                         01228
         FI                                                             01229
         MVC   ACC1&SYSNDX+2(2),=S(ACC3&SYSNDX)                         01230
         OPEN  (&DDNAME)                                                01231
         B     ACC3&SYSNDX                                              01232
&DDNAME  DCB   DSORG=PS,MACRF=GL,DDNAME=&DDNAME,EODAD=ACC2&SYSNDX       01233
ACC3&SYSNDX GET &DDNAME                                                 01234
         AIF   ('&REC'(1,1) EQ '(').REG                                 01235
         MVC   &REC,0(R1)                                               01236
         ZR    R15                                                      01237
         AGO   .EXIT                                                    01238
.REG     ANOP                                                           01239
         LR    &REC,R1                                                  01240
         ZR    R15                                                      01241
.EXIT    ANOP                                                           01242
ACC4&SYSNDX TAG                                                         01243
         MEND                                                           01244
         MACRO                                                          01245
&NAME    DISPLAY &REC,&DDNAME=SYSOUT,&RECFM=FA,&BLKSIZE=133             01246
.*             AUTHOR.   DON HIGGINS.                                   01247
.*             DATE.     11/18/74.                                      01248
.*             REMARKS.  DISPLAY RECORD IF DD AVAILABLE.                01249
.*                       REC MAY BE REGISTER OR LABEL OF REC.           01250
.*                      R15=0 IS SUCCESSFUL                             01251
.*                      R15=4 NO DD FOUND                               01252
&NAME    TAG                                                            01253
DSP1&SYSNDX B  *+4                                                      01254
         FINDDD =CL8'&DDNAME'                                           01255
         IF    (LTR,R1,R1,Z)                                            01256
               WTO  '&DDNAME NOT FOUND'                                 01257
               MVC  DSP1&SYSNDX+2(2),=S(DSP2&SYSNDX)                    01258
DSP2&SYSNDX    LA   R15,4                                               01259
               B    DSP4&SYSNDX                                         01260
         FI                                                             01261
         MVC   DSP1&SYSNDX+2(2),=S(DSP3&SYSNDX)                         01262
         OPEN  (&DDNAME,(OUTPUT))                                       01263
         B     DSP3&SYSNDX                                              01264
&DDNAME  DCB   DSORG=PS,MACRF=PM,DDNAME=&DDNAME,                       X01265
               RECFM=&RECFM,BLKSIZE=&BLKSIZE                            01266
DSP3&SYSNDX TAG                                                         01267
         AIF   ('&REC'(1,1) EQ '(').REG                                 01268
         LA    R0,&REC                                                  01269
         AGO   .PUT                                                     01270
.REG     ANOP                                                           01271
         LR    R0,&REC                                                  01272
.PUT     ANOP                                                           01273
         PUT   &DDNAME                                                  01274
         ZR    R15                                                      01275
DSP4&SYSNDX TAG                                                         01276
         MEND                                                           01277
         MACRO                                                          01278
&N      TPPUTMSG &TERM,&MSG,&LMSG                                       01279
.*             AUTHOR.   DON HIGGINS.                                   01280
.*             DATE.     11/27/74.                                      01281
.*             REMARKS.  ROUTE TERMINAL MESSAGE TO TPPUT.               01282
.*                            TERM - TERMINAL NAME FIELD OR LITERAL     01283
.*                            MSG  - MESSAGE FIELD OR LITERAL           01284
.*                            LMSG - FULL WORD BINARY LENGTH (OPTIONAL) 01285
         LCLA  &L                                                       01286
         CNOP  0,4                                                      01287
&N       BAL   1,*+16                                                   01288
.CHKT1   AIF   ('&TERM'(1,1) EQ '''').TERMLIT                           01289
         DC    A(&TERM)                                                 01290
         AGO   .CHKM1                                                   01291
.TERMLIT ANOP                                                           01292
         DC    A(0)                                                     01293
.CHKM1   AIF   ('&MSG'(1,1) EQ '''').MSGLIT                             01294
         DC    A(&MSG)                                                  01295
         AGO   .CHKL                                                    01296
.MSGLIT  ANOP                                                           01297
         DC    A(0)                                                     01298
.CHKL    AIF   (T'&LMSG EQ 'O').LCALC                                   01299
         DC    A(&LMSG)                                                 01300
         AGO   .CHKT2                                                   01301
.LCALC   ANOP                                                           01302
         DC    A(0)                                                     01303
         AIF   ('&MSG'(1,1) EQ '''').LCALCL                             01304
&L       SETA  L'&MSG                                                   01305
         LA    0,=A(&L)                                                 01306
         ST    0,8(1)                                                   01307
         AGO   .CHKT2                                                   01308
.LCALCL  ANOP                                                           01309
&L       SETA  K'&MSG-2                                                 01310
         LA    0,=A(&L)                                                 01311
         ST    0,8(1)                                                   01312
.CHKT2   AIF   ('&TERM'(1,1) NE '''').CHKM2                             01313
         LA    0,=C&TERM                                                01314
         ST    0,0(1)                                                   01315
         AGO   .CALL                                                    01316
.CHKM2   AIF   ('&MSG'(1,1) NE '''').CALL                               01317
         LA    0,=C&MSG                                                 01318
         ST    0,4(1)                                                   01319
.CALL    ANOP                                                           01320
         L     15,=V(TPPUT)                                             01321
         BALR  14,15                                                    01322
         MEND                                                           01323
         MACRO                                                          01324
&N       TRTTAB &TYPE,&BAD=X'FF',&GOOD=X'00',&SKIP=,&FIND=,&FILL=C' '   01325
         AIF   ('&TYPE' EQ 'PRINT').PRINT                               01326
         AIF   ('&TYPE' EQ 'NUMERIC').NUMERIC                           01327
         AIF   ('&TYPE' EQ 'ALPHA').ALPHA                               01328
         AIF   ('&TYPE' EQ 'ALPHANUM').ALPHAN                           01329
         AIF   ('&TYPE' EQ 'ZFILL').ZFILL                               01330
         AIF   ('&TYPE' EQ 'BAD').BAD                                   01331
         AIF   ('&TYPE' EQ 'GOOD').GOOD                                 01332
         AIF   ('&TYPE' EQ 'SCAN').SCAN                                 01333
         MNOTE 8,'TABLE TYPE INVALID'                                   01334
         MEXIT                                                          01335
.PRINT   ANOP                                                           01336
&N       DC    (X'49'-X'00'+1)&FILL                                     01337
         DC    (X'50'-X'4A'+1)AL1(*-&N)                                 01338
         DC    (X'59'-X'51'+1)&FILL                                     01339
         DC    (X'61'-X'5A'+1)AL1(*-&N)                                 01340
         DC    (X'6A'-X'62'+1)&FILL                                     01341
         DC    (X'6F'-X'6B'+1)AL1(*-&N)                                 01342
         DC    (X'79'-X'70'+1)&FILL                                     01343
         DC    (X'7F'-X'7A'+1)AL1(*-&N)                                 01344
         DC    (X'C0'-X'80'+1)&FILL                                     01345
         DC    (X'C9'-X'C1'+1)AL1(*-&N)                                 01346
         DC    (X'D0'-X'CA'+1)&FILL                                     01347
         DC    (X'D9'-X'D1'+1)AL1(*-&N)                                 01348
         DC    (X'E1'-X'DA'+1)&FILL                                     01349
         DC    (X'E9'-X'E2'+1)AL1(*-&N)                                 01350
         DC    (X'EF'-X'EA'+1)&FILL                                     01351
         DC    (X'F9'-X'F0'+1)AL1(*-&N)                                 01352
         DC    (X'FF'-X'FA'+1)&FILL                                     01353
         MEXIT                                                          01354
.NUMERIC ANOP                                                           01355
&N       DC    240&BAD,10&GOOD,6&BAD                                    01356
         MEXIT                                                          01357
.ALPHA   ANOP                                                           01358
&N       DC    193&BAD,9&GOOD,7&BAD,9&GOOD,8&BAD,8&GOOD                 01359
         DC    22&BAD                                                   01360
         MEXIT                                                          01361
.ALPHAN  ANOP                                                           01362
&N       DC    193&BAD,9&GOOD,7&BAD,9&GOOD,8&BAD,8&GOOD                 01363
         DC    6&BAD,10&GOOD,6&BAD                                      01364
         MEXIT                                                          01365
.ZFILL   ANOP                                                           01366
&N       DC    64AL1(*-&N),C'0',191AL1(*-&N)                            01367
         MEXIT                                                          01368
.BAD     ANOP                                                           01369
&N       DC    256&BAD                                                  01370
         MEXIT                                                          01371
.GOOD    ANOP                                                           01372
&N       DC    256&GOOD                                                 01373
         MEXIT                                                          01374
.SCAN    ANOP                                                           01375
         AIF   (T'&SKIP NE 'O').SKIP                                    01376
         AIF   (T'&FIND NE 'O').FIND                                    01377
         MNOTE 8,'TRT SCAN SKIP OR FIND CHARACTER NOT FOUND'            01378
         MEXIT                                                          01379
.SKIP    ANOP                                                           01380
&N       DC    256&BAD                                                  01381
         ORG   &N+&SKIP                                                 01382
         DC    &GOOD                                                    01383
         ORG                                                            01384
         MEXIT                                                          01385
.FIND    ANOP                                                           01386
&N       DC    256&GOOD                                                 01387
         ORG   &N+&FIND                                                 01388
         DC    &BAD                                                     01389
         ORG                                                            01390
         MEXIT                                                          01391
         MEND                                                           01392
         MACRO                                                          01393
&N       PTRACE &DDNAME=PTRACE                                          01394
.*             AUTHOR.   DON HIGGINS.                                   01395
.*             DATE.     01/06/75.                                      01396
.*             REMARKS.  GENERATE TRACE OF EACH PENTRY NAME ENTERED.    01397
.*                       THIS MACRO SHOULD BE PLACED AS FIRST           01398
.*                       EXECUTABLE STATEMENT IN PROGRAM.               01399
.*                       REMOVE AFTER TESTING TO ELIMINATE OVERHEAD.    01400
         GBLB  &PTRACE                                                  01401
         GBLC  &PTNAME                                                  01402
&PTRACE  SETB  1                                                        01403
&PTNAME  SETC  'PENT&SYSNDX'                                            01404
&N       B     PEND&SYSNDX                                              01405
         B     *+4                                                      01406
PENT&SYSNDX  EQU *                                                      01407
         STM   R14,R1,PSAV&SYSNDX                                       01408
         MVC   *+6+2(2),PENT&SYSNDX-2                                   01409
         LA    R1,*-*                                                   01410
         SH    R1,=H'24'                                                01411
         MVC   PMSG&SYSNDX+1(8),0(R1)                                   01412
         DISPLAY PMSG&SYSNDX,DDNAME=&DDNAME                             01413
         LM    R14,R1,PSAV&SYSNDX                                       01414
         B     PENT&SYSNDX-4                                            01415
PMSG&SYSNDX DC CL133' '                                                 01416
PSAV&SYSNDX DC 4F'0'                                                    01417
PEND&SYSNDX EQU *                                                       01418
         MEND                                                           01419
         MACRO                                                          01420
&N       FINDCDE &EP=0,&EPLOC=0                                         01421
.*             AUTHOR.   DON HIGGINS.                                   01422
.*             DATE.     01/10/75.                                      01423
.*             REMARKS.  SET R1 TO CDE ADDRESS OR ZERO                  01424
         AIF   ('&EP'(1,1) EQ '0').EPLOC                                01425
.EP      ANOP                                                           01426
         BAL   R14,*+12                                                 01427
         DC    CL8'&EP'                                                 01428
         AGO   .FIND                                                    01429
.EPLOC   ANOP                                                           01430
         LA    R14,&EPLOC                                               01431
.FIND    ANOP                                                           01432
         LOADTCB R15                                                    01433
         ZR    R1                                                       01434
         L     R15,36(R15) TCBLLS FE PG 289                             01435
         DO    WHILE,(LTR,R15,R15,NZ)                                   01436
               L    R1,4(R15)      LLE CDE ADDRESS FE PG 280            01437
               IF   (CLC,8(8,R1),0(R14),EQ)                             01438
                    ZR   R15                                            01439
               ELSE                                                     01440
                    L    R15,0(R15)                                     01441
                    ZR   R1                                             01442
               FI                                                       01443
         OD                                                             01444
         MEND                                                           01445
         MACRO                                                          01446
&N       DOEXIT                                                         01447
         GBLA  &DO(10),&DOSEQ(10),&DOLVL,&DOLAB                         01448
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           01449
.*             AUTHOR.   DON HIGGINS.                                   01450
.*             DATE.     01/29/75.                                      01451
.*             REMARKS.  EXIT TO END OF CURRENT DO LOOP.                01452
         AIF   (&DOLVL EQ 0).ERR1                                       01453
         B     IF0&ELSE(&LEVEL)                                         01454
         MEXIT                                                          01455
.ERR1    MNOTE 8,'DOEXIT NOT WITHIN DO LOOP'                            01456
         MEND                                                           01457
         MACRO                                                          01458
&N       HDC   &HLINE,&HCOL,&HDATA                                      01459
         ORG   &HLINE+&HCOL                                             01460
         AIF   (T'&HDATA EQ 'O').EXIT                                   01461
&N       DC    &HDATA                                                   01462
.EXIT    ANOP                                                           01463
         MEND                                                           01464
         MACRO                                                          01465
&N       ABSP  &P                                                       01466
         LCLA  &LP                                                      01467
&LP      SETA  L'&P                                                     01468
&N       OI    &P+&LP-1,X'0F' MAKE PACKED FIELD POSITIVE                01469
         MEND                                                           01470
         MACRO                                                          01471
         XVBT3C                                                         01472
CLGDSECT DSECT                                                          01473
*              AUTHOR.   DON HIGGINS.                                   01474
*              DATE.     04/04/75.                                      01475
*              REMARKS.  RECORD CREATED BY GETCATLG (GU027000).         01476
CLGVOL   DS    CL6       VOLUME                                         01477
CLGDSN   DS    CL44      DATA SET NAME, CONNECT, INDEX, ALIAS, ETC.     01478
CLGTYP   DS    CL1       1-DSN,2-CONNX,3-GDS,4-ALIAS,5-INDEX            01479
CLGDEV   DS    XL4       DEVICE CODE                                    01480
CLGDSNSQ DS    XL2       DATA SET SEQUENCE                              01481
CLGVOLSQ DS    XL2       VOLUME SEQUENCE                                01482
CLGGDSOP DS    BL1       X'02'-DELETE,X'01'-EMPTY OPTION                01483
CLGGDSMX DS    XL1       MAXIMUM GDS DATA SET COUNT                     01484
CLGGDSCR DS    XL2       CURRENT GDS DATA SET COUNT                     01485
         MEND                                                           01486
         MACRO                                                          01487
         QCBD                                                           01488
*                                                                       01489
*              ENQ/DEQ CONTROL BLOCKS  (SEE IEAVENQ1 IGC056)            01490
*                                                                       01491
*                                                                       01492
*              MAJOR QCB                                                01493
*                                                                       01494
QCBMAJ   DSECT                                                          01495
QMJNEXT  DS    A    NEXT MAJOR QCB                                      01496
QMJPREV  DS    A    PREVIOUS MAJOR QCB                                  01497
QMJMINOR DS    A    FIRST MINOR QCB                                     01498
QMJNAME  DS    CL8  MAJOR QCB NAME                                      01499
QMJLNE   EQU   *-QCBMAJ                                                 01500
*                                                                       01501
*              MINOR QCB                                                01502
*                                                                       01503
QCBMIN   DSECT                                                          01504
QMNQEL   DS    A    FIRST QUEUE ELEMENT                                 01505
QMNPREV  DS    A    PREVIOUS MINOR QCB                                  01506
QMNNEXT  DS    A    NEXT MINOR QCB                                      01507
QMNLNM   DS    B    LENGTH OF RANME                                     01508
QMNLSQA  DS    X    TYPE OF ENG                                         01509
QMNSYS   EQU   255                                                      01510
QMNSYSMS EQU   254                                                      01511
*                   ANY OTHER VALUE IS STEP (TCBLSQA VALUE)             01512
QMNNAME  DS    C                                                        01513
*                                                                       01514
*              QUEUE ELEMENT                                            01515
*                                                                       01516
QEL      DSECT                                                          01517
QELNQEL  DS    A    NEXT QEL                                            01518
QELSMC   EQU   QELNQEL       MUST COMPLETE INDICATORS                   01519
QELSYSMC EQU   X'20'     SYSTEM MUST COMPLETE                           01520
QELSTPMC EQU   X'10'     STEP MUST COMPLETE                             01521
QELLQEL  DS    A    PREVIOUS QEL                                        01522
QELCODE  EQU   QELLQEL   TYPE OF REQUEST                                01523
QELSHAR  EQU   X'80'     SHARED                                         01524
QELRESV  EQU   X'40'     RESERVED                                       01525
QELRBWT  EQU   X'20'     DEFER SVRB PROCESSING UNTIL SWAP               01526
QELNQECB EQU   X'10'     ENQ WITH ECB FOR WAIT                          01527
QELRLSE  EQU   X'08'     DELAYED RELEASE                                01528
QELEXCP  EQU   X'04'     EXCP INITIATED TO RELEASE DEVICE               01529
QELSTAT  EQU   X'02'     STATUS SET PENDING                             01530
QELABND  EQU   X'01'     QEL FOR TASK IN ABEND                          01531
QELTCB   DS    A    TCB FOR ENQ                                         01532
QELTJID1 EQU   QELTCB    FIRST BYTE OF TSO USER ID                      01533
QELSVRB  DS    A    SVRB/UCB FOR ENQ                                    01534
QELTJID2 EQU   QELSVRB   SECOND BYTE OF TSO USER ID                     01535
         MEND                                                           01536
         MACRO                                                          01537
&N       SDCB  &M=PM,&R=FBA,&L=133,&B=0,&E=1                            01538
.*             AUTHOR.   DON HIGGINS.                                   01539
.*             DATE.     09/29/75.                                      01540
.*             REMARKS.  SHORT FORM OF COMMONLY USED DCB WITH EXIT TO   01541
.*                       PLUG ZERO BLKSIZE WITH LRECL.                  01542
         DS    0A                                                       01543
         DC    X'85',AL3(*+3) DCB EXIT LIST                             01544
         OC    62(2,1),62(1)       IS BLKSIZE = 0                       01545
         BCR   7,14                NO, EXIT NOW                         01546
         MVC   62(2,1),82(1)       YES, BLKSIZE=LRECL                   01547
         BR    14                  EXIT                                 01548
         DC    CL8'&N'        DCB NAME FOR DUMP VERIFICATION            01549
&N       DCB   EXLST=&N-28,DSORG=PS,DDNAME=&N,                         X01550
               MACRF=&M,RECFM=&R,LRECL=&L,BLKSIZE=&B,EODAD=&E           01551
         MEND                                                           01552
         MACRO                                                          01553
         ELSEIF                                                         01554
         GBLA  &ELSE(10),&SEQ(10),&LEVEL,&LAB                           01555
         GBLA  &ELSEIF(10)                                              01556
         LCLA  &N,&M,&S,&LAB1,&L,&I                                     01557
         LCLC  &OP,&OPR                                                 01558
         LCLB  &TESTSW                                                  01559
.*             AUTHOR.   DON HIGGINS.                                   01560
.*             DATE.     05/23/76.                                      01561
.*             REMARKS.  CONTROL STRUCTURE FOR CONDITIONAL EXECUTION.   01562
         AIF   (&LEVEL EQ 10).ERR1                                      01563
         ELSE                                                           01564
&LEVEL   SETA  &LEVEL+1                                                 01565
&ELSEIF(&LEVEL) SETA 1                                                  01566
&SEQ(&LEVEL) SETA 1                                                     01567
&LAB     SETA  &LAB+1                                                   01568
&ELSE(&LEVEL) SETA &LAB                                                 01569
&N       SETA N'&SYSLIST                                                01570
.NEXTAND ANOP                                                           01571
&TESTSW  SETB  0                                                        01572
.TEST    ANOP                                                           01573
&S       SETA  &S+1                                                     01574
         AIF   (&S GT &N).ERR2                                          01575
&M       SETA  N'&SYSLIST(&S)                                           01576
         AIF   (&M EQ 1).TESTEND                                        01577
         AIF   (&M LT 2).ERR3                                           01578
         AIF   (&M GT 5).ERR4                                           01579
&I       SETA  2                                                        01580
&OPR     SETC  ''                                                       01581
&OP      SETC  '&SYSLIST(&S,1)'                                         01582
         AIF   (&M GT 2).TESTOPR                                        01583
         &OP                                                            01584
         AGO   .TESTEND                                                 01585
.TESTOPR ANOP                                                           01586
         AIF   ('&SYSLIST(&S,&I)'(1,1) NE '''').NOLIT                   01587
&L       SETA  K'&SYSLIST(&S,&I)                                        01588
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'(2,&L-2)                         01589
         AGO   .NEXTOPR                                                 01590
.NOLIT   ANOP                                                           01591
&OPR     SETC  '&OPR'.'&SYSLIST(&S,&I)'                                 01592
.NEXTOPR ANOP                                                           01593
&I       SETA  &I+1                                                     01594
         AIF   (&I EQ &M).TESTGEN                                       01595
&OPR     SETC  '&OPR'.','                                               01596
         AGO   .TESTOPR                                                 01597
.TESTGEN ANOP                                                           01598
         &OP   &OPR                                                     01599
.TESTEND ANOP                                                           01600
         AIF   (&TESTSW EQ 1).ORBC                                      01601
.AMBC    ANOP                                                           01602
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               01603
.CONNECT ANOP                                                           01604
&S       SETA  &S+1                                                     01605
         AIF   (&S GT &N).EXIT                                          01606
&M       SETA  N'&SYSLIST(&S)                                           01607
         AIF   (&M NE 1).ERR5  BAD CONNECTOR                            01608
         AIF   ('&SYSLIST(&S)' EQ 'AND').NEXTAND                        01609
         AIF   ('&SYSLIST(&S)' NE 'OR').ERR5  BAD CONNECTOR             01610
.NEXTOR   ANOP                                                          01611
&LAB1    SETA  &LAB+1                                                   01612
         B     IF0&LAB1  SKIP TEST IF LAST ONE TRUE                     01613
IF0&LAB   EQU *          DO TEST IF LAST ONE FALSE                      01614
&LAB     SETA  &LAB+2                                                   01615
&ELSE(&LEVEL) SETA &LAB                                                 01616
&TESTSW  SETB  1                                                        01617
         AGO   .TEST                                                    01618
.ORBC    ANOP                                                           01619
         BC    15-&SYSLIST(&S,&M),IF0&LAB                               01620
IF0&LAB1 EQU *                                                          01621
         AGO   .CONNECT                                                 01622
.ERR1    MNOTE 8,'IF - LEVEL OVERFLOW'                                  01623
         AGO   .EXIT                                                    01624
.ERR2    MNOTE 8,'IF - MISSING TEST LIST'                               01625
         AGO   .EXIT                                                    01626
.ERR3    MNOTE 8,'IF - TEST LIST TOO SHORT'                             01627
         AGO   .EXIT                                                    01628
.ERR4    MNOTE 8,'IF - TEST LIST TOO LONG'                              01629
         AGO   .EXIT                                                    01630
.ERR5    MNOTE 8,'IF - INVALID CONNECTOR'                               01631
.EXIT    ANOP                                                           01632
         MEND                                                           01633
*          DATA SET CBT848     AT LEVEL 003 AS OF 10/02/77
*          DATA SET GU014300   AT LEVEL 007 AS OF 01/25/73              00001
GETPDSDE SUBENTRY                                                       00002
*              AUTHOR.   DON HIGGINS.                                   00003
*              DATE.     11/11/72.                                      00004
*              REMARKS.  GET NEXT DIRECTORY ENTRY NAME FROM PDS         00005
*                        DIRECTORY.                                     00006
*                                                                       00007
*                        ARGUMENTS                                      00008
*                                                                       00009
*                          1. ADDRESS OF DCB FOR PDS DIRECTORY. IT      00010
*                             MUST HAVE FOLLOWING CHARACTERISTICS AND   00011
*                             BE OPEN FOR INPUT WITH NO EDDAD           00012
*                                                                       00013
*                             PDSDCB DCB DSORG=PS,MACRF=GL,         X   00014
*                                        RECFM=F,BLKSIZE=256,       X   00015
*                                            LRECL=256                  00016
*                                        DDNAME=XXXXXXXX                00017
*                          2. ADDRESS OF END OF DIRECTORY ROUTINE       00018
*                                                                       00019
*                          3.  ADDRESS OF FULL WORD WHERE ADDRESS OF    00020
*                              NEXT DE ENTRY NAME WILL BE PLACED.       00021
*                                                                       00022
*                        THIS ROUTINE IS REUSEABLE AND MAY BE USED      00023
*                        TO READ SEVERAL DIRECTORIES CONCURRENTLY.      00024
*                                                                       00025
*                                                                       00026
         LM    R2,R4,0(R1)                                              00027
         USING IHADCB,R2                                                00028
         L     R5,DCBEODAD                                              00029
         TM    DCBEODAD+3,X'03'         IS IT ODD                       00030
         BZ    RELOAD                   NO, RELOAD LOD REGS             00031
         LA    R0,WKLENGTH                                              00032
         GETMAIN R,LV=(0)          NO,  GET WORKAREA                    00033
         LR    R5,R1                                                    00034
         USING WORKAREA,R5         R5=A(ADDR OF AREA SAVED IN EODAD)    00035
         ST    R5,WKADDR           PUT ADDRESS OF AREA IN AREA FOR MVC  00036
         XC    WKREGS,WKREGS       CLEAR AREA FOR WORK REGS             00037
RELOAD   TAG                                                            00038
         LM    R6,R9,WKREGS        RELOAD                               00039
         AR    R6,R9               R6=A(NEXT ENTRY)                     00040
TESTEOB  CR    R6,R7               IS IT END OF BLOCK                   00041
         BNL   NEXTBLK             YES, GET NEXT BLOCK                  00042
         CLI   0(R6),X'FF'              IS IT END OF DIRECTORY          00043
         BE    EOF                      YES, GO TO EOF                  00044
         ST    R6,0(R4)            STORE ADDRESS OF DE                  00045
         NI    11(R6),X'1F'        TURN OFF ALIAS AND POINT CNT BITS    00046
         IC    R8,11(R6)                                                00047
         LA    R9,12(R8,R8)        R9=12 + 2 X (HALF WORDS)             00048
         STM   R6,R9,WKREGS        SAVE WORK REGS                       00049
         SUBEXIT                                                        00050
NEXTBLK  TAG                                                            00051
         MVC   DCBEODAD+1(3),=AL3(EOF)  SET LOCAL EOF IN DCB            00052
         GET   (R2)                     GET NEXT BLOCK                  00053
         LR    R6,R1                    R6=A(BLOCK)                     00054
         MVC   WKREGS(2),0(R6)          ALIGN HALF WORK BLOCK LENGTH    00055
         LH    R9,WKREGS           R9=LENGTH OF BLOCK                   00056
         LA    R7,0(R6,R9)         R7=A(END OF BLOCK)                   00057
         LA    R6,2(R6)            R6=A(FIRST ENTRY)                    00058
         MVC   DCBEODAD+1(3),WKADDR+1   SAVE WORK AREA ADDR IN EODAD    00059
         B     TESTEOB                  PROCESS BLOCK                   00060
EOF      TAG                                                            00061
         MVC   DCBEODAD+1(3),=AL3(1) RESET EODAD                        00062
         LA    R0,WKLENGTH                                              00063
         LR    R1,R5                                                    00064
         FREEMAIN R,LV=(0),A=(1)        FREE WORKAREA                   00065
         L     R13,4(R13)                                               00066
         LM    R14,R12,12(R13)                                          00067
         L     R14,4(R1)                                                00068
         BR    R14                 EXIT TO EOF ADDRESS                  00069
         LTORG                                                          00070
         EQUREGS                                                        00071
         DCBD  DSORG=PS                                                 00072
WORKAREA DSECT                                                          00073
WKADDR   DS    F                   ADDRESS OF GETMAIN WORKAREA          00074
WKREGS   DS    0XL16                                                    00075
         DS    F                   R6=A(CURRENT DE)                     00076
         DS    F                   R7=A(END OF BLOCK)                   00077
         DS    F                   R8=INSERT WORK REG                   00078
         DS    F                   R9=LENGTH OF DE                      00079
WKLENGTH EQU   *-WORKAREA                                               00080
#PAN$AUD CSECT                                                          000804
$PAN#AUD DC    CL21'003CBT848    10/02/77'                              000805
         END   GETPDSDE                                                 00081
