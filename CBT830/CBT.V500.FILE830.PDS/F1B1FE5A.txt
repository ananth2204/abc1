Controlled TSO COMMAND output


The WW REXX routine

/* REXX TO ISSUE TSO COMMAND */
PARSE UPPER ARG COMMAND
IF SUBSTR(COMMAND,1,2)='WW' THEN EXIT
LISTTABL='TAB'TIME(S)    /* CREATE A UNIQUE TABLE NAME */
COMMAND=STRIP(COMMAND,'B',"")  /* REMOVE THE QUOTES */
COMMAND=STRIP(COMMAND,"B","")  /* FROM THE COMMAND */
ADDRESS ISPEXEC;
/* OPEN/CREATE THE TEMPORARY OUTPUT TABLE */
"TBOPEN "LISTTABL;
IF RC=8 THEN
"TBCREATE "LISTTABL" NAMES(TABLLINE)";
/* PERFORM COMMAND AND TRAP THE OUTPUT */
COMM = '"'COMMAND'"'
 L=OUTTRAP("LINES.")
 INTERPRET "ADDRESS TSO "COMM""
 L= OUTTRAP("OFF")
 IF RCÂ¬=0 THEN
  DO
 SAY 'INVALID TSO COMMAND 'COMMAND
 SIGNAL FINISHN
  END
 IF LINES.0=0 THEN
  DO
 SAY 'NO TSO OUTPUT WAS PRODUCED'
 SIGNAL FINISHN
  END
/* FILTER THE OUTPUT AND ADD TO THE TABLE */
 DO I = 1 TO LINES.0
                           /* LINES MAY BE ADDED HERE */
 TABLLINE = LINES.I        /* TO FILTER THE OUTPUT */
                           /* FOR SPECIFIC COMMANDS */
/* ADD THE VARIABLES INTO THE TABLE */
IF LENGTH(TABLLINE) > 75 THEN   /* IF LINE IS > 75 CHARS */
 DO
  TRUNC=SUBSTR(TABLLINE,76)
  TABLLINE=SUBSTR(TABLLINE,1,75)
"TBADD "LISTTABL" SAVE(TABLLINE)";
  TABLLINE=TRUNC
"TBADD "LISTTABL" SAVE(TABLLINE)";
  END
  ELSE
"TBADD "LISTTABL" SAVE(TABLLINE)";
 END
/* GET READY TO DISPLAY THE TABLE */
 MESSAGE ='MSG()';
 CURSOR='CURSOR()';
 CSRROW ='CSRROW(1)';
 "TBVCLEAR "LISTTABL;
 "TBTOP "LISTTABL;
  TABLLINE='*';
 "TBSARG "LISTTABL" NEXT NAMECOND(TABLLINE,EQ)";
  ZWINTTL=COMMAND         /* WINDOW TITLE */
 "ADDPOP ROW(-2) COLUMN(-1)";
  DO UNTIL RC = 8         /* DISPLAY THE TABLE UNTIL PF3/END ISSUED */
 "TBDISPL "LISTTABL" PANEL(WWPANEL)" MESSAGE CURSOR;
  END
 "REMPOP";
FINISHN:
 "TBEND "LISTTABL;        /* THE TABLE IS NOT SAVED t/
EXIT


The WWPANEL panel

)PANEL KEYLIST(ISRSAB,ISR)
)ATTR DEFAULT( ) FORMAT(MIX)
# TYPE(FP)
@ TYPE(NEF)
$ TYPE(LI)
)BODY WINDOW(76,21) CMD(ZCMD)

#Command ==>@Z

)MODEL ROWS(SCAN)
$Z
)INIT
.ZVARS = '(ZCMD TABLLINE)'
&ZCMD = "
)PROC
)END


David J Ainsworth
Systems Programmer
Scottish Provident (UK)                     c Xephon 1996

