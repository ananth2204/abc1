  VSAMCREA:MACRO();

/* Create a VSAM File using IDCAMS */

 dcl %work      init('');    /* Work Field               */
 dcl %work1     init('');    /* Work Field               */
 dcl %work2     init('');    /* Work Field               */
 dcl %work2a    init('');    /* Work Field               */
 dcl %work3     init('');    /* Work Field               */
 dcl %work3a    init('');    /* Work Field               */
 dcl %l         init('');    /* Work Field               */
 dcl %tempind   init('');    /* Filled in by INDEX Macro */
 dcl %tempdata  init('');
 dcl %tempclus  init('');
 DCL %SYSVSWK1  INIT('') EXT; /* Work Area for VSAM                  */


    %SYSVSWK1='';             /* Clear Work areas                    */
    %work='%list(1)';         /* Get DSID                            */
    %sysvsdsi='%work';        /* Save it here too                    */


 /* Create a unique symbolic containing the details for the VSAM
    data set.  This will be used to create the file if necessary */

 $dsidvs;

 DCL VSAMCNTL * REPLACE;
 DEFINE CLUSTER ( -
 %sysvswk1 %zvsamtxt )
EOF;
dcl printer printer *;
dcl idcams  prog
    sysprint writes printer
    sysin    reads  vsamcntl;

dcl passvsam prog      /* This NEVER works if the file was created */
    dummy    may write dummy;

dcl dummy    ds   dsn %zdsn sysda 0 tracks nodcb;

    run idcams;
    if idcams Â¬=0
    then do;
         signal error 3,'Failed to create %zdsn';
         run passvsam;
    end;
 END;
