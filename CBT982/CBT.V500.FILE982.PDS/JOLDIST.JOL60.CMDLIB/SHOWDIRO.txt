PUTGEM : MACRO (%PRJCAT=,%GEMLIB=,%NOPANEL,
%PASSWD=,%COPYMOD=,%SYSOUT=,%LINK,%TYPE=,%IMS=);
%TYPE=PLI;                   /* DEFAULT FOR ANZ */
DCL %LIB INIT '';
IF %SYSOUT = '' THEN %SYSOUT = 'X';
IF %PRJCAT= '' THEN DO;
    /* %PRJCAT = SUBSTR(SYSPREF,1,3); */
   %PRJCAT = 'GEM.SOURCE.CATALOG';  /* DEFAULT FOR AIR NZ   */
END;
IF %GEMLIB = '' THEN DO;
   %GEMLIB = 'GEN';
   %GEMLIB = 'GEM.%GEMLIB.SOURCE';  /* DEFAULT FOR AIR NZ  */
END;
DCL %GEMMOD INIT '';
IF %LIST(1) ¬= '' THEN %GEMMOD = '%LIST(1)';
IF %NOPANEL = '' THEN
PANEL ('                  JOL 3.3 GEMPLI')
  ('            ANY HIGHLIGHTED FIELD CAN BE CHANGED')
  ('            PROGRAM LANGUAGE TYPE ===>',TYPE,3,'%TYPE')
  ('            IMS PROGRAM REPLY Y OR N=>',IMS,1,'%IMS')
  ('            GEM MODULE ==============>',GEMMOD,12,'%GEMMOD')
  ('            COPY GROUP MODULE =======>',COPYMOD,48,'%COPYMOD')
  ('            SYSOUT CLASS ============>',SYSOUT,1,'%SYSOUT')
  ('            PROJECT CATALOGUE =======>',PRJCAT,44,'%PRJCAT')
  ('            GEM LIBRARY =============>',GEMLIB,44,'%GEMLIB')
  ('        *****************************************************');
IF %COPYMOD ¬= '' THEN %COPYMOD = '- CHGIN %COPYMOD';
IF %PASSWD ¬= '' THEN %PASSWD = '/(%PASSWD)';
DCL POLIB DS DSN &&GEM(%GEMMOD) SYSDA 5,2,2 CYLS FB 80,6080;
DCL GEMPRT SYSOUT %SYSOUT;
DCL GEMPARM * REPLACE;
- LIBRARY %GEMLIB
- PUT %GEMMOD,OUT=POLIB,PO
%COPYMOD
EOF;
GEM: DCL JQHGEM3 PROG NODYNAMS=1
POLIB WRITES POLIB
GEMPRJ READS %PRJCAT
SYSIN READS GEMPARM
SYSLIST WRITES GEMPRT
SYSPRINT WRITES GEMPRT;
RUN GEM;
IF GEM >= 12 THEN DO;
STOP 'COPY OF %GEMMOD FAILED .... CHECK LISTING FOR ERRORS';
END;
   DCL INSRC DS &&GEM(%GEMMOD) LIKE = POLIB;
   DCL OUTSRC DS DSN &&LVL(%GEMMOD) SYSDA 5,2,2 CYLS FB 80,19040;
   DCL LVLPRT SYSOUT %SYSOUT ;
  LVLS:DCL LVLS PROG
      GEMSRC READS INSRC
      UPDTSRC WRITES OUTSRC
      SYSPRINT WRITES LVLPRT;
      RUN LVLS;
    IF (LVLS¬=0) THEN DO;
          STOP 'FLASHER UPDATE OF SOURCE FAILED';
    END;
    IF %IMS='Y' & %TYPE='ASM' THEN DO;
          IMSASM '&&LVL(%GEMMOD)' SOUT %SYSOUT LINK NAME %GEMMOD;
    END;
    IF %IMS='Y' & %TYPE='PLI' THEN DO;
          IMSPLI '&&LVL(%GEMMOD)' SOUT %SYSOUT LINK NAME %GEMMOD;
    END;
   IF %TYPE='ASM' & %IMS='N' THEN DO;
      ASMANZ '&&LVL(%GEMMOD)' SYSOUT %SYSOUT LINK NAME %GEMMOD;
   END;
   IF %TYPE='PLI' & %IMS='N' THEN DO;
      PLIANZ '&&LVL(%GEMMOD)'  LINK
      SYSOUT %SYSOUT;
      END;
   IF %TYPE='COB' THEN DO;
      COBANZ '&&LVL(%GEMMOD)'  LINK
      SYSOUT %SYSOUT;
   END;
   IF %TYPE='FOR' THEN DO;
      FORANZ '&&LVL(%GEMMOD)' LINK SYSOUT %SYSOUT;
   END;
END;
